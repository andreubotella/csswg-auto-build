<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>CSS Anchor Positioning</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
  <meta content="Bikeshed version e8a706a4b, updated Fri Jul 15 11:08:03 2022 -0700" name="generator">
  <link href="https://drafts.csswg.org/css-anchor-1/" rel="canonical">
  <link href="https://drafts.csswg.org/csslogo.ico" rel="icon">
  <meta content="80c9657be45158e255a3a8b5f0ccf90c97e63c5a" name="document-revision">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-issues */

a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-wpt */

:root {
    --wpt-border: hsl(0, 0%, 60%);
    --wpt-bg: hsl(0, 0%, 95%);
    --wpt-text: var(--text);
    --wptheading-text: hsl(0, 0%, 30%);
}
@media (prefers-color-scheme: dark) {
    :root {
        --wpt-border: hsl(0, 0%, 30%);
        --wpt-bg: var(--borderedblock-bg);
        --wpt-text: var(--text);
        --wptheading-text: hsl(0, 0%, 60%);
    }
}
.wpt-tests-block {
    list-style: none;
    border-left: .5em solid var(--wpt-border);
    background: var(--wpt-bg);
    color: var(--wpt-text);
    margin: 1em auto;
    padding: .5em;
}
.wpt-tests-block summary {
    color: var(--wptheading-text);
    font-weight: normal;
    text-transform: uppercase;
}
.wpt-tests-block summary::marker{
    color: var(--wpt-border);
}
.wpt-tests-block summary:hover::marker{
    color: var(--wpt-text);
}
/*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
.wpt-tests-block:not([open]){
    padding: 0;
    border: none;
    background: none;
    font-size: 0.75em;
    line-height: 1;
    position: relative;
    margin: 1em 0 0;
}
.wpt-tests-block:not([open]) summary {
    position: absolute;
    right: 0;
    bottom: 0;
}
/*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
.wpt-tests-block:not([open]):last-child {
    padding-bottom: 1px;
    margin-bottom: -1px;
}
/*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
li:not(:last-child) > .wpt-tests-block:not([open]):last-child,
dd:not(:last-child) > .wpt-tests-block:not([open]):last-child {
    padding-bottom: 0;
    margin-bottom: 0;
}
.wpt-tests-block:not([open]):not(:hover){
    opacity: 0.5;
}
.wpt-tests-list {
    list-style: none;
    display: grid;
    margin: 0;
    padding: 0;
    grid-template-columns: 1fr max-content auto auto;
    grid-column-gap: .5em;
}
.wpt-tests-block hr:last-child {
    display: none;
}
.wpt-test {
    display: contents;
}
.wpt-test > a {
    text-decoration: underline;
    border: none;
}
.wpt-test > .wpt-name { grid-column: 1; }
.wpt-test > .wpt-results { grid-column: 2; }
.wpt-test > .wpt-live { grid-column: 3; }
.wpt-test > .wpt-source { grid-column: 4; }

.wpt-test > .wpt-results {
    display: flex;
    gap: .1em;
}
.wpt-test .wpt-result {
    display: inline-block;
    height: 1em;
    width: 1em;
    border-radius: 50%;
    position: relative;
}
</style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">CSS Anchor Positioning</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="2022-09-28">28 September 2022</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://drafts.csswg.org/css-anchor-1/">https://drafts.csswg.org/css-anchor-1/</a>
      <dt>Issue Tracking:
      <dd><a href="https://github.com/w3c/csswg-drafts/labels/css-anchor-1">CSSWG Issues Repository</a>
      <dd><a href="#issues-index">Inline In Spec</a>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard" data-editor-id="42199"><a class="p-name fn u-url url" href="http://xanthir.com/contact/">Tab Atkins-Bittner</a> (<span class="p-org org">Google</span>)
      <dd class="editor p-author h-card vcard"><span class="p-name fn">Jhey Thompkins</span> (<span class="p-org org">Google</span>)
      <dd class="editor p-author h-card vcard"><span class="p-name fn">Ian Kilpatrick</span> (<span class="p-org org">Google</span>)
      <dt>Suggest an Edit for this Spec:
      <dd><a href="https://github.com/w3c/csswg-drafts/blob/main/css-anchor-1/Overview.bs">GitHub Editor</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2022 <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document" rel="license">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification defines 'anchor positioning', where a positioned element can size and position itself relative to one or more "anchor elements" elsewhere on the page.</p>
    <a href="https://www.w3.org/TR/CSS/">CSS</a> is a language for describing the rendering of structured documents
(such as HTML and XML)
on screen, on paper, etc. 
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p>Please send feedback
	by <a href="https://github.com/w3c/csswg-drafts/issues">filing issues in GitHub</a> (preferred),
	including the spec code “css-anchor” in the title, like this:
	“[css-anchor] <i>…summary of comment…</i>”.
	All issues and comments are <a href="https://lists.w3.org/Archives/Public/public-css-archive/">archived</a>.
	Alternately, feedback can be sent to the (<a href="https://lists.w3.org/Archives/Public/www-style/">archived</a>) public mailing list <a href="mailto:www-style@w3.org?Subject=%5Bcss-anchor%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a>. </p>
   <p>This document is governed by the <a href="https://www.w3.org/2021/Process-20211102/" id="w3c_process_revision">2 November 2021 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#anchoring"><span class="secno">2</span> <span class="content">Anchoring</span></a>
     <ol class="toc">
      <li><a href="#anchor-pos"><span class="secno">2.1</span> <span class="content">Anchor-based Positioning: the <span class="css">anchor()</span> function</span></a>
      <li><a href="#anchor-size"><span class="secno">2.2</span> <span class="content">Anchor-based Sizing: the <span class="css">anchor-size()</span> function</span></a>
      <li><a href="#determining"><span class="secno">2.3</span> <span class="content">Determining The Anchor: the <span class="property">anchor-name</span> property</span></a>
      <li><a href="#queries"><span class="secno">2.4</span> <span class="content">Anchor Queries</span></a>
     </ol>
    <li>
     <a href="#fallback"><span class="secno">3</span> <span class="content">Fallback Sizing/Positioning</span></a>
     <ol class="toc">
      <li><a href="#fallback-property"><span class="secno">3.1</span> <span class="content">The <span class="property">position-fallback</span> Property</span></a>
      <li><a href="#fallback-rule"><span class="secno">3.2</span> <span class="content">The <span class="css">@position-fallback</span> Rule</span></a>
      <li><a href="#fallback-apply"><span class="secno">3.3</span> <span class="content">Applying Position Fallback</span></a>
     </ol>
    <li><a href="#sec"><span class="secno">4</span> <span class="content">Security Considerations</span></a>
    <li><a href="#priv"><span class="secno">5</span> <span class="content">Privacy Considerations</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content"> Document conventions</span></a>
      <li><a href="#w3c-conformance-classes"><span class="secno"></span> <span class="content"> Conformance classes</span></a>
      <li>
       <a href="#w3c-partial"><span class="secno"></span> <span class="content"> Partial implementations</span></a>
       <ol class="toc">
        <li><a href="#w3c-conform-future-proofing"><span class="secno"></span> <span class="content"> Implementations of Unstable and Proprietary Features</span></a>
       </ol>
      <li><a href="#w3c-testing"><span class="secno"></span> <span class="content"> Non-experimental implementations</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#property-index"><span class="secno"></span> <span class="content">Property Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>Introduction here.</p>
   <h2 class="heading settled" data-level="2" id="anchoring"><span class="secno">2. </span><span class="content">Anchoring</span><a class="self-link" href="#anchoring"></a></h2>
   <p>While CSS generally determines the position and size of elements
according to their parents or other ancestors, <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-position-3/#absolute-position" id="ref-for-absolute-position">absolutely positioned</a> elements barely participate in their ancestors' layout.
Instead, they’re sized and positioned explicitly
by the <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-logical-1/#inset-properties" id="ref-for-inset-properties">inset properties</a> and <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-align-3/#box-alignment-properties" id="ref-for-box-alignment-properties">box alignment properties</a>,
only referencing the final size and position of their <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block" id="ref-for-containing-block">containing block</a>.
This provides extreme flexibility,
allowing elements to be positioned more or less arbitrarily,
including over the top of other elements
in ways that the layout methods don’t otherwise allow,
but in return it’s not very expressive—<wbr>the element cannot easily express its size and position
in terms of other elements on the page.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="anchor function" id="anchor-function">anchor functions</dfn> <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor">anchor()</a> and <a class="css" data-link-type="maybe" href="#funcdef-anchor-size" id="ref-for-funcdef-anchor-size">anchor-size()</a>,
defined below,
give back some of the expressivity of ordinary layout
without compromising on the flexibility and power of <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-position-3/#absolute-position" id="ref-for-absolute-position①">absolute positioning</a>.
Using these functions,
one can size and position an <span id="ref-for-absolute-position②">absolutely positioned</span> element
relative to one or more <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element">anchor elements</a> on the page.
The <span class="css">@position-set</span> rule allows even more flexibility,
allowing multiple different sizes/positions to be tried out sequentially
until one is found that fits within the <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block" id="ref-for-containing-block①">containing block</a>.</p>
   <h3 class="heading settled" data-level="2.1" id="anchor-pos"><span class="secno">2.1. </span><span class="content">Anchor-based Positioning: the <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor①">anchor()</a> function</span><a class="self-link" href="#anchor-pos"></a></h3>
   <p>An <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-position-3/#absolute-position" id="ref-for-absolute-position③">absolutely-positioned</a> element
can use the <dfn class="dfn-paneled css" data-dfn-type="function" data-export id="funcdef-anchor">anchor()</dfn> function
as a value in its <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-logical-1/#inset-properties" id="ref-for-inset-properties①">inset properties</a> to refer to the position of one or more <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element①">anchor elements</a>.
The <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor②">anchor()</a> function resolves to a <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#length-value" id="ref-for-length-value" title="Expands to: advance measure | cap | ch | cm | dvb | dvh | dvi | dvmax | dvmin | dvw | em | ex | ic | in | lh | lvb | lvh | lvi | lvmax | lvmin | lvw | mm | pc | pt | px | q | rcap | rch | rem | rex | ric | rlh | svb | svh | svi | svmax | svmin | svw | vb | vh | vi | vmax | vmin | vw">&lt;length></a>.</p>
<pre class="prod">anchor() = anchor( <a class="production" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident">&lt;dashed-ident></a><a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#mult-opt" id="ref-for-mult-opt">?</a> <a class="production" data-link-type="type" href="#typedef-anchor-side" id="ref-for-typedef-anchor-side">&lt;anchor-side></a><a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-comma" id="ref-for-comb-comma">,</a> <a class="production" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-length-percentage" id="ref-for-typedef-length-percentage">&lt;length-percentage></a><a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#mult-opt" id="ref-for-mult-opt①">?</a> )
<dfn class="dfn-paneled" data-dfn-type="type" data-export id="typedef-anchor-side"><a class="production" data-link-type="type" href="#typedef-anchor-side" id="ref-for-typedef-anchor-side①">&lt;anchor-side></a></dfn> = top <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one" id="ref-for-comb-one">|</a> left <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one" id="ref-for-comb-one①">|</a> right <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one" id="ref-for-comb-one②">|</a> bottom
        <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one" id="ref-for-comb-one③">|</a> start <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one" id="ref-for-comb-one④">|</a> end <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one" id="ref-for-comb-one⑤">|</a> self-start <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one" id="ref-for-comb-one⑥">|</a> self-end
        <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one" id="ref-for-comb-one⑦">|</a> <a class="production" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#percentage-value" id="ref-for-percentage-value">&lt;percentage></a> <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one" id="ref-for-comb-one⑧">|</a> center
</pre>
   <p>The <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor③">anchor()</a> function has three arguments:</p>
   <ul>
    <li data-md>
     <p>the <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident①">&lt;dashed-ident></a> specifies the <a data-link-type="dfn" href="#anchor-name" id="ref-for-anchor-name">anchor name</a> of the <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element②">anchor element</a> it will be drawing positioning information from.
See <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element">target anchor element</a> for details.</p>
     <p>If omitted, the function uses an element’s <a data-link-type="dfn" href="#implicit-anchor-elements" id="ref-for-implicit-anchor-elements">implicit anchor element</a> instead.</p>
    <li data-md>
     <p>the <a class="production css" data-link-type="type" href="#typedef-anchor-side" id="ref-for-typedef-anchor-side②">&lt;anchor-side></a> value
refers to the position of the corresponding side
of the <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element①">target anchor element</a>.</p>
     <p>The physical <a class="production css" data-link-type="type" href="#typedef-anchor-side" id="ref-for-typedef-anchor-side③">&lt;anchor-side></a> keywords
(<dfn class="css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-left">left<a class="self-link" href="#valdef-anchor-left"></a></dfn>, <dfn class="css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-right">right<a class="self-link" href="#valdef-anchor-right"></a></dfn>, <dfn class="dfn-paneled css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-top">top</dfn>,
and <dfn class="dfn-paneled css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-bottom">bottom</dfn>)
must only be used in <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-logical-1/#inset-properties" id="ref-for-inset-properties②">inset properties</a> corresponding to the same axis:
for example, <a class="css" data-link-type="maybe" href="#valdef-anchor-top" id="ref-for-valdef-anchor-top">top</a> and <a class="css" data-link-type="maybe" href="#valdef-anchor-bottom" id="ref-for-valdef-anchor-bottom">bottom</a> are valid in <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-top" id="ref-for-propdef-top">top</a> and <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-bottom" id="ref-for-propdef-bottom">bottom</a>,
but not in <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-left" id="ref-for-propdef-left">left</a> and <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-right" id="ref-for-propdef-right">right</a>.
Using wrong-axis keywords makes the function invalid.</p>
     <p>The logical <a class="production css" data-link-type="type" href="#typedef-anchor-side" id="ref-for-typedef-anchor-side④">&lt;anchor-side></a> keywords
(<dfn class="dfn-paneled css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-start">start</dfn>, <dfn class="dfn-paneled css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-end">end</dfn>, <dfn class="dfn-paneled css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-self-start">self-start</dfn>,
and <dfn class="dfn-paneled css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-self-end">self-end</dfn>)
map to one of the physical keywords
depending on the property the function is being used in
(<a class="css" data-link-type="maybe" href="#valdef-anchor-top" id="ref-for-valdef-anchor-top①">top</a> or <a class="css" data-link-type="maybe" href="#valdef-anchor-bottom" id="ref-for-valdef-anchor-bottom①">bottom</a> in the <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-top" id="ref-for-propdef-top①">top</a> or <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-bottom" id="ref-for-propdef-bottom①">bottom</a> properties, etc)
and the <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-writing-modes-4/#writing-mode" id="ref-for-writing-mode">writing mode</a> of either the element
(for <a class="css" data-link-type="maybe" href="#valdef-anchor-self-start" id="ref-for-valdef-anchor-self-start">self-start</a> and <a class="css" data-link-type="maybe" href="#valdef-anchor-self-end" id="ref-for-valdef-anchor-self-end">self-end</a>)
or the <span id="ref-for-writing-mode①">writing mode</span> of the element’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block" id="ref-for-containing-block②">containing block</a> (for <a class="css" data-link-type="maybe" href="#valdef-anchor-start" id="ref-for-valdef-anchor-start">start</a> and <a class="css" data-link-type="maybe" href="#valdef-anchor-end" id="ref-for-valdef-anchor-end">end</a>).</p>
     <p class="issue" id="issue-c74bca11"><a class="self-link" href="#issue-c74bca11"></a> Do we need to refer to the anchor element’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-writing-modes-4/#writing-mode" id="ref-for-writing-mode②">writing mode</a>?
I think that’s too unpredictable to actually do anything useful.
If you’re specifying your <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-inset-inline-start" id="ref-for-propdef-inset-inline-start">inset-inline-start</a> property,
you almost certainly want to refer to an anchor edge
relative to your own directions,
not an unpredictable edge based on the anchor.</p>
     <p>A <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#percentage-value" id="ref-for-percentage-value①">&lt;percentage></a> value refers to a position
a corresponding percentage between the <a class="css" data-link-type="maybe" href="#valdef-anchor-start" id="ref-for-valdef-anchor-start①">start</a> and <a class="css" data-link-type="maybe" href="#valdef-anchor-end" id="ref-for-valdef-anchor-end①">end</a> sides,
with <span class="css">0%</span> being equivalent to <span class="css" id="ref-for-valdef-anchor-start②">start</span> and <span class="css">100%</span> being equivalent to <span class="css" id="ref-for-valdef-anchor-end②">end</span>.
The <dfn class="css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-center">center<a class="self-link" href="#valdef-anchor-center"></a></dfn> keyword is equivalent to <span class="css">50%</span>.</p>
    <li data-md>
     <p>the optional <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-length-percentage" id="ref-for-typedef-length-percentage①">&lt;length-percentage></a> final argument is a fallback value.
If the <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor④">anchor()</a> represents an <a data-link-type="dfn" href="#valid-anchor-query" id="ref-for-valid-anchor-query">invalid anchor query</a>,
it resolves to this value
rather that determining its value as detailed below.</p>
     <p>If omitted,
it defaults to <span class="css">0px</span>.</p>
   </ul>
   <p>An <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor⑤">anchor()</a> function representing a <a data-link-type="dfn" href="#valid-anchor-query" id="ref-for-valid-anchor-query①">valid anchor query</a> resolves to the <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#length-value" id="ref-for-length-value①" title="Expands to: advance measure | cap | ch | cm | dvb | dvh | dvi | dvmax | dvmin | dvw | em | ex | ic | in | lh | lvb | lvh | lvi | lvmax | lvmin | lvw | mm | pc | pt | px | q | rcap | rch | rem | rex | ric | rlh | svb | svh | svi | svmax | svmin | svw | vb | vh | vi | vmax | vmin | vw">&lt;length></a> that would align the edge
of the positioned elements' <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-position-3/#inset-modified-containing-block" id="ref-for-inset-modified-containing-block">inset-modified containing block</a> corresponding to the property the function appears in
with the specified border edge of the <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element②">target anchor element</a>.</p>
   <p>If the <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element③">target anchor element</a> is <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-break-4/#fragment" id="ref-for-fragment">fragmented</a>,
the axis-aligned bounding rectangle
of the fragments' border boxes is used instead.</p>
   <p class="issue" id="issue-3c6fe13f"><a class="self-link" href="#issue-3c6fe13f"></a> Do we need to control which box we’re referring to,
so you can align to padding or content edge?</p>
   <p class="issue" id="issue-c27c1cde"><a class="self-link" href="#issue-c27c1cde"></a> Per flackr/iank feedback,
this should be able to respond to the scroll position
of the anchor element,
both for positioning and for fallback,
in a way essentially identical to @scroll-timeline.
Precise timing + details to be filled in.</p>
   <div class="example" id="example-ef794aa0">
    <a class="self-link" href="#example-ef794aa0"></a> For example,
	in <span class="css">.bar { top: anchor(--foo top); }</span>,
	the <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor⑥">anchor()</a> will resolve to the length
	that’ll line up the <code>.bar</code> element’s top edge
	with the <span class="css">--foo</span> anchor’s top edge. 
    <p>On the other hand,
	in <span class="css">.bar { bottom: anchor(--foo top); }</span>,
	it will instead resolve to the length
	that’ll line up the <code>.bar</code> element’s <em>bottom</em> edge
	with the <span class="css">--foo</span> anchor’s top edge.</p>
    <p>Since <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-top" id="ref-for-propdef-top②">top</a> and <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-bottom" id="ref-for-propdef-bottom②">bottom</a> values specify insets from different edges
	(the top and bottom of the element’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block" id="ref-for-containing-block③">containing block</a>,
	respectively),
	the same <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor⑦">anchor()</a> will usually resolve to different lengths in each.</p>
   </div>
   <div class="example" id="example-fcdb8337">
    <a class="self-link" href="#example-fcdb8337"></a> Because the <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor⑧">anchor()</a> function resolves to a <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#length-value" id="ref-for-length-value②" title="Expands to: advance measure | cap | ch | cm | dvb | dvh | dvi | dvmax | dvmin | dvw | em | ex | ic | in | lh | lvb | lvh | lvi | lvmax | lvmin | lvw | mm | pc | pt | px | q | rcap | rch | rem | rex | ric | rlh | svb | svh | svi | svmax | svmin | svw | vb | vh | vi | vmax | vmin | vw">&lt;length></a>,
	it can be used in <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-values-4/#math-function" id="ref-for-math-function">math functions</a> like any other length. 
    <p>For example, the following will set up the element
	so that its <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-position-3/#inset-modified-containing-block" id="ref-for-inset-modified-containing-block①">inset-modified containing block</a> is centered on the <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element③">anchor element</a> and as wide as possible without overflowing the <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block" id="ref-for-containing-block④">containing block</a>:</p>
<pre class="highlight">.centered-message <c- p>{</c->
  <c- k>position</c-><c- p>:</c-> fixed<c- p>;</c->
  <c- k>max-width</c-><c- p>:</c-> max-content<c- p>;</c->
  <c- k>justify-content</c-><c- p>:</c-> center<c- p>;</c->

  <c- k>--center</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--x <c- m>50</c-><c- k>%</c-><c- p>);</c->
  <c- k>--half-distance</c-><c- p>:</c-> <c- nf>min</c-><c- p>(</c->
    <c- nf>abs</c-><c- p>(</c-><c- m>0</c-><c- k>%</c-> - <c- nf>var</c-><c- p>(</c->--center<c- p>)),</c->
    <c- nf>abs</c-><c- p>(</c-><c- m>100</c-><c- k>%</c-> - <c- nf>var</c-><c- p>(</c->--center<c- p>))</c->
  <c- p>);</c->
  <c- k>left</c-><c- p>:</c-> <c- nf>calc</c-><c- p>(</c-><c- nf>var</c-><c- p>(</c->--center<c- p>)</c-> - <c- nf>var</c-><c- p>(</c->--half-distance<c- p>));</c->
  <c- k>right</c-><c- p>:</c-> <c- nf>calc</c-><c- p>(</c-><c- nf>var</c-><c- p>(</c->--center<c- p>)</c-> - <c- nf>var</c-><c- p>(</c->--half-distance<c- p>));</c->
  <c- k>bottom</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--x top<c- p>);</c->
<c- p>}</c->
</pre>
    <p>This might be appropriate for an error message
	on an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/input.html#the-input-element" id="ref-for-the-input-element">input</a></code> element,
	for example,
	as the centering will make it easier to discover
	which input is being referred to.</p>
   </div>
   <h3 class="heading settled" data-level="2.2" id="anchor-size"><span class="secno">2.2. </span><span class="content">Anchor-based Sizing: the <a class="css" data-link-type="maybe" href="#funcdef-anchor-size" id="ref-for-funcdef-anchor-size①">anchor-size()</a> function</span><a class="self-link" href="#anchor-size"></a></h3>
   <p>An <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-position-3/#absolute-position" id="ref-for-absolute-position④">absolutely-positioned</a> element
can use the <dfn class="dfn-paneled css" data-dfn-type="function" data-export id="funcdef-anchor-size">anchor-size()</dfn> function
in its <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-sizing-3/#sizing-property" id="ref-for-sizing-property">sizing properties</a> to refer to the size of one or more <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element④">anchor elements</a>.
The <a class="css" data-link-type="maybe" href="#funcdef-anchor-size" id="ref-for-funcdef-anchor-size②">anchor-size()</a> function resolves to a <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#length-value" id="ref-for-length-value③" title="Expands to: advance measure | cap | ch | cm | dvb | dvh | dvi | dvmax | dvmin | dvw | em | ex | ic | in | lh | lvb | lvh | lvi | lvmax | lvmin | lvw | mm | pc | pt | px | q | rcap | rch | rem | rex | ric | rlh | svb | svh | svi | svmax | svmin | svw | vb | vh | vi | vmax | vmin | vw">&lt;length></a>.</p>
<pre class="prod">anchor-size() = anchor( <a class="production" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident②">&lt;dashed-ident></a><a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#mult-opt" id="ref-for-mult-opt②">?</a> <a class="production" data-link-type="type" href="#typedef-anchor-size" id="ref-for-typedef-anchor-size">&lt;anchor-size></a><a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-comma" id="ref-for-comb-comma①">,</a> <a class="production" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-length-percentage" id="ref-for-typedef-length-percentage②">&lt;length-percentage></a><a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#mult-opt" id="ref-for-mult-opt③">?</a> )
<dfn class="dfn-paneled" data-dfn-type="type" data-export id="typedef-anchor-size"><a class="production" data-link-type="type" href="#typedef-anchor-size" id="ref-for-typedef-anchor-size①">&lt;anchor-size></a></dfn> = width <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one" id="ref-for-comb-one⑨">|</a> height <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one" id="ref-for-comb-one①⓪">|</a> block <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one" id="ref-for-comb-one①①">|</a> inline <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one" id="ref-for-comb-one①②">|</a> self-block <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one" id="ref-for-comb-one①③">|</a> self-inline
</pre>
   <p>The <a class="css" data-link-type="maybe" href="#funcdef-anchor-size" id="ref-for-funcdef-anchor-size③">anchor-size()</a> function is similar to <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor⑨">anchor()</a>,
and takes the same arguments,
save that the <a class="production css" data-link-type="type" href="#typedef-anchor-side" id="ref-for-typedef-anchor-side⑤">&lt;anchor-side></a> keywords are replaced with <a class="production css" data-link-type="type" href="#typedef-anchor-size" id="ref-for-typedef-anchor-size②">&lt;anchor-size></a>,
referring to the distance between two opposing sides.</p>
   <p>The physical <a class="production css" data-link-type="type" href="#typedef-anchor-size" id="ref-for-typedef-anchor-size③">&lt;anchor-size></a> keywords
(<dfn class="css" data-dfn-for="anchor-size()" data-dfn-type="value" data-export id="valdef-anchor-size-width">width<a class="self-link" href="#valdef-anchor-size-width"></a></dfn> and <dfn class="css" data-dfn-for="anchor-size()" data-dfn-type="value" data-export id="valdef-anchor-size-height">height<a class="self-link" href="#valdef-anchor-size-height"></a></dfn>)
refer to the width and height,
respectively,
of the <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element④">target anchor element</a>.
Unlike <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor①⓪">anchor()</a>, there is no restriction on having to match axises;
for example, <a class="css" data-link-type="propdesc" href="https://andreubotella.com/csswg-auto-build/css-sizing-3/#propdef-width" id="ref-for-propdef-width">width: anchor-size(--foo height);</a> is valid.</p>
   <p>The logical <a class="production css" data-link-type="type" href="#typedef-anchor-size" id="ref-for-typedef-anchor-size④">&lt;anchor-size></a> keywords
(<dfn class="dfn-paneled css" data-dfn-for="anchor-size()" data-dfn-type="value" data-export id="valdef-anchor-size-block">block</dfn>, <dfn class="dfn-paneled css" data-dfn-for="anchor-size()" data-dfn-type="value" data-export id="valdef-anchor-size-inline">inline</dfn>, <dfn class="dfn-paneled css" data-dfn-for="anchor-size()" data-dfn-type="value" data-export id="valdef-anchor-size-self-block">self-block</dfn>,
and <dfn class="dfn-paneled css" data-dfn-for="anchor-size()" data-dfn-type="value" data-export id="valdef-anchor-size-self-inline">self-inline</dfn>)
map to one of the physical keywords
according to either the <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-writing-modes-4/#writing-mode" id="ref-for-writing-mode③">writing mode</a> of the element
(for <a class="css" data-link-type="maybe" href="#valdef-anchor-size-self-block" id="ref-for-valdef-anchor-size-self-block">self-block</a> and <a class="css" data-link-type="maybe" href="#valdef-anchor-size-self-inline" id="ref-for-valdef-anchor-size-self-inline">self-inline</a>)
or the <span id="ref-for-writing-mode④">writing mode</span> of the element’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block" id="ref-for-containing-block⑤">containing block</a> (for <a class="css" data-link-type="maybe" href="#valdef-anchor-size-block" id="ref-for-valdef-anchor-size-block">block</a> and <a class="css" data-link-type="maybe" href="#valdef-anchor-size-inline" id="ref-for-valdef-anchor-size-inline">inline</a>).</p>
   <p>An <a class="css" data-link-type="maybe" href="#funcdef-anchor-size" id="ref-for-funcdef-anchor-size④">anchor-size()</a> function representing a <a data-link-type="dfn" href="#valid-anchor-query" id="ref-for-valid-anchor-query②">valid anchor query</a> resolves to the <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#length-value" id="ref-for-length-value④" title="Expands to: advance measure | cap | ch | cm | dvb | dvh | dvi | dvmax | dvmin | dvw | em | ex | ic | in | lh | lvb | lvh | lvi | lvmax | lvmin | lvw | mm | pc | pt | px | q | rcap | rch | rem | rex | ric | rlh | svb | svh | svi | svmax | svmin | svw | vb | vh | vi | vmax | vmin | vw">&lt;length></a> separating the relevant border edges
(either left and right, or top and bottom,
whichever is in the specified axis)
of the <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element⑤">target anchor element</a>.</p>
   <h3 class="heading settled" data-level="2.3" id="determining"><span class="secno">2.3. </span><span class="content">Determining The Anchor: the <a class="property css" data-link-type="property" href="#propdef-anchor-name" id="ref-for-propdef-anchor-name">anchor-name</a> property</span><a class="self-link" href="#determining"></a></h3>
   <table class="def propdef" data-link-for-hint="anchor-name">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-anchor-name">anchor-name</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">none <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one" id="ref-for-comb-one①④">|</a> <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident③">&lt;dashed-ident></a>
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>none
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td><a href="https://www.w3.org/TR/css-pseudo/#generated-content" title="Includes ::before and ::after pseudo-elements.">all elements</a>
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>no
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>n/a
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>as specified
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>discrete
   </table>
   <p>Values are defined as follows:</p>
   <dl>
    <dt data-md><dfn class="css" data-dfn-for="anchor-name" data-dfn-type="value" data-export id="valdef-anchor-name-none">none<a class="self-link" href="#valdef-anchor-name-none"></a></dfn>
    <dd data-md>
     <p>The property has no effect.</p>
    <dt data-md><dfn class="css" data-dfn-for="anchor-name" data-dfn-type="value" data-export id="valdef-anchor-name-dashed-ident"><a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident④">&lt;dashed-ident></a><a class="self-link" href="#valdef-anchor-name-dashed-ident"></a></dfn>
    <dd data-md>
     <p>The element is an <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-local-lt="anchor" data-noexport id="anchor-element">anchor element</dfn>,
with an <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-noexport id="anchor-name">anchor name</dfn> equal to the <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident⑤">&lt;dashed-ident></a>.</p>
   </dl>
   <p>The <a data-link-type="dfn" href="#anchor-function" id="ref-for-anchor-function">anchor functions</a> refer to an <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element⑤">anchor element</a> by name.
That name is not necessarily unique on the page, however;
even if it is, the <span id="ref-for-anchor-element⑥">anchor element</span> in question
might not be capable of anchoring the positioned element.</p>
   <div class="algorithm" data-algorithm="target anchor element">
     To determine the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="target-anchor-element">target <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element⑦">anchor element</a></dfn> given a querying element <var>query el</var> and an optional anchor name <var>name</var>,
	find the first element <var>el</var> in tree order
	which satisfies the following conditions: 
    <ul>
     <li data-md>
      <p>If <var>name</var> is not provided,
but <var>query el</var> has one or more <a data-link-type="dfn" href="#implicit-anchor-elements" id="ref-for-implicit-anchor-elements①">implicit anchor elements</a>, <var>el</var> is one of those elements.</p>
     <li data-md>
      <p>If <var>name</var> is provided, <var>el</var> is an <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element⑧">anchor element</a> with an <a data-link-type="dfn" href="#anchor-name" id="ref-for-anchor-name①">anchor name</a> of <var>name</var>.</p>
     <li data-md>
      <p>Either <var>el</var> is a descendant of <var>query el</var>’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block" id="ref-for-containing-block⑥">containing block</a>,
or <var>query el</var>’s <span id="ref-for-containing-block⑦">containing block</span> is the <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-display-3/#initial-containing-block" id="ref-for-initial-containing-block">initial containing block</a></p>
     <li data-md>
      <p>If <var>el</var> has the same <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block" id="ref-for-containing-block⑧">containing block</a> as <var>query el</var>, <var>el</var> is not <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-position-3/#absolute-position" id="ref-for-absolute-position⑤">absolutely positioned</a></p>
     <li data-md>
      <p>If <var>el</var> has a different <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block" id="ref-for-containing-block⑨">containing block</a> from <var>query el</var>,
the last <span id="ref-for-containing-block①⓪">containing block</span> in <var>el</var>’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block-chain" id="ref-for-containing-block-chain">containing block chain</a> before reaching <var>query el</var>’s <span id="ref-for-containing-block①①">containing block</span> is not <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-position-3/#absolute-position" id="ref-for-absolute-position⑥">absolutely positioned</a></p>
    </ul>
    <p class="note" role="note"><span>Note:</span> There might not be any such element.</p>
    <p class="note" role="note"><span>Note:</span> The general rule captured by these conditions
	is that <var>el</var> must be fully laid out
	before <var>query el</var> is laid out.
	CSS’s rules about the layout order of stacking contexts
	give us assurances about this,
	and the list of conditions above
	exactly rephrases the stacking context rules
	into just what’s relevant for this purpose,
	ensuring there is no possibly circularity
	in anchor positioning.</p>
   </div>
   <p>An element can have one or more <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="implicit-anchor-elements">implicit anchor elements</dfn>,
defined by other features.
This specification does not define any <a data-link-type="dfn" href="#implicit-anchor-elements" id="ref-for-implicit-anchor-elements②">implicit anchor elements</a> itself.</p>
   <p class="note" role="note"><span>Note:</span> The Popup API, for example,
defines an <a data-link-type="dfn" href="#implicit-anchor-elements" id="ref-for-implicit-anchor-elements③">implicit anchor element</a> for a popup—<wbr>the element that the popup is attached to.</p>
   <h3 class="heading settled" data-level="2.4" id="queries"><span class="secno">2.4. </span><span class="content">Anchor Queries</span><a class="self-link" href="#queries"></a></h3>
   <p>The <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor①①">anchor()</a> and <a class="css" data-link-type="maybe" href="#funcdef-anchor-size" id="ref-for-funcdef-anchor-size⑤">anchor-size()</a> functions
represent an <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="anchor-query">anchor query</dfn>:
a request for the position of one or more sides
of one or more <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element⑨">anchor elements</a>.</p>
   <p><a data-link-type="dfn" href="#anchor-query" id="ref-for-anchor-query">Anchor queries</a> are <dfn class="dfn-paneled" data-dfn-type="dfn" data-local-lt="invalid|valid" data-lt="valid anchor query|invalid anchor query" data-noexport id="valid-anchor-query">valid</dfn> only if all of the following conditions are true:</p>
   <ul>
    <li data-md>
     <p>Their function is used on an element that is <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-position-3/#absolute-position" id="ref-for-absolute-position⑦">absolutely-positioned</a>.</p>
    <li data-md>
     <p>If representing an <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor①②">anchor()</a> function,
the function is being used in an <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-logical-1/#inset-properties" id="ref-for-inset-properties③">inset property</a>.</p>
    <li data-md>
     <p>If representing an <a class="css" data-link-type="maybe" href="#funcdef-anchor-size" id="ref-for-funcdef-anchor-size⑥">anchor-size()</a> function,
the function is being used in a <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-sizing-3/#sizing-property" id="ref-for-sizing-property①">sizing property</a>.</p>
    <li data-md>
     <p>There is a <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element⑥">target anchor element</a> for the element
and the <a data-link-type="dfn" href="#anchor-name" id="ref-for-anchor-name②">anchor name</a> specified in the function.</p>
   </ul>
   <p class="note" role="note"><span>Note:</span> As specified in the definition of <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor①③">anchor()</a>,
an <a data-link-type="dfn" href="#valid-anchor-query" id="ref-for-valid-anchor-query③">invalid anchor query</a> causes the function to resolve to its fallback value instead.</p>
   <h2 class="heading settled" data-level="3" id="fallback"><span class="secno">3. </span><span class="content">Fallback Sizing/Positioning</span><a class="self-link" href="#fallback"></a></h2>
   <p>Anchor positioning,
while powerful,
can also be unpredictable.
The <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element①⓪">anchor element</a> might be anywhere on the page,
so positioning an element in any particular fashion
(such as above the anchor, or the right of the anchor)
might result in the positioned element overflowing its <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block" id="ref-for-containing-block①②">containing block</a> or being positioned partially off screen.</p>
   <p>To ameliorate this, an <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-position-3/#absolute-position" id="ref-for-absolute-position⑧">absolutely positioned</a> element
can use the <a class="property css" data-link-type="property" href="#propdef-position-fallback" id="ref-for-propdef-position-fallback">position-fallback</a> property
to refer to a <a class="css" data-link-type="maybe" href="#at-ruledef-position-fallback" id="ref-for-at-ruledef-position-fallback">@position-fallback</a> block,
giving a list of possible style rules to try out.
Each is applied to the element, one by one,
and the first that doesn’t cause the element
to overflow its <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block" id="ref-for-containing-block①③">containing block</a> is taken as the winner.</p>
   <h3 class="heading settled" data-level="3.1" id="fallback-property"><span class="secno">3.1. </span><span class="content">The <a class="property css" data-link-type="property" href="#propdef-position-fallback" id="ref-for-propdef-position-fallback①">position-fallback</a> Property</span><a class="self-link" href="#fallback-property"></a></h3>
   <table class="def propdef" data-link-for-hint="position-fallback">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-position-fallback">position-fallback</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">none <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one" id="ref-for-comb-one①⑤">|</a> <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident⑥">&lt;dashed-ident></a>
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>none
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td><a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-position-3/#absolute-position" id="ref-for-absolute-position⑨">absolutely-positioned</a> elements
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>no
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>n/a
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>as specified
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>discrete
   </table>
   <p>Values have the following meanings:</p>
   <dl>
    <dt data-md><dfn class="css" data-dfn-for="position-fallback" data-dfn-type="value" data-export id="valdef-position-fallback-none">none<a class="self-link" href="#valdef-position-fallback-none"></a></dfn>
    <dd data-md>
     <p>The property has no effect;
the element does not use a <a data-link-type="dfn" href="#position-fallback-list" id="ref-for-position-fallback-list">position fallback list</a>.</p>
    <dt data-md><dfn class="css" data-dfn-for="position-fallback" data-dfn-type="value" data-export id="valdef-position-fallback-dashed-ident"><a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident⑦">&lt;dashed-ident></a><a class="self-link" href="#valdef-position-fallback-dashed-ident"></a></dfn>
    <dd data-md>
     <p>If there is a <a class="css" data-link-type="maybe" href="#at-ruledef-position-fallback" id="ref-for-at-ruledef-position-fallback①">@position-fallback</a> rule
with a name matching the specified ident,
then the element uses that <a data-link-type="dfn" href="#position-fallback-list" id="ref-for-position-fallback-list①">position fallback list</a>.</p>
     <p>Otherwise,
this value has no effect.</p>
   </dl>
   <h3 class="heading settled" data-level="3.2" id="fallback-rule"><span class="secno">3.2. </span><span class="content">The <a class="css" data-link-type="maybe" href="#at-ruledef-position-fallback" id="ref-for-at-ruledef-position-fallback②">@position-fallback</a> Rule</span><a class="self-link" href="#fallback-rule"></a></h3>
   <p>The <dfn class="dfn-paneled css" data-dfn-type="at-rule" data-export id="at-ruledef-position-fallback">@position-fallback</dfn> rule
defines a <a data-link-type="dfn" href="#position-fallback-list" id="ref-for-position-fallback-list②">position fallback list</a> with a given name,
specifying one or more sets of positioning properties
inside of <dfn class="dfn-paneled css" data-dfn-type="at-rule" data-export id="at-ruledef-try">@try</dfn> blocks
that will be applied to an element,
with each successive one serving as fallback
if the previous would cause the element
to partially or fully overflow its <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block" id="ref-for-containing-block①④">containing block</a>.</p>
   <p>The grammar of the <a class="css" data-link-type="maybe" href="#at-ruledef-position-fallback" id="ref-for-at-ruledef-position-fallback③">@position-fallback</a> rule is:</p>
<pre class="prod">@position-fallback <a class="production" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident⑧">&lt;dashed-ident></a> {
  <a class="production" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-syntax-3/#typedef-rule-list" id="ref-for-typedef-rule-list">&lt;rule-list></a>
}

@try { <a class="production" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-syntax-3/#typedef-declaration-list" id="ref-for-typedef-declaration-list">&lt;declaration-list></a> }
</pre>
   <p>The <a class="css" data-link-type="maybe" href="#at-ruledef-position-fallback" id="ref-for-at-ruledef-position-fallback④">@position-fallback</a> rule only accepts <a class="css" data-link-type="maybe" href="#at-ruledef-try" id="ref-for-at-ruledef-try">@try</a> rules.
The <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident⑨">&lt;dashed-ident></a> specified in the prelude
is the rule’s name.
If multiple <span class="css" id="ref-for-at-ruledef-position-fallback⑤">@position-fallback</span> rules are declared with the same name,
the last one in document order "wins".</p>
   <p>The <a class="css" data-link-type="maybe" href="#at-ruledef-try" id="ref-for-at-ruledef-try①">@try</a> rule only accepts the following <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-cascade-5/#css-property" id="ref-for-css-property">properties</a>:</p>
   <ul>
    <li data-md>
     <p><a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-logical-1/#inset-properties" id="ref-for-inset-properties④">inset properties</a></p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-sizing-3/#sizing-property" id="ref-for-sizing-property②">sizing properties</a></p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-align-3/#box-alignment-properties" id="ref-for-box-alignment-properties①">box alignment properties</a></p>
   </ul>
   <p class="issue" id="issue-14452576"><a class="self-link" href="#issue-14452576"></a> What exactly are the constraints that determine what’s allowed here?
Current list is based off of what’s reasonable
from Chrome’s experimental impl.
We can make a CQ that keys off of which fallback was used
to allow more general styling,
at least for descendants.</p>
   <p>The <a class="css" data-link-type="maybe" href="#at-ruledef-try" id="ref-for-at-ruledef-try②">@try</a> rules inside a <a class="css" data-link-type="maybe" href="#at-ruledef-position-fallback" id="ref-for-at-ruledef-position-fallback⑥">@position-fallback</a> specify a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="position-fallback-list">position fallback list</dfn>,
where each entry consists of the properties specified by each <span class="css" id="ref-for-at-ruledef-try③">@try</span>,
in order.</p>
   <p class="issue" id="issue-0dfe4786"><a class="self-link" href="#issue-0dfe4786"></a> If you have a bunch of elements
that all use the same positioning and fallback,
just relative to different anchor elements
(like a bunch of tooltips),
there’s no way to have them share @position-fallback rules;
they each need a unique set.
This sucks!
Should figure out some way to address this.</p>
   <p class="issue" id="issue-5b530169"><a class="self-link" href="#issue-5b530169"></a> Would be useful to be able to detect
when your anchor(s) are fully off-screen
and suppress your display entirely.
For example, tooltips living outside the scroller
holding the text they’re anchored to
don’t want to just hover over arbitrary parts of the page
because their anchor happens to have that position
relative to the scrollport.</p>
   <h3 class="heading settled" data-level="3.3" id="fallback-apply"><span class="secno">3.3. </span><span class="content">Applying Position Fallback</span><a class="self-link" href="#fallback-apply"></a></h3>
   <p>When an element uses a <a data-link-type="dfn" href="#position-fallback-list" id="ref-for-position-fallback-list③">position fallback list</a>,
it selects one entry from the list
as defined below,
and applies those properties to itself as <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-cascade-5/#used-value" id="ref-for-used-value">used values</a>.</p>
   <p class="note" role="note"><span>Note:</span> These have to be applied as used values
because we’re in the middle of layout right now;
defining how they’d interact with the cascade
would be extremely confusing *at a minimum*,
and perhaps actually circular.
In any case, not worth the cost in spec or impl.</p>
   <p class="issue" id="issue-0b311ea0"><a class="self-link" href="#issue-0b311ea0"></a> This implies that the values can’t be transitioned in the usual fashion,
since transitions key off of computed values
and we’re past that point.
However, popups sliding between positions is a common effect in UI libs.
Probably should introduce a <span class="css">smooth</span> keyword
to <a class="property css" data-link-type="property" href="#propdef-position-fallback" id="ref-for-propdef-position-fallback②">position-fallback</a> to trigger automatic "animation" of the fallback’d properties.</p>
   <p>To determine which entry is selected, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">iterate</a> over the <a data-link-type="dfn" href="#position-fallback-list" id="ref-for-position-fallback-list④">position fallback list</a>,
applying the properties of each entry in turn
according to the standard cascade rules,
and determining whether or not the element’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-box-4/#margin-box" id="ref-for-margin-box">margin box</a> overflows its <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block" id="ref-for-containing-block①⑤">containing block</a>.</p>
   <p class="note" role="note"><span>Note:</span> Descendants overflowing the anchored block
don’t affect this.</p>
   <p>The properties of the first non-overflowing entry
(or the last attempted entry, if none succeeded),
are taken as the final values for the specified properties.</p>
   <p>Implementations may choose to impose an implementation-defined limit
on the length of <a data-link-type="dfn" href="#position-fallback-list" id="ref-for-position-fallback-list⑤">position fallback lists</a>,
to limit the amount of excess layout work that may be required.
This limit must be <em>at least</em> five.</p>
   <div class="issue" id="issue-52cb8f94">
    <a class="self-link" href="#issue-52cb8f94"></a> Nested anchors
	(an anchored element inside of another anchored element)
	present the potential for exponential blow-up of layouts
	when doing fallback,
	since the grandchild anchored element can cause scrollbars on an ancestor,
	changing the IMCB for the child anchored element,
	thus possibly causing the fallback choice to change for it. 
    <p>There are strategies to avoid this,
	but they’re not without costs of their own.
	We should <em>probably</em> impose a <strong>maximum</strong> limit as well,
	to avoid this.</p>
    <p>However, since *most* usages won’t be problematic in the first place,
	we don’t want to restrict them unduly
	just to prevent weird situations from exploding.
	Perhaps a complexity budget based on the branching factor at each level?
	Like, accumulate the product of the fallback list lengths from ancestors,
	and your fallback list gets limited to not exceed a total product
	of, say, 1k.
	Get too deep and you’re stuck with your first choice only!
	But this would allow large, complex fallback lists for top-level stuff,
	and even some reasonable nesting.
	(Length-five lists could be nested to depth of 4, for example,
	if we did go with 1k.)</p>
    <p>More thought is needed.</p>
   </div>
   <div class="example" id="example-cd628aaa">
    <a class="self-link" href="#example-cd628aaa"></a> For example,
	the following CSS will first attempt to position a "popup"
	below the <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-display-3/#elements" id="ref-for-elements">element</a>,
	but if it doesn’t fit on-screen will switch to being above;
	it defaults to left-aligning,
	but will switch to right-aligning if that doesn’t fit. 
<pre class="highlight">#myPopup <c- p>{</c->
  <c- k>position</c-><c- p>:</c-> fixed<c- p>;</c->
  <c- k>position-fallback</c-><c- p>:</c-> --button-popup<c- p>;</c->
  <c- k>overflow</c-><c- p>:</c-> auto<c- p>;</c->

  <c- c>/* The popup is at least as wide as the button */</c->
  min-width: <c- nf>anchor-size</c-><c- p>(</c->--button width<c- p>);</c->

  <c- c>/* The popup is at least as tall as 2 menu items */</c->
  min-height: <c- m>6</c-><c- k>em</c-><c- p>;</c->
<c- p>}</c->

<c- n>@position-fallback</c-> --button-popup <c- p>{</c->
  <c- c>/* First try to align the top, left edge of the popup</c->
<c- c>  with the bottom, left edge of the button. */</c->
  <c- n>@try</c-> <c- p>{</c->
    <c- k>top</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--button bottom<c- p>);</c->
    <c- k>left</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--button left<c- p>);</c->
  <c- p>}</c->

  <c- c>/* Next try to align the bottom, left edge of the popup</c->
<c- c>  with the top, left edge of the button. */</c->
  <c- n>@try</c-> <c- p>{</c->
    <c- k>bottom</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--button top<c- p>);</c->
    <c- k>left</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--button left<c- p>);</c->
  <c- p>}</c->

  <c- c>/* Next try to align the top, right edge of the popup</c->
<c- c>  with the bottom, right edge of the button. */</c->
  <c- n>@try</c-> <c- p>{</c->
    <c- k>top</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--button bottom<c- p>);</c->
    <c- k>right</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--button right<c- p>);</c->
  <c- p>}</c->

  <c- c>/* Finally, try to align the bottom, right edge of the popup</c->
<c- c>  with the top, right edge of the button. Other positions are possible,</c->
<c- c>  but this is the final option the author would like the rendering</c->
<c- c>  engine to try. */</c->
  <c- n>@try</c-> <c- p>{</c->
    <c- k>bottom</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--button top<c- p>);</c->
    <c- k>right</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--button right<c- p>);</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
   </div>
   <h2 class="heading settled" data-level="4" id="sec"><span class="secno">4. </span><span class="content">Security Considerations</span><a class="self-link" href="#sec"></a></h2>
   <p>Nil.</p>
   <h2 class="heading settled" data-level="5" id="priv"><span class="secno">5. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#priv"></a></h2>
   <p>Nil.</p>
  </main>
  <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content"> Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
  <h3 class="no-ref heading settled" id="w3c-conventions"><span class="content"> Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
  <div class="example" id="w3c-example">
   <a class="self-link" href="#w3c-example"></a> 
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <p>Advisements are normative sections styled to evoke special attention and are
    set apart from other normative text with <code>&lt;strong class="advisement"></code>, like
    this: <strong class="advisement"> UAs MUST provide an accessible alternative. </strong></p>
  <details class="wpt-tests-block" dir="ltr" lang="en" open>
   <summary>Tests</summary>
   <p>Tests relating to the content of this specification
                     may be documented in “Tests” blocks like this one.
                     Any such block is non-normative.</p>
   <ul class="wpt-tests-list"></ul>
   <hr>
  </details>
  <h3 class="no-ref heading settled" id="w3c-conformance-classes"><span class="content"> Conformance classes</span><a class="self-link" href="#w3c-conformance-classes"></a></h3>
  <p>Conformance to this specification
    is defined for three conformance classes: </p>
  <dl>
   <dt>style sheet 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
            style sheet</a>. 
   <dt>renderer 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that interprets the semantics of a style sheet and renders
            documents that use them. 
   <dt>authoring tool 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that writes a style sheet. 
  </dl>
  <p>A style sheet is conformant to this specification
    if all of its statements that use syntax defined in this module are valid
    according to the generic CSS grammar and the individual grammars of each
    feature defined in this module. </p>
  <p>A renderer is conformant to this specification
    if, in addition to interpreting the style sheet as defined by the
    appropriate specifications, it supports all the features defined
    by this specification by parsing them correctly
    and rendering the document accordingly. However, the inability of a
    UA to correctly render a document due to limitations of the device
    does not make the UA non-conformant. (For example, a UA is not
    required to render color on a monochrome monitor.) </p>
  <p>An authoring tool is conformant to this specification
    if it writes style sheets that are syntactically correct according to the
    generic CSS grammar and the individual grammars of each feature in
    this module, and meet all other conformance requirements of style sheets
    as described in this module. </p>
  <h3 class="no-ref heading settled" id="w3c-partial"><span class="content"> Partial implementations</span><a class="self-link" href="#w3c-partial"></a></h3>
  <p>So that authors can exploit the forward-compatible parsing rules to
    assign fallback values, CSS renderers <strong>must</strong> treat as invalid (and <a href="http://www.w3.org/TR/CSS21/conform.html#ignore">ignore
    as appropriate</a>) any at-rules, properties, property values, keywords,
    and other syntactic constructs for which they have no usable level of
    support. In particular, user agents <strong>must not</strong> selectively
    ignore unsupported component values and honor supported values in a single
    multi-value property declaration: if any value is considered invalid
    (as unsupported values must be), CSS requires that the entire declaration
    be ignored.</p>
  <h4 class="heading settled" id="w3c-conform-future-proofing"><span class="content"> Implementations of Unstable and Proprietary Features</span><a class="self-link" href="#w3c-conform-future-proofing"></a></h4>
  <p>To avoid clashes with future stable CSS features,
        the CSSWG recommends <a href="http://www.w3.org/TR/CSS/#future-proofing">following best practices</a> for the implementation of <a href="http://www.w3.org/TR/CSS/#unstable">unstable</a> features and <a href="http://www.w3.org/TR/CSS/#proprietary-extension">proprietary extensions</a> to CSS. </p>
  <h3 class="no-ref heading settled" id="w3c-testing"><span class="content"> Non-experimental implementations</span><a class="self-link" href="#w3c-testing"></a></h3>
  <p>Once a specification reaches the Candidate Recommendation stage,
    non-experimental implementations are possible, and implementors should
    release an unprefixed implementation of any CR-level feature they
    can demonstrate to be correctly implemented according to spec. </p>
  <p>To establish and maintain the interoperability of CSS across
    implementations, the CSS Working Group requests that non-experimental
    CSS renderers submit an implementation report (and, if necessary, the
    testcases used for that implementation report) to the W3C before
    releasing an unprefixed implementation of any CSS features. Testcases
    submitted to W3C are subject to review and correction by the CSS
    Working Group. </p>
  <p>Further information on submitting testcases and implementation reports
    can be found from on the CSS Working Group’s website at <a href="http://www.w3.org/Style/CSS/Test/">http://www.w3.org/Style/CSS/Test/</a>.
    Questions should be directed to the <a href="http://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a> mailing list.</p>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#anchor-element">anchor</a><span>, in § 2.3</span>
   <li><a href="#funcdef-anchor">anchor()</a><span>, in § 2.1</span>
   <li><a href="#anchor-element">anchor element</a><span>, in § 2.3</span>
   <li><a href="#anchor-function">anchor function</a><span>, in § 2</span>
   <li><a href="#anchor-name">anchor name</a><span>, in § 2.3</span>
   <li><a href="#propdef-anchor-name">anchor-name</a><span>, in § 2.3</span>
   <li><a href="#anchor-query">anchor query</a><span>, in § 2.4</span>
   <li><a href="#typedef-anchor-side">&lt;anchor-side></a><span>, in § 2.1</span>
   <li><a href="#typedef-anchor-size">&lt;anchor-size></a><span>, in § 2.2</span>
   <li><a href="#funcdef-anchor-size">anchor-size()</a><span>, in § 2.2</span>
   <li><a href="#valdef-anchor-size-block">block</a><span>, in § 2.2</span>
   <li><a href="#valdef-anchor-bottom">bottom</a><span>, in § 2.1</span>
   <li><a href="#valdef-anchor-center">center</a><span>, in § 2.1</span>
   <li>
    &lt;dashed-ident>
    <ul>
     <li><a href="#valdef-anchor-name-dashed-ident">value for anchor-name</a><span>, in § 2.3</span>
     <li><a href="#valdef-position-fallback-dashed-ident">value for position-fallback</a><span>, in § 3.1</span>
    </ul>
   <li><a href="#valdef-anchor-end">end</a><span>, in § 2.1</span>
   <li><a href="#valdef-anchor-size-height">height</a><span>, in § 2.2</span>
   <li><a href="#implicit-anchor-elements">implicit anchor elements</a><span>, in § 2.3</span>
   <li><a href="#valdef-anchor-size-inline">inline</a><span>, in § 2.2</span>
   <li><a href="#valid-anchor-query">invalid</a><span>, in § 2.4</span>
   <li><a href="#valid-anchor-query">invalid anchor query</a><span>, in § 2.4</span>
   <li><a href="#valdef-anchor-left">left</a><span>, in § 2.1</span>
   <li>
    none
    <ul>
     <li><a href="#valdef-anchor-name-none">value for anchor-name</a><span>, in § 2.3</span>
     <li><a href="#valdef-position-fallback-none">value for position-fallback</a><span>, in § 3.1</span>
    </ul>
   <li><a href="#at-ruledef-position-fallback">@position-fallback</a><span>, in § 3.2</span>
   <li><a href="#propdef-position-fallback">position-fallback</a><span>, in § 3.1</span>
   <li><a href="#position-fallback-list">position fallback list</a><span>, in § 3.2</span>
   <li><a href="#valdef-anchor-right">right</a><span>, in § 2.1</span>
   <li><a href="#valdef-anchor-size-self-block">self-block</a><span>, in § 2.2</span>
   <li><a href="#valdef-anchor-self-end">self-end</a><span>, in § 2.1</span>
   <li><a href="#valdef-anchor-size-self-inline">self-inline</a><span>, in § 2.2</span>
   <li><a href="#valdef-anchor-self-start">self-start</a><span>, in § 2.1</span>
   <li><a href="#valdef-anchor-start">start</a><span>, in § 2.1</span>
   <li><a href="#target-anchor-element">target anchor element</a><span>, in § 2.3</span>
   <li><a href="#valdef-anchor-top">top</a><span>, in § 2.1</span>
   <li><a href="#at-ruledef-try">@try</a><span>, in § 3.2</span>
   <li><a href="#valid-anchor-query">valid</a><span>, in § 2.4</span>
   <li><a href="#valid-anchor-query">valid anchor query</a><span>, in § 2.4</span>
   <li><a href="#valdef-anchor-size-width">width</a><span>, in § 2.2</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-box-alignment-properties">
   <a href="https://andreubotella.com/csswg-auto-build/css-align-3/#box-alignment-properties">https://andreubotella.com/csswg-auto-build/css-align-3/#box-alignment-properties</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-box-alignment-properties">2. Anchoring</a>
    <li><a href="#ref-for-box-alignment-properties①">3.2. The @position-fallback Rule</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-margin-box">
   <a href="https://andreubotella.com/csswg-auto-build/css-box-4/#margin-box">https://andreubotella.com/csswg-auto-build/css-box-4/#margin-box</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-margin-box">3.3. Applying Position Fallback</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-fragment">
   <a href="https://andreubotella.com/csswg-auto-build/css-break-4/#fragment">https://andreubotella.com/csswg-auto-build/css-break-4/#fragment</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fragment">2.1. Anchor-based Positioning: the anchor() function</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-css-property">
   <a href="https://andreubotella.com/csswg-auto-build/css-cascade-5/#css-property">https://andreubotella.com/csswg-auto-build/css-cascade-5/#css-property</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-css-property">3.2. The @position-fallback Rule</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-used-value">
   <a href="https://andreubotella.com/csswg-auto-build/css-cascade-5/#used-value">https://andreubotella.com/csswg-auto-build/css-cascade-5/#used-value</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-used-value">3.3. Applying Position Fallback</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-containing-block">
   <a href="https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block">https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-containing-block">2. Anchoring</a> <a href="#ref-for-containing-block①">(2)</a>
    <li><a href="#ref-for-containing-block②">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-containing-block③">(2)</a> <a href="#ref-for-containing-block④">(3)</a>
    <li><a href="#ref-for-containing-block⑤">2.2. Anchor-based Sizing: the anchor-size() function</a>
    <li><a href="#ref-for-containing-block⑥">2.3. Determining The Anchor: the anchor-name property</a> <a href="#ref-for-containing-block⑦">(2)</a> <a href="#ref-for-containing-block⑧">(3)</a> <a href="#ref-for-containing-block⑨">(4)</a> <a href="#ref-for-containing-block①⓪">(5)</a> <a href="#ref-for-containing-block①①">(6)</a>
    <li><a href="#ref-for-containing-block①②">3. Fallback Sizing/Positioning</a> <a href="#ref-for-containing-block①③">(2)</a>
    <li><a href="#ref-for-containing-block①④">3.2. The @position-fallback Rule</a>
    <li><a href="#ref-for-containing-block①⑤">3.3. Applying Position Fallback</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-containing-block-chain">
   <a href="https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block-chain">https://andreubotella.com/csswg-auto-build/css-display-3/#containing-block-chain</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-containing-block-chain">2.3. Determining The Anchor: the anchor-name property</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-elements">
   <a href="https://andreubotella.com/csswg-auto-build/css-display-3/#elements">https://andreubotella.com/csswg-auto-build/css-display-3/#elements</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-elements">3.3. Applying Position Fallback</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-initial-containing-block">
   <a href="https://andreubotella.com/csswg-auto-build/css-display-3/#initial-containing-block">https://andreubotella.com/csswg-auto-build/css-display-3/#initial-containing-block</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-initial-containing-block">2.3. Determining The Anchor: the anchor-name property</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-inset-properties">
   <a href="https://andreubotella.com/csswg-auto-build/css-logical-1/#inset-properties">https://andreubotella.com/csswg-auto-build/css-logical-1/#inset-properties</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-inset-properties">2. Anchoring</a>
    <li><a href="#ref-for-inset-properties①">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-inset-properties②">(2)</a>
    <li><a href="#ref-for-inset-properties③">2.4. Anchor Queries</a>
    <li><a href="#ref-for-inset-properties④">3.2. The @position-fallback Rule</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-absolute-position">
   <a href="https://andreubotella.com/csswg-auto-build/css-position-3/#absolute-position">https://andreubotella.com/csswg-auto-build/css-position-3/#absolute-position</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-absolute-position">2. Anchoring</a> <a href="#ref-for-absolute-position①">(2)</a> <a href="#ref-for-absolute-position②">(3)</a>
    <li><a href="#ref-for-absolute-position③">2.1. Anchor-based Positioning: the anchor() function</a>
    <li><a href="#ref-for-absolute-position④">2.2. Anchor-based Sizing: the anchor-size() function</a>
    <li><a href="#ref-for-absolute-position⑤">2.3. Determining The Anchor: the anchor-name property</a> <a href="#ref-for-absolute-position⑥">(2)</a>
    <li><a href="#ref-for-absolute-position⑦">2.4. Anchor Queries</a>
    <li><a href="#ref-for-absolute-position⑧">3. Fallback Sizing/Positioning</a>
    <li><a href="#ref-for-absolute-position⑨">3.1. The position-fallback Property</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-absolute-position">
   <a href="https://andreubotella.com/csswg-auto-build/css-position-3/#absolute-position">https://andreubotella.com/csswg-auto-build/css-position-3/#absolute-position</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-absolute-position">2. Anchoring</a> <a href="#ref-for-absolute-position①">(2)</a> <a href="#ref-for-absolute-position②">(3)</a>
    <li><a href="#ref-for-absolute-position③">2.1. Anchor-based Positioning: the anchor() function</a>
    <li><a href="#ref-for-absolute-position④">2.2. Anchor-based Sizing: the anchor-size() function</a>
    <li><a href="#ref-for-absolute-position⑤">2.3. Determining The Anchor: the anchor-name property</a> <a href="#ref-for-absolute-position⑥">(2)</a>
    <li><a href="#ref-for-absolute-position⑦">2.4. Anchor Queries</a>
    <li><a href="#ref-for-absolute-position⑧">3. Fallback Sizing/Positioning</a>
    <li><a href="#ref-for-absolute-position⑨">3.1. The position-fallback Property</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-absolute-position">
   <a href="https://andreubotella.com/csswg-auto-build/css-position-3/#absolute-position">https://andreubotella.com/csswg-auto-build/css-position-3/#absolute-position</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-absolute-position">2. Anchoring</a> <a href="#ref-for-absolute-position①">(2)</a> <a href="#ref-for-absolute-position②">(3)</a>
    <li><a href="#ref-for-absolute-position③">2.1. Anchor-based Positioning: the anchor() function</a>
    <li><a href="#ref-for-absolute-position④">2.2. Anchor-based Sizing: the anchor-size() function</a>
    <li><a href="#ref-for-absolute-position⑤">2.3. Determining The Anchor: the anchor-name property</a> <a href="#ref-for-absolute-position⑥">(2)</a>
    <li><a href="#ref-for-absolute-position⑦">2.4. Anchor Queries</a>
    <li><a href="#ref-for-absolute-position⑧">3. Fallback Sizing/Positioning</a>
    <li><a href="#ref-for-absolute-position⑨">3.1. The position-fallback Property</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-propdef-bottom">
   <a href="https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-bottom">https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-bottom</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-propdef-bottom">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-propdef-bottom①">(2)</a> <a href="#ref-for-propdef-bottom②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-propdef-inset-inline-start">
   <a href="https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-inset-inline-start">https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-inset-inline-start</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-propdef-inset-inline-start">2.1. Anchor-based Positioning: the anchor() function</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-inset-modified-containing-block">
   <a href="https://andreubotella.com/csswg-auto-build/css-position-3/#inset-modified-containing-block">https://andreubotella.com/csswg-auto-build/css-position-3/#inset-modified-containing-block</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-inset-modified-containing-block">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-inset-modified-containing-block①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-propdef-left">
   <a href="https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-left">https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-left</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-propdef-left">2.1. Anchor-based Positioning: the anchor() function</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-propdef-right">
   <a href="https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-right">https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-right</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-propdef-right">2.1. Anchor-based Positioning: the anchor() function</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-propdef-top">
   <a href="https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-top">https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-top</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-propdef-top">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-propdef-top①">(2)</a> <a href="#ref-for-propdef-top②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-sizing-property">
   <a href="https://andreubotella.com/csswg-auto-build/css-sizing-3/#sizing-property">https://andreubotella.com/csswg-auto-build/css-sizing-3/#sizing-property</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sizing-property">2.2. Anchor-based Sizing: the anchor-size() function</a>
    <li><a href="#ref-for-sizing-property①">2.4. Anchor Queries</a>
    <li><a href="#ref-for-sizing-property②">3.2. The @position-fallback Rule</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-propdef-width">
   <a href="https://andreubotella.com/csswg-auto-build/css-sizing-3/#propdef-width">https://andreubotella.com/csswg-auto-build/css-sizing-3/#propdef-width</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-propdef-width">2.2. Anchor-based Sizing: the anchor-size() function</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-typedef-declaration-list">
   <a href="https://andreubotella.com/csswg-auto-build/css-syntax-3/#typedef-declaration-list">https://andreubotella.com/csswg-auto-build/css-syntax-3/#typedef-declaration-list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-typedef-declaration-list">3.2. The @position-fallback Rule</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-typedef-rule-list">
   <a href="https://andreubotella.com/csswg-auto-build/css-syntax-3/#typedef-rule-list">https://andreubotella.com/csswg-auto-build/css-syntax-3/#typedef-rule-list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-typedef-rule-list">3.2. The @position-fallback Rule</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-comb-comma">
   <a href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-comma">https://andreubotella.com/csswg-auto-build/css-values-4/#comb-comma</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-comb-comma">2.1. Anchor-based Positioning: the anchor() function</a>
    <li><a href="#ref-for-comb-comma①">2.2. Anchor-based Sizing: the anchor-size() function</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-typedef-dashed-ident">
   <a href="https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-dashed-ident">https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-dashed-ident</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-typedef-dashed-ident">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-typedef-dashed-ident①">(2)</a>
    <li><a href="#ref-for-typedef-dashed-ident②">2.2. Anchor-based Sizing: the anchor-size() function</a>
    <li><a href="#ref-for-typedef-dashed-ident③">2.3. Determining The Anchor: the anchor-name property</a> <a href="#ref-for-typedef-dashed-ident④">(2)</a> <a href="#ref-for-typedef-dashed-ident⑤">(3)</a>
    <li><a href="#ref-for-typedef-dashed-ident⑥">3.1. The position-fallback Property</a> <a href="#ref-for-typedef-dashed-ident⑦">(2)</a>
    <li><a href="#ref-for-typedef-dashed-ident⑧">3.2. The @position-fallback Rule</a> <a href="#ref-for-typedef-dashed-ident⑨">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-typedef-length-percentage">
   <a href="https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-length-percentage">https://andreubotella.com/csswg-auto-build/css-values-4/#typedef-length-percentage</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-typedef-length-percentage">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-typedef-length-percentage①">(2)</a>
    <li><a href="#ref-for-typedef-length-percentage②">2.2. Anchor-based Sizing: the anchor-size() function</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-length-value">
   <a href="https://andreubotella.com/csswg-auto-build/css-values-4/#length-value">https://andreubotella.com/csswg-auto-build/css-values-4/#length-value</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-length-value">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-length-value①">(2)</a> <a href="#ref-for-length-value②">(3)</a>
    <li><a href="#ref-for-length-value③">2.2. Anchor-based Sizing: the anchor-size() function</a> <a href="#ref-for-length-value④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-percentage-value">
   <a href="https://andreubotella.com/csswg-auto-build/css-values-4/#percentage-value">https://andreubotella.com/csswg-auto-build/css-values-4/#percentage-value</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-percentage-value">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-percentage-value①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-mult-opt">
   <a href="https://andreubotella.com/csswg-auto-build/css-values-4/#mult-opt">https://andreubotella.com/csswg-auto-build/css-values-4/#mult-opt</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-mult-opt">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-mult-opt①">(2)</a>
    <li><a href="#ref-for-mult-opt②">2.2. Anchor-based Sizing: the anchor-size() function</a> <a href="#ref-for-mult-opt③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-math-function">
   <a href="https://andreubotella.com/csswg-auto-build/css-values-4/#math-function">https://andreubotella.com/csswg-auto-build/css-values-4/#math-function</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-math-function">2.1. Anchor-based Positioning: the anchor() function</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-comb-one">
   <a href="https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one">https://andreubotella.com/csswg-auto-build/css-values-4/#comb-one</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-comb-one">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-comb-one①">(2)</a> <a href="#ref-for-comb-one②">(3)</a> <a href="#ref-for-comb-one③">(4)</a> <a href="#ref-for-comb-one④">(5)</a> <a href="#ref-for-comb-one⑤">(6)</a> <a href="#ref-for-comb-one⑥">(7)</a> <a href="#ref-for-comb-one⑦">(8)</a> <a href="#ref-for-comb-one⑧">(9)</a>
    <li><a href="#ref-for-comb-one⑨">2.2. Anchor-based Sizing: the anchor-size() function</a> <a href="#ref-for-comb-one①⓪">(2)</a> <a href="#ref-for-comb-one①①">(3)</a> <a href="#ref-for-comb-one①②">(4)</a> <a href="#ref-for-comb-one①③">(5)</a>
    <li><a href="#ref-for-comb-one①④">2.3. Determining The Anchor: the anchor-name property</a>
    <li><a href="#ref-for-comb-one①⑤">3.1. The position-fallback Property</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-writing-mode">
   <a href="https://andreubotella.com/csswg-auto-build/css-writing-modes-4/#writing-mode">https://andreubotella.com/csswg-auto-build/css-writing-modes-4/#writing-mode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-writing-mode">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-writing-mode①">(2)</a> <a href="#ref-for-writing-mode②">(3)</a>
    <li><a href="#ref-for-writing-mode③">2.2. Anchor-based Sizing: the anchor-size() function</a> <a href="#ref-for-writing-mode④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-the-input-element">
   <a href="https://html.spec.whatwg.org/multipage/input.html#the-input-element">https://html.spec.whatwg.org/multipage/input.html#the-input-element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-the-input-element">2.1. Anchor-based Positioning: the anchor() function</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-iterate">
   <a href="https://infra.spec.whatwg.org/#list-iterate">https://infra.spec.whatwg.org/#list-iterate</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-iterate">3.3. Applying Position Fallback</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSS-ALIGN-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-box-alignment-properties">box alignment properties</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-BOX-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-margin-box">margin box</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-BREAK-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-fragment">fragment</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-CASCADE-5]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-css-property">property</span>
     <li><span class="dfn-paneled" id="term-for-used-value">used value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-DISPLAY-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-containing-block">containing block</span>
     <li><span class="dfn-paneled" id="term-for-containing-block-chain">containing block chain</span>
     <li><span class="dfn-paneled" id="term-for-elements">element</span>
     <li><span class="dfn-paneled" id="term-for-initial-containing-block">initial containing block</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-LOGICAL-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-inset-properties">inset properties</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-POSITION-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-absolute-position">absolute position</span>
     <li><span class="dfn-paneled" id="term-for-absolute-position①">absolutely position</span>
     <li><span class="dfn-paneled" id="term-for-absolute-position②">absolutely-positioned</span>
     <li><span class="dfn-paneled" id="term-for-propdef-bottom">bottom</span>
     <li><span class="dfn-paneled" id="term-for-propdef-inset-inline-start">inset-inline-start</span>
     <li><span class="dfn-paneled" id="term-for-inset-modified-containing-block">inset-modified containing block</span>
     <li><span class="dfn-paneled" id="term-for-propdef-left">left</span>
     <li><span class="dfn-paneled" id="term-for-propdef-right">right</span>
     <li><span class="dfn-paneled" id="term-for-propdef-top">top</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-SIZING-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-sizing-property">sizing property</span>
     <li><span class="dfn-paneled" id="term-for-propdef-width">width</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-SYNTAX-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-typedef-declaration-list">&lt;declaration-list></span>
     <li><span class="dfn-paneled" id="term-for-typedef-rule-list">&lt;rule-list></span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-VALUES-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-comb-comma">,</span>
     <li><span class="dfn-paneled" id="term-for-typedef-dashed-ident">&lt;dashed-ident></span>
     <li><span class="dfn-paneled" id="term-for-typedef-length-percentage">&lt;length-percentage></span>
     <li><span class="dfn-paneled" id="term-for-length-value">&lt;length></span>
     <li><span class="dfn-paneled" id="term-for-percentage-value">&lt;percentage></span>
     <li><span class="dfn-paneled" id="term-for-mult-opt">?</span>
     <li><span class="dfn-paneled" id="term-for-math-function">math function</span>
     <li><span class="dfn-paneled" id="term-for-comb-one">|</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-WRITING-MODES-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-writing-mode">writing mode</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-the-input-element">input</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-list-iterate">iterate</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-align-3">[CSS-ALIGN-3]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://andreubotella.com/csswg-auto-build/css-align/"><cite>CSS Box Alignment Module Level 3</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/css-align/">https://andreubotella.com/csswg-auto-build/css-align/</a>
   <dt id="biblio-css-box-4">[CSS-BOX-4]
   <dd>Elika Etemad. <a href="https://andreubotella.com/csswg-auto-build/css-box-4/"><cite>CSS Box Model Module Level 4</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/css-box-4/">https://andreubotella.com/csswg-auto-build/css-box-4/</a>
   <dt id="biblio-css-break-4">[CSS-BREAK-4]
   <dd>Rossen Atanassov; Elika Etemad. <a href="https://andreubotella.com/csswg-auto-build/css-break-4/"><cite>CSS Fragmentation Module Level 4</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/css-break-4/">https://andreubotella.com/csswg-auto-build/css-break-4/</a>
   <dt id="biblio-css-cascade-5">[CSS-CASCADE-5]
   <dd>Elika Etemad; Miriam Suzanne; Tab Atkins Jr.. <a href="https://andreubotella.com/csswg-auto-build/css-cascade-5/"><cite>CSS Cascading and Inheritance Level 5</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/css-cascade-5/">https://andreubotella.com/csswg-auto-build/css-cascade-5/</a>
   <dt id="biblio-css-display-3">[CSS-DISPLAY-3]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://andreubotella.com/csswg-auto-build/css-display/"><cite>CSS Display Module Level 3</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/css-display/">https://andreubotella.com/csswg-auto-build/css-display/</a>
   <dt id="biblio-css-logical-1">[CSS-LOGICAL-1]
   <dd>Rossen Atanassov; Elika Etemad. <a href="https://andreubotella.com/csswg-auto-build/css-logical-1/"><cite>CSS Logical Properties and Values Level 1</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/css-logical-1/">https://andreubotella.com/csswg-auto-build/css-logical-1/</a>
   <dt id="biblio-css-position-3">[CSS-POSITION-3]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://andreubotella.com/csswg-auto-build/css-position-3/"><cite>CSS Positioned Layout Module Level 3</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/css-position-3/">https://andreubotella.com/csswg-auto-build/css-position-3/</a>
   <dt id="biblio-css-sizing-3">[CSS-SIZING-3]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://andreubotella.com/csswg-auto-build/css-sizing-3/"><cite>CSS Box Sizing Module Level 3</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/css-sizing-3/">https://andreubotella.com/csswg-auto-build/css-sizing-3/</a>
   <dt id="biblio-css-syntax-3">[CSS-SYNTAX-3]
   <dd>Tab Atkins Jr.; Simon Sapin. <a href="https://andreubotella.com/csswg-auto-build/css-syntax/"><cite>CSS Syntax Module Level 3</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/css-syntax/">https://andreubotella.com/csswg-auto-build/css-syntax/</a>
   <dt id="biblio-css-values-4">[CSS-VALUES-4]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://andreubotella.com/csswg-auto-build/css-values-4/"><cite>CSS Values and Units Module Level 4</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/css-values-4/">https://andreubotella.com/csswg-auto-build/css-values-4/</a>
   <dt id="biblio-css-writing-modes-4">[CSS-WRITING-MODES-4]
   <dd>Elika Etemad; Koji Ishii. <a href="https://andreubotella.com/csswg-auto-build/css-writing-modes-4/"><cite>CSS Writing Modes Level 4</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/css-writing-modes-4/">https://andreubotella.com/csswg-auto-build/css-writing-modes-4/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="property-index"><span class="content">Property Index</span><a class="self-link" href="#property-index"></a></h2>
  <div class="big-element-wrapper">
   <table class="index">
    <thead>
     <tr>
      <th scope="col">Name
      <th scope="col">Value
      <th scope="col">Initial
      <th scope="col">Applies to
      <th scope="col">Inh.
      <th scope="col">%ages
      <th scope="col">Anim­ation type
      <th scope="col">Canonical order
      <th scope="col">Com­puted value
    <tbody>
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-anchor-name" id="ref-for-propdef-anchor-name①">anchor-name</a>
      <td>none | &lt;dashed-ident>
      <td>none
      <td>all elements
      <td>no
      <td>n/a
      <td>discrete
      <td>per grammar
      <td>as specified
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-position-fallback" id="ref-for-propdef-position-fallback③">position-fallback</a>
      <td>none | &lt;dashed-ident>
      <td>none
      <td>absolutely-positioned elements
      <td>no
      <td>n/a
      <td>discrete
      <td>per grammar
      <td>as specified
   </table>
  </div>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Do we need to refer to the anchor element’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/css-writing-modes-4/#writing-mode">writing mode</a>?
I think that’s too unpredictable to actually do anything useful.
If you’re specifying your <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/css-position-3/#propdef-inset-inline-start">inset-inline-start</a> property,
you almost certainly want to refer to an anchor edge
relative to your own directions,
not an unpredictable edge based on the anchor. <a class="issue-return" href="#issue-c74bca11" title="Jump to section">↵</a></div>
   <div class="issue"> Do we need to control which box we’re referring to,
so you can align to padding or content edge? <a class="issue-return" href="#issue-3c6fe13f" title="Jump to section">↵</a></div>
   <div class="issue"> Per flackr/iank feedback,
this should be able to respond to the scroll position
of the anchor element,
both for positioning and for fallback,
in a way essentially identical to @scroll-timeline.
Precise timing + details to be filled in. <a class="issue-return" href="#issue-c27c1cde" title="Jump to section">↵</a></div>
   <div class="issue"> What exactly are the constraints that determine what’s allowed here?
Current list is based off of what’s reasonable
from Chrome’s experimental impl.
We can make a CQ that keys off of which fallback was used
to allow more general styling,
at least for descendants. <a class="issue-return" href="#issue-14452576" title="Jump to section">↵</a></div>
   <div class="issue"> If you have a bunch of elements
that all use the same positioning and fallback,
just relative to different anchor elements
(like a bunch of tooltips),
there’s no way to have them share @position-fallback rules;
they each need a unique set.
This sucks!
Should figure out some way to address this. <a class="issue-return" href="#issue-0dfe4786" title="Jump to section">↵</a></div>
   <div class="issue"> Would be useful to be able to detect
when your anchor(s) are fully off-screen
and suppress your display entirely.
For example, tooltips living outside the scroller
holding the text they’re anchored to
don’t want to just hover over arbitrary parts of the page
because their anchor happens to have that position
relative to the scrollport. <a class="issue-return" href="#issue-5b530169" title="Jump to section">↵</a></div>
   <div class="issue"> This implies that the values can’t be transitioned in the usual fashion,
since transitions key off of computed values
and we’re past that point.
However, popups sliding between positions is a common effect in UI libs.
Probably should introduce a <span class="css">smooth</span> keyword
to <a class="property css" data-link-type="property" href="#propdef-position-fallback">position-fallback</a> to trigger automatic "animation" of the fallback’d properties. <a class="issue-return" href="#issue-0b311ea0" title="Jump to section">↵</a></div>
   <div class="issue">
     Nested anchors
	(an anchored element inside of another anchored element)
	present the potential for exponential blow-up of layouts
	when doing fallback,
	since the grandchild anchored element can cause scrollbars on an ancestor,
	changing the IMCB for the child anchored element,
	thus possibly causing the fallback choice to change for it. 
    <p>There are strategies to avoid this,
	but they’re not without costs of their own.
	We should <em>probably</em> impose a <strong>maximum</strong> limit as well,
	to avoid this.</p>
    <p>However, since *most* usages won’t be problematic in the first place,
	we don’t want to restrict them unduly
	just to prevent weird situations from exploding.
	Perhaps a complexity budget based on the branching factor at each level?
	Like, accumulate the product of the fallback list lengths from ancestors,
	and your fallback list gets limited to not exceed a total product
	of, say, 1k.
	Get too deep and you’re stuck with your first choice only!
	But this would allow large, complex fallback lists for top-level stuff,
	and even some reasonable nesting.
	(Length-five lists could be nested to depth of 4, for example,
	if we did go with 1k.)</p>
    <p>More thought is needed.</p>
     <a class="issue-return" href="#issue-52cb8f94" title="Jump to section">↵</a>
   </div>
  </div>
  <aside class="dfn-panel" data-for="anchor-function">
   <b><a href="#anchor-function">#anchor-function</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-anchor-function">2.3. Determining The Anchor: the anchor-name property</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="funcdef-anchor">
   <b><a href="#funcdef-anchor">#funcdef-anchor</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-funcdef-anchor">2. Anchoring</a>
    <li><a href="#ref-for-funcdef-anchor①">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-funcdef-anchor②">(2)</a> <a href="#ref-for-funcdef-anchor③">(3)</a> <a href="#ref-for-funcdef-anchor④">(4)</a> <a href="#ref-for-funcdef-anchor⑤">(5)</a> <a href="#ref-for-funcdef-anchor⑥">(6)</a> <a href="#ref-for-funcdef-anchor⑦">(7)</a> <a href="#ref-for-funcdef-anchor⑧">(8)</a>
    <li><a href="#ref-for-funcdef-anchor⑨">2.2. Anchor-based Sizing: the anchor-size() function</a> <a href="#ref-for-funcdef-anchor①⓪">(2)</a>
    <li><a href="#ref-for-funcdef-anchor①①">2.4. Anchor Queries</a> <a href="#ref-for-funcdef-anchor①②">(2)</a> <a href="#ref-for-funcdef-anchor①③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="typedef-anchor-side">
   <b><a href="#typedef-anchor-side">#typedef-anchor-side</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-typedef-anchor-side">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-typedef-anchor-side①">(2)</a> <a href="#ref-for-typedef-anchor-side②">(3)</a> <a href="#ref-for-typedef-anchor-side③">(4)</a> <a href="#ref-for-typedef-anchor-side④">(5)</a>
    <li><a href="#ref-for-typedef-anchor-side⑤">2.2. Anchor-based Sizing: the anchor-size() function</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="valdef-anchor-top">
   <b><a href="#valdef-anchor-top">#valdef-anchor-top</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valdef-anchor-top">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-valdef-anchor-top①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="valdef-anchor-bottom">
   <b><a href="#valdef-anchor-bottom">#valdef-anchor-bottom</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valdef-anchor-bottom">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-valdef-anchor-bottom①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="valdef-anchor-start">
   <b><a href="#valdef-anchor-start">#valdef-anchor-start</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valdef-anchor-start">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-valdef-anchor-start①">(2)</a> <a href="#ref-for-valdef-anchor-start②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="valdef-anchor-end">
   <b><a href="#valdef-anchor-end">#valdef-anchor-end</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valdef-anchor-end">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-valdef-anchor-end①">(2)</a> <a href="#ref-for-valdef-anchor-end②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="valdef-anchor-self-start">
   <b><a href="#valdef-anchor-self-start">#valdef-anchor-self-start</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valdef-anchor-self-start">2.1. Anchor-based Positioning: the anchor() function</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="valdef-anchor-self-end">
   <b><a href="#valdef-anchor-self-end">#valdef-anchor-self-end</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valdef-anchor-self-end">2.1. Anchor-based Positioning: the anchor() function</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="funcdef-anchor-size">
   <b><a href="#funcdef-anchor-size">#funcdef-anchor-size</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-funcdef-anchor-size">2. Anchoring</a>
    <li><a href="#ref-for-funcdef-anchor-size①">2.2. Anchor-based Sizing: the anchor-size() function</a> <a href="#ref-for-funcdef-anchor-size②">(2)</a> <a href="#ref-for-funcdef-anchor-size③">(3)</a> <a href="#ref-for-funcdef-anchor-size④">(4)</a>
    <li><a href="#ref-for-funcdef-anchor-size⑤">2.4. Anchor Queries</a> <a href="#ref-for-funcdef-anchor-size⑥">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="typedef-anchor-size">
   <b><a href="#typedef-anchor-size">#typedef-anchor-size</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-typedef-anchor-size">2.2. Anchor-based Sizing: the anchor-size() function</a> <a href="#ref-for-typedef-anchor-size①">(2)</a> <a href="#ref-for-typedef-anchor-size②">(3)</a> <a href="#ref-for-typedef-anchor-size③">(4)</a> <a href="#ref-for-typedef-anchor-size④">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="valdef-anchor-size-block">
   <b><a href="#valdef-anchor-size-block">#valdef-anchor-size-block</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valdef-anchor-size-block">2.2. Anchor-based Sizing: the anchor-size() function</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="valdef-anchor-size-inline">
   <b><a href="#valdef-anchor-size-inline">#valdef-anchor-size-inline</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valdef-anchor-size-inline">2.2. Anchor-based Sizing: the anchor-size() function</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="valdef-anchor-size-self-block">
   <b><a href="#valdef-anchor-size-self-block">#valdef-anchor-size-self-block</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valdef-anchor-size-self-block">2.2. Anchor-based Sizing: the anchor-size() function</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="valdef-anchor-size-self-inline">
   <b><a href="#valdef-anchor-size-self-inline">#valdef-anchor-size-self-inline</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valdef-anchor-size-self-inline">2.2. Anchor-based Sizing: the anchor-size() function</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="propdef-anchor-name">
   <b><a href="#propdef-anchor-name">#propdef-anchor-name</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-propdef-anchor-name">2.3. Determining The Anchor: the anchor-name property</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="anchor-element">
   <b><a href="#anchor-element">#anchor-element</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-anchor-element">2. Anchoring</a>
    <li><a href="#ref-for-anchor-element①">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-anchor-element②">(2)</a> <a href="#ref-for-anchor-element③">(3)</a>
    <li><a href="#ref-for-anchor-element④">2.2. Anchor-based Sizing: the anchor-size() function</a>
    <li><a href="#ref-for-anchor-element⑤">2.3. Determining The Anchor: the anchor-name property</a> <a href="#ref-for-anchor-element⑥">(2)</a> <a href="#ref-for-anchor-element⑦">(3)</a> <a href="#ref-for-anchor-element⑧">(4)</a>
    <li><a href="#ref-for-anchor-element⑨">2.4. Anchor Queries</a>
    <li><a href="#ref-for-anchor-element①⓪">3. Fallback Sizing/Positioning</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="anchor-name">
   <b><a href="#anchor-name">#anchor-name</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-anchor-name">2.1. Anchor-based Positioning: the anchor() function</a>
    <li><a href="#ref-for-anchor-name①">2.3. Determining The Anchor: the anchor-name property</a>
    <li><a href="#ref-for-anchor-name②">2.4. Anchor Queries</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="target-anchor-element">
   <b><a href="#target-anchor-element">#target-anchor-element</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-target-anchor-element">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-target-anchor-element①">(2)</a> <a href="#ref-for-target-anchor-element②">(3)</a> <a href="#ref-for-target-anchor-element③">(4)</a>
    <li><a href="#ref-for-target-anchor-element④">2.2. Anchor-based Sizing: the anchor-size() function</a> <a href="#ref-for-target-anchor-element⑤">(2)</a>
    <li><a href="#ref-for-target-anchor-element⑥">2.4. Anchor Queries</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="implicit-anchor-elements">
   <b><a href="#implicit-anchor-elements">#implicit-anchor-elements</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-implicit-anchor-elements">2.1. Anchor-based Positioning: the anchor() function</a>
    <li><a href="#ref-for-implicit-anchor-elements①">2.3. Determining The Anchor: the anchor-name property</a> <a href="#ref-for-implicit-anchor-elements②">(2)</a> <a href="#ref-for-implicit-anchor-elements③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="anchor-query">
   <b><a href="#anchor-query">#anchor-query</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-anchor-query">2.4. Anchor Queries</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="valid-anchor-query">
   <b><a href="#valid-anchor-query">#valid-anchor-query</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valid-anchor-query">2.1. Anchor-based Positioning: the anchor() function</a> <a href="#ref-for-valid-anchor-query①">(2)</a>
    <li><a href="#ref-for-valid-anchor-query②">2.2. Anchor-based Sizing: the anchor-size() function</a>
    <li><a href="#ref-for-valid-anchor-query③">2.4. Anchor Queries</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="propdef-position-fallback">
   <b><a href="#propdef-position-fallback">#propdef-position-fallback</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-propdef-position-fallback">3. Fallback Sizing/Positioning</a>
    <li><a href="#ref-for-propdef-position-fallback①">3.1. The position-fallback Property</a>
    <li><a href="#ref-for-propdef-position-fallback②">3.3. Applying Position Fallback</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="at-ruledef-position-fallback">
   <b><a href="#at-ruledef-position-fallback">#at-ruledef-position-fallback</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-at-ruledef-position-fallback">3. Fallback Sizing/Positioning</a>
    <li><a href="#ref-for-at-ruledef-position-fallback①">3.1. The position-fallback Property</a>
    <li><a href="#ref-for-at-ruledef-position-fallback②">3.2. The @position-fallback Rule</a> <a href="#ref-for-at-ruledef-position-fallback③">(2)</a> <a href="#ref-for-at-ruledef-position-fallback④">(3)</a> <a href="#ref-for-at-ruledef-position-fallback⑤">(4)</a> <a href="#ref-for-at-ruledef-position-fallback⑥">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="at-ruledef-try">
   <b><a href="#at-ruledef-try">#at-ruledef-try</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-at-ruledef-try">3.2. The @position-fallback Rule</a> <a href="#ref-for-at-ruledef-try①">(2)</a> <a href="#ref-for-at-ruledef-try②">(3)</a> <a href="#ref-for-at-ruledef-try③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="position-fallback-list">
   <b><a href="#position-fallback-list">#position-fallback-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-position-fallback-list">3.1. The position-fallback Property</a> <a href="#ref-for-position-fallback-list①">(2)</a>
    <li><a href="#ref-for-position-fallback-list②">3.2. The @position-fallback Rule</a>
    <li><a href="#ref-for-position-fallback-list③">3.3. Applying Position Fallback</a> <a href="#ref-for-position-fallback-list④">(2)</a> <a href="#ref-for-position-fallback-list⑤">(3)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    {
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>