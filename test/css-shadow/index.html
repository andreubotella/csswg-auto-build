<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>CSS Shadow Module Level 1</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <meta content="Bikeshed version 0ef803fdf, updated Tue Jan 6 11:59:39 2026 -0800" name="generator">
  <link href="https://drafts.csswg.org/css-shadow-1/" rel="canonical">
  <link href="https://drafts.csswg.org/csslogo.ico" rel="icon">
  <meta content="b7d9aa16a8fb6e7a6e3705b83e13daf5c3967108" name="revision">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example " counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-idl-highlighting */
pre.idl.highlight {
    background: var(--borderedblock-bg, var(--def-bg));
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

[data-algorithm] var { cursor: pointer; }
var[data-var-color] { background-color: var(--var-bg); box-shadow: 0 0 0 2px var(--var-bg); }

var[data-var-color] { --var-bg: #F4D200; }
var[data-var-color="1"] { --var-bg: #FF87A2; }
var[data-var-color="2"] { --var-bg: #96E885; }
var[data-var-color="3"] { --var-bg: #3EEED2; }
var[data-var-color="4"] { --var-bg: #EACFB6; }
var[data-var-color="5"] { --var-bg: #82DDFF; }
var[data-var-color="6"] { --var-vg: #FFBCF2; }

@media (prefers-color-scheme: dark) {
	var[data-var-color] { --var-bg: #bc1a00; }
	var[data-var-color="1"] { --var-bg: #007f00; }
	var[data-var-color="2"] { --var-bg: #008698; }
	var[data-var-color="3"] { --var-bg: #7f5b2b; }
	var[data-var-color="4"] { --var-bg: #004df3; }
	var[data-var-color="5"] { --var-bg: #a1248a; }
	var[data-var-color="6"] { --var-vg: #ff0000; }
}
</style>
<style>/* Boilerplate: style-wpt */
:root {
    --wpt-border: hsl(0, 0%, 60%);
    --wpt-bg: hsl(0, 0%, 95%);
    --wpt-text: var(--text);
    --wptheading-text: hsl(0, 0%, 30%);
}
@media (prefers-color-scheme: dark) {
    :root {
        --wpt-border: hsl(0, 0%, 30%);
        --wpt-bg: var(--borderedblock-bg);
        --wpt-text: var(--text);
        --wptheading-text: hsl(0, 0%, 60%);
    }
}
.wpt-tests-block {
    list-style: none;
    border-left: .5em solid var(--wpt-border);
    background: var(--wpt-bg);
    color: var(--wpt-text);
    margin: 1em auto;
    padding: .5em;
}
.wpt-tests-block summary {
    color: var(--wptheading-text);
    font-weight: normal;
    text-transform: uppercase;
}
.wpt-tests-block summary::marker{
    color: var(--wpt-border);
}
.wpt-tests-block summary:hover::marker{
    color: var(--wpt-text);
}
/*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
.wpt-tests-block:not([open]){
    padding: 0;
    border: none;
    background: none;
    font-size: 0.75em;
    line-height: 1;
    position: relative;
    margin: 1em 0 0;
}
.wpt-tests-block:not([open]) summary {
    position: absolute;
    right: 0;
    bottom: 0;
}
/*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
.wpt-tests-block:not([open]):last-child {
    padding-bottom: 1px;
    margin-bottom: -1px;
}
/*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
li:not(:last-child) > .wpt-tests-block:not([open]):last-child,
dd:not(:last-child) > .wpt-tests-block:not([open]):last-child {
    padding-bottom: 0;
    margin-bottom: 0;
}
.wpt-tests-block:not([open]):not(:hover){
    opacity: 0.5;
}
.wpt-tests-list {
    list-style: none;
    display: grid;
    margin: 0;
    padding: 0;
    grid-template-columns: 1fr max-content auto auto;
    grid-column-gap: .5em;
}
.wpt-tests-block hr:last-child {
    display: none;
}
.wpt-test {
    display: contents;
}
.wpt-test > a {
    text-decoration: underline;
    border: none;
}
.wpt-test > .wpt-name { grid-column: 1; }
.wpt-test > .wpt-results { grid-column: 2; }
.wpt-test > .wpt-live { grid-column: 3; }
.wpt-test > .wpt-source { grid-column: 4; }

.wpt-test > .wpt-results {
    display: flex;
    gap: .1em;
}
.wpt-test .wpt-result {
    display: inline-block;
    height: 1em;
    width: 1em;
    border-radius: 50%;
    position: relative;
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/">
    <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
</a>
</p>
   <h1 class="no-ref p-name" id="title">CSS Shadow Module Level 1</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#ED">Editor’s Draft</a>,
    <time class="dt-updated" datetime="2026-01-16">16 January 2026</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://drafts.csswg.org/css-shadow-1/">https://drafts.csswg.org/css-shadow-1/</a>
      <dt>Previous Versions:
      <dd><a href="https://www.w3.org/TR/2014/WD-css-scoping-1-20140403/" rel="prev">https://www.w3.org/TR/2014/WD-css-scoping-1-20140403/</a>
      <dt>Issue Tracking:
      <dd><a href="https://github.com/w3c/csswg-drafts/labels/css-shadow-1">CSSWG Issues Repository</a>
      <dd><a href="#issues-index">Inline In Spec</a>
      <dt class="editor">Editors:
      <dd class="editor h-card p-author vcard" data-editor-id="42199"><a class="fn p-name u-url url" href="http://xanthir.com/contact/">Tab Atkins Jr.</a> (<span class="org p-org">Google</span>)
      <dd class="editor h-card p-author vcard" data-editor-id="106713"><a class="email fn p-name u-email" href="mailto:fergal@chromium.org">Fergal Daly</a> (<span class="org p-org">Google</span>)
      <dt>Suggest an Edit for this Spec:
      <dd><a href="https://github.com/w3c/csswg-drafts/blob/main/css-shadow-1/Overview.bs">GitHub Editor</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 2026 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply.
</p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="heading no-num no-ref no-toc settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This module defines ways for CSS to interact with Shadow DOM and its scoping mechanism.</p>
   


<a href="https://www.w3.org/TR/CSS/">CSS</a> is a language for describing the rendering of structured documents
(such as HTML and XML)
on screen, on paper, etc.


  </div>
  <h2 class="heading no-num no-ref no-toc settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p>
	This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress.

</p>
   <p>Please send feedback
	by <a href="https://github.com/w3c/csswg-drafts/issues">filing issues in GitHub</a> (preferred),
	including the spec code “css-shadow” in the title, like this:
	“[css-shadow] <i>…summary of comment…</i>”.
	All issues and comments are <a href="https://lists.w3.org/Archives/Public/public-css-archive/">archived</a>.
	Alternately, feedback can be sent to the (<a href="https://lists.w3.org/Archives/Public/www-style/">archived</a>) public mailing list
	<a href="mailto:www-style@w3.org?Subject=%5Bcss-shadow%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a>.

</p>
   <p>This document is governed by the
	<a href="https://www.w3.org/policies/process/20250818/" id="w3c_process_revision">18 August 2025 W3C Process Document</a>.

</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-ref no-toc" id="contents">Table of Contents</h2>
   <ol class="toc">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#default-element-styles"><span class="secno">2</span> <span class="content">Default Styles for Custom Elements</span></a>
    <li>
     <a href="#shadow-dom"><span class="secno">3</span> <span class="content">Shadow Encapsulation</span></a>
     <ol class="toc">
      <li><a href="#shadow-gloss"><span class="secno">3.1</span> <span class="content">Informative Explanation of Shadow DOM</span></a>
      <li>
       <a href="#selectors"><span class="secno">3.2</span> <span class="content">Shadow DOM and Selectors</span></a>
       <ol class="toc">
        <li><a href="#selectors-data-model"><span class="secno">3.2.1</span> <span class="content">
Matching Selectors Against Shadow Trees</span></a>
        <li><a href="#host-element-in-tree"><span class="secno">3.2.2</span> <span class="content">
Selecting Shadow Hosts from within a Shadow Tree</span></a>
        <li><a href="#host-selector"><span class="secno">3.2.3</span> <span class="content">
Selecting Into the Light: the <span class="css">:host</span>, <span class="css">:host()</span>, and <span class="css">:host-context()</span> pseudo-classes</span></a>
        <li><a href="#slotted-pseudo"><span class="secno">3.2.4</span> <span class="content">
Selecting Slot-Assigned Content: the <span class="css">::slotted()</span> pseudo-element</span></a>
        <li><a href="#the-has-slotted-pseudo"><span class="secno">3.2.5</span> <span class="content">
Matching on the Presence of Slot-Assigned Nodes: the <span class="css">:has-slotted</span> pseudo-class</span></a>
       </ol>
     </ol>
    <li>
     <a href="#shadow-cascading"><span class="secno">4</span> <span class="content">Shadow Trees and the Cascade</span></a>
     <ol class="toc">
      <li>
       <a href="#flattening"><span class="secno">4.1</span> <span class="content">
Flattening the DOM into an Element Tree</span></a>
       <ol class="toc">
        <li><a href="#slots-in-shadow-tree"><span class="secno">4.1.1</span> <span class="content">
Slots and Slotted Elements in a Shadow Tree</span></a>
       </ol>
      <li>
       <a href="#shadow-names"><span class="secno">4.2</span> <span class="content">
Name-Defining Constructs and Inheritance</span></a>
       <ol class="toc">
        <li><a href="#shadow-names-serialization"><span class="secno">4.2.1</span> <span class="content">
Serialized Tree-Scoped References</span></a>
       </ol>
     </ol>
    <li>
     <a href="#exposing"><span class="secno">5</span> <span class="content">Exposing a Shadow Element</span></a>
     <ol class="toc">
      <li><a href="#motivation"><span class="secno">5.1</span> <span class="content">Motivation</span></a>
      <li><a href="#part-attr"><span class="secno">5.2</span> <span class="content">Naming a Shadow Element: the <code><span>part</span></code> attribute</span></a>
      <li><a href="#exportparts-attr"><span class="secno">5.3</span> <span class="content">Forwarding a Shadow Element: the <code><span>exportparts</span></code> attribute</span></a>
      <li><a href="#part"><span class="secno">5.4</span> <span class="content">Selecting a Shadow Element: the <span class="css">::part()</span> pseudo-element</span></a>
      <li><a href="#idl"><span class="secno">5.5</span> <span class="content">Extensions to the <code class="idl"><span>Element</span></code> Interface</span></a>
      <li>
       <a href="#parsing"><span class="secno">5.6</span> <span class="content">Microsyntaxes for parsing</span></a>
       <ol class="toc">
        <li><a href="#parsing-mapping"><span class="secno">5.6.1</span> <span class="content">
Rules for parsing part mappings</span></a>
        <li><a href="#parsing-mapping-list"><span class="secno">5.6.2</span> <span class="content">
Rules for parsing a list of part mappings</span></a>
       </ol>
     </ol>
    <li><a href="#changes"><span class="secno">6</span> <span class="content">Changes</span></a>
    <li><a href="#privacy"><span class="secno">7</span> <span class="content">Privacy Considerations</span></a>
    <li><a href="#security"><span class="secno">8</span> <span class="content">Security Considerations</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">
Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">
Document conventions</span></a>
      <li><a href="#w3c-conformance-classes"><span class="secno"></span> <span class="content">
Conformance classes</span></a>
      <li>
       <a href="#w3c-partial"><span class="secno"></span> <span class="content">
Partial implementations</span></a>
       <ol class="toc">
        <li><a href="#w3c-conform-future-proofing"><span class="secno"></span> <span class="content">
Implementations of Unstable and Proprietary Features</span></a>
       </ol>
      <li><a href="#w3c-testing"><span class="secno"></span> <span class="content">
Non-experimental implementations</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>Shadow DOM allows authors to separate their page into "components",
subtrees of markup whose details are only relevant to the component itself,
not the outside page.
This reduces the chance of a style meant for one part of the page
accidentally over-applying and making a different part of the page look wrong.
However, this styling barrier also makes it harder for a page to interact with its components
when it actually <em>wants</em> to do so.</p>
   <p>This specification defines the <a class="css" data-link-type="maybe" href="#selectordef-part" id="ref-for-selectordef-part">::part()</a> pseudo-element,
which allows an author to style specific, purposely exposed elements in a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree">shadow tree</a>
from the outside page’s context.
In combination with <a data-link-type="dfn" href="https://drafts.csswg.org/css-variables-2/#custom-property" id="ref-for-custom-property">custom properties</a>,
which let the outside page pass particular values
(such as theme colors)
into the component for it to do with as it will,
these pseudo-elements allow components and the outside page
to interact in safe, powerful ways,
maintaining encapsulation
without surrendering all control.</p>
   <p>The <a class="css" data-link-type="maybe" href="#selectordef-host" id="ref-for-selectordef-host">:host</a> pseudo-class and its <a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#functional-pseudo-class" id="ref-for-functional-pseudo-class">functional counterpart</a> <a class="css" data-link-type="maybe" href="#selectordef-host-function" id="ref-for-selectordef-host-function">:host()</a> match the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree①">shadow tree’s</a> <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host">shadow host</a>.</p>
   <p>Furthermore, the <span class="css">::slotted</span> <a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#pseudo-element" id="ref-for-pseudo-element">pseudo-element</a> and the related <a class="css" data-link-type="maybe" href="#selectordef-has-slotted" id="ref-for-selectordef-has-slotted">:has-slotted</a> <a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#pseudo-class" id="ref-for-pseudo-class">pseudo-class</a> provide ways to interact with <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-slot" id="ref-for-concept-slot">slots</a> and their assigned <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree②">shadow tree</a>.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <p>General tests for shadow parts</p>
    <ul class="wpt-tests-list"></ul>
    <hr>
   </details>
   <p class="note" role="note"><span class="marker">Note:</span> This specification was originally titled CSS Scoping Module Level 1.
It has since been merged with CSS Shadow Parts Module Level 1 and renamed to CSS Shadow Module Level 1
to better reflect its comprehensive coverage of Shadow DOM features.
The <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-6/#scoped-style-rules" id="ref-for-scoped-style-rules">scoped style rules</a> feature initially described in this module has been moved to <a data-link-type="biblio" href="#biblio-css-cascade-6" title="CSS Cascading and Inheritance Level 6">[css-cascade-6]</a>.</p>
   <h2 class="heading settled" data-level="2" id="default-element-styles"><span class="secno">2. </span><span class="content">Default Styles for Custom Elements</span><a class="self-link" href="#default-element-styles"></a></h2>
   <p><strong class="advisement"> This section is <strong>experimental</strong>,
	and is under active discussion.
	Do not implement without consulting the CSSWG.</strong></p>
   <p>When defining <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/custom-elements.html#custom-element" id="ref-for-custom-element">custom elements</a>,
	one often wants to set up "default" styles for them,
	akin to the user-agent styles that apply to built-in elements.
	This is, unfortunately, hard to do in vanilla CSS,
	due to issues of scoping and specificity—​the element in question might be used in <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree③">shadow trees</a>,
	and thus is unreachable by any selector targeting it in the outermost document;
	and selectors, even low-specificity ones like simple <a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#type-selector" id="ref-for-type-selector">type selectors</a>,
	can accidentally override author-level styles meant to target the element.</p>
   <p>To aid in this, this section defines a way
	to create a stylesheet of "default element styles" for a given element.
	This stylesheet applies across the entire document,
	in all <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree④">shadow trees</a>,
	and the rules in it apply at the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#cascade-origin-ua" id="ref-for-cascade-origin-ua">user-agent origin</a>,
	so author-level rules automatically win.</p>
   <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window">Window</a></code>s gain a private slot <dfn class="dfn-paneled idl-code" data-dfn-for="Window" data-dfn-type="attribute" data-export id="dom-window-defaultelementstylesmap-slot"><code>[[defaultElementStylesMap]]</code></dfn>
	which is a map of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-local-name" id="ref-for-concept-element-local-name">local names</a> to <a data-link-type="dfn" href="https://drafts.csswg.org/css-syntax-3/#css-stylesheet" id="ref-for-css-stylesheet">stylesheets</a>.</p>
   <p>These stylesheets must apply to every document in the window.
	They must be interpreted as user agent stylesheets.</p>
   <p class="note" role="note"><span class="marker">Note:</span> This implies, in particular,
	that they apply to all <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree⑤">shadow trees</a> in every document,
	and that the declarations in them are from the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#cascade-origin-ua" id="ref-for-cascade-origin-ua①">user-agent origin</a>.</p>
   <p>For the purpose of the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-6/#cascade" id="ref-for-cascade">cascade</a>,
	these stylesheets are ordered after the user agent’s own stylesheets;
	their relative ordering doesn’t matter as it is not observable.</p>
   <p>Within these stylesheets, <a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#complex" id="ref-for-complex">complex selectors</a> must be treated as invalid.
	Every <a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#compound" id="ref-for-compound">compound selector</a> must be treated as containing an additional <a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#type-selector" id="ref-for-type-selector①">type selector</a>
	that selects elements with the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element-local-name" id="ref-for-concept-element-local-name①">local name</a>
	that the stylesheet is keyed with.</p>
   <p class="issue" id="issue-f4e1dc6b"><a class="self-link" href="#issue-f4e1dc6b"></a> Do we need to restrict the <a data-link-type="dfn" href="https://drafts.csswg.org/css-syntax-3/#at-rule" id="ref-for-at-rule">at-rules</a> that can be used in these sheets?
	For example, do we allow an <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-fonts-5/#at-font-face-rule" id="ref-for-at-font-face-rule">@font-face</a>?
	I’m going to leave it as allowed unless/until I hear complaints.</p>
   <p>This specification does not define how to add to, remove from, or generally manipulate
	the <code class="idl"><a data-link-type="idl" href="#dom-window-defaultelementstylesmap-slot" id="ref-for-dom-window-defaultelementstylesmap-slot">[[defaultElementStylesMap]]</a></code>.
	It is expected that other specifications,
	such as <a data-link-type="biblio" href="#biblio-dom" title="DOM Standard">[DOM]</a>,
	will define ways to do so.</p>
   <h2 class="heading settled" data-level="3" id="shadow-dom"><span class="secno">3. </span><span class="content">Shadow Encapsulation</span><a class="self-link" href="#shadow-dom"></a></h2>
   <h3 class="heading settled" data-level="3.1" id="shadow-gloss"><span class="secno">3.1. </span><span class="content">Informative Explanation of Shadow DOM</span><a class="self-link" href="#shadow-gloss"></a></h3>
   <p><em>The following is a non-normative explanation
	of several concepts normatively defined in the DOM Standard <a data-link-type="biblio" href="#biblio-dom" title="DOM Standard">[DOM]</a>,
	to aid in understanding what this spec defines
	without having to fully grok the DOM Standard.</em></p>
   <p>In addition to the qualities of an element tree defined in <a href="https://drafts.csswg.org/selectors/#data-model">Selectors Level 4 § data-model</a>,
	the DOM Standard adds several new concepts related to <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree⑥">shadow trees</a>,
	several of which are relevant to CSS.</p>
   <p>An element can host a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree⑦">shadow tree</a>,
	which is a special kind of document fragment
	with a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-root" id="ref-for-concept-shadow-root">shadow root</a>
	(a non-element node)
	at its root.
	Children of the <span id="ref-for-concept-shadow-root①">shadow root</span> are ordinary elements and other nodes.
	The element hosting the <span id="ref-for-concept-shadow-tree⑧">shadow tree</span> is its <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-documentfragment-host" id="ref-for-concept-documentfragment-host">host</a>,
	or <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host①">shadow host</a>.</p>
   <p>The elements in a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree⑨">shadow tree</a> are not <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-descendant" id="ref-for-concept-tree-descendant">descendants</a> of the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host②">shadow host</a> in general
	(including for the purposes of Selectors like the <a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#descendant-combinator" id="ref-for-descendant-combinator">descendant combinator</a>).
	However, the <span id="ref-for-concept-shadow-tree①⓪">shadow tree</span>,
	when it exists,
	is used in the construction of the <a data-link-type="dfn" href="#flat-tree" id="ref-for-flat-tree">flattened element tree</a>,
	which CSS uses for all purposes <em>after</em> Selectors
	(including inheritance and box construction).</p>
   <p>Loosely, the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree①①">shadow tree</a> is treated as the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host③">shadow host’s</a> contents
	instead of its normal <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-light-tree" id="ref-for-concept-light-tree">light tree</a> contents.
	However, some of its <span id="ref-for-concept-light-tree①">light tree</span> children
	can be "pulled into" the <span id="ref-for-concept-shadow-tree①②">shadow tree</span>
	by assigning them to <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-slot" id="ref-for-concept-slot①">slots</a>.
	This causes them to be treated as children of the <span id="ref-for-concept-slot②">slot</span>
	for CSS purposes.
	The <span id="ref-for-concept-slot③">slots</span> can then be assigned to <span id="ref-for-concept-slot④">slots</span>
	in deeper <span id="ref-for-concept-shadow-tree①③">shadow trees</span>;
	luckily, <span id="ref-for-concept-slot⑤">slots</span> themselves don’t generate boxes by default,
	so you don’t get an unpredictable cascade of <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#the-slot-element" id="ref-for-the-slot-element">slot</a></code> wrapper elements
	disrupting your CSS.</p>
   <p>If nothing is explicitly assigned to a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-slot" id="ref-for-concept-slot⑥">slot</a>,
	the <span id="ref-for-concept-slot⑦">slot’s</span> own children are instead assigned to it,
	as a sort of "default" contents.</p>
   <h3 class="heading settled" data-level="3.2" id="selectors"><span class="secno">3.2. </span><span class="content">Shadow DOM and Selectors</span><a class="self-link" href="#selectors"></a></h3>
   <h4 class="heading settled" data-level="3.2.1" id="selectors-data-model"><span class="secno">3.2.1. </span><span class="content">
Matching Selectors Against Shadow Trees</span><a class="self-link" href="#selectors-data-model"></a></h4>
   <p>When a selector is matched against a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree①④">shadow tree</a>,
	the selector match list
	is initially the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host④">shadow host</a>,
	followed by all children of the <span id="ref-for-concept-shadow-tree①⑤">shadow tree’s</span> <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-root" id="ref-for-concept-shadow-root②">shadow root</a>
	and their descendants,
	ordered by a pre-order traversal.</p>
   <p class="issue" id="issue-b8d42d77"><a class="self-link" href="#issue-b8d42d77"></a> Rewrite this against the newer call forms of the matching algorithms.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Remember that the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-descendant" id="ref-for-concept-tree-descendant①">descendants</a> of an element
	are based on the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-light-tree" id="ref-for-concept-light-tree②">light tree</a> <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-child" id="ref-for-concept-tree-child">children</a> of the element,
	which does not include the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree①⑥">shadow trees</a> of the element.</p>
   <p>When a selector is <a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#match-a-selector-against-a-tree" id="ref-for-match-a-selector-against-a-tree">matched against a tree</a>,
	its <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="tree-context">tree context</dfn> is the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-root" id="ref-for-concept-tree-root">root</a> of the <var>root elements</var> passed to the algorithm.
	If the <a data-link-type="dfn" href="#tree-context" id="ref-for-tree-context">tree context</a> is a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-root" id="ref-for-concept-shadow-root③">shadow root</a>,
	that selector is being matched <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="in the context of a shadow tree|in the context of the shadow tree" id="in-the-context-of-a-shadow-tree">in the context of a shadow tree</dfn>.</p>
   <div class="example" id="example-4f60723d"><a class="self-link" href="#example-4f60723d"></a>
		For example,
		any selector in a stylesheet embedded in or linked from an element in a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree①⑦">shadow tree</a>
		is <a data-link-type="dfn" href="#in-the-context-of-a-shadow-tree" id="ref-for-in-the-context-of-a-shadow-tree">in the context of a shadow tree</a>.
		So is the argument to <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-parentnode-queryselector" id="ref-for-dom-parentnode-queryselector">querySelector()</a></code> when called from a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-root" id="ref-for-concept-shadow-root④">shadow root</a>.
	</div>
   <p>Declarations inherit the <a data-link-type="dfn" href="#tree-context" id="ref-for-tree-context①">tree context</a>
	of the selector that was matched to apply them.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <h4 class="heading settled" data-level="3.2.2" id="host-element-in-tree"><span class="secno">3.2.2. </span><span class="content">
Selecting Shadow Hosts from within a Shadow Tree</span><a class="self-link" href="#host-element-in-tree"></a></h4>
   <p>A <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host⑤">shadow host</a> is outside of the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree①⑧">shadow tree</a> it hosts,
	and so would ordinarily be untargettable by any selectors evaluated <a data-link-type="dfn" href="#in-the-context-of-a-shadow-tree" id="ref-for-in-the-context-of-a-shadow-tree①">in the context of the shadow tree</a>
	(as selectors are limited to a single tree),
	but it is sometimes useful to be able to style it from inside the <span id="ref-for-concept-shadow-tree①⑨">shadow tree</span> context.</p>
   <p>For the purpose of Selectors,
	a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host⑥">shadow host</a> also appears in its <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree②⓪">shadow tree</a>,
	with the contents of the <span id="ref-for-concept-shadow-tree②①">shadow tree</span> treated as its children.
	(In other words, the <span id="ref-for-element-shadow-host⑦">shadow host</span> is treated as replacing the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-root" id="ref-for-concept-shadow-root⑤">shadow root</a> node.)</p>
   <p>When considered within its own <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree②②">shadow trees</a>,
	the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host⑧">shadow host</a> is <a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#featureless" id="ref-for-featureless">featureless</a>.
	Only the <a class="css" data-link-type="maybe" href="#selectordef-host" id="ref-for-selectordef-host①">:host</a>, <a class="css" data-link-type="maybe" href="#selectordef-host-function" id="ref-for-selectordef-host-function①">:host()</a>, and <a class="css" data-link-type="maybe" href="#selectordef-host-context" id="ref-for-selectordef-host-context">:host-context()</a> pseudo-classes are allowed to match it.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <details class="note">
    <summary>Why is the shadow host so weird?</summary>
    <p>The <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host⑨">shadow host</a> lives outside the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree②③">shadow tree</a>,
		and its markup is in control of the page author,
		not the component author.</p>
    <p>It would not be very good if a component used a particular class name
		internally in a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree②④">shadow tree</a> stylesheet,
		and the page author using the component accidentally <em>also</em>
		used the same class name and put it on the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host①⓪">shadow host</a>.
		Such a situation would result in accidental styling
		that is impossible for the component author to predict,
		and confusing for the page author to debug.</p>
    <p>However, there are still some reasonable use-cases for letting a stylesheet in a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree②⑤">shadow tree</a>
		style its <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host①①">shadow host</a>.
		(For example,
		the component might want to be laid out as a flexbox,
		requiring the <span id="ref-for-element-shadow-host①②">shadow host</span> to be set to <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display">display: flex</a>.)
		So, to allow this situation but prevent accidental styling,
		the <span id="ref-for-element-shadow-host①③">shadow host</span> appears but is completely featureless
		and unselectable except through <a class="css" data-link-type="maybe" href="#selectordef-host" id="ref-for-selectordef-host②">:host</a> and its related functional forms,
		which make it very explicit when you’re trying to match against markup provided by the page author.</p>
   </details>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <h4 class="heading settled" data-level="3.2.3" id="host-selector"><span class="secno">3.2.3. </span><span class="content">
Selecting Into the Light: the <a class="css" data-link-type="maybe" href="#selectordef-host" id="ref-for-selectordef-host③">:host</a>, <a class="css" data-link-type="maybe" href="#selectordef-host-function" id="ref-for-selectordef-host-function②">:host()</a>, and <a class="css" data-link-type="maybe" href="#selectordef-host-context" id="ref-for-selectordef-host-context①">:host-context()</a> pseudo-classes</span><a class="self-link" href="#host-selector"></a></h4>
   <p>The <dfn class="css dfn-paneled" data-dfn-type="selector" data-export id="selectordef-host">:host</dfn> pseudo-class,
	when evaluated <a data-link-type="dfn" href="#in-the-context-of-a-shadow-tree" id="ref-for-in-the-context-of-a-shadow-tree②">in the context of a shadow tree</a>,
	matches the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree②⑥">shadow tree’s</a> <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host①④">shadow host</a>.
	In any other context,
	it matches nothing.</p>
   <p>The <dfn class="css dfn-paneled" data-dfn-type="selector" data-export id="selectordef-host-function">:host()</dfn> function pseudo-class
	has the syntax:</p>
<pre>:host( <a class="production" data-link-type="type" href="https://drafts.csswg.org/selectors-4/#typedef-compound-selector" id="ref-for-typedef-compound-selector">&lt;compound-selector></a> )</pre>
   <p>When evaluated <a data-link-type="dfn" href="#in-the-context-of-a-shadow-tree" id="ref-for-in-the-context-of-a-shadow-tree③">in the context of a shadow tree</a>,
	it matches the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree②⑦">shadow tree’s</a> <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host①⑤">shadow host</a>
	if the <span id="ref-for-element-shadow-host①⑥">shadow host</span>,
	in its normal context,
	matches the selector argument.
	In any other context,
	it matches nothing.</p>
   <p>The <a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#specificity" id="ref-for-specificity">specificity</a> of <a class="css" data-link-type="maybe" href="#selectordef-host" id="ref-for-selectordef-host④">:host</a> is that of a pseudo-class.
	The <span id="ref-for-specificity①">specificity</span> of <a class="css" data-link-type="maybe" href="#selectordef-host-function" id="ref-for-selectordef-host-function③">:host()</a> is that of a pseudo-class,
	plus the <span id="ref-for-specificity②">specificity</span> of its argument.</p>
   <p class="note" role="note"><span class="marker">Note:</span> This is different from the specificity of similar pseudo-classes,
	like <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/selectors-4/#matches-pseudo" id="ref-for-matches-pseudo">:is()</a> or <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/selectors-4/#negation-pseudo" id="ref-for-negation-pseudo">:not()</a>,
	which <em>only</em> take the specificity of their argument.
	This is because <a class="css" data-link-type="maybe" href="#selectordef-host" id="ref-for-selectordef-host⑤">:host</a> is affirmatively selecting an element all by itself,
	like a "normal" pseudo-class;
	it takes a selector argument for syntactic reasons
	(we can’t say that <span class="css">:host.foo</span> matches but <span class="css">.foo</span> doesn’t),
	but is otherwise identical
	to just using <span class="css" id="ref-for-selectordef-host⑥">:host</span> followed by a selector.</p>
   <div class="example" id="example-20a3843d">
    <a class="self-link" href="#example-20a3843d"></a>
		For example, say you had a component with a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree②⑧">shadow tree</a> like the following:

		
<pre>&lt;x-foo class="foo">
  &lt;"shadow tree">
    &lt;div class="foo">...&lt;/div>
  &lt;/>
&lt;/x-foo>
</pre>
    <p>For a stylesheet within the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree②⑨">shadow tree</a>:</p>
    <ul>
     <li data-md>
      <p><a class="css" data-link-type="maybe" href="#selectordef-host" id="ref-for-selectordef-host⑦">:host</a> matches the <code>&lt;x-foo></code> element.</p>
     <li data-md>
      <p><span class="css">x-foo</span> matches nothing.</p>
     <li data-md>
      <p><span class="css">.foo</span> matches only the <code>&lt;div></code> element.</p>
     <li data-md>
      <p><span class="css">.foo:host</span> matches nothing</p>
     <li data-md>
      <p><span class="css">:host(.foo)</span> matches the <code>&lt;x-foo></code> element.</p>
    </ul>
   </div>
   <p>Ordinary, selectors within a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree③⓪">shadow tree</a>
	can’t see elements outside the <span id="ref-for-concept-shadow-tree③①">shadow tree</span> at all.
	Sometimes, however, it’s useful to select an ancestor that lies somewhere outside the shadow tree,
	above it in the document.</p>
   <div class="example" id="example-45cde0ef"><a class="self-link" href="#example-45cde0ef"></a>
		For example, a group of components can define a handful of color themes
		they know how to respond to.
		Page authors could opt into a particular theme
		by adding a specific class to the components,
		or higher up in the document.
	</div>
   <p>The <dfn class="css dfn-paneled" data-dfn-type="selector" data-export id="selectordef-host-context">:host-context()</dfn> functional pseudo-class tests whether there is an ancestor,
	outside the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree③②">shadow tree</a>,
	which matches a particular selector.
	Its syntax is:</p>
<pre class="prod">:host-context( <a class="production" data-link-type="type" href="https://drafts.csswg.org/selectors-4/#typedef-compound-selector" id="ref-for-typedef-compound-selector①">&lt;compound-selector></a> )</pre>
   <p>When evaluated <a data-link-type="dfn" href="#in-the-context-of-a-shadow-tree" id="ref-for-in-the-context-of-a-shadow-tree④">in the context of a shadow tree</a>,
	the <a class="css" data-link-type="maybe" href="#selectordef-host-context" id="ref-for-selectordef-host-context②">:host-context()</a> pseudo-class matches the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host①⑦">shadow host</a>,
	if the <span id="ref-for-element-shadow-host①⑧">shadow host</span> or one of its <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-including-ancestor" id="ref-for-concept-shadow-including-ancestor">shadow-including ancestors</a>
	matches the provided <a class="css production" data-link-type="type" href="https://drafts.csswg.org/selectors-4/#typedef-compound-selector" id="ref-for-typedef-compound-selector②">&lt;compound-selector></a>.
	In any other context,
	it matches nothing.</p>
   <p>The <a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#specificity" id="ref-for-specificity③">specificity</a> of <a class="css" data-link-type="maybe" href="#selectordef-host-context" id="ref-for-selectordef-host-context③">:host-context()</a> is that of a pseudo-class,
	plus the <span id="ref-for-specificity④">specificity</span> of its argument.</p>
   <p class="note" role="note"><span class="marker">Note:</span> This means that the selector pierces through shadow boundaries on the way up,
	looking for elements that match its argument,
	until it reaches the document root.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <h4 class="heading settled" data-level="3.2.4" id="slotted-pseudo"><span class="secno">3.2.4. </span><span class="content">
Selecting Slot-Assigned Content: the <a class="css" data-link-type="maybe" href="#selectordef-slotted" id="ref-for-selectordef-slotted">::slotted()</a> pseudo-element</span><a class="self-link" href="#slotted-pseudo"></a></h4>
   <p>The <dfn class="css dfn-paneled" data-dfn-type="selector" data-export id="selectordef-slotted">::slotted()</dfn> pseudo-element
	represents the elements <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#find-flattened-slotables" id="ref-for-find-flattened-slotables">assigned, after flattening,</a> to a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-slot" id="ref-for-concept-slot⑧">slot</a>.
	This pseudo-element only exists on <span id="ref-for-concept-slot⑨">slots</span>.</p>
   <p>The <a class="css" data-link-type="maybe" href="#selectordef-slotted" id="ref-for-selectordef-slotted①">::slotted()</a> pseudo-element is an <em>alias</em> for other elements in the tree,
	and does not generate any boxes itself.</p>
   <p>The grammar of the <a class="css" data-link-type="maybe" href="#selectordef-slotted" id="ref-for-selectordef-slotted②">::slotted()</a> pseudo-element is:</p>
<pre class="prod">::slotted( <a class="production" data-link-type="type" href="https://drafts.csswg.org/selectors-4/#typedef-compound-selector" id="ref-for-typedef-compound-selector③">&lt;compound-selector></a> )</pre>
   <p>The <a class="css" data-link-type="maybe" href="#selectordef-slotted" id="ref-for-selectordef-slotted③">::slotted()</a> pseudo-element represents the elements that are:</p>
   <ul>
    <li data-md>
     <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#find-flattened-slotables" id="ref-for-find-flattened-slotables①">assigned, after flattening,</a> to the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-slot" id="ref-for-concept-slot①⓪">slot</a> that is <span class="css">::slotted</span>’s originating element</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#match-a-selector-against-an-element" id="ref-for-match-a-selector-against-an-element">matched</a> by its <a class="css production" data-link-type="type" href="https://drafts.csswg.org/selectors-4/#typedef-compound-selector" id="ref-for-typedef-compound-selector④">&lt;compound-selector></a> argument</p>
   </ul>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <p>The <a class="css" data-link-type="maybe" href="#selectordef-slotted" id="ref-for-selectordef-slotted④">::slotted()</a> pseudo-element can be followed by a <a data-link-type="dfn" href="https://drafts.csswg.org/css-pseudo-4/#tree-abiding" id="ref-for-tree-abiding">tree-abiding pseudo-element</a>,
	like <span class="css">::slotted()::before</span>,
	representing the appropriate pseudo-element of the elements represented by the <span class="css" id="ref-for-selectordef-slotted⑤">::slotted()</span> pseudo-element.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <p>The <a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#specificity" id="ref-for-specificity⑤">specificity</a> of <a class="css" data-link-type="maybe" href="#selectordef-slotted" id="ref-for-selectordef-slotted⑥">::slotted()</a> is that of a pseudo-element,
	plus the <span id="ref-for-specificity⑥">specificity</span> of its argument.</p>
   <div class="example" id="example-7cc70c2d">
    <a class="self-link" href="#example-7cc70c2d"></a>
		For example, say you had a component with both children and a shadow tree,
		like the following:

		
<pre>&lt;x-foo>
  &lt;div id="one" slot="foo" class="foo">...&lt;/div>
  &lt;div id="two" slot="foo">...&lt;/div>
  &lt;div id="three" class="foo">
    &lt;div id="four" slot="foo">...&lt;/div>
  &lt;/div>
  &lt;"shadow tree">
    &lt;div id="five">...&lt;/div>
    &lt;div id="six">...&lt;/div>
    &lt;slot name="foo">&lt;/slot>
  &lt;/"shadow tree">
&lt;/x-foo>
</pre>
    <p>For a stylesheet within the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree③③">shadow tree</a>,
		a selector like <span class="css">::slotted(*)</span>
		selects <span class="css">#one</span> and <span class="css">#two</span> only,
		as they’re the elements <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#find-flattened-slotables" id="ref-for-find-flattened-slotables②">assigned</a> to the sole <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#the-slot-element" id="ref-for-the-slot-element①">slot</a></code> element.
		It will <em>not</em> select <span class="css">#three</span>
		(no <code>slot</code> attribute)
		nor <span class="css">#four</span>
		(only direct <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-child" id="ref-for-concept-tree-child①">children</a> of a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host①⑨">shadow host</a> can be assigned to a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-slot" id="ref-for-concept-slot①①">slot</a>).</p>
    <p>A selector like <span class="css">::slotted(.foo)</span>,
		on the other hand,
		will only select <span class="css">#one</span>,
		as it matches <span class="css">.foo</span>,
		but <span class="css">#two</span> doesn’t.</p>
    <p class="note" role="note"><span class="marker">Note:</span> Note that a selector like <span class="css">::slotted(*)</span>
		is equivalent to <span class="css">*::slotted(*)</span>,
		where the <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/selectors-3/#x" id="ref-for-x">*</a> selects many more elements than just the <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#the-slot-element" id="ref-for-the-slot-element②">slot</a></code> element.
		However, since only the <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#the-slot-element" id="ref-for-the-slot-element③">slot</a></code> elements are <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-slot" id="ref-for-concept-slot①②">slots</a>,
		they’re the only elements with a <a class="css" data-link-type="maybe" href="#selectordef-slotted" id="ref-for-selectordef-slotted⑦">::slotted()</a> pseudo-element as well.</p>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> <a class="css" data-link-type="maybe" href="#selectordef-slotted" id="ref-for-selectordef-slotted⑧">::slotted()</a> can only represent the <em>elements</em>
	assigned to the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-slot" id="ref-for-concept-slot①③">slot</a>.
	<span id="ref-for-concept-slot①④">Slots</span> can also be assigned text nodes,
	which can’t be selected by <span class="css" id="ref-for-selectordef-slotted⑨">::slotted()</span>.
	The only way to style assigned text nodes
	is by styling the <span id="ref-for-concept-slot①⑤">slot</span> and relying on inheritance.</p>
   <h4 class="heading settled" data-level="3.2.5" id="the-has-slotted-pseudo"><span class="secno">3.2.5. </span><span class="content">
Matching on the Presence of Slot-Assigned Nodes: the <a class="css" data-link-type="maybe" href="#selectordef-has-slotted" id="ref-for-selectordef-has-slotted①">:has-slotted</a> pseudo-class</span><a class="self-link" href="#the-has-slotted-pseudo"></a></h4>
   <p>The <dfn class="css dfn-paneled" data-dfn-type="selector" data-export id="selectordef-has-slotted">:has-slotted</dfn> pseudo-class
	matches <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#the-slot-element" id="ref-for-the-slot-element④">slot</a></code> elements
	which have a non-empty list of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#find-flattened-slotables" id="ref-for-find-flattened-slotables③">flattened slotted nodes</a>.</p>
   <p>When <a class="css" data-link-type="maybe" href="#selectordef-has-slotted" id="ref-for-selectordef-has-slotted②">:has-slotted</a> matches a slot with fallback content,
	we can conclude that the fallback content is <em>not</em> being displayed.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Even a single whitespace text node is sufficient to make <a class="css" data-link-type="maybe" href="#selectordef-has-slotted" id="ref-for-selectordef-has-slotted③">:has-slotted</a>' apply.
	This is by design, so that the behavior of this pseudo-class is consistent with the behavior of the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/scripting.html#dom-slot-assignednodes" id="ref-for-dom-slot-assignednodes">assignedNodes()</a></code> method.
	A future version of this specification is expected to introduce a way to exclude this case from matching.</p>
   <p class="note" role="note"><span class="marker">Note:</span> It is expected that a future version of this specification will introduce a functional <span class="css">:has-slotted()</span> pseudo-class that allows
	more fine-grained matching by accepting a selector argument.
	<a class="css" data-link-type="maybe" href="#selectordef-has-slotted" id="ref-for-selectordef-has-slotted④">:has-slotted</a> is <em>not</em> an alias of <span class="css">:has-slotted(*)</span>,
	as the latter would not match slotted text nodes, but <span class="css" id="ref-for-selectordef-has-slotted⑤">:has-slotted</span> does.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <h2 class="heading settled" data-level="4" id="shadow-cascading"><span class="secno">4. </span><span class="content">Shadow Trees and the Cascade</span><a class="self-link" href="#shadow-cascading"></a></h2>
   <p>See <a href="https://drafts.csswg.org/css-cascade-4/#cascade-sort"><cite>CSS Cascading 4</cite> § 6.1 Cascade Sorting Order</a>.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <h3 class="algorithm heading settled" data-algorithm="Flattening the DOM into an Element Tree" data-level="4.1" id="flattening"><span class="secno">4.1. </span><span class="content">
Flattening the DOM into an Element Tree</span><a class="self-link" href="#flattening"></a></h3>
   <p>While Selectors operates on the DOM tree as the host language presents it,
	with separate trees that are unreachable via the standard parent/<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-child" id="ref-for-concept-tree-child②">child</a> relationship,
	the rest of CSS needs a single unified tree structure to work with.
	This is called the <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="flat tree|flattened element tree" id="flat-tree">flattened element tree</dfn>
	(or <a data-link-type="dfn" href="#flat-tree" id="ref-for-flat-tree①">flat tree</a>),
	and is constructed as follows:</p>
   <ol>
    <li data-md>
     <p>Let <var>pending nodes</var> be a list of DOM nodes with associated parents,
initially containing just the document’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-root" id="ref-for-concept-tree-root①">root</a> element with no associated parent.</p>
    <li data-md>
     <p>Repeatedly execute the following substeps until <var>pending nodes</var> is empty:</p>
     <ol>
      <li data-md>
       <p>Pop the first element from <var>pending nodes</var>,
and assign it to <var>pending node</var>.</p>
      <li data-md>
       <p>Insert <var>pending node</var> into the <a data-link-type="dfn" href="#flat-tree" id="ref-for-flat-tree②">flat tree</a>
as a child of its associated parent.
(If it has no associated parent,
it’s the document root—​just insert it into the <span id="ref-for-flat-tree③">flat tree</span> as its root.)</p>
      <li data-md>
       <p>Perform one of the following,
whichever is the first that matches:</p>
       <dl class="switch">
        <dt><var>pending node</var> is a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host②⓪">shadow host</a>
	
        <dd>
		Append the child nodes of the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-root" id="ref-for-concept-shadow-root⑥">shadow root</a> of the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree③④">shadow tree</a> it hosts
		to <var>pending nodes</var>,
		with <var>pending node</var> as their associated parent.
	
        <dt><var>pending node</var> is a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-slot" id="ref-for-concept-slot①⑥">slot</a>
	
        <dd>
         
		<a data-link-type="dfn" href="https://dom.spec.whatwg.org/#find-slotables" id="ref-for-find-slotables">Find slottables</a> for <var>pending node</var>,
		and append them to <var>pending nodes</var>,
		with <var>pending node</var> as their associated parent.


         <p>If no <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-slotable" id="ref-for-concept-slotable">slottables</a> were found for <var>pending node</var>,
		instead append its <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-child" id="ref-for-concept-tree-child③">children</a> to <var>pending nodes</var>,
		with <var>pending node</var> as their associated parent.</p>
        <dt>Otherwise,
	
        <dd>
		Append the child nodes of <var>pending node</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-light-tree" id="ref-for-concept-light-tree③">light tree</a>
		to <var>pending nodes</var>,
		with <var>pending node</var> as their associated parent.

       </dl>
     </ol>
   </ol>
   <p class="note" role="note"><span class="marker">Note:</span> In other words, the <a data-link-type="dfn" href="#flat-tree" id="ref-for-flat-tree④">flat tree</a> is the top-level DOM tree,
	but <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host②①">shadow hosts</a> are filled with their <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree③⑤">shadow tree</a> children
	instead of their <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-light-tree" id="ref-for-concept-light-tree④">light tree</a> children
	(and this proceeds recursively if the <span id="ref-for-concept-shadow-tree③⑥">shadow tree</span> contains any <span id="ref-for-element-shadow-host②②">shadow hosts</span>),
	and <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-slot" id="ref-for-concept-slot①⑦">slots</a> get filled with the nodes that are assigned to them
	(and this proceeds recursively if the <span id="ref-for-concept-slot①⑧">slots</span> are themselves
	assigned to a <span id="ref-for-concept-slot①⑨">slot</span> in a deeper <span id="ref-for-concept-shadow-tree③⑦">shadow tree</span>).</p>
   <p class="issue" id="issue-75772618"><a class="self-link" href="#issue-75772618"></a> A non-obvious result of this
	is that elements assigned to a slot inherit from that slot,
	not their light-tree parent
	or any deeper slots their slot gets assigned to.
	This means that text nodes are styled by the shadow tree of their parent,
	with nobody else capable of intervening in any way.
	Do we want an additional pseudo-element for targeting those text nodes
	so they can be styled at all slot-assignment levels,
	like normal elements can be?
	This implies it needs to work for text nodes in the light tree
	before they’re assigned downwards,
	so this can’t just be a <a class="css" data-link-type="maybe" href="#selectordef-slotted" id="ref-for-selectordef-slotted①⓪">::slotted()</a> variant.
	Luckily, this is a long-standing request!</p>
   <h4 class="heading settled" data-level="4.1.1" id="slots-in-shadow-tree"><span class="secno">4.1.1. </span><span class="content">
Slots and Slotted Elements in a Shadow Tree</span><a class="self-link" href="#slots-in-shadow-tree"></a></h4>
   <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-slot" id="ref-for-concept-slot②⓪">Slots</a> must act as if they were assigned <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-display-4/#propdef-display" id="ref-for-propdef-display①">display: contents</a>
	via a rule in the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#cascade-origin-ua" id="ref-for-cascade-origin-ua②">UA origin</a>.
	This must be possible to override via <span class="property" id="ref-for-propdef-display②">display</span>,
	so they <em>do</em> generate boxes if desired.</p>
   <p class="note" role="note"><span class="marker">Note:</span> A non-obvious result of assigning elements to <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-slot" id="ref-for-concept-slot②①">slots</a>
	is that they <a data-link-type="dfn">inherit</a> from the <span id="ref-for-concept-slot②②">slot</span> they’re assigned to.
	Their original <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-light-tree" id="ref-for-concept-light-tree⑤">light tree</a> parent,
	and any deeper <span id="ref-for-concept-slot②③">slots</span> that their <span id="ref-for-concept-slot②④">slot</span> gets assigned to,
	don’t affect inheritance.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <h3 class="heading settled" data-level="4.2" id="shadow-names"><span class="secno">4.2. </span><span class="content">
Name-Defining Constructs and Inheritance</span><a class="self-link" href="#shadow-names"></a></h3>
   <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree③⑧">Shadow trees</a> are meant to be an encapsulation boundary,
	allowing independent authors to share code
	without accidentally polluting each other’s namespaces.
	For example, element IDs,
	which are generally meant to be unique within a document,
	can be validly used multiple times
	as long as each use is in a different <span id="ref-for-concept-shadow-tree③⑨">shadow tree</span>.</p>
   <p>Similarly, several <a data-link-type="dfn" href="https://drafts.csswg.org/css-syntax-3/#at-rule" id="ref-for-at-rule①">at-rules</a> in CSS,
	such as <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-animations-1/#at-ruledef-keyframes" id="ref-for-at-ruledef-keyframes">@keyframes</a> or <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-fonts-5/#at-font-face-rule" id="ref-for-at-font-face-rule①">@font-face</a>,
	define a name that later at-rules or properties can refer to them by.
	Like IDs, these names are globally exposed and unique within a document;
	also like IDs,
	this restriction is now loosened to being unique within a given <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree④⓪">shadow tree</a>.</p>
   <p>However, property inheritance can carry values from one tree to another,
	which complicates referencing the correct definition of a given name.
	Done naively, this can produce surprising and confusing results for authors.
	This section defines a set of concepts to use in defining and referencing "global" names
	in a way that respects encapsulation
	and doesn’t give surprising results.</p>
   <p>If an at-rule or property defines a name that other CSS constructs can refer to it by,
	such as a <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-fonts-5/#at-font-face-rule" id="ref-for-at-font-face-rule②">@font-face</a> <a class="css property" data-link-type="descriptor" href="https://drafts.csswg.org/css-fonts-4/#descdef-font-face-font-family" id="ref-for-descdef-font-face-font-family">font-family</a> name
	or an <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-anchor-position-1/#propdef-anchor-scope" id="ref-for-propdef-anchor-scope">anchor-scope</a> name,
	it must be defined as a <dfn class="dfn-paneled" data-dfn-for="CSS" data-dfn-type="dfn" data-export id="css-tree-scoped-name">tree-scoped name</dfn>.
	<a data-link-type="dfn" href="#css-tree-scoped-name" id="ref-for-css-tree-scoped-name">Tree-scoped names</a> are associated with
	the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-root" id="ref-for-concept-tree-root②">root</a> of the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element" id="ref-for-concept-element">element</a> hosting the stylesheet
	that the at-rule or property is declared in.</p>
   <p>Additionally, <a data-link-type="dfn" href="#css-tree-scoped-name" id="ref-for-css-tree-scoped-name①">tree-scoped names</a> can be <dfn class="dfn-paneled" data-dfn-for="tree-scoped name" data-dfn-type="dfn" data-export id="tree-scoped-name-loosely-matched">loosely matched</dfn> or <dfn class="dfn-paneled" data-dfn-for="tree-scoped name" data-dfn-type="dfn" data-export id="tree-scoped-name-strictly-matched">strictly matched</dfn>,
	defaulting to <a data-link-type="dfn" href="#tree-scoped-name-loosely-matched" id="ref-for-tree-scoped-name-loosely-matched">loosely matched</a> unless otherwise specified.
	A <span id="ref-for-tree-scoped-name-loosely-matched①">loosely matched</span> <span id="ref-for-css-tree-scoped-name②">tree-scoped name</span>
	can be matched by <a data-link-type="dfn" href="#css-tree-scoped-reference" id="ref-for-css-tree-scoped-reference">tree-scoped references</a>
	(see below)
	in the same tree or descendant trees,
	while a <a data-link-type="dfn" href="#tree-scoped-name-strictly-matched" id="ref-for-tree-scoped-name-strictly-matched">strictly matched</a> <span id="ref-for-css-tree-scoped-name③">tree-scoped name</span>
	can only be matched by <span id="ref-for-css-tree-scoped-reference①">tree-scoped references</span>
	in the exact same tree.</p>
   <p>Properties or descriptors that reference a <a data-link-type="dfn" href="#css-tree-scoped-name" id="ref-for-css-tree-scoped-name④">tree-scoped name</a>,
	such as the <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-fonts-4/#propdef-font-family" id="ref-for-propdef-font-family">font-family</a>
	or <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-animations-1/#propdef-animation-name" id="ref-for-propdef-animation-name">animation-name</a> properties,
	must define their value as a <dfn class="dfn-paneled" data-dfn-for="CSS" data-dfn-type="dfn" data-export id="css-tree-scoped-reference">tree-scoped reference</dfn>.
	These references implicitly capture
	a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-tree" id="ref-for-concept-node-tree">node tree</a> <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-root" id="ref-for-concept-tree-root③">root</a>
	along with their specified value:
	unless otherwise specified,
	the <span id="ref-for-concept-tree-root④">root</span> of the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-element" id="ref-for-concept-element①">element</a> hosting the stylesheet that the property or descriptor is declared in.
	This <span id="ref-for-concept-tree-root⑤">root</span> reference stays with the <a data-link-type="dfn" href="#css-tree-scoped-reference" id="ref-for-css-tree-scoped-reference②">tree-scoped reference</a>
	as it is inherited.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <p>If a <a data-link-type="dfn" href="#css-tree-scoped-name" id="ref-for-css-tree-scoped-name⑤">tree-scoped name</a> is <dfn class="dfn-paneled" data-dfn-for="tree-scoped name" data-dfn-type="dfn" data-export id="tree-scoped-name-global">global</dfn>
	(such as <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-fonts-5/#at-font-face-rule" id="ref-for-at-font-face-rule③">@font-face</a> names),
	then when a <a data-link-type="dfn" href="#css-tree-scoped-reference" id="ref-for-css-tree-scoped-reference③">tree-scoped reference</a> is dereferenced to find it,
	first search only the <span id="ref-for-css-tree-scoped-name⑥">tree-scoped names</span> associated with the same <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-root" id="ref-for-concept-tree-root⑥">root</a>
	as the <span id="ref-for-css-tree-scoped-reference④">tree-scoped reference</span>.
	If no relevant <span id="ref-for-css-tree-scoped-name⑦">tree-scoped name</span> is found,
	and the <span id="ref-for-concept-tree-root⑦">root</span> is a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-root" id="ref-for-concept-shadow-root⑦">shadow root</a>,
	then repeat this search in the <span id="ref-for-concept-tree-root⑧">root</span>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-documentfragment-host" id="ref-for-concept-documentfragment-host①">host</a>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-tree" id="ref-for-concept-node-tree①">node tree</a> (recursively).
	(In other words, global <span id="ref-for-css-tree-scoped-name⑧">tree-scoped names</span> “inherit” into descendant shadow trees,
	so long as they don’t define the same name themselves.)</p>
   <p>If a <a data-link-type="dfn" href="#css-tree-scoped-name" id="ref-for-css-tree-scoped-name⑨">tree-scoped name</a> is <dfn class="dfn-paneled" data-dfn-for="tree-scoped name" data-dfn-type="dfn" data-export id="tree-scoped-name-local">local</dfn> to an element
	(such as <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-anchor-position-1/#propdef-anchor-name" id="ref-for-propdef-anchor-name">anchor-name</a> or <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-anchor-position-1/#propdef-anchor-scope" id="ref-for-propdef-anchor-scope①">anchor-scope</a> values),
	then whether a <a data-link-type="dfn" href="#css-tree-scoped-reference" id="ref-for-css-tree-scoped-reference⑤">tree-scoped reference</a> matches the <span id="ref-for-css-tree-scoped-name①⓪">tree-scoped name</span> on a given element
	depends on whether the <span id="ref-for-css-tree-scoped-name①①">tree-scoped name</span> is <a data-link-type="dfn" href="#tree-scoped-name-strictly-matched" id="ref-for-tree-scoped-name-strictly-matched①">strictly</a> or <a data-link-type="dfn" href="#tree-scoped-name-loosely-matched" id="ref-for-tree-scoped-name-loosely-matched②">loosely</a> matched.
	A <span id="ref-for-tree-scoped-name-strictly-matched②">strictly matched</span> <span id="ref-for-css-tree-scoped-name①②">tree-scoped name</span> only matches if
	both names are associated with the same tree.
	A <span id="ref-for-tree-scoped-name-loosely-matched③">loosely matched</span> <span id="ref-for-css-tree-scoped-name①③">tree-scoped name</span> also matches if
	the <span id="ref-for-css-tree-scoped-name①④">tree-scoped name</span> is associated with an ancestor tree.</p>
   <p>If two <a data-link-type="dfn" href="#css-tree-scoped-name" id="ref-for-css-tree-scoped-name①⑤">tree-scoped names</a> are directly compared
	(for example, when comparing <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-5/#computed-value" id="ref-for-computed-value">computed values</a>),
	they are considered to match only if their identifiers match,
	<em>and</em> their <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-root" id="ref-for-concept-tree-root⑨">root</a>s match exactly.
	(If one has a <span id="ref-for-concept-tree-root①⓪">root</span> that’s an ancestor of the other, for example,
	they <em>do not</em> match.)</p>
   <div class="issue" id="issue-3293692a">
    <a class="self-link" href="#issue-3293692a"></a>
		TODO: Fix all the at-rules that define global names,
		and the properties that reference them,
		to use these concepts.


    <p>Global names include:</p>
    <ul>
     <li data-md>
      <p><a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-fonts-5/#at-font-face-rule" id="ref-for-at-font-face-rule④">@font-face</a>, referenced by <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-fonts-4/#propdef-font-family" id="ref-for-propdef-font-family①">font-family</a></p>
     <li data-md>
      <p><a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-fonts-4/#at-ruledef-font-feature-values" id="ref-for-at-ruledef-font-feature-values">@font-feature-values</a>, referenced by <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-fonts-4/#propdef-font-family" id="ref-for-propdef-font-family②">font-family</a></p>
     <li data-md>
      <p><a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-animations-1/#at-ruledef-keyframes" id="ref-for-at-ruledef-keyframes①">@keyframes</a>, referenced by <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-animations-1/#propdef-animation-name" id="ref-for-propdef-animation-name①">animation-name</a></p>
     <li data-md>
      <p><a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-counter-styles-3/#at-ruledef-counter-style" id="ref-for-at-ruledef-counter-style">@counter-style</a>, referenced by <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-lists-3/#propdef-list-style-type" id="ref-for-propdef-list-style-type">list-style-type</a></p>
     <li data-md>
      <p><a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-color-5/#at-ruledef-profile" id="ref-for-at-ruledef-profile">@color-profile</a>, referenced by the <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-color-5/#funcdef-color" id="ref-for-funcdef-color">color()</a> function</p>
     <li data-md>
      <p><a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-fonts-4/#at-ruledef-font-palette-values" id="ref-for-at-ruledef-font-palette-values">@font-palette-values</a>, referenced by <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-fonts-4/#propdef-font-palette" id="ref-for-propdef-font-palette">font-palette</a></p>
     <li data-md>
      <p>others?</p>
    </ul>
   </div>
   <div class="example" id="example-cd0cbc57">
    <a class="self-link" href="#example-cd0cbc57"></a>


    <p>For example,
		given the following document
		(using the imaginary &lt;::shadow>&lt;/::shadow> markup
		to indicate an element’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree④①">shadow tree</a>):</p>
<pre class="highlight"><c- p>&lt;</c-><c- f>p</c-> <c- e>class</c-><c- o>=</c-><c- s>outer</c-><c- p>></c->Here's some text in the outer document's "foo" font.
<c- p>&lt;</c-><c- f>style</c-><c- p>></c->
  <c- p>@</c-><c- k>font-face</c-> <c- p>{</c->
    <c- f>font-family</c-><c- o>:</c-> <c- f>foo</c-><c- o>;</c->
    <c- f>src</c-><c- o>:</c-> <c- f>url</c-><c- o>(</c-><c- f>https</c-><c- o>://</c-><c- f>example</c-><c- p>.</c-><c- nc>com</c-><c- o>/</c-><c- f>outer</c-><c- p>.</c-><c- nc>woff</c-><c- o>);</c->
  <c- p>}</c->
  <c- f>body</c-> <c- p>{</c-> <c- k>font-family</c-><c- p>:</c-> <c- n>foo</c-><c- p>;</c-> <c- p>}</c->
  <c- f>my-component</c-><c- p>::</c-><c- nd>part</c-><c- o>(</c-><c- f>text</c-><c- o>)</c-> <c- p>{</c-> <c- k>font-family</c-><c- p>:</c-> <c- n>foo</c-><c- p>;</c-> <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->

<c- p>&lt;</c-><c- f>my-component</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>::shadow</c-><c- p>></c->
    <c- p>&lt;</c-><c- f>p</c-> <c- e>class</c-><c- o>=</c-><c- s>inner-default</c-><c- p>></c->I'm inheriting the outer document's font-family.
    <c- p>&lt;</c-><c- f>p</c-> <c- e>class</c-><c- o>=</c-><c- s>inner-styled</c-><c- p>></c->And I'm explicitly styled to be in the component's "foo" font.
    <c- p>&lt;</c-><c- f>p</c-> <c- e>class</c-><c- o>=</c-><c- s>part-styled</c-> <c- e>part</c-><c- o>=</c-><c- s>text</c-><c- p>></c->
      I'm explicitly styled by the outer document,
      and get the outer document's "foo" font.
    <c- p>&lt;</c-><c- f>style</c-><c- p>></c->
      <c- p>@</c-><c- k>font-face</c-> <c- p>{</c->
        <c- f>font-family</c-><c- o>:</c-> <c- f>foo</c-><c- o>;</c->
        <c- f>src</c-><c- o>:</c-> <c- f>url</c-><c- o>(</c-><c- f>https</c-><c- o>://</c-><c- f>example</c-><c- p>.</c-><c- nc>com</c-><c- o>/</c-><c- f>inner</c-><c- p>.</c-><c- nc>woff</c-><c- o>);</c->
      <c- p>}</c->
      <c- p>.</c-><c- nc>inner-styled</c-> <c- p>{</c-> <c- k>font-family</c-><c- p>:</c-> <c- n>foo</c-><c- p>;</c-> <c- p>}</c->
    <c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
  <c- p>&lt;/</c-><c- f>::shadow</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>my-component</c-><c- p>></c->
</pre>
    <p>The <span class="css">.outer</span> element references the outer <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-fonts-5/#at-font-face-rule" id="ref-for-at-font-face-rule⑤">@font-face</a>, using the "outer.woff" file.</p>
    <p>The <span class="css">.inner-default</span> element inherits the <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-fonts-4/#propdef-font-family" id="ref-for-propdef-font-family③">font-family: foo</a> value from the outer document,
		using the same <a data-link-type="dfn" href="#css-tree-scoped-reference" id="ref-for-css-tree-scoped-reference⑥">tree-scoped reference</a> as <span class="css">.outer</span>,
		and thus also uses the "outer.woff" font file.</p>
    <p>The <span class="css">.inner-style</span> element, on the other hand,
		receives a <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-fonts-4/#propdef-font-family" id="ref-for-propdef-font-family④">font-family: foo</a> from the stylesheet inside the shadow,
		and thus its <a data-link-type="dfn" href="#css-tree-scoped-reference" id="ref-for-css-tree-scoped-reference⑦">tree-scoped reference</a> refers to the shadow’s <span class="css">@font-family</span>,
		and it uses the "inner.woff" file.</p>
    <p>The <span class="css">.part-styled</span> element also receives its style from the outer document,
		tho by being directly set rather than by inheritance.
		Thus, its <a data-link-type="dfn" href="#css-tree-scoped-reference" id="ref-for-css-tree-scoped-reference⑧">tree-scoped reference</a> also refer’s to the outer document,
		and it uses the "outer.woff" file.</p>
   </div>
   <div class="example" id="example-6de7b535">
    <a class="self-link" href="#example-6de7b535"></a>
		Here is a more complex example,
		showing three levels of trees,
		and illustrating precisely how <a data-link-type="dfn" href="#css-tree-scoped-name" id="ref-for-css-tree-scoped-name①⑥">tree-scoped names</a> and <a data-link-type="dfn" href="#css-tree-scoped-reference" id="ref-for-css-tree-scoped-reference⑨">tree-scoped references</a> inherit.

		
<pre class="highlight"><c- p>&lt;</c-><c- f>style</c-><c- p>></c->
  <c- p>@</c-><c- k>font-face</c-> <c- p>{</c->
    <c- f>font-family</c-><c- o>:</c-> <c- f>foo</c-><c- o>;</c->
    <c- f>src</c-><c- o>:</c-> <c- f>url</c-><c- o>(</c-><c- f>https</c-><c- o>://</c-><c- f>example</c-><c- p>.</c-><c- nc>com</c-><c- o>/</c-><c- f>outer</c-><c- p>.</c-><c- nc>woff</c-><c- o>);</c->
  <c- p>}</c->
  <c- f>body</c-> <c- p>{</c-> <c- k>font-family</c-><c- p>:</c-> <c- n>foo</c-><c- p>;</c-> <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->

<c- p>&lt;</c-><c- f>child-component</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>::shadow</c-><c- p>></c->
    <c- p>&lt;</c-><c- f>style</c-><c- p>></c->
      <c- p>@</c-><c- k>font-face</c-> <c- p>{</c->
        <c- f>font-family</c-><c- o>:</c-> <c- f>foo</c-><c- o>;</c->
        <c- f>src</c-><c- o>:</c-> <c- f>url</c-><c- o>(</c-><c- f>https</c-><c- o>://</c-><c- f>example</c-><c- p>.</c-><c- nc>com</c-><c- o>/</c-><c- f>inner</c-><c- p>.</c-><c- nc>woff</c-><c- o>);</c->
      <c- p>}</c->
    <c- p>&lt;/</c-><c- f>style</c-><c- p>></c->

    <c- p>&lt;</c-><c- f>grandchild-component</c-><c- p>></c->
      <c- p>&lt;</c-><c- f>::shadow</c-><c- p>></c->
        <c- p>&lt;</c-><c- f>p</c-> <c- e>class</c-><c- o>=</c-><c- s>inner-default</c-><c- p>></c->
          I'm inheriting the outer document's "foo" font.
        <c- p>&lt;/</c-><c- f>p</c-><c- p>></c->
        <c- p>&lt;</c-><c- f>p</c-> <c- e>class</c-><c- o>=</c-><c- s>inner-search</c-><c- p>></c->
          And I can't find a local "foo" font,
          so I'm searching further up the tree,
          and find the shadow's "foo" font.
        <c- p>&lt;/</c-><c- f>p</c-><c- p>></c->
        <c- p>&lt;</c-><c- f>style</c-><c- p>></c->
        <c- p>.</c-><c- nc>inner-search</c-> <c- p>{</c-> <c- k>font-family</c-><c- p>:</c-> <c- n>foo</c-><c- p>;</c-> <c- p>}</c->
        <c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
      <c- p>&lt;/</c-><c- f>::shadow</c-><c- p>></c->
    <c- p>&lt;/</c-><c- f>grandchild-component</c-><c- p>></c->
  <c- p>&lt;/</c-><c- f>::shadow</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>child-component</c-><c- p>></c->
</pre>
    <p>Here, just as in the previous example,
		<span class="css">.inner-default</span> is inheriting the <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-fonts-4/#propdef-font-family" id="ref-for-propdef-font-family⑤">font-family: foo</a> declared in the outer document,
		and so it ends up referencing the outer document’s <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-fonts-5/#at-font-face-rule" id="ref-for-at-font-face-rule⑥">@font-face</a>,
		and is rendered with the "outer.woff" file.</p>
    <p>On the other hand,
		<span class="css">.inner-search</span> receives its style from a stylesheet in <code>&lt;grandchild-component></code>’s shadow tree,
		so it attempts to find a <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-fonts-5/#at-font-face-rule" id="ref-for-at-font-face-rule⑦">@font-face</a> defining a <span class="css">foo</span> font in that tree.
		There is no such <span class="css" id="ref-for-at-font-face-rule⑧">@font-face</span>,
		so it starts walking up the shadow trees,
		finding an appropriate <span class="css" id="ref-for-at-font-face-rule⑨">@font-face</span> in <code>&lt;child-component></code>,
		so it’s rendered with the "inner.woff" file.</p>
   </div>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <h4 class="heading settled" data-level="4.2.1" id="shadow-names-serialization"><span class="secno">4.2.1. </span><span class="content">
Serialized Tree-Scoped References</span><a class="self-link" href="#shadow-names-serialization"></a></h4>
   <p>If a <a data-link-type="dfn" href="#css-tree-scoped-reference" id="ref-for-css-tree-scoped-reference①⓪">tree-scoped reference</a> is serialized,
	it serializes only its value;
	the associated <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-root" id="ref-for-concept-tree-root①①">root</a> is lost.</p>
   <div class="example" id="example-ad083628">
    <a class="self-link" href="#example-ad083628"></a>


    <p>This implies that `el.style.foo = getComputedStyle(el).foo;`
		is not necessarily a no-op,
		like it typically was before <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree④②">shadow trees</a> existed.</p>
    <p>For example,
		given the following document
		(using the imaginary &lt;::shadow>&lt;/::shadow> markup
		to indicate an element’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree④③">shadow tree</a>):</p>
<pre class="highlight"><c- p>&lt;</c-><c- f>p</c-> <c- e>class</c-><c- o>=</c-><c- s>outer</c-><c- p>></c->Here's some text in the outer document's "foo" font.
<c- p>&lt;</c-><c- f>style</c-><c- p>></c->
  <c- p>@</c-><c- k>font-face</c-> <c- p>{</c->
    <c- f>font-family</c-><c- o>:</c-> <c- f>foo</c-><c- o>;</c->
    <c- f>src</c-><c- o>:</c-> <c- f>url</c-><c- o>(</c-><c- f>foo</c-><c- p>.</c-><c- nc>woff</c-><c- o>);</c->
  <c- p>}</c->
  <c- f>body</c-> <c- p>{</c-> <c- k>font-family</c-><c- p>:</c-> <c- n>foo</c-><c- p>;</c-> <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->

<c- p>&lt;</c-><c- f>my-component</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>::shadow</c-><c- p>></c->
    <c- p>&lt;</c-><c- f>p</c-> <c- e>class</c-><c- o>=</c-><c- s>inner-default</c-><c- p>></c->I'm inheriting the outer document's font-family.
    <c- p>&lt;</c-><c- f>p</c-> <c- e>class</c-><c- o>=</c-><c- s>inner-styled</c-><c- p>></c->And I'm explicitly styled to be in the component's "foo" font.
    <c- p>&lt;</c-><c- f>style</c-><c- p>></c->
      <c- p>@</c-><c- k>font-face</c-> <c- p>{</c->
        <c- f>font-family</c-><c- o>:</c-> <c- f>foo</c-><c- o>;</c->
        <c- f>src</c-><c- o>:</c-> <c- f>url</c-><c- o>(</c-><c- f>https</c-><c- o>://</c-><c- f>example</c-><c- p>.</c-><c- nc>com</c-><c- o>/</c-><c- f>foo</c-><c- p>.</c-><c- nc>woff</c-><c- o>);</c->
      <c- p>}</c->
      <c- p>.</c-><c- nc>inner-styled</c-> <c- p>{</c-> <c- k>font-family</c-><c- p>:</c-> <c- n>foo</c-><c- p>;</c-> <c- p>}</c->
    <c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
    <c- p>&lt;</c-><c- f>script</c-><c- p>></c->
      <c- a>const</c-> innerDefault <c- o>=</c-> document<c- p>.</c->querySelector<c- p>(</c-><c- t>'.inner-default'</c-><c- p>);</c->
      <c- a>const</c-> innerStyled <c- o>=</c-> document<c- p>.</c->querySelector<c- p>(</c-><c- t>'.inner-styled'</c-><c- p>);</c->
      <c- a>const</c-> defaultFont <c- o>=</c-> getComputedStyle<c- p>(</c->innerDefault<c- p>).</c->fontFamily<c- p>;</c->
      <c- a>const</c-> styledFont <c- o>=</c-> getComputedStyle<c- p>(</c->innerStyled<c- p>).</c->fontFamily<c- p>;</c->

      console<c- p>.</c->log<c- p>(</c->defaultFont <c- o>==</c-> styledFont<c- p>);</c-> <c- c1>// true!</c->
    <c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
  <c- p>&lt;/</c-><c- f>::shadow</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>my-component</c-><c- p>></c->
</pre>
    <p>The <code>.outer</code> element is styled with the outer document’s "foo" <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-fonts-5/#at-font-face-rule" id="ref-for-at-font-face-rule①⓪">@font-face</a>.
		The <code>.inner-default</code> element inherits <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-fonts-4/#propdef-font-family" id="ref-for-propdef-font-family⑥">font-family</a> from the outer document,
		meaning it inherits a <a data-link-type="dfn" href="#css-tree-scoped-reference" id="ref-for-css-tree-scoped-reference①①">tree-scoped reference</a>
		referencing that outer document,
		and so it’s in the same font as <code>.outer</code>.</p>
    <p>Meanwhile, <code>.inner-styled</code> is explicitly styled from inside the shadow root,
		so it receives a fresh <a data-link-type="dfn" href="#css-tree-scoped-reference" id="ref-for-css-tree-scoped-reference①②">tree-scoped reference</a>
		referencing its shadow tree,
		and it is instead styled the shadow’s own "foo" <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-fonts-5/#at-font-face-rule" id="ref-for-at-font-face-rule①①">@font-face</a>.</p>
    <p>Despite that, the script running inside the component
		sees the two elements as having the same value for <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-fonts-4/#propdef-font-family" id="ref-for-propdef-font-family⑦">font-family</a>,
		because the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-root" id="ref-for-concept-tree-root①②">root</a>-reference part of a <a data-link-type="dfn" href="#css-tree-scoped-reference" id="ref-for-css-tree-scoped-reference①③">tree-scoped reference</a>
		is not preserved by serialization.
		If it were to set <code class="highlight">innerDefault<c- p>.</c->style<c- p>.</c->fontFamily <c- o>=</c-> defaultFont<c- p>;</c-></code>
		(thus setting the <span class="property" id="ref-for-propdef-font-family⑧">font-family</span> property of the element’s attribute stylesheet,
		which lives in the shadow tree),
		the <code>.inner-default</code> element would suddenly switch
		to the same font as <code>.inner-styled</code>!</p>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> The <a data-link-type="biblio" href="#biblio-css-typed-om-1" title="CSS Typed OM Level 1">[css-typed-om-1]</a> is expected to reflect the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-root" id="ref-for-concept-tree-root①③">root</a> reference of a <a data-link-type="dfn" href="#css-tree-scoped-reference" id="ref-for-css-tree-scoped-reference①④">tree-scoped reference</a>
	in its <a data-link-type="dfn" href="https://drafts.css-houdini.org/css-typed-om-1/#css-reify" id="ref-for-css-reify">reification</a> rules for values,
	allowing authors to tell what <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-tree" id="ref-for-concept-node-tree②">node tree</a> the reference is taking its values from,
	and allowing values to be transported across <span id="ref-for-concept-node-tree③">node trees</span>
	without changing their meaning.</p>
   <h2 class="heading settled" data-level="5" id="exposing"><span class="secno">5. </span><span class="content">Exposing a Shadow Element</span><a class="self-link" href="#exposing"></a></h2>
   
Elements in a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree④④">shadow tree</a> may be exported for styling by stylesheets outside the tree
using the part and exportparts attributes.


   <p>Each element has a <dfn class="dfn-paneled" data-dfn-for="element" data-dfn-type="dfn" data-export id="element-part-name-list">part name list</dfn>
which is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">ordered set</a> of tokens.</p>
   <p>Each element has a <dfn class="dfn-paneled" data-dfn-for="element" data-dfn-type="dfn" data-export id="element-forwarded-part-name-list">forwarded part name list</dfn>
which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple">tuples</a>
containing a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string">string</a> for the inner part being forwarded
and a <span id="ref-for-string①">string</span> giving the name it will be exposed as.</p>
   <p>Each <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-root" id="ref-for-concept-shadow-root⑧">shadow root</a> can be thought of as having a <dfn class="dfn-paneled" data-dfn-for="shadow root" data-dfn-type="dfn" data-export id="shadow-root-part-element-map">part element map</dfn>
with keys that are <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string②">strings</a>
and values that are <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">ordered sets</a> of elements.</p>
   <p>The <a data-link-type="dfn" href="#shadow-root-part-element-map" id="ref-for-shadow-root-part-element-map">part element map</a> is described
only as part of the algorithm for calculating style in this spec.
It is not exposed via the DOM,
as calculating it may be expensive
and exposing it could allow access to elements inside closed shadow roots.</p>
   <p><a data-link-type="dfn" href="#shadow-root-part-element-map" id="ref-for-shadow-root-part-element-map①">Part element maps</a> are affected by the addition and removal of elements
and changes to the <a data-link-type="dfn" href="#element-part-name-list" id="ref-for-element-part-name-list">part name lists</a> and <a data-link-type="dfn" href="#element-forwarded-part-name-list" id="ref-for-element-forwarded-part-name-list">forwarded part name lists</a> of elements in the DOM.</p>
   <div class="algorithm" data-algorithm="calculate the part element map">
    
	To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="calculate-the-part-element-map">calculate the <a data-link-type="dfn" href="#shadow-root-part-element-map" id="ref-for-shadow-root-part-element-map②">part element map</a></dfn> of a shadow root, <var>outerRoot</var>:


    <ol>
     <li data-md>
      <p>For each <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-descendant" id="ref-for-concept-tree-descendant②">descendant</a> <var>el</var> within <var>outerRoot</var>:</p>
      <ol>
       <li data-md>
        <p>For each <var>name</var> in <var>el</var>’s <a data-link-type="dfn" href="#element-part-name-list" id="ref-for-element-part-name-list①">part name list</a>,
<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append">append</a> <var>el</var> to <var>outerRoot</var>’s <a data-link-type="dfn" href="#shadow-root-part-element-map" id="ref-for-shadow-root-part-element-map③">part element map</a>[<var>name</var>].</p>
       <li data-md>
        <p>If <var>el</var> is a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host②③">shadow host</a> itself
then let <var>innerRoot</var> be its shadow root.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#calculate-the-part-element-map" id="ref-for-calculate-the-part-element-map">Calculate</a> <var>innerRoot</var>’s <a data-link-type="dfn" href="#shadow-root-part-element-map" id="ref-for-shadow-root-part-element-map④">part element map</a>.</p>
       <li data-md>
        <p>For each <var>innerName</var>/<var>outerName</var> in <var>el</var>’s <a data-link-type="dfn" href="#element-forwarded-part-name-list" id="ref-for-element-forwarded-part-name-list①">forwarded part name list</a>:</p>
        <ol>
         <li data-md>
          <p>If <var>innerName</var> is an ident:</p>
          <ol>
           <li data-md>
            <p>Let <var>innerParts</var> be <var>innerRoot</var>’s <a data-link-type="dfn" href="#shadow-root-part-element-map" id="ref-for-shadow-root-part-element-map⑤">part element map</a>[<var>innerName</var>]</p>
           <li data-md>
            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append①">Append</a> the elements in <var>innerParts</var>
to <var>outerRoot</var>’s <a data-link-type="dfn" href="#shadow-root-part-element-map" id="ref-for-shadow-root-part-element-map⑥">part element map</a>[<var>outerName</var>]</p>
          </ol>
         <li data-md>
          <p>If <var>innerName</var> is a pseudo-element name:</p>
          <ol>
           <li data-md>
            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append②">Append</a> <var>innerRoot</var>’s pseudo-element(s) with that name
to <var>outerRoot</var>’s <a data-link-type="dfn" href="#shadow-root-part-element-map" id="ref-for-shadow-root-part-element-map⑦">part element map</a>[<var>outerName</var>].</p>
          </ol>
        </ol>
      </ol>
    </ol>
   </div>
   <h3 class="heading settled" data-level="5.1" id="motivation"><span class="secno">5.1. </span><span class="content">Motivation</span><a class="self-link" href="#motivation"></a></h3>
   <p>For custom elements to be fully useful and as capable as built-in elements
it should be possible for parts of them to be styled from outside.
Exactly what can be styled from outside should be controlled by the element author.
Also, it should be possible for a custom element to present a stable "API" for styling.
That is, the selector used to style a part of a custom element
should not expose or require knowledge of the internal details of the element.
The custom element author should be able to change the internal details of the element
while leaving the selectors untouched.</p>
   <p>The previous proposed method for styling inside the shadow tree,
the >>> combinator,
turned out to be <em>too powerful</em> for its own good;
it exposed too much of a component’s internal structure to scrutiny,
defeating some of the encapsulation benefits that using Shadow DOM brings.
For this,
and other performance-related reasons,
the >>> combinator was eventually dropped.</p>
   <p>This left us with using <a data-link-type="dfn" href="https://drafts.csswg.org/css-variables-2/#custom-property" id="ref-for-custom-property①">custom properties</a> as the only way to style into a shadow tree:
the component would advertise that it uses certain <span id="ref-for-custom-property②">custom properties</span> to style its internals,
and the outer page could then set those properties as it wished on the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host②④">shadow host</a>,
letting inheritance push the values down to where they were needed.
This works very well for many simple theming use-cases.</p>
   <p>However, there are some cases where this falls down.
If a component wishes to allow arbitrary styling of something in its shadow tree,
the only way to do so is to define hundreds of <a data-link-type="dfn" href="https://drafts.csswg.org/css-variables-2/#custom-property" id="ref-for-custom-property③">custom properties</a>
(one per CSS property they wish to allow control of),
which is obviously ridiculous
for both usability and performance reasons.
The situation is compounded if authors wish to style the component differently
based on pseudo-classes like <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/selectors-4/#hover-pseudo" id="ref-for-hover-pseudo">:hover</a>;
the component needs to duplicate the <span id="ref-for-custom-property④">custom properties</span> used
for each pseudo-class
(and each combination,
like <span class="css">:hover:focus</span>,
resulting in a combinatorial explosion).
This makes the usability and performance problems even worse.</p>
   <p>We introduce <a class="css" data-link-type="maybe" href="#selectordef-part" id="ref-for-selectordef-part①">::part()</a> to handle this case much more elegantly and performantly.
Rather than bundling everything into <a data-link-type="dfn" href="https://drafts.csswg.org/css-variables-2/#custom-property" id="ref-for-custom-property⑤">custom property</a> names,
the functionality lives in selectors and style rule syntax,
like it’s meant to.
This is far more usable for both component authors
and component users,
should have much better performance,
and allows for better encapsulation/API surface.</p>
   <p>It’s important to note that <a class="css" data-link-type="maybe" href="#selectordef-part" id="ref-for-selectordef-part②">::part()</a>
offers <em>absolutely zero new theoretical power</em>.
It is not a rehash of the <span class="css">>>></span> combinator,
it is simply a more convenient and consistent syntax
for something authors can already do with <a data-link-type="dfn" href="https://drafts.csswg.org/css-variables-2/#custom-property" id="ref-for-custom-property⑥">custom properties</a>.
By separating out the explicitly "published" parts of an element
(the <a data-link-type="dfn" href="#shadow-root-part-element-map" id="ref-for-shadow-root-part-element-map⑧">part element map</a>)
from the sub-parts that it merely happens to contain,
it also helps with encapsulation,
as authors can use <span class="css" id="ref-for-selectordef-part③">::part()</span> without fear of accidental over-styling.</p>
   <h3 class="heading settled" data-level="5.2" id="part-attr"><span class="secno">5.2. </span><span class="content">Naming a Shadow Element: the <code><a data-link-type="element-sub" href="#element-attrdef-html-global-part" id="ref-for-element-attrdef-html-global-part">part</a></code> attribute</span><a class="self-link" href="#part-attr"></a></h3>
   <p>Any element in a shadow tree can have a <dfn class="dfn-paneled" data-dfn-for="html-global" data-dfn-type="element-attr" data-export id="element-attrdef-html-global-part"><code>part</code></dfn> attribute.
This is used to expose the element outside of the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree④⑤">shadow tree</a>.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <p>The part attribute is parsed as a space-separated list of tokens representing the part names of this element.</p>
   <p class="note" role="note"><span class="marker">Note:</span> It’s okay to give a part multiple names.
The "part name" should be considered similar to a class,
not an id or tagname.</p>
<pre class="example" id="example-a2e8f894"><a class="self-link" href="#example-a2e8f894"></a>&lt;style>
  c-e<b>::part(textspan)</b> { color: red; }
&lt;/style>

&lt;template id="c-e-template">
  &lt;span <b>part="textspan"</b>>This text will be red&lt;/span>
&lt;/template>
&lt;c-e>&lt;/c-e>
&lt;script>
  // Add template as custom element c-e
  ...
&lt;/script>
</pre>
   <h3 class="heading settled" data-level="5.3" id="exportparts-attr"><span class="secno">5.3. </span><span class="content">Forwarding a Shadow Element: the <code><a data-link-type="element-sub" href="#element-attrdef-html-global-exportparts" id="ref-for-element-attrdef-html-global-exportparts">exportparts</a></code> attribute</span><a class="self-link" href="#exportparts-attr"></a></h3>
   <p>Any element in a shadow tree can have a <dfn class="dfn-paneled" data-dfn-for="html-global" data-dfn-type="element-attr" data-export id="element-attrdef-html-global-exportparts"><code>exportparts</code></dfn> attribute.
If the element is a shadow host,
this is used to allow styling of parts from hosts inside the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree④⑥">shadow tree</a>
by rules outside this the <span id="ref-for-concept-shadow-tree④⑦">shadow tree</span>
(as if they were elements in the same tree as the host,
named by a part attribute).</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <p>The exportparts attribute is parsed as a comma-separated list of part mappings.
Each part mapping is one of:</p>
   <dl class="switch">
    <dt data-md><code>innerIdent : outerIdent</code>
    <dd data-md>
     <p>Adds <code>innerIdent</code>/<code>outerIdent</code> to el’s <a data-link-type="dfn" href="#element-forwarded-part-name-list" id="ref-for-element-forwarded-part-name-list②">forwarded part name list</a>.</p>
    <dt data-md><code>ident</code>
    <dd data-md>
     <p>Adds <code>ident</code>/<code>ident</code> to el’s <a data-link-type="dfn" href="#element-forwarded-part-name-list" id="ref-for-element-forwarded-part-name-list③">forwarded part name list</a>.</p>
     <p class="note" role="note"><span class="marker">Note:</span> This is shorthand for <code>ident : ident</code>.</p>
    <dt data-md><code>::ident : outerIdent</code>
    <dd data-md>
     <p>If <code>::ident</code> is the name of a <a data-link-type="dfn" href="https://drafts.csswg.org/css-pseudo-4/#fully-styleable" id="ref-for-fully-styleable">fully styleable pseudo-element</a>,
adds <code>::ident</code>/<code>outerIdent</code>
to el’s <a data-link-type="dfn" href="#element-forwarded-part-name-list" id="ref-for-element-forwarded-part-name-list④">forward part name list</a>.
Otherwise, does nothing.</p>
    <dt data-md>anything else
    <dd data-md>
     <p>Ignored for error-recovery / future compatibility.</p>
   </dl>
   <p class="note" role="note"><span class="marker">Note:</span> It’s okay to map a sub-part to several names.</p>
<pre class="example" id="example-8f835643"><a class="self-link" href="#example-8f835643"></a>&lt;style>
  c-e<b>::part(textspan)</b> { color: red; }
&lt;/style>

&lt;template id="c-e-outer-template">
  &lt;c-e-inner <b>exportparts="innerspan: textspan"</b>>&lt;/c-e-inner>
&lt;/template>

&lt;template id="c-e-inner-template">
  &lt;span <b>part="innerspan"</b>>
    This text will be red because the containing shadow
    host forwards <b>innerspan</b> to the document as "textspan"
    and the document style matches it.
  &lt;/span>
  &lt;span <b>part="textspan"</b>>
    This text will not be red because <b>textspan</b> in the document style
    cannot match against the part inside the inner custom element
    if it is not forwarded.
  &lt;/span>
&lt;/template>

&lt;c-e>&lt;/c-e>
&lt;script>
  // Add template as custom elements c-e-inner, c-e-outer
  ...
&lt;/script>
</pre>
   <div class="example" id="example-b11a0a88">
    <a class="self-link" href="#example-b11a0a88"></a>
	For example, a <a data-link-type="dfn" href="https://drafts.csswg.org/css-pseudo-4/#fully-styleable" id="ref-for-fully-styleable①">fully styleable pseudo-element</a>
	can be used in the <code><a data-link-type="element-sub" href="#element-attrdef-html-global-exportparts" id="ref-for-element-attrdef-html-global-exportparts①">exportparts</a></code> attribute,
	to masquerade as a <a class="css" data-link-type="maybe" href="#selectordef-part" id="ref-for-selectordef-part④">::part()</a>
	for the component it’s in:

	
<pre class="html">&lt;template id=custom-element-template>
  &lt;p exportparts="::before : preceding-text, ::after : following-text">
    Main text.
&lt;/template>
</pre>
    <p>An element using that template
	can use a selector like <span class="css">x-component::part(preceding-text)</span>
	to target the <span class="css">p::before</span> pseudo-element in its shadow,
	so users of the component don’t need to know
	that the preceding text is implemented as a pseudo-element.</p>
   </div>
   <h3 class="heading settled" data-level="5.4" id="part"><span class="secno">5.4. </span><span class="content">Selecting a Shadow Element: the <a class="css" data-link-type="maybe" href="#selectordef-part" id="ref-for-selectordef-part⑤">::part()</a> pseudo-element</span><a class="self-link" href="#part"></a></h3>
   <p>The <dfn class="css dfn-paneled" data-dfn-type="selector" data-export id="selectordef-part">::part()</dfn> pseudo-element
allows you to select elements that have been exposed via a <code><a data-link-type="element-sub" href="#element-attrdef-html-global-part" id="ref-for-element-attrdef-html-global-part①">part</a></code> attribute.
The syntax is:</p>
<pre class="prod">::part() = ::part( <a class="production" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#typedef-ident" id="ref-for-typedef-ident">&lt;ident></a><a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#mult-one-plus" id="ref-for-mult-one-plus">+</a> )
</pre>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <p>The <a class="css" data-link-type="maybe" href="#selectordef-part" id="ref-for-selectordef-part⑥">::part()</a> pseudo-element only matches anything
when the <a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#originating-element" id="ref-for-originating-element">originating element</a> is a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#element-shadow-host" id="ref-for-element-shadow-host②⑤">shadow host</a>.</p>
   <div class="example" id="example-c617aa59"><a class="self-link" href="#example-c617aa59"></a>
	For example,
	if you have a custom button
	that contains a "label" element that is exposed for styling
	(via <code>part="label"</code>),
	you can select it with
	<span class="css">x-button::part(label)</span>.
</div>
   <div class="example" id="example-72ff019b">
    <a class="self-link" href="#example-72ff019b"></a>
	Part names act similarly to classes:
	multiple elements can have the same part name,
	and a single element can have multiple part names.


    <p>A tabstrip control might have multiple elements
	with <code>part="tab"</code>,
	all of which are selected by <span class="css">::part(tab)</span>.</p>
    <p>If a single tab is active at a time,
	it can be specially indicated with <code>part="tab active"</code>
	and then selected by <span class="css">::part(tab active)</span>
	(or <span class="css">::part(active tab)</span>, as order doesn’t matter).</p>
   </div>
   <p>The <a class="css" data-link-type="maybe" href="#selectordef-part" id="ref-for-selectordef-part⑦">::part()</a> pseudo-element is a <a data-link-type="dfn" href="https://drafts.csswg.org/css-pseudo-4/#fully-styleable" id="ref-for-fully-styleable②">fully styleable pseudo-element</a>.
If the <a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#originating-element" id="ref-for-originating-element①">originating element’s</a> <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-root" id="ref-for-concept-shadow-root⑨">shadow root’s</a> <a data-link-type="dfn" href="#shadow-root-part-element-map" id="ref-for-shadow-root-part-element-map⑨">part element map</a>
<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">contains</a> the specified <a class="css production" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#typedef-ident" id="ref-for-typedef-ident①">&lt;ident></a>,
<span class="css" id="ref-for-selectordef-part⑧">::part()</span> represents the elements keyed to that ident;
if multiple idents are provided and the <span id="ref-for-shadow-root-part-element-map①⓪">part element map</span> contains them all,
it represents the intersection of the elements keyed to each ident.
Otherwise, it matches nothing.</p>
   <p><a class="css" data-link-type="maybe" href="#selectordef-part" id="ref-for-selectordef-part⑨">::part()</a> pseudo-elements inherit according to their position
in the <a data-link-type="dfn" href="https://drafts.csswg.org/selectors-4/#originating-element" id="ref-for-originating-element②">originating element’s</a> shadow tree.</p>
   <div class="example" id="example-11b18654">
    <a class="self-link" href="#example-11b18654"></a>
	For example,
	<span class="css">x-panel::part(confirm-button)::part(label)</span>
	never matches anything.
	This is because doing so would expose more structural information
	than is intended.


    <p>If the <code>&lt;x-panel></code>’s internal confirm button had used something like
	<code>part="label => confirm-label"</code>
	to forward the button’s internal parts up into the panel’s own <a data-link-type="dfn" href="#shadow-root-part-element-map" id="ref-for-shadow-root-part-element-map①①">part element map</a>,
	then a selector like
	<span class="css">x-panel::part(confirm-label)</span>
	would select just the one button’s label,
	ignoring any other labels.</p>
   </div>
   <h3 class="heading settled" data-level="5.5" id="idl"><span class="secno">5.5. </span><span class="content">Extensions to the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#element" id="ref-for-element">Element</a></code> Interface</span><a class="self-link" href="#idl"></a></h3>
<pre class="def highlight idl"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#element" id="ref-for-element①"><c- g>Element</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject"><c- g>SameObject</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#PutForwards" id="ref-for-PutForwards"><c- g>PutForwards</c-></a>=<a class="idl-code" data-link-type="attribute" href="https://dom.spec.whatwg.org/#dom-domtokenlist-value" id="ref-for-dom-domtokenlist-value"><c- n>value</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#domtokenlist" id="ref-for-domtokenlist"><c- n>DOMTokenList</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="Element" data-dfn-type="attribute" data-export data-readonly data-type="DOMTokenList" id="dom-element-part"><code><c- g>part</c-></code></dfn>;
};
</pre>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <p>The part attribute’s getter must return a DOMTokenList object
whose associated element is the context object
and whose associated attribute’s local name is part.
The token set of this particular DOMTokenList object are also known as the element’s parts.</p>
   <p class="issue" id="issue-853df044"><a class="self-link" href="#issue-853df044"></a> Define this as a superglobal in the DOM spec. <a href="https://github.com/w3c/csswg-drafts/issues/3424">[w3c/csswg-drafts Issue #3424]</a></p>
   <h3 class="heading settled" data-level="5.6" id="parsing"><span class="secno">5.6. </span><span class="content">Microsyntaxes for parsing</span><a class="self-link" href="#parsing"></a></h3>
   <h4 class="heading settled" data-level="5.6.1" id="parsing-mapping"><span class="secno">5.6.1. </span><span class="content">
Rules for parsing part mappings</span><a class="self-link" href="#parsing-mapping"></a></h4>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="valid-part-mapping">valid part mapping</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple①">tuple</a> of tokens
separated by a U+003A COLON character
and any number of space characters before or after the U+003A COLON
The tokens must not contain U+003A COLON or U+002C COMMA characters.</p>
   <p>The rules for parsing a part mapping are as follows:</p>
   <ol>
    <li data-md>
     <p>Let <var>input</var> be the string being parsed.</p>
    <li data-md>
     <p>Let <var>position</var> be a pointer into <var>input</var>, initially pointing at the start of the string.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points" id="ref-for-collect-a-sequence-of-code-points">Collect a sequence of code points</a> that are space characters</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points" id="ref-for-collect-a-sequence-of-code-points①">Collect a sequence of code points</a> that are not space characters or U+003A COLON characters,
and let <var>first token</var> be the result.</p>
    <li data-md>
     <p>If <var>first token</var> is empty then return error.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points" id="ref-for-collect-a-sequence-of-code-points②">Collect a sequence of code points</a> that are space characters.</p>
    <li data-md>
     <p>If the end of the <var>input</var> has been reached, return the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple②">tuple</a> (<var>first token</var>, <var>first token</var>)</p>
    <li data-md>
     <p>If character at <var>position</var> is not a U+003A COLON character, return error.</p>
    <li data-md>
     <p>Consume the U+003A COLON character.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points" id="ref-for-collect-a-sequence-of-code-points③">Collect a sequence of code points</a> that are space characters.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points" id="ref-for-collect-a-sequence-of-code-points④">Collect a sequence of code points</a> that are not space characters or U+003A COLON characters.
and let <var>second token</var> be the result.</p>
    <li data-md>
     <p>If <var>second token</var> is empty then return error.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points" id="ref-for-collect-a-sequence-of-code-points⑤">Collect a sequence of code points</a> that are space characters.</p>
    <li data-md>
     <p>If <var>position</var> is not past the end of <var>input</var> then return error.</p>
    <li data-md>
     <p>Return the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple③">tuple</a> (<var>first token</var>, <var>second token</var>).</p>
   </ol>
   <h4 class="heading settled" data-level="5.6.2" id="parsing-mapping-list"><span class="secno">5.6.2. </span><span class="content">
Rules for parsing a list of part mappings</span><a class="self-link" href="#parsing-mapping-list"></a></h4>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="valid-list-of-part-mappings">valid list of part mappings</dfn> is a number of valid part mappings
separated by a U+002C COMMA character
and any number of space characters before or after the U+002C COMMA</p>
   <p>The rules for parsing a list of part mappings are as follow:</p>
   <ol>
    <li data-md>
     <p>Let <var>input</var> be the string being parsed.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#split-on-commas" id="ref-for-split-on-commas">Split the string <var>input</var> on commas</a>.
Let <var>unparsed mappings</var> be the resulting list of strings.</p>
    <li data-md>
     <p>Let <var>mappings</var> be an initially empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①">list</a> of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple④">tuples</a> of tokens.
This <span id="ref-for-list②">list</span> will be the result of this algorithm.</p>
    <li data-md>
     <p>For each string <var>unparsed mapping</var> in <var>unparsed mappings</var>,
run the following substeps:</p>
     <ol>
      <li data-md>
       <p>If <var>unparsed mapping</var> is empty or contains only space characters,
continue to the next iteration of the loop.</p>
      <li data-md>
       <p>Let <var>mapping</var> be the result of parsing <var>unparsed mapping</var>
using the <span>rules for parsing part mappings</span>.</p>
      <li data-md>
       <p>If <var>mapping</var> is an error then continue to the next iteration of the loop.
This allows clients to skip over new syntax that is not understood.</p>
      <li data-md>
       <p>Append <var>mapping</var> to <var>mappings</var>.</p>
     </ol>
   </ol>
   <h2 class="heading settled" data-level="6" id="changes"><span class="secno">6. </span><span class="content">Changes</span><a class="self-link" href="#changes"></a></h2>
   <p>The following significant changes were made since the
	<a href="https://www.w3.org/TR/2014/WD-css-scoping-1-20140403/">3 April 2014 Working Draft</a>.</p>
   <ul>
    <li data-md>
     <p>Defined that tree-scoped names inherit into descendant shadow trees</p>
    <li data-md>
     <p>Renamed <span class="css">::content</span> to <span class="css">::slotted</span>.</p>
    <li data-md>
     <p>Define the flattened tree.</p>
    <li data-md>
     <p>Generally reorg and rebase the Shadow DOM section on top of current DOM.</p>
    <li data-md>
     <p>Punt <span class="css">@scope</span> and related things,
and <span class="css">::region</span> and related things,
to the next level of the draft.</p>
    <li data-md>
     <p>Define the specificity of <a class="css" data-link-type="maybe" href="#selectordef-host" id="ref-for-selectordef-host⑧">:host</a>, <a class="css" data-link-type="maybe" href="#selectordef-host-function" id="ref-for-selectordef-host-function④">:host()</a>, <a class="css" data-link-type="maybe" href="#selectordef-host-context" id="ref-for-selectordef-host-context④">:host-context()</a>, and <a class="css" data-link-type="maybe" href="#selectordef-slotted" id="ref-for-selectordef-slotted①①">::slotted()</a></p>
    <li data-md>
     <p>Remove the <span class="css">>>></span> (previously called <span class="css">/deep/</span>) combinator.</p>
    <li data-md>
     <p>Define that tree-abiding pseudos are allowed after <a class="css" data-link-type="maybe" href="#selectordef-slotted" id="ref-for-selectordef-slotted①②">::slotted()</a>.</p>
    <li data-md>
     <p>Allow <a class="css production" data-link-type="type" href="https://drafts.csswg.org/selectors-4/#typedef-compound-selector-list" id="ref-for-typedef-compound-selector-list">&lt;compound-selector-list></a> in all the pseudos.</p>
    <li data-md>
     <p>Define a way to create a stylesheet of default element styles for a given element.</p>
    <li data-md>
     <p>Make featureless elements match nothing.</p>
    <li data-md>
     <p>Define <a data-link-type="dfn" href="#in-the-context-of-a-shadow-tree" id="ref-for-in-the-context-of-a-shadow-tree⑤">in the context of a shadow tree</a>.</p>
    <li data-md>
     <p>Merged <a data-link-type="biblio" href="#biblio-css-shadow-parts" title="CSS Shadow Parts Module Level 1">[css-shadow-parts]</a> and renamed the specification to CSS Shadow Module Level 1. (<a href="https://github.com/w3c/csswg-drafts/issues/5809#issuecomment-910896765">Issue #5809</a>)</p>
    <li data-md>
     <p>Added support for multiple names in <a class="css" data-link-type="maybe" href="#selectordef-part" id="ref-for-selectordef-part①⓪">::part()</a></p>
    <li data-md>
     <p>Renamed 'part name map' to <a data-link-type="dfn" href="#element-forwarded-part-name-list" id="ref-for-element-forwarded-part-name-list⑤">forwarded part name list</a></p>
    <li data-md>
     <p>Restructured 'part element list' algorithm</p>
    <li data-md>
     <p>Moved various <a class="css" data-link-type="maybe" href="#selectordef-part" id="ref-for-selectordef-part①①">::part()</a> details to <a data-link-type="dfn" href="https://drafts.csswg.org/css-pseudo-4/#fully-styleable" id="ref-for-fully-styleable③">fully styleable pseudo-element</a></p>
    <li data-md>
     <p>Added Web Platform Tests coverage</p>
    <li data-md>
     <p>Minor editorial improvements</p>
   </ul>
   <h2 class="heading settled" data-level="7" id="privacy"><span class="secno">7. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#privacy"></a></h2>
   <p>This specification introduces Shadow DOM and some shadow-piercing capabilities,
but this does not introduce any privacy issues —​shadow DOM, as currently specified, is intentionally not a privacy boundary
(and the parts of the UA that use shadow DOM and <em>do</em> have a privacy boundary
implicitly rely on protections not yet specified,
which protect them from the things defined in this specification).</p>
   <h2 class="heading settled" data-level="8" id="security"><span class="secno">8. </span><span class="content">Security Considerations</span><a class="self-link" href="#security"></a></h2>
   <p>This specification introduces Shadow DOM and some shadow-piercing capabilities,
but this does not introduce any security issues —​shadow DOM, as currently specified, is intentionally not a security boundary,
merely a convenience for page authors.
Exposing <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree④⑧">shadow trees</a> to selectors in this way introduces no new security considerations.
(And the parts of the UA that use shadow DOM and <em>do</em> have a security boundary
implicitly rely on protections not yet specified,
which protect them from the things defined in this specification).</p>
  </main>
  <h2 class="heading no-num no-ref settled" id="w3c-conformance"><span class="content">
Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
  <h3 class="heading no-ref settled" id="w3c-conventions"><span class="content">
Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification.

    </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this:

    </p>
  <div class="example" id="w3c-example">
   <a class="self-link" href="#w3c-example"></a>
        
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this:

    </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <p>Advisements are normative sections styled to evoke special attention and are
    set apart from other normative text with <code>&lt;strong class="advisement"></code>, like
    this:

    <strong class="advisement">
        UAs MUST provide an accessible alternative.
    </strong></p>
  <details class="wpt-tests-block" dir="ltr" lang="en" open>
   <summary>Tests</summary>
   <p>Tests relating to the content of this specification
                     may be documented in “Tests” blocks like this one.
                     Any such block is non-normative.</p>
   <ul class="wpt-tests-list"></ul>
   <hr>
  </details>
  <h3 class="heading no-ref settled" id="w3c-conformance-classes"><span class="content">
Conformance classes</span><a class="self-link" href="#w3c-conformance-classes"></a></h3>
  <p>Conformance to this specification
    is defined for three conformance classes:
    </p>
  <dl>
   <dt>style sheet
            
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
            style sheet</a>.
        
   <dt>renderer
            
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
            that interprets the semantics of a style sheet and renders
            documents that use them.
        
   <dt>authoring tool
            
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
            that writes a style sheet.
    
  </dl>
  <p>A style sheet is conformant to this specification
    if all of its statements that use syntax defined in this module are valid
    according to the generic CSS grammar and the individual grammars of each
    feature defined in this module.

    </p>
  <p>A renderer is conformant to this specification
    if, in addition to interpreting the style sheet as defined by the
    appropriate specifications, it supports all the features defined
    by this specification by parsing them correctly
    and rendering the document accordingly. However, the inability of a
    UA to correctly render a document due to limitations of the device
    does not make the UA non-conformant. (For example, a UA is not
    required to render color on a monochrome monitor.)

    </p>
  <p>An authoring tool is conformant to this specification
    if it writes style sheets that are syntactically correct according to the
    generic CSS grammar and the individual grammars of each feature in
    this module, and meet all other conformance requirements of style sheets
    as described in this module.

</p>
  <h3 class="heading no-ref settled" id="w3c-partial"><span class="content">
Partial implementations</span><a class="self-link" href="#w3c-partial"></a></h3>
  <p>So that authors can exploit the forward-compatible parsing rules to
    assign fallback values, CSS renderers <strong>must</strong>
    treat as invalid (and <a href="http://www.w3.org/TR/CSS21/conform.html#ignore">ignore
    as appropriate</a>) any at-rules, properties, property values, keywords,
    and other syntactic constructs for which they have no usable level of
    support. In particular, user agents <strong>must not</strong> selectively
    ignore unsupported component values and honor supported values in a single
    multi-value property declaration: if any value is considered invalid
    (as unsupported values must be), CSS requires that the entire declaration
    be ignored.</p>
  <h4 class="heading settled" id="w3c-conform-future-proofing"><span class="content">
Implementations of Unstable and Proprietary Features</span><a class="self-link" href="#w3c-conform-future-proofing"></a></h4>
  <p>To avoid clashes with future stable CSS features,
        the CSSWG recommends <a href="http://www.w3.org/TR/CSS/#future-proofing">following best practices</a> for the implementation of <a href="http://www.w3.org/TR/CSS/#unstable">unstable</a> features and <a href="http://www.w3.org/TR/CSS/#proprietary-extension">proprietary extensions</a> to CSS.

</p>
  <h3 class="heading no-ref settled" id="w3c-testing"><span class="content">
Non-experimental implementations</span><a class="self-link" href="#w3c-testing"></a></h3>
  <p>Once a specification reaches the Candidate Recommendation stage,
    non-experimental implementations are possible, and implementors should
    release an unprefixed implementation of any CR-level feature they
    can demonstrate to be correctly implemented according to spec.

    </p>
  <p>To establish and maintain the interoperability of CSS across
    implementations, the CSS Working Group requests that non-experimental
    CSS renderers submit an implementation report (and, if necessary, the
    testcases used for that implementation report) to the W3C before
    releasing an unprefixed implementation of any CSS features. Testcases
    submitted to W3C are subject to review and correction by the CSS
    Working Group.

    </p>
  <p>Further information on submitting testcases and implementation reports
    can be found from on the CSS Working Group’s website at
    <a href="http://www.w3.org/Style/CSS/Test/">http://www.w3.org/Style/CSS/Test/</a>.
    Questions should be directed to the
    <a href="http://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a>
    mailing list.</p>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="heading no-num no-ref settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="heading no-num no-ref settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#calculate-the-part-element-map">calculate the part element map</a><span>, in § 5</span>
   <li><a href="#dom-window-defaultelementstylesmap-slot">[[defaultElementStylesMap]]</a><span>, in § 2</span>
   <li><a href="#element-attrdef-html-global-exportparts">exportparts</a><span>, in § 5.3</span>
   <li><a href="#flat-tree">flattened element tree</a><span>, in § 4.1</span>
   <li><a href="#flat-tree">flat tree</a><span>, in § 4.1</span>
   <li><a href="#element-forwarded-part-name-list">forwarded part name list</a><span>, in § 5</span>
   <li><a href="#tree-scoped-name-global">global</a><span>, in § 4.2</span>
   <li><a href="#selectordef-has-slotted">:has-slotted</a><span>, in § 3.2.5</span>
   <li><a href="#selectordef-host">:host</a><span>, in § 3.2.3</span>
   <li><a href="#selectordef-host-function">:host()</a><span>, in § 3.2.3</span>
   <li><a href="#selectordef-host-context">:host-context()</a><span>, in § 3.2.3</span>
   <li><a href="#in-the-context-of-a-shadow-tree">in the context of a shadow tree</a><span>, in § 3.2.1</span>
   <li><a href="#in-the-context-of-a-shadow-tree">in the context of the shadow tree</a><span>, in § 3.2.1</span>
   <li><a href="#tree-scoped-name-local">local</a><span>, in § 4.2</span>
   <li><a href="#tree-scoped-name-loosely-matched">loosely matched</a><span>, in § 4.2</span>
   <li><a href="#selectordef-part">::part()</a><span>, in § 5.4</span>
   <li>
    part
    <ul>
     <li><a href="#dom-element-part">attribute for Element</a><span>, in § 5.5</span>
     <li><a href="#element-attrdef-html-global-part">element-attr for html-global</a><span>, in § 5.2</span>
    </ul>
   <li><a href="#shadow-root-part-element-map">part element map</a><span>, in § 5</span>
   <li><a href="#element-part-name-list">part name list</a><span>, in § 5</span>
   <li><a href="#selectordef-slotted">::slotted()</a><span>, in § 3.2.4</span>
   <li><a href="#tree-scoped-name-strictly-matched">strictly matched</a><span>, in § 4.2</span>
   <li><a href="#tree-context">tree context</a><span>, in § 3.2.1</span>
   <li><a href="#css-tree-scoped-name">tree-scoped name</a><span>, in § 4.2</span>
   <li><a href="#css-tree-scoped-reference">tree-scoped reference</a><span>, in § 4.2</span>
   <li><a href="#valid-list-of-part-mappings">valid list of part mappings</a><span>, in § 5.6.2</span>
   <li><a href="#valid-part-mapping">valid part mapping</a><span>, in § 5.6.1</span>
  </ul>
  <h3 class="heading no-num no-ref settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSS-ANCHOR-POSITION-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="be2c21cf">anchor-name</span>
     <li><span class="dfn-paneled" id="2284f85b">anchor-scope</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-ANIMATIONS-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="fa19c68e">@keyframes</span>
     <li><span class="dfn-paneled" id="d984b6fe">animation-name</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-CASCADE-5]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="9cd25054">computed value</span>
     <li><span class="dfn-paneled" id="f45b0220">UA origin</span>
     <li><span class="dfn-paneled" id="63fe4250">user-agent origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-CASCADE-6]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="de6d76c2">cascade</span>
     <li><span class="dfn-paneled" id="8a768cb6">scoped style rules</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-COLOR-5]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="94d3d62c">@color-profile</span>
     <li><span class="dfn-paneled" id="03eee7b4">color()</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-COUNTER-STYLES-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="da946c0f">@counter-style</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-DISPLAY-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="e7f0dd6c">display</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-FONTS-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="92befb0f">@font-feature-values</span>
     <li><span class="dfn-paneled" id="0a78ad53">@font-palette-values</span>
     <li><span class="dfn-paneled" id="d65d17df">font-family</span>
     <li><span class="dfn-paneled" id="465328f2">font-family <small>(for @font-face)</small></span>
     <li><span class="dfn-paneled" id="3a21f8b8">font-palette</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-FONTS-5]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0497de86">@font-face</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-LISTS-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="de56fbfe">list-style-type</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-PSEUDO-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3b733e03">fully styleable pseudo-elements</span>
     <li><span class="dfn-paneled" id="16a52cab">tree-abiding pseudo-elements</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-SYNTAX-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="762610c7">at-rule</span>
     <li><span class="dfn-paneled" id="11e722f0">stylesheet</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-TYPED-OM-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="4b630c5b">reification</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-VALUES-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="bedd9d42">+</span>
     <li><span class="dfn-paneled" id="9213678e">&lt;ident></span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-VARIABLES-2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="198f1537">custom property</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="141bbada">DOMTokenList</span>
     <li><span class="dfn-paneled" id="296f3551">Element</span>
     <li><span class="dfn-paneled" id="84f47c16">child</span>
     <li><span class="dfn-paneled" id="92b2d7da">children</span>
     <li><span class="dfn-paneled" id="da8b8e0e">descendant</span>
     <li><span class="dfn-paneled" id="27d9b7ea">element</span>
     <li><span class="dfn-paneled" id="71908cce">find flattened slottables</span>
     <li><span class="dfn-paneled" id="2807a08c">find slottables</span>
     <li><span class="dfn-paneled" id="5d233601">host</span>
     <li><span class="dfn-paneled" id="cd1cb230">light tree</span>
     <li><span class="dfn-paneled" id="83ca4a87">local name</span>
     <li><span class="dfn-paneled" id="c7d8d91b">node tree</span>
     <li><span class="dfn-paneled" id="31e1cce6">querySelector(selectors)</span>
     <li><span class="dfn-paneled" id="f7960529">root</span>
     <li><span class="dfn-paneled" id="58a8f724">shadow host</span>
     <li><span class="dfn-paneled" id="3fcc582f">shadow root</span>
     <li><span class="dfn-paneled" id="19f9e9df">shadow tree</span>
     <li><span class="dfn-paneled" id="8f378588">shadow-including ancestor</span>
     <li><span class="dfn-paneled" id="5b18ffe6">slot</span>
     <li><span class="dfn-paneled" id="8e74149c">slottable</span>
     <li><span class="dfn-paneled" id="ff74a37a">value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="5d7209e9">Window</span>
     <li><span class="dfn-paneled" id="80e3bb55">assignedNodes(options)</span>
     <li><span class="dfn-paneled" id="b6fb7a51">custom element</span>
     <li><span class="dfn-paneled" id="3ad13207">slot</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="53275e46">append</span>
     <li><span class="dfn-paneled" id="d24334b4">collect a sequence of code points</span>
     <li><span class="dfn-paneled" id="a326add7">contain</span>
     <li><span class="dfn-paneled" id="649608b9">list</span>
     <li><span class="dfn-paneled" id="692595fe">ordered set</span>
     <li><span class="dfn-paneled" id="b29084c6">split a string on commas</span>
     <li><span class="dfn-paneled" id="0698d556">string</span>
     <li><span class="dfn-paneled" id="0e8de730">tuple</span>
    </ul>
   <li>
    <a data-link-type="biblio">[SELECTORS-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="53a193f1">*</span>
    </ul>
   <li>
    <a data-link-type="biblio">[SELECTORS-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="2fb9329a">:hover</span>
     <li><span class="dfn-paneled" id="b4d48921">:is()</span>
     <li><span class="dfn-paneled" id="1324ff49">:not()</span>
     <li><span class="dfn-paneled" id="5a223d21">&lt;compound-selector-list></span>
     <li><span class="dfn-paneled" id="32b9b591">&lt;compound-selector></span>
     <li><span class="dfn-paneled" id="832ba741">complex selector</span>
     <li><span class="dfn-paneled" id="24408a11">compound selector</span>
     <li><span class="dfn-paneled" id="5f4f98ab">descendant combinator</span>
     <li><span class="dfn-paneled" id="3a1154bf">featureless</span>
     <li><span class="dfn-paneled" id="afde9b5e">functional pseudo-class</span>
     <li><span class="dfn-paneled" id="c8f141cb">match a selector against a tree</span>
     <li><span class="dfn-paneled" id="5e0d3b02">match a selector against an element</span>
     <li><span class="dfn-paneled" id="82805a4e">originating element</span>
     <li><span class="dfn-paneled" id="628c6566">pseudo-class</span>
     <li><span class="dfn-paneled" id="42b00c6e">pseudo-elements</span>
     <li><span class="dfn-paneled" id="bb2056aa">specificity</span>
     <li><span class="dfn-paneled" id="32c45571">type selector</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="21ecf38f">PutForwards</span>
     <li><span class="dfn-paneled" id="a5c91173">SameObject</span>
    </ul>
  </ul>
  <h2 class="heading no-num no-ref settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="heading no-num no-ref settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-anchor-position-1">[CSS-ANCHOR-POSITION-1]
   <dd>Tab Atkins Jr.; Elika Etemad; Ian Kilpatrick. <a href="https://drafts.csswg.org/css-anchor-position-1/"><cite>CSS Anchor Positioning Module Level 1</cite></a>. URL: <a href="https://drafts.csswg.org/css-anchor-position-1/">https://drafts.csswg.org/css-anchor-position-1/</a>
   <dt id="biblio-css-animations-1">[CSS-ANIMATIONS-1]
   <dd>David Baron; et al. <a href="https://drafts.csswg.org/css-animations/"><cite>CSS Animations Level 1</cite></a>. URL: <a href="https://drafts.csswg.org/css-animations/">https://drafts.csswg.org/css-animations/</a>
   <dt id="biblio-css-cascade-4">[CSS-CASCADE-4]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-cascade-4/"><cite>CSS Cascading and Inheritance Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-cascade-4/">https://drafts.csswg.org/css-cascade-4/</a>
   <dt id="biblio-css-cascade-5">[CSS-CASCADE-5]
   <dd>Elika Etemad; Miriam Suzanne; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-cascade-5/"><cite>CSS Cascading and Inheritance Level 5</cite></a>. URL: <a href="https://drafts.csswg.org/css-cascade-5/">https://drafts.csswg.org/css-cascade-5/</a>
   <dt id="biblio-css-cascade-6">[CSS-CASCADE-6]
   <dd>Elika Etemad; Miriam Suzanne; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-cascade-6/"><cite>CSS Cascading and Inheritance Level 6</cite></a>. URL: <a href="https://drafts.csswg.org/css-cascade-6/">https://drafts.csswg.org/css-cascade-6/</a>
   <dt id="biblio-css-color-5">[CSS-COLOR-5]
   <dd>Chris Lilley; et al. <a href="https://drafts.csswg.org/css-color-5/"><cite>CSS Color Module Level 5</cite></a>. URL: <a href="https://drafts.csswg.org/css-color-5/">https://drafts.csswg.org/css-color-5/</a>
   <dt id="biblio-css-counter-styles-3">[CSS-COUNTER-STYLES-3]
   <dd>Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-counter-styles/"><cite>CSS Counter Styles Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-counter-styles/">https://drafts.csswg.org/css-counter-styles/</a>
   <dt id="biblio-css-display-4">[CSS-DISPLAY-4]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-display-4/"><cite>CSS Display Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-display-4/">https://drafts.csswg.org/css-display-4/</a>
   <dt id="biblio-css-fonts-4">[CSS-FONTS-4]
   <dd>Chris Lilley. <a href="https://drafts.csswg.org/css-fonts-4/"><cite>CSS Fonts Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-fonts-4/">https://drafts.csswg.org/css-fonts-4/</a>
   <dt id="biblio-css-fonts-5">[CSS-FONTS-5]
   <dd>Chris Lilley. <a href="https://drafts.csswg.org/css-fonts-5/"><cite>CSS Fonts Module Level 5</cite></a>. URL: <a href="https://drafts.csswg.org/css-fonts-5/">https://drafts.csswg.org/css-fonts-5/</a>
   <dt id="biblio-css-lists-3">[CSS-LISTS-3]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://drafts.csswg.org/css-lists-3/"><cite>CSS Lists and Counters Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-lists-3/">https://drafts.csswg.org/css-lists-3/</a>
   <dt id="biblio-css-pseudo-4">[CSS-PSEUDO-4]
   <dd>Elika Etemad; Alan Stearns. <a href="https://drafts.csswg.org/css-pseudo-4/"><cite>CSS Pseudo-Elements Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-pseudo-4/">https://drafts.csswg.org/css-pseudo-4/</a>
   <dt id="biblio-css-syntax-3">[CSS-SYNTAX-3]
   <dd>Tab Atkins Jr.; Simon Sapin. <a href="https://drafts.csswg.org/css-syntax/"><cite>CSS Syntax Module Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/css-syntax/">https://drafts.csswg.org/css-syntax/</a>
   <dt id="biblio-css-values-4">[CSS-VALUES-4]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://drafts.csswg.org/css-values-4/"><cite>CSS Values and Units Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-values-4/">https://drafts.csswg.org/css-values-4/</a>
   <dt id="biblio-css-variables-2">[CSS-VARIABLES-2]
   <dd><a href="https://drafts.csswg.org/css-variables-2/"><cite>CSS Custom Properties for Cascading Variables Module Level 2</cite></a>. Editor's Draft. URL: <a href="https://drafts.csswg.org/css-variables-2/">https://drafts.csswg.org/css-variables-2/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-selectors-4">[SELECTORS-4]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://drafts.csswg.org/selectors/"><cite>Selectors Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/selectors/">https://drafts.csswg.org/selectors/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="heading no-num no-ref settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-css-shadow-parts">[CSS-SHADOW-PARTS]
   <dd>Tab Atkins Jr.; Fergal Daly. <a href="https://drafts.csswg.org/css-shadow-parts/"><cite>CSS Shadow Parts Module Level 1</cite></a>. URL: <a href="https://drafts.csswg.org/css-shadow-parts/">https://drafts.csswg.org/css-shadow-parts/</a>
   <dt id="biblio-css-typed-om-1">[CSS-TYPED-OM-1]
   <dd>Tab Atkins Jr.; François Remy. <a href="https://drafts.css-houdini.org/css-typed-om-1/"><cite>CSS Typed OM Level 1</cite></a>. URL: <a href="https://drafts.css-houdini.org/css-typed-om-1/">https://drafts.css-houdini.org/css-typed-om-1/</a>
   <dt id="biblio-selectors-3">[SELECTORS-3]
   <dd>Tantek Çelik; et al. <a href="https://drafts.csswg.org/selectors-3/"><cite>Selectors Level 3</cite></a>. URL: <a href="https://drafts.csswg.org/selectors-3/">https://drafts.csswg.org/selectors-3/</a>
  </dl>
  <h2 class="heading no-num no-ref settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="def highlight idl"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#element"><c- g>Element</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#PutForwards"><c- g>PutForwards</c-></a>=<a class="idl-code" data-link-type="attribute" href="https://dom.spec.whatwg.org/#dom-domtokenlist-value"><c- n>value</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#domtokenlist"><c- n>DOMTokenList</c-></a> <a data-readonly data-type="DOMTokenList" href="#dom-element-part"><code><c- g>part</c-></code></a>;
};

</pre>
  <h2 class="heading no-num no-ref settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Do we need to restrict the <a data-link-type="dfn" href="https://drafts.csswg.org/css-syntax-3/#at-rule">at-rules</a> that can be used in these sheets?
	For example, do we allow an <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-fonts-5/#at-font-face-rule">@font-face</a>?
	I’m going to leave it as allowed unless/until I hear complaints. <a class="issue-return" href="#issue-f4e1dc6b" title="Jump to section">↵</a></div>
   <div class="issue"> Rewrite this against the newer call forms of the matching algorithms. <a class="issue-return" href="#issue-b8d42d77" title="Jump to section">↵</a></div>
   <div class="issue"> A non-obvious result of this
	is that elements assigned to a slot inherit from that slot,
	not their light-tree parent
	or any deeper slots their slot gets assigned to.
	This means that text nodes are styled by the shadow tree of their parent,
	with nobody else capable of intervening in any way.
	Do we want an additional pseudo-element for targeting those text nodes
	so they can be styled at all slot-assignment levels,
	like normal elements can be?
	This implies it needs to work for text nodes in the light tree
	before they’re assigned downwards,
	so this can’t just be a <a class="css" data-link-type="maybe" href="#selectordef-slotted">::slotted()</a> variant.
	Luckily, this is a long-standing request! <a class="issue-return" href="#issue-75772618" title="Jump to section">↵</a></div>
   <div class="issue">
    
		TODO: Fix all the at-rules that define global names,
		and the properties that reference them,
		to use these concepts.


    <p>Global names include:</p>
    <ul>
     <li data-md>
      <p><a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-fonts-5/#at-font-face-rule">@font-face</a>, referenced by <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-fonts-4/#propdef-font-family">font-family</a></p>
     <li data-md>
      <p><a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-fonts-4/#at-ruledef-font-feature-values">@font-feature-values</a>, referenced by <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-fonts-4/#propdef-font-family">font-family</a></p>
     <li data-md>
      <p><a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-animations-1/#at-ruledef-keyframes">@keyframes</a>, referenced by <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-animations-1/#propdef-animation-name">animation-name</a></p>
     <li data-md>
      <p><a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-counter-styles-3/#at-ruledef-counter-style">@counter-style</a>, referenced by <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-lists-3/#propdef-list-style-type">list-style-type</a></p>
     <li data-md>
      <p><a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-color-5/#at-ruledef-profile">@color-profile</a>, referenced by the <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-color-5/#funcdef-color">color()</a> function</p>
     <li data-md>
      <p><a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-fonts-4/#at-ruledef-font-palette-values">@font-palette-values</a>, referenced by <a class="css property" data-link-type="property" href="https://drafts.csswg.org/css-fonts-4/#propdef-font-palette">font-palette</a></p>
     <li data-md>
      <p>others?</p>
    </ul>
    	 <a class="issue-return" href="#issue-3293692a" title="Jump to section">↵</a>
   </div>
   <div class="issue"> Define this as a superglobal in the DOM spec. <a href="https://github.com/w3c/csswg-drafts/issues/3424">[w3c/csswg-drafts Issue #3424]</a> <a class="issue-return" href="#issue-853df044" title="Jump to section">↵</a></div>
  </div>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"03eee7b4": {"dfnID":"03eee7b4","dfnText":"color()","external":true,"refSections":[{"refs":[{"id":"ref-for-funcdef-color"}],"title":"4.2. \nName-Defining Constructs and Inheritance"}],"url":"https://drafts.csswg.org/css-color-5/#funcdef-color"},
"0497de86": {"dfnID":"0497de86","dfnText":"@font-face","external":true,"refSections":[{"refs":[{"id":"ref-for-at-font-face-rule"}],"title":"2. Default Styles for Custom Elements"},{"refs":[{"id":"ref-for-at-font-face-rule\u2460"},{"id":"ref-for-at-font-face-rule\u2461"},{"id":"ref-for-at-font-face-rule\u2462"},{"id":"ref-for-at-font-face-rule\u2463"},{"id":"ref-for-at-font-face-rule\u2464"},{"id":"ref-for-at-font-face-rule\u2465"},{"id":"ref-for-at-font-face-rule\u2466"},{"id":"ref-for-at-font-face-rule\u2467"},{"id":"ref-for-at-font-face-rule\u2468"}],"title":"4.2. \nName-Defining Constructs and Inheritance"},{"refs":[{"id":"ref-for-at-font-face-rule\u2460\u24ea"},{"id":"ref-for-at-font-face-rule\u2460\u2460"}],"title":"4.2.1. \nSerialized Tree-Scoped References"}],"url":"https://drafts.csswg.org/css-fonts-5/#at-font-face-rule"},
"0698d556": {"dfnID":"0698d556","dfnText":"string","external":true,"refSections":[{"refs":[{"id":"ref-for-string"},{"id":"ref-for-string\u2460"},{"id":"ref-for-string\u2461"}],"title":"5. Exposing a Shadow Element"}],"url":"https://infra.spec.whatwg.org/#string"},
"0a78ad53": {"dfnID":"0a78ad53","dfnText":"@font-palette-values","external":true,"refSections":[{"refs":[{"id":"ref-for-at-ruledef-font-palette-values"}],"title":"4.2. \nName-Defining Constructs and Inheritance"}],"url":"https://drafts.csswg.org/css-fonts-4/#at-ruledef-font-palette-values"},
"0e8de730": {"dfnID":"0e8de730","dfnText":"tuple","external":true,"refSections":[{"refs":[{"id":"ref-for-tuple"}],"title":"5. Exposing a Shadow Element"},{"refs":[{"id":"ref-for-tuple\u2460"},{"id":"ref-for-tuple\u2461"},{"id":"ref-for-tuple\u2462"}],"title":"5.6.1. \nRules for parsing part mappings"},{"refs":[{"id":"ref-for-tuple\u2463"}],"title":"5.6.2. \nRules for parsing a list of part mappings"}],"url":"https://infra.spec.whatwg.org/#tuple"},
"11e722f0": {"dfnID":"11e722f0","dfnText":"stylesheet","external":true,"refSections":[{"refs":[{"id":"ref-for-css-stylesheet"}],"title":"2. Default Styles for Custom Elements"}],"url":"https://drafts.csswg.org/css-syntax-3/#css-stylesheet"},
"1324ff49": {"dfnID":"1324ff49","dfnText":":not()","external":true,"refSections":[{"refs":[{"id":"ref-for-negation-pseudo"}],"title":"3.2.3. \nSelecting Into the Light: the :host, :host(), and :host-context() pseudo-classes"}],"url":"https://drafts.csswg.org/selectors-4/#negation-pseudo"},
"141bbada": {"dfnID":"141bbada","dfnText":"DOMTokenList","external":true,"refSections":[{"refs":[{"id":"ref-for-domtokenlist"}],"title":"5.5. Extensions to the Element Interface"}],"url":"https://dom.spec.whatwg.org/#domtokenlist"},
"16a52cab": {"dfnID":"16a52cab","dfnText":"tree-abiding pseudo-elements","external":true,"refSections":[{"refs":[{"id":"ref-for-tree-abiding"}],"title":"3.2.4. \nSelecting Slot-Assigned Content: the ::slotted() pseudo-element"}],"url":"https://drafts.csswg.org/css-pseudo-4/#tree-abiding"},
"198f1537": {"dfnID":"198f1537","dfnText":"custom property","external":true,"refSections":[{"refs":[{"id":"ref-for-custom-property"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-custom-property\u2460"},{"id":"ref-for-custom-property\u2461"},{"id":"ref-for-custom-property\u2462"},{"id":"ref-for-custom-property\u2463"},{"id":"ref-for-custom-property\u2464"},{"id":"ref-for-custom-property\u2465"}],"title":"5.1. Motivation"}],"url":"https://drafts.csswg.org/css-variables-2/#custom-property"},
"19f9e9df": {"dfnID":"19f9e9df","dfnText":"shadow tree","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-shadow-tree"},{"id":"ref-for-concept-shadow-tree\u2460"},{"id":"ref-for-concept-shadow-tree\u2461"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-concept-shadow-tree\u2462"},{"id":"ref-for-concept-shadow-tree\u2463"},{"id":"ref-for-concept-shadow-tree\u2464"}],"title":"2. Default Styles for Custom Elements"},{"refs":[{"id":"ref-for-concept-shadow-tree\u2465"},{"id":"ref-for-concept-shadow-tree\u2466"},{"id":"ref-for-concept-shadow-tree\u2467"},{"id":"ref-for-concept-shadow-tree\u2468"},{"id":"ref-for-concept-shadow-tree\u2460\u24ea"},{"id":"ref-for-concept-shadow-tree\u2460\u2460"},{"id":"ref-for-concept-shadow-tree\u2460\u2461"},{"id":"ref-for-concept-shadow-tree\u2460\u2462"}],"title":"3.1. Informative Explanation of Shadow DOM"},{"refs":[{"id":"ref-for-concept-shadow-tree\u2460\u2463"},{"id":"ref-for-concept-shadow-tree\u2460\u2464"},{"id":"ref-for-concept-shadow-tree\u2460\u2465"},{"id":"ref-for-concept-shadow-tree\u2460\u2466"}],"title":"3.2.1. \nMatching Selectors Against Shadow Trees"},{"refs":[{"id":"ref-for-concept-shadow-tree\u2460\u2467"},{"id":"ref-for-concept-shadow-tree\u2460\u2468"},{"id":"ref-for-concept-shadow-tree\u2461\u24ea"},{"id":"ref-for-concept-shadow-tree\u2461\u2460"},{"id":"ref-for-concept-shadow-tree\u2461\u2461"},{"id":"ref-for-concept-shadow-tree\u2461\u2462"},{"id":"ref-for-concept-shadow-tree\u2461\u2463"},{"id":"ref-for-concept-shadow-tree\u2461\u2464"}],"title":"3.2.2. \nSelecting Shadow Hosts from within a Shadow Tree"},{"refs":[{"id":"ref-for-concept-shadow-tree\u2461\u2465"},{"id":"ref-for-concept-shadow-tree\u2461\u2466"},{"id":"ref-for-concept-shadow-tree\u2461\u2467"},{"id":"ref-for-concept-shadow-tree\u2461\u2468"},{"id":"ref-for-concept-shadow-tree\u2462\u24ea"},{"id":"ref-for-concept-shadow-tree\u2462\u2460"},{"id":"ref-for-concept-shadow-tree\u2462\u2461"}],"title":"3.2.3. \nSelecting Into the Light: the :host, :host(), and :host-context() pseudo-classes"},{"refs":[{"id":"ref-for-concept-shadow-tree\u2462\u2462"}],"title":"3.2.4. \nSelecting Slot-Assigned Content: the ::slotted() pseudo-element"},{"refs":[{"id":"ref-for-concept-shadow-tree\u2462\u2463"},{"id":"ref-for-concept-shadow-tree\u2462\u2464"},{"id":"ref-for-concept-shadow-tree\u2462\u2465"},{"id":"ref-for-concept-shadow-tree\u2462\u2466"}],"title":"4.1. \nFlattening the DOM into an Element Tree"},{"refs":[{"id":"ref-for-concept-shadow-tree\u2462\u2467"},{"id":"ref-for-concept-shadow-tree\u2462\u2468"},{"id":"ref-for-concept-shadow-tree\u2463\u24ea"},{"id":"ref-for-concept-shadow-tree\u2463\u2460"}],"title":"4.2. \nName-Defining Constructs and Inheritance"},{"refs":[{"id":"ref-for-concept-shadow-tree\u2463\u2461"},{"id":"ref-for-concept-shadow-tree\u2463\u2462"}],"title":"4.2.1. \nSerialized Tree-Scoped References"},{"refs":[{"id":"ref-for-concept-shadow-tree\u2463\u2463"}],"title":"5. Exposing a Shadow Element"},{"refs":[{"id":"ref-for-concept-shadow-tree\u2463\u2464"}],"title":"5.2. Naming a Shadow Element: the part attribute"},{"refs":[{"id":"ref-for-concept-shadow-tree\u2463\u2465"},{"id":"ref-for-concept-shadow-tree\u2463\u2466"}],"title":"5.3. Forwarding a Shadow Element: the exportparts attribute"},{"refs":[{"id":"ref-for-concept-shadow-tree\u2463\u2467"}],"title":"8. Security Considerations"}],"url":"https://dom.spec.whatwg.org/#concept-shadow-tree"},
"21ecf38f": {"dfnID":"21ecf38f","dfnText":"PutForwards","external":true,"refSections":[{"refs":[{"id":"ref-for-PutForwards"}],"title":"5.5. Extensions to the Element Interface"}],"url":"https://webidl.spec.whatwg.org/#PutForwards"},
"2284f85b": {"dfnID":"2284f85b","dfnText":"anchor-scope","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-anchor-scope"},{"id":"ref-for-propdef-anchor-scope\u2460"}],"title":"4.2. \nName-Defining Constructs and Inheritance"}],"url":"https://drafts.csswg.org/css-anchor-position-1/#propdef-anchor-scope"},
"24408a11": {"dfnID":"24408a11","dfnText":"compound selector","external":true,"refSections":[{"refs":[{"id":"ref-for-compound"}],"title":"2. Default Styles for Custom Elements"}],"url":"https://drafts.csswg.org/selectors-4/#compound"},
"27d9b7ea": {"dfnID":"27d9b7ea","dfnText":"element","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-element"},{"id":"ref-for-concept-element\u2460"}],"title":"4.2. \nName-Defining Constructs and Inheritance"}],"url":"https://dom.spec.whatwg.org/#concept-element"},
"2807a08c": {"dfnID":"2807a08c","dfnText":"find slottables","external":true,"refSections":[{"refs":[{"id":"ref-for-find-slotables"}],"title":"4.1. \nFlattening the DOM into an Element Tree"}],"url":"https://dom.spec.whatwg.org/#find-slotables"},
"296f3551": {"dfnID":"296f3551","dfnText":"Element","external":true,"refSections":[{"refs":[{"id":"ref-for-element"},{"id":"ref-for-element\u2460"}],"title":"5.5. Extensions to the Element Interface"}],"url":"https://dom.spec.whatwg.org/#element"},
"2fb9329a": {"dfnID":"2fb9329a","dfnText":":hover","external":true,"refSections":[{"refs":[{"id":"ref-for-hover-pseudo"}],"title":"5.1. Motivation"}],"url":"https://drafts.csswg.org/selectors-4/#hover-pseudo"},
"31e1cce6": {"dfnID":"31e1cce6","dfnText":"querySelector(selectors)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-parentnode-queryselector"}],"title":"3.2.1. \nMatching Selectors Against Shadow Trees"}],"url":"https://dom.spec.whatwg.org/#dom-parentnode-queryselector"},
"32b9b591": {"dfnID":"32b9b591","dfnText":"<compound-selector>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-compound-selector"},{"id":"ref-for-typedef-compound-selector\u2460"},{"id":"ref-for-typedef-compound-selector\u2461"}],"title":"3.2.3. \nSelecting Into the Light: the :host, :host(), and :host-context() pseudo-classes"},{"refs":[{"id":"ref-for-typedef-compound-selector\u2462"},{"id":"ref-for-typedef-compound-selector\u2463"}],"title":"3.2.4. \nSelecting Slot-Assigned Content: the ::slotted() pseudo-element"}],"url":"https://drafts.csswg.org/selectors-4/#typedef-compound-selector"},
"32c45571": {"dfnID":"32c45571","dfnText":"type selector","external":true,"refSections":[{"refs":[{"id":"ref-for-type-selector"},{"id":"ref-for-type-selector\u2460"}],"title":"2. Default Styles for Custom Elements"}],"url":"https://drafts.csswg.org/selectors-4/#type-selector"},
"3a1154bf": {"dfnID":"3a1154bf","dfnText":"featureless","external":true,"refSections":[{"refs":[{"id":"ref-for-featureless"}],"title":"3.2.2. \nSelecting Shadow Hosts from within a Shadow Tree"}],"url":"https://drafts.csswg.org/selectors-4/#featureless"},
"3a21f8b8": {"dfnID":"3a21f8b8","dfnText":"font-palette","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-font-palette"}],"title":"4.2. \nName-Defining Constructs and Inheritance"}],"url":"https://drafts.csswg.org/css-fonts-4/#propdef-font-palette"},
"3ad13207": {"dfnID":"3ad13207","dfnText":"slot","external":true,"refSections":[{"refs":[{"id":"ref-for-the-slot-element"}],"title":"3.1. Informative Explanation of Shadow DOM"},{"refs":[{"id":"ref-for-the-slot-element\u2460"},{"id":"ref-for-the-slot-element\u2461"},{"id":"ref-for-the-slot-element\u2462"}],"title":"3.2.4. \nSelecting Slot-Assigned Content: the ::slotted() pseudo-element"},{"refs":[{"id":"ref-for-the-slot-element\u2463"}],"title":"3.2.5. \nMatching on the Presence of Slot-Assigned Nodes: the :has-slotted pseudo-class"}],"url":"https://html.spec.whatwg.org/multipage/scripting.html#the-slot-element"},
"3b733e03": {"dfnID":"3b733e03","dfnText":"fully styleable pseudo-elements","external":true,"refSections":[{"refs":[{"id":"ref-for-fully-styleable"},{"id":"ref-for-fully-styleable\u2460"}],"title":"5.3. Forwarding a Shadow Element: the exportparts attribute"},{"refs":[{"id":"ref-for-fully-styleable\u2461"}],"title":"5.4. Selecting a Shadow Element: the ::part() pseudo-element"},{"refs":[{"id":"ref-for-fully-styleable\u2462"}],"title":"6. Changes"}],"url":"https://drafts.csswg.org/css-pseudo-4/#fully-styleable"},
"3fcc582f": {"dfnID":"3fcc582f","dfnText":"shadow root","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-shadow-root"},{"id":"ref-for-concept-shadow-root\u2460"}],"title":"3.1. Informative Explanation of Shadow DOM"},{"refs":[{"id":"ref-for-concept-shadow-root\u2461"},{"id":"ref-for-concept-shadow-root\u2462"},{"id":"ref-for-concept-shadow-root\u2463"}],"title":"3.2.1. \nMatching Selectors Against Shadow Trees"},{"refs":[{"id":"ref-for-concept-shadow-root\u2464"}],"title":"3.2.2. \nSelecting Shadow Hosts from within a Shadow Tree"},{"refs":[{"id":"ref-for-concept-shadow-root\u2465"}],"title":"4.1. \nFlattening the DOM into an Element Tree"},{"refs":[{"id":"ref-for-concept-shadow-root\u2466"}],"title":"4.2. \nName-Defining Constructs and Inheritance"},{"refs":[{"id":"ref-for-concept-shadow-root\u2467"}],"title":"5. Exposing a Shadow Element"},{"refs":[{"id":"ref-for-concept-shadow-root\u2468"}],"title":"5.4. Selecting a Shadow Element: the ::part() pseudo-element"}],"url":"https://dom.spec.whatwg.org/#concept-shadow-root"},
"42b00c6e": {"dfnID":"42b00c6e","dfnText":"pseudo-elements","external":true,"refSections":[{"refs":[{"id":"ref-for-pseudo-element"}],"title":"1. Introduction"}],"url":"https://drafts.csswg.org/selectors-4/#pseudo-element"},
"465328f2": {"dfnID":"465328f2","dfnText":"font-family (for @font-face)","external":true,"refSections":[{"refs":[{"id":"ref-for-descdef-font-face-font-family"}],"title":"4.2. \nName-Defining Constructs and Inheritance"}],"url":"https://drafts.csswg.org/css-fonts-4/#descdef-font-face-font-family"},
"4b630c5b": {"dfnID":"4b630c5b","dfnText":"reification","external":true,"refSections":[{"refs":[{"id":"ref-for-css-reify"}],"title":"4.2.1. \nSerialized Tree-Scoped References"}],"url":"https://drafts.css-houdini.org/css-typed-om-1/#css-reify"},
"53275e46": {"dfnID":"53275e46","dfnText":"append","external":true,"refSections":[{"refs":[{"id":"ref-for-list-append"},{"id":"ref-for-list-append\u2460"},{"id":"ref-for-list-append\u2461"}],"title":"5. Exposing a Shadow Element"}],"url":"https://infra.spec.whatwg.org/#list-append"},
"53a193f1": {"dfnID":"53a193f1","dfnText":"*","external":true,"refSections":[{"refs":[{"id":"ref-for-x"}],"title":"3.2.4. \nSelecting Slot-Assigned Content: the ::slotted() pseudo-element"}],"url":"https://drafts.csswg.org/selectors-3/#x"},
"58a8f724": {"dfnID":"58a8f724","dfnText":"shadow host","external":true,"refSections":[{"refs":[{"id":"ref-for-element-shadow-host"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-element-shadow-host\u2460"},{"id":"ref-for-element-shadow-host\u2461"},{"id":"ref-for-element-shadow-host\u2462"}],"title":"3.1. Informative Explanation of Shadow DOM"},{"refs":[{"id":"ref-for-element-shadow-host\u2463"}],"title":"3.2.1. \nMatching Selectors Against Shadow Trees"},{"refs":[{"id":"ref-for-element-shadow-host\u2464"},{"id":"ref-for-element-shadow-host\u2465"},{"id":"ref-for-element-shadow-host\u2466"},{"id":"ref-for-element-shadow-host\u2467"},{"id":"ref-for-element-shadow-host\u2468"},{"id":"ref-for-element-shadow-host\u2460\u24ea"},{"id":"ref-for-element-shadow-host\u2460\u2460"},{"id":"ref-for-element-shadow-host\u2460\u2461"},{"id":"ref-for-element-shadow-host\u2460\u2462"}],"title":"3.2.2. \nSelecting Shadow Hosts from within a Shadow Tree"},{"refs":[{"id":"ref-for-element-shadow-host\u2460\u2463"},{"id":"ref-for-element-shadow-host\u2460\u2464"},{"id":"ref-for-element-shadow-host\u2460\u2465"},{"id":"ref-for-element-shadow-host\u2460\u2466"},{"id":"ref-for-element-shadow-host\u2460\u2467"}],"title":"3.2.3. \nSelecting Into the Light: the :host, :host(), and :host-context() pseudo-classes"},{"refs":[{"id":"ref-for-element-shadow-host\u2460\u2468"}],"title":"3.2.4. \nSelecting Slot-Assigned Content: the ::slotted() pseudo-element"},{"refs":[{"id":"ref-for-element-shadow-host\u2461\u24ea"},{"id":"ref-for-element-shadow-host\u2461\u2460"},{"id":"ref-for-element-shadow-host\u2461\u2461"}],"title":"4.1. \nFlattening the DOM into an Element Tree"},{"refs":[{"id":"ref-for-element-shadow-host\u2461\u2462"}],"title":"5. Exposing a Shadow Element"},{"refs":[{"id":"ref-for-element-shadow-host\u2461\u2463"}],"title":"5.1. Motivation"},{"refs":[{"id":"ref-for-element-shadow-host\u2461\u2464"}],"title":"5.4. Selecting a Shadow Element: the ::part() pseudo-element"}],"url":"https://dom.spec.whatwg.org/#element-shadow-host"},
"5a223d21": {"dfnID":"5a223d21","dfnText":"<compound-selector-list>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-compound-selector-list"}],"title":"6. Changes"}],"url":"https://drafts.csswg.org/selectors-4/#typedef-compound-selector-list"},
"5b18ffe6": {"dfnID":"5b18ffe6","dfnText":"slot","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-slot"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-concept-slot\u2460"},{"id":"ref-for-concept-slot\u2461"},{"id":"ref-for-concept-slot\u2462"},{"id":"ref-for-concept-slot\u2463"},{"id":"ref-for-concept-slot\u2464"},{"id":"ref-for-concept-slot\u2465"},{"id":"ref-for-concept-slot\u2466"}],"title":"3.1. Informative Explanation of Shadow DOM"},{"refs":[{"id":"ref-for-concept-slot\u2467"},{"id":"ref-for-concept-slot\u2468"},{"id":"ref-for-concept-slot\u2460\u24ea"},{"id":"ref-for-concept-slot\u2460\u2460"},{"id":"ref-for-concept-slot\u2460\u2461"},{"id":"ref-for-concept-slot\u2460\u2462"},{"id":"ref-for-concept-slot\u2460\u2463"},{"id":"ref-for-concept-slot\u2460\u2464"}],"title":"3.2.4. \nSelecting Slot-Assigned Content: the ::slotted() pseudo-element"},{"refs":[{"id":"ref-for-concept-slot\u2460\u2465"},{"id":"ref-for-concept-slot\u2460\u2466"},{"id":"ref-for-concept-slot\u2460\u2467"},{"id":"ref-for-concept-slot\u2460\u2468"}],"title":"4.1. \nFlattening the DOM into an Element Tree"},{"refs":[{"id":"ref-for-concept-slot\u2461\u24ea"},{"id":"ref-for-concept-slot\u2461\u2460"},{"id":"ref-for-concept-slot\u2461\u2461"},{"id":"ref-for-concept-slot\u2461\u2462"},{"id":"ref-for-concept-slot\u2461\u2463"}],"title":"4.1.1. \nSlots and Slotted Elements in a Shadow Tree"}],"url":"https://dom.spec.whatwg.org/#concept-slot"},
"5d233601": {"dfnID":"5d233601","dfnText":"host","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-documentfragment-host"}],"title":"3.1. Informative Explanation of Shadow DOM"},{"refs":[{"id":"ref-for-concept-documentfragment-host\u2460"}],"title":"4.2. \nName-Defining Constructs and Inheritance"}],"url":"https://dom.spec.whatwg.org/#concept-documentfragment-host"},
"5d7209e9": {"dfnID":"5d7209e9","dfnText":"Window","external":true,"refSections":[{"refs":[{"id":"ref-for-window"}],"title":"2. Default Styles for Custom Elements"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"},
"5e0d3b02": {"dfnID":"5e0d3b02","dfnText":"match a selector against an element","external":true,"refSections":[{"refs":[{"id":"ref-for-match-a-selector-against-an-element"}],"title":"3.2.4. \nSelecting Slot-Assigned Content: the ::slotted() pseudo-element"}],"url":"https://drafts.csswg.org/selectors-4/#match-a-selector-against-an-element"},
"5f4f98ab": {"dfnID":"5f4f98ab","dfnText":"descendant combinator","external":true,"refSections":[{"refs":[{"id":"ref-for-descendant-combinator"}],"title":"3.1. Informative Explanation of Shadow DOM"}],"url":"https://drafts.csswg.org/selectors-4/#descendant-combinator"},
"628c6566": {"dfnID":"628c6566","dfnText":"pseudo-class","external":true,"refSections":[{"refs":[{"id":"ref-for-pseudo-class"}],"title":"1. Introduction"}],"url":"https://drafts.csswg.org/selectors-4/#pseudo-class"},
"63fe4250": {"dfnID":"63fe4250","dfnText":"user-agent origin","external":true,"refSections":[{"refs":[{"id":"ref-for-cascade-origin-ua"},{"id":"ref-for-cascade-origin-ua\u2460"}],"title":"2. Default Styles for Custom Elements"},{"refs":[{"id":"ref-for-cascade-origin-ua\u2461"}],"title":"4.1.1. \nSlots and Slotted Elements in a Shadow Tree"}],"url":"https://drafts.csswg.org/css-cascade-5/#cascade-origin-ua"},
"649608b9": {"dfnID":"649608b9","dfnText":"list","external":true,"refSections":[{"refs":[{"id":"ref-for-list"}],"title":"5. Exposing a Shadow Element"},{"refs":[{"id":"ref-for-list\u2460"},{"id":"ref-for-list\u2461"}],"title":"5.6.2. \nRules for parsing a list of part mappings"}],"url":"https://infra.spec.whatwg.org/#list"},
"692595fe": {"dfnID":"692595fe","dfnText":"ordered set","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-set"},{"id":"ref-for-ordered-set\u2460"}],"title":"5. Exposing a Shadow Element"}],"url":"https://infra.spec.whatwg.org/#ordered-set"},
"71908cce": {"dfnID":"71908cce","dfnText":"find flattened slottables","external":true,"refSections":[{"refs":[{"id":"ref-for-find-flattened-slotables"},{"id":"ref-for-find-flattened-slotables\u2460"},{"id":"ref-for-find-flattened-slotables\u2461"}],"title":"3.2.4. \nSelecting Slot-Assigned Content: the ::slotted() pseudo-element"},{"refs":[{"id":"ref-for-find-flattened-slotables\u2462"}],"title":"3.2.5. \nMatching on the Presence of Slot-Assigned Nodes: the :has-slotted pseudo-class"}],"url":"https://dom.spec.whatwg.org/#find-flattened-slotables"},
"762610c7": {"dfnID":"762610c7","dfnText":"at-rule","external":true,"refSections":[{"refs":[{"id":"ref-for-at-rule"}],"title":"2. Default Styles for Custom Elements"},{"refs":[{"id":"ref-for-at-rule\u2460"}],"title":"4.2. \nName-Defining Constructs and Inheritance"}],"url":"https://drafts.csswg.org/css-syntax-3/#at-rule"},
"80e3bb55": {"dfnID":"80e3bb55","dfnText":"assignedNodes(options)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-slot-assignednodes"}],"title":"3.2.5. \nMatching on the Presence of Slot-Assigned Nodes: the :has-slotted pseudo-class"}],"url":"https://html.spec.whatwg.org/multipage/scripting.html#dom-slot-assignednodes"},
"82805a4e": {"dfnID":"82805a4e","dfnText":"originating element","external":true,"refSections":[{"refs":[{"id":"ref-for-originating-element"},{"id":"ref-for-originating-element\u2460"},{"id":"ref-for-originating-element\u2461"}],"title":"5.4. Selecting a Shadow Element: the ::part() pseudo-element"}],"url":"https://drafts.csswg.org/selectors-4/#originating-element"},
"832ba741": {"dfnID":"832ba741","dfnText":"complex selector","external":true,"refSections":[{"refs":[{"id":"ref-for-complex"}],"title":"2. Default Styles for Custom Elements"}],"url":"https://drafts.csswg.org/selectors-4/#complex"},
"83ca4a87": {"dfnID":"83ca4a87","dfnText":"local name","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-element-local-name"},{"id":"ref-for-concept-element-local-name\u2460"}],"title":"2. Default Styles for Custom Elements"}],"url":"https://dom.spec.whatwg.org/#concept-element-local-name"},
"84f47c16": {"dfnID":"84f47c16","dfnText":"child","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-tree-child"}],"title":"3.2.1. \nMatching Selectors Against Shadow Trees"},{"refs":[{"id":"ref-for-concept-tree-child\u2460"}],"title":"3.2.4. \nSelecting Slot-Assigned Content: the ::slotted() pseudo-element"},{"refs":[{"id":"ref-for-concept-tree-child\u2461"},{"id":"ref-for-concept-tree-child\u2462"}],"title":"4.1. \nFlattening the DOM into an Element Tree"}],"url":"https://dom.spec.whatwg.org/#concept-tree-child"},
"8a768cb6": {"dfnID":"8a768cb6","dfnText":"scoped style rules","external":true,"refSections":[{"refs":[{"id":"ref-for-scoped-style-rules"}],"title":"1. Introduction"}],"url":"https://drafts.csswg.org/css-cascade-6/#scoped-style-rules"},
"8e74149c": {"dfnID":"8e74149c","dfnText":"slottable","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-slotable"}],"title":"4.1. \nFlattening the DOM into an Element Tree"}],"url":"https://dom.spec.whatwg.org/#concept-slotable"},
"8f378588": {"dfnID":"8f378588","dfnText":"shadow-including ancestor","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-shadow-including-ancestor"}],"title":"3.2.3. \nSelecting Into the Light: the :host, :host(), and :host-context() pseudo-classes"}],"url":"https://dom.spec.whatwg.org/#concept-shadow-including-ancestor"},
"9213678e": {"dfnID":"9213678e","dfnText":"<ident>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-ident"},{"id":"ref-for-typedef-ident\u2460"}],"title":"5.4. Selecting a Shadow Element: the ::part() pseudo-element"}],"url":"https://drafts.csswg.org/css-values-4/#typedef-ident"},
"92b2d7da": {"dfnID":"92b2d7da","dfnText":"children","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-tree-child"}],"title":"3.2.1. \nMatching Selectors Against Shadow Trees"},{"refs":[{"id":"ref-for-concept-tree-child\u2460"}],"title":"3.2.4. \nSelecting Slot-Assigned Content: the ::slotted() pseudo-element"},{"refs":[{"id":"ref-for-concept-tree-child\u2461"},{"id":"ref-for-concept-tree-child\u2462"}],"title":"4.1. \nFlattening the DOM into an Element Tree"}],"url":"https://dom.spec.whatwg.org/#concept-tree-child"},
"92befb0f": {"dfnID":"92befb0f","dfnText":"@font-feature-values","external":true,"refSections":[{"refs":[{"id":"ref-for-at-ruledef-font-feature-values"}],"title":"4.2. \nName-Defining Constructs and Inheritance"}],"url":"https://drafts.csswg.org/css-fonts-4/#at-ruledef-font-feature-values"},
"94d3d62c": {"dfnID":"94d3d62c","dfnText":"@color-profile","external":true,"refSections":[{"refs":[{"id":"ref-for-at-ruledef-profile"}],"title":"4.2. \nName-Defining Constructs and Inheritance"}],"url":"https://drafts.csswg.org/css-color-5/#at-ruledef-profile"},
"9cd25054": {"dfnID":"9cd25054","dfnText":"computed value","external":true,"refSections":[{"refs":[{"id":"ref-for-computed-value"}],"title":"4.2. \nName-Defining Constructs and Inheritance"}],"url":"https://drafts.csswg.org/css-cascade-5/#computed-value"},
"a326add7": {"dfnID":"a326add7","dfnText":"contain","external":true,"refSections":[{"refs":[{"id":"ref-for-map-exists"}],"title":"5.4. Selecting a Shadow Element: the ::part() pseudo-element"}],"url":"https://infra.spec.whatwg.org/#map-exists"},
"a5c91173": {"dfnID":"a5c91173","dfnText":"SameObject","external":true,"refSections":[{"refs":[{"id":"ref-for-SameObject"}],"title":"5.5. Extensions to the Element Interface"}],"url":"https://webidl.spec.whatwg.org/#SameObject"},
"afde9b5e": {"dfnID":"afde9b5e","dfnText":"functional pseudo-class","external":true,"refSections":[{"refs":[{"id":"ref-for-functional-pseudo-class"}],"title":"1. Introduction"}],"url":"https://drafts.csswg.org/selectors-4/#functional-pseudo-class"},
"b29084c6": {"dfnID":"b29084c6","dfnText":"split a string on commas","external":true,"refSections":[{"refs":[{"id":"ref-for-split-on-commas"}],"title":"5.6.2. \nRules for parsing a list of part mappings"}],"url":"https://infra.spec.whatwg.org/#split-on-commas"},
"b4d48921": {"dfnID":"b4d48921","dfnText":":is()","external":true,"refSections":[{"refs":[{"id":"ref-for-matches-pseudo"}],"title":"3.2.3. \nSelecting Into the Light: the :host, :host(), and :host-context() pseudo-classes"}],"url":"https://drafts.csswg.org/selectors-4/#matches-pseudo"},
"b6fb7a51": {"dfnID":"b6fb7a51","dfnText":"custom element","external":true,"refSections":[{"refs":[{"id":"ref-for-custom-element"}],"title":"2. Default Styles for Custom Elements"}],"url":"https://html.spec.whatwg.org/multipage/custom-elements.html#custom-element"},
"bb2056aa": {"dfnID":"bb2056aa","dfnText":"specificity","external":true,"refSections":[{"refs":[{"id":"ref-for-specificity"},{"id":"ref-for-specificity\u2460"},{"id":"ref-for-specificity\u2461"},{"id":"ref-for-specificity\u2462"},{"id":"ref-for-specificity\u2463"}],"title":"3.2.3. \nSelecting Into the Light: the :host, :host(), and :host-context() pseudo-classes"},{"refs":[{"id":"ref-for-specificity\u2464"},{"id":"ref-for-specificity\u2465"}],"title":"3.2.4. \nSelecting Slot-Assigned Content: the ::slotted() pseudo-element"}],"url":"https://drafts.csswg.org/selectors-4/#specificity"},
"be2c21cf": {"dfnID":"be2c21cf","dfnText":"anchor-name","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-anchor-name"}],"title":"4.2. \nName-Defining Constructs and Inheritance"}],"url":"https://drafts.csswg.org/css-anchor-position-1/#propdef-anchor-name"},
"bedd9d42": {"dfnID":"bedd9d42","dfnText":"+","external":true,"refSections":[{"refs":[{"id":"ref-for-mult-one-plus"}],"title":"5.4. Selecting a Shadow Element: the ::part() pseudo-element"}],"url":"https://drafts.csswg.org/css-values-4/#mult-one-plus"},
"c7d8d91b": {"dfnID":"c7d8d91b","dfnText":"node tree","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-node-tree"},{"id":"ref-for-concept-node-tree\u2460"}],"title":"4.2. \nName-Defining Constructs and Inheritance"},{"refs":[{"id":"ref-for-concept-node-tree\u2461"},{"id":"ref-for-concept-node-tree\u2462"}],"title":"4.2.1. \nSerialized Tree-Scoped References"}],"url":"https://dom.spec.whatwg.org/#concept-node-tree"},
"c8f141cb": {"dfnID":"c8f141cb","dfnText":"match a selector against a tree","external":true,"refSections":[{"refs":[{"id":"ref-for-match-a-selector-against-a-tree"}],"title":"3.2.1. \nMatching Selectors Against Shadow Trees"}],"url":"https://drafts.csswg.org/selectors-4/#match-a-selector-against-a-tree"},
"calculate-the-part-element-map": {"dfnID":"calculate-the-part-element-map","dfnText":"calculate the part element map","external":false,"refSections":[{"refs":[{"id":"ref-for-calculate-the-part-element-map"}],"title":"5. Exposing a Shadow Element"}],"url":"#calculate-the-part-element-map"},
"cd1cb230": {"dfnID":"cd1cb230","dfnText":"light tree","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-light-tree"},{"id":"ref-for-concept-light-tree\u2460"}],"title":"3.1. Informative Explanation of Shadow DOM"},{"refs":[{"id":"ref-for-concept-light-tree\u2461"}],"title":"3.2.1. \nMatching Selectors Against Shadow Trees"},{"refs":[{"id":"ref-for-concept-light-tree\u2462"},{"id":"ref-for-concept-light-tree\u2463"}],"title":"4.1. \nFlattening the DOM into an Element Tree"},{"refs":[{"id":"ref-for-concept-light-tree\u2464"}],"title":"4.1.1. \nSlots and Slotted Elements in a Shadow Tree"}],"url":"https://dom.spec.whatwg.org/#concept-light-tree"},
"css-tree-scoped-name": {"dfnID":"css-tree-scoped-name","dfnText":"tree-scoped name","external":false,"refSections":[{"refs":[{"id":"ref-for-css-tree-scoped-name"},{"id":"ref-for-css-tree-scoped-name\u2460"},{"id":"ref-for-css-tree-scoped-name\u2461"},{"id":"ref-for-css-tree-scoped-name\u2462"},{"id":"ref-for-css-tree-scoped-name\u2463"},{"id":"ref-for-css-tree-scoped-name\u2464"},{"id":"ref-for-css-tree-scoped-name\u2465"},{"id":"ref-for-css-tree-scoped-name\u2466"},{"id":"ref-for-css-tree-scoped-name\u2467"},{"id":"ref-for-css-tree-scoped-name\u2468"},{"id":"ref-for-css-tree-scoped-name\u2460\u24ea"},{"id":"ref-for-css-tree-scoped-name\u2460\u2460"},{"id":"ref-for-css-tree-scoped-name\u2460\u2461"},{"id":"ref-for-css-tree-scoped-name\u2460\u2462"},{"id":"ref-for-css-tree-scoped-name\u2460\u2463"},{"id":"ref-for-css-tree-scoped-name\u2460\u2464"},{"id":"ref-for-css-tree-scoped-name\u2460\u2465"}],"title":"4.2. Name-Defining Constructs and Inheritance"}],"url":"#css-tree-scoped-name"},
"css-tree-scoped-reference": {"dfnID":"css-tree-scoped-reference","dfnText":"tree-scoped reference","external":false,"refSections":[{"refs":[{"id":"ref-for-css-tree-scoped-reference"},{"id":"ref-for-css-tree-scoped-reference\u2460"},{"id":"ref-for-css-tree-scoped-reference\u2461"},{"id":"ref-for-css-tree-scoped-reference\u2462"},{"id":"ref-for-css-tree-scoped-reference\u2463"},{"id":"ref-for-css-tree-scoped-reference\u2464"},{"id":"ref-for-css-tree-scoped-reference\u2465"},{"id":"ref-for-css-tree-scoped-reference\u2466"},{"id":"ref-for-css-tree-scoped-reference\u2467"},{"id":"ref-for-css-tree-scoped-reference\u2468"}],"title":"4.2. Name-Defining Constructs and Inheritance"},{"refs":[{"id":"ref-for-css-tree-scoped-reference\u2460\u24ea"},{"id":"ref-for-css-tree-scoped-reference\u2460\u2460"},{"id":"ref-for-css-tree-scoped-reference\u2460\u2461"},{"id":"ref-for-css-tree-scoped-reference\u2460\u2462"},{"id":"ref-for-css-tree-scoped-reference\u2460\u2463"}],"title":"4.2.1. Serialized Tree-Scoped References"}],"url":"#css-tree-scoped-reference"},
"d24334b4": {"dfnID":"d24334b4","dfnText":"collect a sequence of code points","external":true,"refSections":[{"refs":[{"id":"ref-for-collect-a-sequence-of-code-points"},{"id":"ref-for-collect-a-sequence-of-code-points\u2460"},{"id":"ref-for-collect-a-sequence-of-code-points\u2461"},{"id":"ref-for-collect-a-sequence-of-code-points\u2462"},{"id":"ref-for-collect-a-sequence-of-code-points\u2463"},{"id":"ref-for-collect-a-sequence-of-code-points\u2464"}],"title":"5.6.1. \nRules for parsing part mappings"}],"url":"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points"},
"d65d17df": {"dfnID":"d65d17df","dfnText":"font-family","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-font-family"},{"id":"ref-for-propdef-font-family\u2460"},{"id":"ref-for-propdef-font-family\u2461"},{"id":"ref-for-propdef-font-family\u2462"},{"id":"ref-for-propdef-font-family\u2463"},{"id":"ref-for-propdef-font-family\u2464"}],"title":"4.2. \nName-Defining Constructs and Inheritance"},{"refs":[{"id":"ref-for-propdef-font-family\u2465"},{"id":"ref-for-propdef-font-family\u2466"},{"id":"ref-for-propdef-font-family\u2467"}],"title":"4.2.1. \nSerialized Tree-Scoped References"}],"url":"https://drafts.csswg.org/css-fonts-4/#propdef-font-family"},
"d984b6fe": {"dfnID":"d984b6fe","dfnText":"animation-name","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-animation-name"},{"id":"ref-for-propdef-animation-name\u2460"}],"title":"4.2. \nName-Defining Constructs and Inheritance"}],"url":"https://drafts.csswg.org/css-animations-1/#propdef-animation-name"},
"da8b8e0e": {"dfnID":"da8b8e0e","dfnText":"descendant","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-tree-descendant"}],"title":"3.1. Informative Explanation of Shadow DOM"},{"refs":[{"id":"ref-for-concept-tree-descendant\u2460"}],"title":"3.2.1. \nMatching Selectors Against Shadow Trees"},{"refs":[{"id":"ref-for-concept-tree-descendant\u2461"}],"title":"5. Exposing a Shadow Element"}],"url":"https://dom.spec.whatwg.org/#concept-tree-descendant"},
"da946c0f": {"dfnID":"da946c0f","dfnText":"@counter-style","external":true,"refSections":[{"refs":[{"id":"ref-for-at-ruledef-counter-style"}],"title":"4.2. \nName-Defining Constructs and Inheritance"}],"url":"https://drafts.csswg.org/css-counter-styles-3/#at-ruledef-counter-style"},
"de56fbfe": {"dfnID":"de56fbfe","dfnText":"list-style-type","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-list-style-type"}],"title":"4.2. \nName-Defining Constructs and Inheritance"}],"url":"https://drafts.csswg.org/css-lists-3/#propdef-list-style-type"},
"de6d76c2": {"dfnID":"de6d76c2","dfnText":"cascade","external":true,"refSections":[{"refs":[{"id":"ref-for-cascade"}],"title":"2. Default Styles for Custom Elements"}],"url":"https://drafts.csswg.org/css-cascade-6/#cascade"},
"dom-element-part": {"dfnID":"dom-element-part","dfnText":"part","external":false,"refSections":[],"url":"#dom-element-part"},
"dom-window-defaultelementstylesmap-slot": {"dfnID":"dom-window-defaultelementstylesmap-slot","dfnText":"[[defaultElementStylesMap]]","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-window-defaultelementstylesmap-slot"}],"title":"2. Default Styles for Custom Elements"}],"url":"#dom-window-defaultelementstylesmap-slot"},
"e7f0dd6c": {"dfnID":"e7f0dd6c","dfnText":"display","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-display"}],"title":"3.2.2. \nSelecting Shadow Hosts from within a Shadow Tree"},{"refs":[{"id":"ref-for-propdef-display\u2460"},{"id":"ref-for-propdef-display\u2461"}],"title":"4.1.1. \nSlots and Slotted Elements in a Shadow Tree"}],"url":"https://drafts.csswg.org/css-display-4/#propdef-display"},
"element-attrdef-html-global-exportparts": {"dfnID":"element-attrdef-html-global-exportparts","dfnText":"exportparts","external":false,"refSections":[{"refs":[{"id":"ref-for-element-attrdef-html-global-exportparts"},{"id":"ref-for-element-attrdef-html-global-exportparts\u2460"}],"title":"5.3. Forwarding a Shadow Element: the exportparts attribute"}],"url":"#element-attrdef-html-global-exportparts"},
"element-attrdef-html-global-part": {"dfnID":"element-attrdef-html-global-part","dfnText":"part","external":false,"refSections":[{"refs":[{"id":"ref-for-element-attrdef-html-global-part"}],"title":"5.2. Naming a Shadow Element: the part attribute"},{"refs":[{"id":"ref-for-element-attrdef-html-global-part\u2460"}],"title":"5.4. Selecting a Shadow Element: the ::part() pseudo-element"}],"url":"#element-attrdef-html-global-part"},
"element-forwarded-part-name-list": {"dfnID":"element-forwarded-part-name-list","dfnText":"forwarded part name list","external":false,"refSections":[{"refs":[{"id":"ref-for-element-forwarded-part-name-list"},{"id":"ref-for-element-forwarded-part-name-list\u2460"}],"title":"5. Exposing a Shadow Element"},{"refs":[{"id":"ref-for-element-forwarded-part-name-list\u2461"},{"id":"ref-for-element-forwarded-part-name-list\u2462"},{"id":"ref-for-element-forwarded-part-name-list\u2463"}],"title":"5.3. Forwarding a Shadow Element: the exportparts attribute"},{"refs":[{"id":"ref-for-element-forwarded-part-name-list\u2464"}],"title":"6. Changes"}],"url":"#element-forwarded-part-name-list"},
"element-part-name-list": {"dfnID":"element-part-name-list","dfnText":"part name list","external":false,"refSections":[{"refs":[{"id":"ref-for-element-part-name-list"},{"id":"ref-for-element-part-name-list\u2460"}],"title":"5. Exposing a Shadow Element"}],"url":"#element-part-name-list"},
"f45b0220": {"dfnID":"f45b0220","dfnText":"UA origin","external":true,"refSections":[{"refs":[{"id":"ref-for-cascade-origin-ua"},{"id":"ref-for-cascade-origin-ua\u2460"}],"title":"2. Default Styles for Custom Elements"},{"refs":[{"id":"ref-for-cascade-origin-ua\u2461"}],"title":"4.1.1. \nSlots and Slotted Elements in a Shadow Tree"}],"url":"https://drafts.csswg.org/css-cascade-5/#cascade-origin-ua"},
"f7960529": {"dfnID":"f7960529","dfnText":"root","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-tree-root"}],"title":"3.2.1. \nMatching Selectors Against Shadow Trees"},{"refs":[{"id":"ref-for-concept-tree-root\u2460"}],"title":"4.1. \nFlattening the DOM into an Element Tree"},{"refs":[{"id":"ref-for-concept-tree-root\u2461"},{"id":"ref-for-concept-tree-root\u2462"},{"id":"ref-for-concept-tree-root\u2463"},{"id":"ref-for-concept-tree-root\u2464"},{"id":"ref-for-concept-tree-root\u2465"},{"id":"ref-for-concept-tree-root\u2466"},{"id":"ref-for-concept-tree-root\u2467"},{"id":"ref-for-concept-tree-root\u2468"},{"id":"ref-for-concept-tree-root\u2460\u24ea"}],"title":"4.2. \nName-Defining Constructs and Inheritance"},{"refs":[{"id":"ref-for-concept-tree-root\u2460\u2460"},{"id":"ref-for-concept-tree-root\u2460\u2461"},{"id":"ref-for-concept-tree-root\u2460\u2462"}],"title":"4.2.1. \nSerialized Tree-Scoped References"}],"url":"https://dom.spec.whatwg.org/#concept-tree-root"},
"fa19c68e": {"dfnID":"fa19c68e","dfnText":"@keyframes","external":true,"refSections":[{"refs":[{"id":"ref-for-at-ruledef-keyframes"},{"id":"ref-for-at-ruledef-keyframes\u2460"}],"title":"4.2. \nName-Defining Constructs and Inheritance"}],"url":"https://drafts.csswg.org/css-animations-1/#at-ruledef-keyframes"},
"ff74a37a": {"dfnID":"ff74a37a","dfnText":"value","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-domtokenlist-value"}],"title":"5.5. Extensions to the Element Interface"}],"url":"https://dom.spec.whatwg.org/#dom-domtokenlist-value"},
"flat-tree": {"dfnID":"flat-tree","dfnText":"flattened element tree","external":false,"refSections":[{"refs":[{"id":"ref-for-flat-tree"}],"title":"3.1. Informative Explanation of Shadow DOM"},{"refs":[{"id":"ref-for-flat-tree\u2460"},{"id":"ref-for-flat-tree\u2461"},{"id":"ref-for-flat-tree\u2462"},{"id":"ref-for-flat-tree\u2463"}],"title":"4.1. Flattening the DOM into an Element Tree"}],"url":"#flat-tree"},
"in-the-context-of-a-shadow-tree": {"dfnID":"in-the-context-of-a-shadow-tree","dfnText":"in the context of a shadow tree","external":false,"refSections":[{"refs":[{"id":"ref-for-in-the-context-of-a-shadow-tree"}],"title":"3.2.1. Matching Selectors Against Shadow Trees"},{"refs":[{"id":"ref-for-in-the-context-of-a-shadow-tree\u2460"}],"title":"3.2.2. Selecting Shadow Hosts from within a Shadow Tree"},{"refs":[{"id":"ref-for-in-the-context-of-a-shadow-tree\u2461"},{"id":"ref-for-in-the-context-of-a-shadow-tree\u2462"},{"id":"ref-for-in-the-context-of-a-shadow-tree\u2463"}],"title":"3.2.3. Selecting Into the Light: the :host, :host(), and :host-context() pseudo-classes"},{"refs":[{"id":"ref-for-in-the-context-of-a-shadow-tree\u2464"}],"title":"6. Changes"}],"url":"#in-the-context-of-a-shadow-tree"},
"selectordef-has-slotted": {"dfnID":"selectordef-has-slotted","dfnText":":has-slotted","external":false,"refSections":[{"refs":[{"id":"ref-for-selectordef-has-slotted"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-selectordef-has-slotted\u2460"},{"id":"ref-for-selectordef-has-slotted\u2461"},{"id":"ref-for-selectordef-has-slotted\u2462"},{"id":"ref-for-selectordef-has-slotted\u2463"},{"id":"ref-for-selectordef-has-slotted\u2464"}],"title":"3.2.5. Matching on the Presence of Slot-Assigned Nodes: the :has-slotted pseudo-class"}],"url":"#selectordef-has-slotted"},
"selectordef-host": {"dfnID":"selectordef-host","dfnText":":host","external":false,"refSections":[{"refs":[{"id":"ref-for-selectordef-host"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-selectordef-host\u2460"},{"id":"ref-for-selectordef-host\u2461"}],"title":"3.2.2. Selecting Shadow Hosts from within a Shadow Tree"},{"refs":[{"id":"ref-for-selectordef-host\u2462"},{"id":"ref-for-selectordef-host\u2463"},{"id":"ref-for-selectordef-host\u2464"},{"id":"ref-for-selectordef-host\u2465"},{"id":"ref-for-selectordef-host\u2466"}],"title":"3.2.3. Selecting Into the Light: the :host, :host(), and :host-context() pseudo-classes"},{"refs":[{"id":"ref-for-selectordef-host\u2467"}],"title":"6. Changes"}],"url":"#selectordef-host"},
"selectordef-host-context": {"dfnID":"selectordef-host-context","dfnText":":host-context()","external":false,"refSections":[{"refs":[{"id":"ref-for-selectordef-host-context"}],"title":"3.2.2. Selecting Shadow Hosts from within a Shadow Tree"},{"refs":[{"id":"ref-for-selectordef-host-context\u2460"},{"id":"ref-for-selectordef-host-context\u2461"},{"id":"ref-for-selectordef-host-context\u2462"}],"title":"3.2.3. Selecting Into the Light: the :host, :host(), and :host-context() pseudo-classes"},{"refs":[{"id":"ref-for-selectordef-host-context\u2463"}],"title":"6. Changes"}],"url":"#selectordef-host-context"},
"selectordef-host-function": {"dfnID":"selectordef-host-function","dfnText":":host()","external":false,"refSections":[{"refs":[{"id":"ref-for-selectordef-host-function"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-selectordef-host-function\u2460"}],"title":"3.2.2. Selecting Shadow Hosts from within a Shadow Tree"},{"refs":[{"id":"ref-for-selectordef-host-function\u2461"},{"id":"ref-for-selectordef-host-function\u2462"}],"title":"3.2.3. Selecting Into the Light: the :host, :host(), and :host-context() pseudo-classes"},{"refs":[{"id":"ref-for-selectordef-host-function\u2463"}],"title":"6. Changes"}],"url":"#selectordef-host-function"},
"selectordef-part": {"dfnID":"selectordef-part","dfnText":"::part()","external":false,"refSections":[{"refs":[{"id":"ref-for-selectordef-part"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-selectordef-part\u2460"},{"id":"ref-for-selectordef-part\u2461"},{"id":"ref-for-selectordef-part\u2462"}],"title":"5.1. Motivation"},{"refs":[{"id":"ref-for-selectordef-part\u2463"}],"title":"5.3. Forwarding a Shadow Element: the exportparts attribute"},{"refs":[{"id":"ref-for-selectordef-part\u2464"},{"id":"ref-for-selectordef-part\u2465"},{"id":"ref-for-selectordef-part\u2466"},{"id":"ref-for-selectordef-part\u2467"},{"id":"ref-for-selectordef-part\u2468"}],"title":"5.4. Selecting a Shadow Element: the ::part() pseudo-element"},{"refs":[{"id":"ref-for-selectordef-part\u2460\u24ea"},{"id":"ref-for-selectordef-part\u2460\u2460"}],"title":"6. Changes"}],"url":"#selectordef-part"},
"selectordef-slotted": {"dfnID":"selectordef-slotted","dfnText":"::slotted()","external":false,"refSections":[{"refs":[{"id":"ref-for-selectordef-slotted"},{"id":"ref-for-selectordef-slotted\u2460"},{"id":"ref-for-selectordef-slotted\u2461"},{"id":"ref-for-selectordef-slotted\u2462"},{"id":"ref-for-selectordef-slotted\u2463"},{"id":"ref-for-selectordef-slotted\u2464"},{"id":"ref-for-selectordef-slotted\u2465"},{"id":"ref-for-selectordef-slotted\u2466"},{"id":"ref-for-selectordef-slotted\u2467"},{"id":"ref-for-selectordef-slotted\u2468"}],"title":"3.2.4. Selecting Slot-Assigned Content: the ::slotted() pseudo-element"},{"refs":[{"id":"ref-for-selectordef-slotted\u2460\u24ea"}],"title":"4.1. Flattening the DOM into an Element Tree"},{"refs":[{"id":"ref-for-selectordef-slotted\u2460\u2460"},{"id":"ref-for-selectordef-slotted\u2460\u2461"}],"title":"6. Changes"}],"url":"#selectordef-slotted"},
"shadow-root-part-element-map": {"dfnID":"shadow-root-part-element-map","dfnText":"part element map","external":false,"refSections":[{"refs":[{"id":"ref-for-shadow-root-part-element-map"},{"id":"ref-for-shadow-root-part-element-map\u2460"},{"id":"ref-for-shadow-root-part-element-map\u2461"},{"id":"ref-for-shadow-root-part-element-map\u2462"},{"id":"ref-for-shadow-root-part-element-map\u2463"},{"id":"ref-for-shadow-root-part-element-map\u2464"},{"id":"ref-for-shadow-root-part-element-map\u2465"},{"id":"ref-for-shadow-root-part-element-map\u2466"}],"title":"5. Exposing a Shadow Element"},{"refs":[{"id":"ref-for-shadow-root-part-element-map\u2467"}],"title":"5.1. Motivation"},{"refs":[{"id":"ref-for-shadow-root-part-element-map\u2468"},{"id":"ref-for-shadow-root-part-element-map\u2460\u24ea"},{"id":"ref-for-shadow-root-part-element-map\u2460\u2460"}],"title":"5.4. Selecting a Shadow Element: the ::part() pseudo-element"}],"url":"#shadow-root-part-element-map"},
"tree-context": {"dfnID":"tree-context","dfnText":"tree context","external":false,"refSections":[{"refs":[{"id":"ref-for-tree-context"},{"id":"ref-for-tree-context\u2460"}],"title":"3.2.1. Matching Selectors Against Shadow Trees"}],"url":"#tree-context"},
"tree-scoped-name-global": {"dfnID":"tree-scoped-name-global","dfnText":"global","external":false,"refSections":[],"url":"#tree-scoped-name-global"},
"tree-scoped-name-local": {"dfnID":"tree-scoped-name-local","dfnText":"local","external":false,"refSections":[],"url":"#tree-scoped-name-local"},
"tree-scoped-name-loosely-matched": {"dfnID":"tree-scoped-name-loosely-matched","dfnText":"loosely matched","external":false,"refSections":[{"refs":[{"id":"ref-for-tree-scoped-name-loosely-matched"},{"id":"ref-for-tree-scoped-name-loosely-matched\u2460"},{"id":"ref-for-tree-scoped-name-loosely-matched\u2461"},{"id":"ref-for-tree-scoped-name-loosely-matched\u2462"}],"title":"4.2. Name-Defining Constructs and Inheritance"}],"url":"#tree-scoped-name-loosely-matched"},
"tree-scoped-name-strictly-matched": {"dfnID":"tree-scoped-name-strictly-matched","dfnText":"strictly matched","external":false,"refSections":[{"refs":[{"id":"ref-for-tree-scoped-name-strictly-matched"},{"id":"ref-for-tree-scoped-name-strictly-matched\u2460"},{"id":"ref-for-tree-scoped-name-strictly-matched\u2461"}],"title":"4.2. Name-Defining Constructs and Inheritance"}],"url":"#tree-scoped-name-strictly-matched"},
"valid-list-of-part-mappings": {"dfnID":"valid-list-of-part-mappings","dfnText":"valid list of part mappings","external":false,"refSections":[],"url":"#valid-list-of-part-mappings"},
"valid-part-mapping": {"dfnID":"valid-part-mapping","dfnText":"valid part mapping","external":false,"refSections":[],"url":"#valid-part-mapping"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#calculate-the-part-element-map": {"displayText":"calculate the part element map","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":"calculate the part element map","type":"dfn","url":"#calculate-the-part-element-map"},
"#css-tree-scoped-name": {"displayText":"tree-scoped name","export":true,"for_":["CSS"],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":"tree-scoped name","type":"dfn","url":"#css-tree-scoped-name"},
"#css-tree-scoped-reference": {"displayText":"tree-scoped reference","export":true,"for_":["CSS"],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":"tree-scoped reference","type":"dfn","url":"#css-tree-scoped-reference"},
"#dom-window-defaultelementstylesmap-slot": {"displayText":"[[defaultElementStylesMap]]","export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":"[[defaultElementStylesMap]]","type":"attribute","url":"#dom-window-defaultelementstylesmap-slot"},
"#element-attrdef-html-global-exportparts": {"displayText":"exportparts","export":true,"for_":["html-global"],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":"exportparts","type":"element-attr","url":"#element-attrdef-html-global-exportparts"},
"#element-attrdef-html-global-part": {"displayText":"part","export":true,"for_":["html-global"],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":"part","type":"element-attr","url":"#element-attrdef-html-global-part"},
"#element-forwarded-part-name-list": {"displayText":"forwarded part name list","export":true,"for_":["element"],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":"forwarded part name list","type":"dfn","url":"#element-forwarded-part-name-list"},
"#element-part-name-list": {"displayText":"part name list","export":true,"for_":["element"],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":"part name list","type":"dfn","url":"#element-part-name-list"},
"#flat-tree": {"displayText":"flattened element tree","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":"flattened element tree","type":"dfn","url":"#flat-tree"},
"#in-the-context-of-a-shadow-tree": {"displayText":"in the context of a shadow tree","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":"in the context of a shadow tree","type":"dfn","url":"#in-the-context-of-a-shadow-tree"},
"#selectordef-has-slotted": {"displayText":":has-slotted","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":":has-slotted","type":"selector","url":"#selectordef-has-slotted"},
"#selectordef-host": {"displayText":":host","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":":host","type":"selector","url":"#selectordef-host"},
"#selectordef-host-context": {"displayText":":host-context()","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":":host-context()","type":"selector","url":"#selectordef-host-context"},
"#selectordef-host-function": {"displayText":":host()","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":":host()","type":"selector","url":"#selectordef-host-function"},
"#selectordef-part": {"displayText":"::part()","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":"::part()","type":"selector","url":"#selectordef-part"},
"#selectordef-slotted": {"displayText":"::slotted()","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":"::slotted()","type":"selector","url":"#selectordef-slotted"},
"#shadow-root-part-element-map": {"displayText":"part element map","export":true,"for_":["shadow root"],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":"part element map","type":"dfn","url":"#shadow-root-part-element-map"},
"#tree-context": {"displayText":"tree context","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":"tree context","type":"dfn","url":"#tree-context"},
"#tree-scoped-name-loosely-matched": {"displayText":"loosely matched","export":true,"for_":["tree-scoped name"],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":"loosely matched","type":"dfn","url":"#tree-scoped-name-loosely-matched"},
"#tree-scoped-name-strictly-matched": {"displayText":"strictly matched","export":true,"for_":["tree-scoped name"],"level":"1","normative":true,"shortname":"css-shadow","spec":"css-shadow-1","status":"local","text":"strictly matched","type":"dfn","url":"#tree-scoped-name-strictly-matched"},
"https://dom.spec.whatwg.org/#concept-documentfragment-host": {"displayText":"host","export":true,"for_":["DocumentFragment"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"host","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-documentfragment-host"},
"https://dom.spec.whatwg.org/#concept-element": {"displayText":"element","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"element","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-element"},
"https://dom.spec.whatwg.org/#concept-element-local-name": {"displayText":"local name","export":true,"for_":["Element"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"local name","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-element-local-name"},
"https://dom.spec.whatwg.org/#concept-light-tree": {"displayText":"light tree","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"light tree","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-light-tree"},
"https://dom.spec.whatwg.org/#concept-node-tree": {"displayText":"node tree","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"node tree","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-node-tree"},
"https://dom.spec.whatwg.org/#concept-shadow-including-ancestor": {"displayText":"shadow-including ancestor","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"shadow-including ancestor","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-shadow-including-ancestor"},
"https://dom.spec.whatwg.org/#concept-shadow-root": {"displayText":"shadow root","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"shadow root","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-shadow-root"},
"https://dom.spec.whatwg.org/#concept-shadow-tree": {"displayText":"shadow tree","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"shadow tree","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-shadow-tree"},
"https://dom.spec.whatwg.org/#concept-slot": {"displayText":"slot","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"slot","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-slot"},
"https://dom.spec.whatwg.org/#concept-slotable": {"displayText":"slottable","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"slottable","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-slotable"},
"https://dom.spec.whatwg.org/#concept-tree-child": {"displayText":"children","export":true,"for_":["tree"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"children","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-tree-child"},
"https://dom.spec.whatwg.org/#concept-tree-descendant": {"displayText":"descendant","export":true,"for_":["tree"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"descendant","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-tree-descendant"},
"https://dom.spec.whatwg.org/#concept-tree-root": {"displayText":"root","export":true,"for_":["tree"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"root","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-tree-root"},
"https://dom.spec.whatwg.org/#dom-domtokenlist-value": {"displayText":"value","export":true,"for_":["DOMTokenList"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"value","type":"attribute","url":"https://dom.spec.whatwg.org/#dom-domtokenlist-value"},
"https://dom.spec.whatwg.org/#dom-parentnode-queryselector": {"displayText":"querySelector(selectors)","export":true,"for_":["ParentNode"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"querySelector(selectors)","type":"method","url":"https://dom.spec.whatwg.org/#dom-parentnode-queryselector"},
"https://dom.spec.whatwg.org/#domtokenlist": {"displayText":"DOMTokenList","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"DOMTokenList","type":"interface","url":"https://dom.spec.whatwg.org/#domtokenlist"},
"https://dom.spec.whatwg.org/#element": {"displayText":"Element","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"Element","type":"interface","url":"https://dom.spec.whatwg.org/#element"},
"https://dom.spec.whatwg.org/#element-shadow-host": {"displayText":"shadow host","export":true,"for_":["Element"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"shadow host","type":"dfn","url":"https://dom.spec.whatwg.org/#element-shadow-host"},
"https://dom.spec.whatwg.org/#find-flattened-slotables": {"displayText":"find flattened slottables","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"find flattened slottables","type":"dfn","url":"https://dom.spec.whatwg.org/#find-flattened-slotables"},
"https://dom.spec.whatwg.org/#find-slotables": {"displayText":"find slottables","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"find slottables","type":"dfn","url":"https://dom.spec.whatwg.org/#find-slotables"},
"https://drafts.css-houdini.org/css-typed-om-1/#css-reify": {"displayText":"reification","export":true,"for_":["CSS"],"level":"1","normative":true,"shortname":"css-typed-om","spec":"css-typed-om-1","status":"current","text":"reification","type":"dfn","url":"https://drafts.css-houdini.org/css-typed-om-1/#css-reify"},
"https://drafts.csswg.org/css-anchor-position-1/#propdef-anchor-name": {"displayText":"anchor-name","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor-position","spec":"css-anchor-position-1","status":"current","text":"anchor-name","type":"property","url":"https://drafts.csswg.org/css-anchor-position-1/#propdef-anchor-name"},
"https://drafts.csswg.org/css-anchor-position-1/#propdef-anchor-scope": {"displayText":"anchor-scope","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor-position","spec":"css-anchor-position-1","status":"current","text":"anchor-scope","type":"property","url":"https://drafts.csswg.org/css-anchor-position-1/#propdef-anchor-scope"},
"https://drafts.csswg.org/css-animations-1/#at-ruledef-keyframes": {"displayText":"@keyframes","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animations","spec":"css-animations-1","status":"current","text":"@keyframes","type":"at-rule","url":"https://drafts.csswg.org/css-animations-1/#at-ruledef-keyframes"},
"https://drafts.csswg.org/css-animations-1/#propdef-animation-name": {"displayText":"animation-name","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-animations","spec":"css-animations-1","status":"current","text":"animation-name","type":"property","url":"https://drafts.csswg.org/css-animations-1/#propdef-animation-name"},
"https://drafts.csswg.org/css-cascade-5/#cascade-origin-ua": {"displayText":"user-agent origin","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-cascade","spec":"css-cascade-5","status":"current","text":"user-agent origin","type":"dfn","url":"https://drafts.csswg.org/css-cascade-5/#cascade-origin-ua"},
"https://drafts.csswg.org/css-cascade-5/#computed-value": {"displayText":"computed value","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-cascade","spec":"css-cascade-5","status":"current","text":"computed value","type":"dfn","url":"https://drafts.csswg.org/css-cascade-5/#computed-value"},
"https://drafts.csswg.org/css-cascade-6/#cascade": {"displayText":"cascade","export":true,"for_":[],"level":"6","normative":true,"shortname":"css-cascade","spec":"css-cascade-6","status":"current","text":"cascade","type":"dfn","url":"https://drafts.csswg.org/css-cascade-6/#cascade"},
"https://drafts.csswg.org/css-cascade-6/#scoped-style-rules": {"displayText":"scoped style rules","export":true,"for_":[],"level":"6","normative":true,"shortname":"css-cascade","spec":"css-cascade-6","status":"current","text":"scoped style rules","type":"dfn","url":"https://drafts.csswg.org/css-cascade-6/#scoped-style-rules"},
"https://drafts.csswg.org/css-color-5/#at-ruledef-profile": {"displayText":"@color-profile","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-color","spec":"css-color-5","status":"current","text":"@color-profile","type":"at-rule","url":"https://drafts.csswg.org/css-color-5/#at-ruledef-profile"},
"https://drafts.csswg.org/css-color-5/#funcdef-color": {"displayText":"color()","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-color","spec":"css-color-5","status":"current","text":"color()","type":"function","url":"https://drafts.csswg.org/css-color-5/#funcdef-color"},
"https://drafts.csswg.org/css-counter-styles-3/#at-ruledef-counter-style": {"displayText":"@counter-style","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-counter-styles","spec":"css-counter-styles-3","status":"current","text":"@counter-style","type":"at-rule","url":"https://drafts.csswg.org/css-counter-styles-3/#at-ruledef-counter-style"},
"https://drafts.csswg.org/css-display-4/#propdef-display": {"displayText":"display","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"display","type":"property","url":"https://drafts.csswg.org/css-display-4/#propdef-display"},
"https://drafts.csswg.org/css-fonts-4/#at-ruledef-font-feature-values": {"displayText":"@font-feature-values","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-fonts","spec":"css-fonts-4","status":"current","text":"@font-feature-values","type":"at-rule","url":"https://drafts.csswg.org/css-fonts-4/#at-ruledef-font-feature-values"},
"https://drafts.csswg.org/css-fonts-4/#at-ruledef-font-palette-values": {"displayText":"@font-palette-values","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-fonts","spec":"css-fonts-4","status":"current","text":"@font-palette-values","type":"at-rule","url":"https://drafts.csswg.org/css-fonts-4/#at-ruledef-font-palette-values"},
"https://drafts.csswg.org/css-fonts-4/#descdef-font-face-font-family": {"displayText":"font-family","export":true,"for_":["@font-face"],"level":"4","normative":true,"shortname":"css-fonts","spec":"css-fonts-4","status":"current","text":"font-family","type":"descriptor","url":"https://drafts.csswg.org/css-fonts-4/#descdef-font-face-font-family"},
"https://drafts.csswg.org/css-fonts-4/#propdef-font-family": {"displayText":"font-family","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-fonts","spec":"css-fonts-4","status":"current","text":"font-family","type":"property","url":"https://drafts.csswg.org/css-fonts-4/#propdef-font-family"},
"https://drafts.csswg.org/css-fonts-4/#propdef-font-palette": {"displayText":"font-palette","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-fonts","spec":"css-fonts-4","status":"current","text":"font-palette","type":"property","url":"https://drafts.csswg.org/css-fonts-4/#propdef-font-palette"},
"https://drafts.csswg.org/css-fonts-5/#at-font-face-rule": {"displayText":"@font-face","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-fonts","spec":"css-fonts-5","status":"current","text":"@font-face","type":"at-rule","url":"https://drafts.csswg.org/css-fonts-5/#at-font-face-rule"},
"https://drafts.csswg.org/css-lists-3/#propdef-list-style-type": {"displayText":"list-style-type","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-lists","spec":"css-lists-3","status":"current","text":"list-style-type","type":"property","url":"https://drafts.csswg.org/css-lists-3/#propdef-list-style-type"},
"https://drafts.csswg.org/css-pseudo-4/#fully-styleable": {"displayText":"fully styleable pseudo-elements","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-pseudo","spec":"css-pseudo-4","status":"current","text":"fully styleable pseudo-elements","type":"dfn","url":"https://drafts.csswg.org/css-pseudo-4/#fully-styleable"},
"https://drafts.csswg.org/css-pseudo-4/#tree-abiding": {"displayText":"tree-abiding pseudo-elements","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-pseudo","spec":"css-pseudo-4","status":"current","text":"tree-abiding pseudo-elements","type":"dfn","url":"https://drafts.csswg.org/css-pseudo-4/#tree-abiding"},
"https://drafts.csswg.org/css-syntax-3/#at-rule": {"displayText":"at-rule","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-syntax","spec":"css-syntax-3","status":"current","text":"at-rule","type":"dfn","url":"https://drafts.csswg.org/css-syntax-3/#at-rule"},
"https://drafts.csswg.org/css-syntax-3/#css-stylesheet": {"displayText":"stylesheet","export":true,"for_":["CSS"],"level":"3","normative":true,"shortname":"css-syntax","spec":"css-syntax-3","status":"current","text":"stylesheet","type":"dfn","url":"https://drafts.csswg.org/css-syntax-3/#css-stylesheet"},
"https://drafts.csswg.org/css-values-4/#mult-one-plus": {"displayText":"+","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"+","type":"grammar","url":"https://drafts.csswg.org/css-values-4/#mult-one-plus"},
"https://drafts.csswg.org/css-values-4/#typedef-ident": {"displayText":"<ident>","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"<ident>","type":"type","url":"https://drafts.csswg.org/css-values-4/#typedef-ident"},
"https://drafts.csswg.org/css-variables-2/#custom-property": {"displayText":"custom property","export":true,"for_":[],"level":"2","normative":true,"shortname":"css-variables","spec":"css-variables-2","status":"current","text":"custom property","type":"dfn","url":"https://drafts.csswg.org/css-variables-2/#custom-property"},
"https://drafts.csswg.org/selectors-3/#x": {"displayText":"*","export":true,"for_":[],"level":"3","normative":true,"shortname":"selectors","spec":"selectors-3","status":"current","text":"*","type":"selector","url":"https://drafts.csswg.org/selectors-3/#x"},
"https://drafts.csswg.org/selectors-4/#complex": {"displayText":"complex selector","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":"complex selector","type":"dfn","url":"https://drafts.csswg.org/selectors-4/#complex"},
"https://drafts.csswg.org/selectors-4/#compound": {"displayText":"compound selector","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":"compound selector","type":"dfn","url":"https://drafts.csswg.org/selectors-4/#compound"},
"https://drafts.csswg.org/selectors-4/#descendant-combinator": {"displayText":"descendant combinator","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":"descendant combinator","type":"dfn","url":"https://drafts.csswg.org/selectors-4/#descendant-combinator"},
"https://drafts.csswg.org/selectors-4/#featureless": {"displayText":"featureless","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":"featureless","type":"dfn","url":"https://drafts.csswg.org/selectors-4/#featureless"},
"https://drafts.csswg.org/selectors-4/#functional-pseudo-class": {"displayText":"functional pseudo-class","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":"functional pseudo-class","type":"dfn","url":"https://drafts.csswg.org/selectors-4/#functional-pseudo-class"},
"https://drafts.csswg.org/selectors-4/#hover-pseudo": {"displayText":":hover","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":":hover","type":"selector","url":"https://drafts.csswg.org/selectors-4/#hover-pseudo"},
"https://drafts.csswg.org/selectors-4/#match-a-selector-against-a-tree": {"displayText":"match a selector against a tree","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":"match a selector against a tree","type":"dfn","url":"https://drafts.csswg.org/selectors-4/#match-a-selector-against-a-tree"},
"https://drafts.csswg.org/selectors-4/#match-a-selector-against-an-element": {"displayText":"match a selector against an element","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":"match a selector against an element","type":"dfn","url":"https://drafts.csswg.org/selectors-4/#match-a-selector-against-an-element"},
"https://drafts.csswg.org/selectors-4/#matches-pseudo": {"displayText":":is()","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":":is()","type":"selector","url":"https://drafts.csswg.org/selectors-4/#matches-pseudo"},
"https://drafts.csswg.org/selectors-4/#negation-pseudo": {"displayText":":not()","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":":not()","type":"selector","url":"https://drafts.csswg.org/selectors-4/#negation-pseudo"},
"https://drafts.csswg.org/selectors-4/#originating-element": {"displayText":"originating element","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":"originating element","type":"dfn","url":"https://drafts.csswg.org/selectors-4/#originating-element"},
"https://drafts.csswg.org/selectors-4/#pseudo-class": {"displayText":"pseudo-class","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":"pseudo-class","type":"dfn","url":"https://drafts.csswg.org/selectors-4/#pseudo-class"},
"https://drafts.csswg.org/selectors-4/#pseudo-element": {"displayText":"pseudo-elements","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":"pseudo-elements","type":"dfn","url":"https://drafts.csswg.org/selectors-4/#pseudo-element"},
"https://drafts.csswg.org/selectors-4/#specificity": {"displayText":"specificity","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":"specificity","type":"dfn","url":"https://drafts.csswg.org/selectors-4/#specificity"},
"https://drafts.csswg.org/selectors-4/#type-selector": {"displayText":"type selector","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":"type selector","type":"dfn","url":"https://drafts.csswg.org/selectors-4/#type-selector"},
"https://drafts.csswg.org/selectors-4/#typedef-compound-selector": {"displayText":"<compound-selector>","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":"<compound-selector>","type":"type","url":"https://drafts.csswg.org/selectors-4/#typedef-compound-selector"},
"https://drafts.csswg.org/selectors-4/#typedef-compound-selector-list": {"displayText":"<compound-selector-list>","export":true,"for_":[],"level":"4","normative":true,"shortname":"selectors","spec":"selectors-4","status":"current","text":"<compound-selector-list>","type":"type","url":"https://drafts.csswg.org/selectors-4/#typedef-compound-selector-list"},
"https://html.spec.whatwg.org/multipage/custom-elements.html#custom-element": {"displayText":"custom element","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"custom element","type":"dfn","url":"https://html.spec.whatwg.org/multipage/custom-elements.html#custom-element"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window": {"displayText":"Window","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"Window","type":"interface","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"},
"https://html.spec.whatwg.org/multipage/scripting.html#dom-slot-assignednodes": {"displayText":"assignedNodes(options)","export":true,"for_":["HTMLSlotElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"assignedNodes(options)","type":"method","url":"https://html.spec.whatwg.org/multipage/scripting.html#dom-slot-assignednodes"},
"https://html.spec.whatwg.org/multipage/scripting.html#the-slot-element": {"displayText":"slot","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"slot","type":"element","url":"https://html.spec.whatwg.org/multipage/scripting.html#the-slot-element"},
"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points": {"displayText":"collect a sequence of code points","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"collect a sequence of code points","type":"dfn","url":"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points"},
"https://infra.spec.whatwg.org/#list": {"displayText":"list","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"list","type":"dfn","url":"https://infra.spec.whatwg.org/#list"},
"https://infra.spec.whatwg.org/#list-append": {"displayText":"append","export":true,"for_":["list"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"append","type":"dfn","url":"https://infra.spec.whatwg.org/#list-append"},
"https://infra.spec.whatwg.org/#map-exists": {"displayText":"contain","export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"contain","type":"dfn","url":"https://infra.spec.whatwg.org/#map-exists"},
"https://infra.spec.whatwg.org/#ordered-set": {"displayText":"ordered set","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"ordered set","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-set"},
"https://infra.spec.whatwg.org/#split-on-commas": {"displayText":"split a string on commas","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"split a string on commas","type":"dfn","url":"https://infra.spec.whatwg.org/#split-on-commas"},
"https://infra.spec.whatwg.org/#string": {"displayText":"string","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"string","type":"dfn","url":"https://infra.spec.whatwg.org/#string"},
"https://infra.spec.whatwg.org/#tuple": {"displayText":"tuple","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"tuple","type":"dfn","url":"https://infra.spec.whatwg.org/#tuple"},
"https://webidl.spec.whatwg.org/#PutForwards": {"displayText":"PutForwards","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"PutForwards","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#PutForwards"},
"https://webidl.spec.whatwg.org/#SameObject": {"displayText":"SameObject","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SameObject","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#SameObject"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
        // Give the original term if it's being displayed in a different way.
        // But allow casing differences, they're insignificant.
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.displayText)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const refHintKey = link.getAttribute("data-refhint-key");
    let key = url;
    if(refHintKey) {
        key = refHintKey + "_" + url;
    }
    const ref = refsData[key];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>