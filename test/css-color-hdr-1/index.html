<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>CSS Color HDR Module Level 1</title>
  <meta content="WD" name="w3c-status">
  <meta content="Bikeshed version 0ef803fdf, updated Tue Jan 6 11:59:39 2026 -0800" name="generator">
  <link href="https://www.w3.org/TR/css-color-hdr-1/" rel="canonical">
  <meta content="f4e196d329e5f58b485948346f8a95ac033a128c" name="revision">
  <meta content="dark light" name="color-scheme">
  <link href="style.css" rel="stylesheet">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example " counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-wpt */
:root {
    --wpt-border: hsl(0, 0%, 60%);
    --wpt-bg: hsl(0, 0%, 95%);
    --wpt-text: var(--text);
    --wptheading-text: hsl(0, 0%, 30%);
}
@media (prefers-color-scheme: dark) {
    :root {
        --wpt-border: hsl(0, 0%, 30%);
        --wpt-bg: var(--borderedblock-bg);
        --wpt-text: var(--text);
        --wptheading-text: hsl(0, 0%, 60%);
    }
}
.wpt-tests-block {
    list-style: none;
    border-left: .5em solid var(--wpt-border);
    background: var(--wpt-bg);
    color: var(--wpt-text);
    margin: 1em auto;
    padding: .5em;
}
.wpt-tests-block summary {
    color: var(--wptheading-text);
    font-weight: normal;
    text-transform: uppercase;
}
.wpt-tests-block summary::marker{
    color: var(--wpt-border);
}
.wpt-tests-block summary:hover::marker{
    color: var(--wpt-text);
}
/*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
.wpt-tests-block:not([open]){
    padding: 0;
    border: none;
    background: none;
    font-size: 0.75em;
    line-height: 1;
    position: relative;
    margin: 1em 0 0;
}
.wpt-tests-block:not([open]) summary {
    position: absolute;
    right: 0;
    bottom: 0;
}
/*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
.wpt-tests-block:not([open]):last-child {
    padding-bottom: 1px;
    margin-bottom: -1px;
}
/*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
li:not(:last-child) > .wpt-tests-block:not([open]):last-child,
dd:not(:last-child) > .wpt-tests-block:not([open]):last-child {
    padding-bottom: 0;
    margin-bottom: 0;
}
.wpt-tests-block:not([open]):not(:hover){
    opacity: 0.5;
}
.wpt-tests-list {
    list-style: none;
    display: grid;
    margin: 0;
    padding: 0;
    grid-template-columns: 1fr max-content auto auto;
    grid-column-gap: .5em;
}
.wpt-tests-block hr:last-child {
    display: none;
}
.wpt-test {
    display: contents;
}
.wpt-test > a {
    text-decoration: underline;
    border: none;
}
.wpt-test > .wpt-name { grid-column: 1; }
.wpt-test > .wpt-results { grid-column: 2; }
.wpt-test > .wpt-live { grid-column: 3; }
.wpt-test > .wpt-source { grid-column: 4; }

.wpt-test > .wpt-results {
    display: flex;
    gap: .1em;
}
.wpt-test .wpt-result {
    display: inline-block;
    height: 1em;
    width: 1em;
    border-radius: 50%;
    position: relative;
}
</style>
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-WD" rel="stylesheet">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/">
    <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
</a>
</p>
   <h1 class="no-ref p-name" id="title">CSS Color HDR Module Level 1</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#WD">W3C Working Draft</a>,
    <time class="dt-updated" datetime="2025-11-25">25 November 2025</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://www.w3.org/TR/2025/WD-css-color-hdr-1-20251125/">https://www.w3.org/TR/2025/WD-css-color-hdr-1-20251125/</a>
      <dt>Latest published version:
      <dd><a href="https://www.w3.org/TR/css-color-hdr-1/">https://www.w3.org/TR/css-color-hdr-1/</a>
      <dt>Editor's Draft:
      <dd><a href="https://drafts.csswg.org/css-color-hdr-1/">https://drafts.csswg.org/css-color-hdr-1/</a>
      <dt>History:
      <dd><a class="u-url" href="https://www.w3.org/standards/history/css-color-hdr-1/">https://www.w3.org/standards/history/css-color-hdr-1/</a>
      <dt>Feedback:
      <dd><a href="https://github.com/w3c/csswg-drafts/labels/css-color-hdr-1">CSSWG Issues Repository</a>
      <dd><a href="#issues-index">Inline In Spec</a>
      <dt class="editor">Editor:
      <dd class="editor h-card p-author vcard" data-editor-id="1438"><a class="fn p-name u-url url" href="https://svgees.us/">Chris Lilley</a> (<span class="org p-org">W3C</span>)
      <dt>Suggest an Edit for this Spec:
      <dd><a href="https://github.com/w3c/csswg-drafts/blob/main/css-color-hdr-1/Overview.bs">GitHub Editor</a>
      <dt>Test Suite:
      <dd class="wpt-overview"><a href="https://wpt.fyi/results/css/css-color-hdr/">https://wpt.fyi/results/css/css-color-hdr/</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 2025 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply.
</p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="heading no-num no-ref no-toc settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This module defines additions to CSS Color 4 and 5 to enable High Dynamic Range (HDR).</p>
   


<a href="https://www.w3.org/TR/CSS/">CSS</a> is a language for describing the rendering of structured documents
(such as HTML and XML)
on screen, on paper, etc.


  </div>
  <h2 class="heading no-num no-ref no-toc settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p><em>This section describes the status of this document at the time of its publication.
	A list of current W3C publications
	and the latest revision of this technical report
	can be found in the <a href="https://www.w3.org/TR/">W3C standards and drafts index.</a></em>

</p>
   <p>
	This document was published
	by the <a href="https://www.w3.org/groups/wg/css">CSS Working Group</a>
	as a <strong>Working Draft</strong> using the <a href="https://www.w3.org/policies/process/20250818/#recs-and-notes">Recommendation
      track</a>.
	Publication as a Working Draft
	does not imply endorsement by <abbr title="World Wide Web Consortium">W3C</abbr> and its Members.

</p>
   <p>
	This is a draft document
	and may be updated, replaced
	or obsoleted by other documents at any time.
	It is inappropriate to cite this document as other than a work in progress.

</p>
   <p>Please send feedback
	by <a href="https://github.com/w3c/csswg-drafts/issues">filing issues in GitHub</a> (preferred),
	including the spec code “css-color-hdr” in the title, like this:
	“[css-color-hdr] <i>…summary of comment…</i>”.
	All issues and comments are <a href="https://lists.w3.org/Archives/Public/public-css-archive/">archived</a>.
	Alternately, feedback can be sent to the (<a href="https://lists.w3.org/Archives/Public/www-style/">archived</a>) public mailing list
	<a href="mailto:www-style@w3.org?Subject=%5Bcss-color-hdr%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a>.

</p>
   <p>This document is governed by the
	<a href="https://www.w3.org/policies/process/20250818/" id="w3c_process_revision">18 August 2025 W3C Process Document</a>.

</p>
   <p>This document was produced by a group operating under the
	<a href="https://www.w3.org/policies/patent-policy/20200915/">W3C Patent Policy</a>.
	W3C maintains a
	<a href="https://www.w3.org/groups/wg/css/ipr" rel="disclosure">public list of any patent disclosures</a>
	made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent that the individual believes
	contains <a href="https://www.w3.org/policies/patent-policy/20200915/#def-essential">Essential Claim(s)</a>
	must disclose the information in accordance with
	<a href="https://www.w3.org/policies/patent-policy/20200915/#sec-Disclosure">section 6 of the W3C Patent Policy</a>.

</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-ref no-toc" id="contents">Table of Contents</h2>
   <ol class="toc">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#values"><span class="secno">1.1</span> <span class="content">Value Definitions</span></a>
     </ol>
    <li>
     <a href="#terminology"><span class="secno">2</span> <span class="content">HDR Terminology</span></a>
     <ol class="toc">
      <li><a href="#defining-dynamic-range"><span class="secno">2.1</span> <span class="content">Defining Dynamic Range</span></a>
      <li><a href="#introducing-headroom"><span class="secno">2.2</span> <span class="content">Introducing Headroom</span></a>
     </ol>
    <li>
     <a href="#controlling-dynamic-range"><span class="secno">3</span> <span class="content">Controlling Dynamic Range</span></a>
     <ol class="toc">
      <li><a href="#the-dynamic-range-limit-property"><span class="secno">3.1</span> <span class="content">The <span class="property">dynamic-range-limit</span> property</span></a>
      <li><a href="#dynamic-range-limit-mix"><span class="secno">3.2</span> <span class="content">Mixing Dynamic Range Limits: the <span class="css">dynamic-range-limit-mix()</span> function</span></a>
      <li><a href="#computing-dynamic-range-limit"><span class="secno">3.3</span> <span class="content">
	Computed Value for <span class="property">dynamic-range-limit</span>
</span></a>
     </ol>
    <li><a href="#color-syntax"><span class="secno">4</span> <span class="content">The <span class="production">&lt;color></span> syntax</span></a>
    <li>
     <a href="#hdr-color-function"><span class="secno">5</span> <span class="content">HDR colors parameterized by headroom: the <span class="css">hdr-color()</span> function</span></a>
     <ol class="toc">
      <li><a href="#headroom-interpolation"><span class="secno">5.1</span> <span class="content">
	Interpolating colors based on headroom
</span></a>
     </ol>
    <li>
     <a href="#DI-HDR"><span class="secno">6</span> <span class="content">
	Device-Independent HDR Colors
</span></a>
     <ol class="toc">
      <li><a href="#ictcp-intro"><span class="secno">6.1</span> <span class="content">
	Introducing ICtCp
</span></a>
      <li><a href="#jaz-intro"><span class="secno">6.2</span> <span class="content">
	Introducing Jzazbz and JzCzhz
</span></a>
      <li><a href="#ICtCp"><span class="secno">6.3</span> <span class="content"><span>ICtCp</span></span></a>
      <li><a href="#Jzazbz"><span class="secno">6.4</span> <span class="content"><span>Jzazbz</span></span></a>
      <li>
       <a href="#JzCzhz"><span class="secno">6.5</span> <span class="content"><span>JzCzhz</span></span></a>
       <ol class="toc">
        <li><a href="#Jzazbz-to-JzCzHz"><span class="secno">6.5.1</span> <span class="content">
		Converting <span class="css">Jzazbz</span> colors to <span class="css">JzCzhz</span> colors</span></a>
        <li><a href="#JzCzHz-to-Jzazbz"><span class="secno">6.5.2</span> <span class="content">
	Converting JzCzhz colors to Jzazbz  colors</span></a>
       </ol>
     </ol>
    <li><a href="#color-function"><span class="secno">7</span> <span class="content">
	Specifying Predefined and Custom Color Spaces: the <span class="css">color()</span> Function
</span></a>
    <li>
     <a href="#predefined-HDR"><span class="secno">8</span> <span class="content">Predefined color spaces for HDR:</span></a>
     <ol class="toc">
      <li><a href="#valdef-color-rec2100-pq"><span class="secno">8.1</span> <span class="content"><span>rec2100-pq</span></span></a>
      <li><a href="#valdef-color-rec2100-hlg"><span class="secno">8.2</span> <span class="content"><span>rec2100-hlg</span></span></a>
      <li><a href="#valdef-color-rec2100-linear"><span class="secno">8.3</span> <span class="content"><span>rec2100-linear</span></span></a>
     </ol>
    <li><a href="#Compositing-SDR-HDR"><span class="secno">9</span> <span class="content">Compositing SDR and HDR content</span></a>
    <li>
     <a href="#serializing-color-values"><span class="secno">10</span> <span class="content">
Serializing <span class="production">&lt;color></span> Values</span></a>
     <ol class="toc">
      <li><a href="#serializing-color-function-values"><span class="secno">10.1</span> <span class="content">
Serializing values of the <span class="css">color()</span> function</span></a>
     </ol>
    <li>
     <a href="#color-conversion-code"><span class="secno">11</span> <span class="content">
	Sample code for Color Conversions</span></a>
     <ol class="toc">
      <li><a href="#rec2100-linear_code"><span class="secno">11.1</span> <span class="content">
	Sample code for <span class="css">rec2100-linear</span>
</span></a>
      <li><a href="#rec2100-pq_code"><span class="secno">11.2</span> <span class="content">
	Sample code for <span class="css">rec2100-pq</span>
</span></a>
      <li><a href="#rec2100-hlg_code"><span class="secno">11.3</span> <span class="content">
	Sample code for <span class="css">rec2100-hlg</span>
</span></a>
      <li><a href="#jzazbz_code"><span class="secno">11.4</span> <span class="content">
	Sample code for <span class="css">jzazbz</span>
</span></a>
      <li><a href="#ictcp_code"><span class="secno">11.5</span> <span class="content">
	Sample code for <span class="css">ICtCp</span>
</span></a>
      <li><a href="#hdr-color-code"><span class="secno">11.6</span> <span class="content">
	Sample code for <span class="css">hdr-color()</span>
</span></a>
     </ol>
    <li><a href="#deltaE"><span class="secno">12</span> <span class="content">
	Sample code for ΔEITP Color Differences
</span></a>
    <li><a href="#privacy"><span class="secno"></span> <span class="content">Privacy Considerations</span></a>
    <li><a href="#security"><span class="secno"></span> <span class="content">Security Considerations</span></a>
    <li><a href="#a11y"><span class="secno"></span> <span class="content">Accessibility Considerations</span></a>
    <li>
     <a href="#changes"><span class="secno"></span> <span class="content">
	Changes
</span></a>
     <ol class="toc">
      <li><a href="#changes-20241217"><span class="secno"></span> <span class="content">Changes since the 
	<span>17 December 2024
	First Public Working Draft
	</span></span></a>
     </ol>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">
Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">
Document conventions</span></a>
      <li><a href="#w3c-conformance-classes"><span class="secno"></span> <span class="content">
Conformance classes</span></a>
      <li>
       <a href="#w3c-partial"><span class="secno"></span> <span class="content">
Partial implementations</span></a>
       <ol class="toc">
        <li><a href="#w3c-conform-future-proofing"><span class="secno"></span> <span class="content">
Implementations of Unstable and Proprietary Features</span></a>
       </ol>
      <li><a href="#w3c-testing"><span class="secno"></span> <span class="content">
Non-experimental implementations</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#property-index"><span class="secno"></span> <span class="content">Property Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>CSS Color 4 adds Wide Color Gamut (WCG) color spaces to the Open Web Platform.
	By design, these are all Standard Dynamic Range (SDR) color spaces.
	This specification defines additions
	to support High Dynamic Range (HDR).</p>
   <figure id="fig-eotf">
    <p><img alt src="./images/lin-srgb-hlg-pq.png" width="839"></p>
    <figcaption>
			The Electro-Optical Transfer Functions (EOTF)
			of four color spaces: 
			extended sRGB and linear-light sRGB
			(as defined in CSS Color 4) and
			the Perceptual Quantizer (PQ) and Hybrid Log-Gamma (HLG)
			as defined in this specification, from <a data-link-type="biblio" href="#biblio-rec_bt2100" title="ITU-R BT.2100-3 Image parameter values for high dynamic range television for use in production and international programme exchange">[Rec_BT.2100]</a>.
		</figcaption>
   </figure>
   <p>While WCG specifications have been broadly stable for some decades,
	HDR standards are less mature
	and have undergone frequent revision in the last decade.</p>
   <h3 class="heading settled" data-level="1.1" id="values"><span class="secno">1.1. </span><span class="content">Value Definitions</span><a class="self-link" href="#values"></a></h3>
   <p>This specification follows the <a href="https://www.w3.org/TR/CSS2/about.html#property-defs">CSS property definition conventions</a> from <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a>
	using the <a href="https://www.w3.org/TR/css-values-3/#value-defs">value definition syntax</a> from <a data-link-type="biblio" href="#biblio-css-values-3" title="CSS Values and Units Module Level 3">[CSS-VALUES-3]</a>.
	Value types not defined in this specification are defined in CSS Values &amp; Units <a data-link-type="biblio" href="#biblio-css-values-3" title="CSS Values and Units Module Level 3">[CSS-VALUES-3]</a>.
	Combination with other CSS modules may expand the definitions of these value types.</p>
   <p>In addition to the property-specific values listed in their definitions,
	all properties defined in this specification
	also accept the <a data-link-type="dfn" href="https://www.w3.org/TR/css-values-4/#css-wide-keywords" id="ref-for-css-wide-keywords">CSS-wide keywords</a> as their property value.
	For readability they have not been repeated explicitly.</p>
   <h2 class="heading settled" data-level="2" id="terminology"><span class="secno">2. </span><span class="content">HDR Terminology</span><a class="self-link" href="#terminology"></a></h2>
   <h3 class="heading settled" data-level="2.1" id="defining-dynamic-range"><span class="secno">2.1. </span><span class="content">Defining Dynamic Range</span><a class="self-link" href="#defining-dynamic-range"></a></h3>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="dynamic-range">Dynamic range</dfn> is the difference in <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-4/#luminance" id="ref-for-luminance">luminance</a>
between the <em>lightest</em> and the <em>darkest</em> colors.
Dynamic range is measured in photographic <em>stops</em>.
One stop is a doubling of luminance.</p>
<pre class="highlight lang-js"><c- a>function</c-> DynamicRange <c- p>(</c->high<c- p>,</c-> low<c- p>)</c-> <c- p>{</c->
  <c- k>return</c-> Math<c- p>.</c->log2<c- p>(</c->high<c- p>)</c-> <c- o>-</c-> Math<c- p>.</c->log2<c- p>(</c->low<c- p>);</c->
  <c- p>}</c-> 
</pre>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="hdr-reference-white">HDR reference white</dfn>,
also called media white,
is the color of a normal white background, 
or of white text on a dark background.
It can be comfortably viewed, over the whole screen.</p>
   <p>In <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="standard-dynamic-range">Standard Dynamic Range</dfn> (SDR),
HDR reference white is also
lightest possible color,
produced by full-intensity red, green, and blue.</p>
   <div class="example" id="ex-SDR-dynamic-range"><a class="self-link" href="#ex-SDR-dynamic-range"></a>
	For example, in <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-4/#sRGB-space" id="ref-for-sRGB-space">sRGB</a>, 
	under standard viewing conditions,
	white is defined to have a luminance of 80 cd/m²
	while black is defined to have a luminance of 0.2 cd/m².
	Thus, the dynamic range is 8.6 stops.
</div>
   <p>It is common to adjust the overall brighness of the screen
to acommodate user preference or viewing conditions 
which are different to the standard ones.</p>
   <p>For SDR, making the screen brighter does not change the dynamic range,
because the darkest color also gets brighter.</p>
   <div class="example" id="ex-SDR-brighter-dynamic-range"><a class="self-link" href="#ex-SDR-brighter-dynamic-range"></a>
	For example, an <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-4/#sRGB-space" id="ref-for-sRGB-space①">sRGB</a> screen, 
	might be set so that white has a luminance of 160 cd/m²
	so the deepest black has a luminance of 0.4 cd/m².
	The dynamic range is still 8.6 stops.
</div>
   <p>In <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="high-dynamic-range">High Dynamic Range</dfn> (HDR),
brighter colors than <a data-link-type="dfn" href="#hdr-reference-white" id="ref-for-hdr-reference-white">HDR reference white</a> can be displayed.
For example, if HDR reference white on an HDR display is set to 203 cd/m²
it might be possible to display small highlights at 1000 cd/m².
Typically, the brightest colors can only be displayed
on a small part of the display,
and for a limited time.
This is because of energy usage and heating considerations.</p>
   <div class="example" id="ex-HDR-dynamic-range"><a class="self-link" href="#ex-HDR-dynamic-range"></a>
	For example, on an HDR reference mastering display, 
	the small-area peak white might have a luminance of 1000 cd/m²
	while the deepest black has a luminance of 0.05 cd/m².
	Thus, the dynamic range is 14.3 stops.
</div>
   <p>For HDR, using a brighter screen increases the dynamic range,
while the luminance of HDR reference white remains constant.</p>
   <div class="example" id="ex-HDR-PQ-dynamic-range"><a class="self-link" href="#ex-HDR-PQ-dynamic-range"></a>
	For example, using the <span class="css">rec2100-pq</span> colorspace 
	defined in <a data-link-type="biblio" href="#biblio-rec_bt2100" title="ITU-R BT.2100-3 Image parameter values for high dynamic range television for use in production and international programme exchange">[Rec_BT.2100]</a>, 
	the brightest peak white is defined to have a luminance of 10,000 cd/m²
	while the deepest black has a luminance of 0.001 cd/m².
	Thus, the encoded dynamic range is 23.3 stops.
</div>
   <p class="issue" id="issue-b905ab0c"><a class="self-link" href="#issue-b905ab0c"></a> add a diagram showing SDR and HDR dynamic ranges on a log scale</p>
   <p>When <a href="#Compositing-SDR-HDR">§ 9 Compositing SDR and HDR content</a>,
and for color space conversion,
the HDR reference white for SDR content
should be anchored at <strong>203 cd/m²</strong> <a data-link-type="biblio" href="#biblio-rpt_bt2408" title="Report ITU-R BT.2408-0 Operational practices in HDR television production">[Rpt_BT.2408]</a>
so that that the HDR reference white level 
of the inputs to compositing
will end up at the HDR reference white level 
of the combined signal.</p>
   <p>When displaying HDR (or mixed SDR and HDR) content,
for displays which are less capable than the reference mastering display,
and for viewing conditions different to the standard ones,
a <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="color-re-rendering">color re-rendering</dfn> step ((OOTF) will be performed.
This may result in a HDR reference white being displayed
at a value lower or higher than 203 cd/m².</p>
   <h3 class="heading settled" data-level="2.2" id="introducing-headroom"><span class="secno">2.2. </span><span class="content">Introducing Headroom</span><a class="self-link" href="#introducing-headroom"></a></h3>
   <p>The peak <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-4/#luminance" id="ref-for-luminance①">luminance</a> level
	which an HDR display can produce 
	varies greatly.</p>
   <p>The amount by which peak white is greater than HDR reference white
	is termed the <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="hdr-headroom">HDR headroom</dfn>,
	and depends on the level of HDR reference white,
	user preference,
	and viewing conditions.</p>
   <p>It is typically expressed in photographic <strong>stops</strong>.
	Thus, <a data-link-type="dfn" href="#standard-dynamic-range" id="ref-for-standard-dynamic-range">standard dynamic range</a> (SDR) 
	by definition has an <a data-link-type="dfn" href="#hdr-headroom" id="ref-for-hdr-headroom">HDR headroom</a> of 0 stops,
	because the brightest white is HDR reference white.</p>
   <div class="example" id="ex-low-headroom"><a class="self-link" href="#ex-low-headroom"></a>
	For example, a low-end HDR display
	(which <em>just</em> meets the requirements of
	<a href="https://displayhdr.org/">DisplayHDR 400</a>, 
	the lowest tier of Vesa Certified DisplayHDR conformance <a data-link-type="biblio" href="#biblio-displayhdr" title="Summary of DisplayHDR Specs under CTS 1.2">[DisplayHDR]</a>)
	might display HDR reference white at 
	up to 200 cd/m<sup>2</sup>
	while the peak white is only
	400 cd/m<sup>2</sup>
	(at the brightest HDR reference white, only one stop of HDR headroom).
</div>
   <div class="example" id="ex-high-headroom">
    <a class="self-link" href="#ex-high-headroom"></a>
	For example, a high-end HDR display 
	(which exceeds the requirements of
	<a href="https://displayhdr.org/">DisplayHDR 1400</a>, 
	the current highest tier of Vesa Certified DisplayHDR conformance)
	might display HDR reference white at 
	up to 400 cd/m<sup>2</sup>
	while it’s peak white is
	1600 cd/m<sup>2</sup>.


    <p>In dim viewing conditions,
	with HDR reference white set to 100 cd/m<sup>2</sup>,
	this gives four stops (16x) of HDR headroom.</p>
   </div>
   <p id="headroom-privacy">
	The Web platform does not currently
	directly expose the level of headroom of a display,
	because it depends on viewing conditions
	and real-time, unquantized headroom information
	would be a tracking vector
	(for example, detecting that a user moved outside
	and that it is a sunny day).
</p>
   <p id="constrained-headroom">
	It is not always desirable 
	to use the maximum available level
	of HDR headroom.
	CSS provides a way to control,
	in broad terms,
	how much headroom is desired;
	and this level can vary by element
	and over time.
</p>
   <div class="example" id="ex-photo-grid"><a class="self-link" href="#ex-photo-grid"></a>
	For example, consider a Web page displaying a grid of photographs.
	Some of these are HDR, including some very high dynamic range images
	such as a shot straight into the sun.
	It would be tiring to view the set of photos together
	at full dynamic range.
	At the same time, 
	squashing everything to the SDR range 
	would not adequately represent
	the character of individual photos.
	The design goal is to show "enough" HDR
	to allow meaningful evaluation of the group of photos.
</div>
   <h2 class="heading settled" data-level="3" id="controlling-dynamic-range"><span class="secno">3. </span><span class="content">Controlling Dynamic Range</span><a class="self-link" href="#controlling-dynamic-range"></a></h2>
   <h3 class="heading settled" data-level="3.1" id="the-dynamic-range-limit-property"><span class="secno">3.1. </span><span class="content">The <a class="css property" data-link-type="property" href="#propdef-dynamic-range-limit" id="ref-for-propdef-dynamic-range-limit">dynamic-range-limit</a> property</span><a class="self-link" href="#the-dynamic-range-limit-property"></a></h3>
   <table class="def propdef" data-link-for-hint="dynamic-range-limit">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="css dfn-paneled" data-dfn-type="property" data-export id="propdef-dynamic-range-limit">dynamic-range-limit</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">standard <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one">|</a> no-limit <span id="ref-for-comb-one①">|</span> constrained <span id="ref-for-comb-one②">|</span> <a class="css production" data-link-type="function" href="#funcdef-dynamic-range-limit-mix" id="ref-for-funcdef-dynamic-range-limit-mix">&lt;dynamic-range-limit-mix()></a>
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>no-limit
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td><a href="https://www.w3.org/TR/css-pseudo/#generated-content" title="Includes ::before and ::after pseudo-elements.">all elements</a>
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>yes
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>n/a
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>see <a href="#computing-dynamic-range-limit">Computed Value for dynamic-range-limit</a>
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>by <a class="css" data-link-type="maybe" href="#funcdef-dynamic-range-limit-mix" id="ref-for-funcdef-dynamic-range-limit-mix①">dynamic-range-limit-mix()</a>
   </table>
   <details class="wpt-tests-block" dir="ltr" lang="en" open>
    <summary>Tests</summary>
    <ul class="wpt-tests-list">
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/css/css-color-hdr/computed.html" title="css/css-color-hdr/computed.html">computed.html</a> <a class="wpt-live" href="http://wpt.live/css/css-color-hdr/computed.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/css/css-color-hdr/computed.html"><small>(source)</small></a>
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/css/css-color-hdr/inheritance.html" title="css/css-color-hdr/inheritance.html">inheritance.html</a> <a class="wpt-live" href="http://wpt.live/css/css-color-hdr/inheritance.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/css/css-color-hdr/inheritance.html"><small>(source)</small></a>
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/css/css-color-hdr/interpolation.html" title="css/css-color-hdr/interpolation.html">interpolation.html</a> <a class="wpt-live" href="http://wpt.live/css/css-color-hdr/interpolation.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/css/css-color-hdr/interpolation.html"><small>(source)</small></a>
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/css/css-color-hdr/parsing.html" title="css/css-color-hdr/parsing.html">parsing.html</a> <a class="wpt-live" href="http://wpt.live/css/css-color-hdr/parsing.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/css/css-color-hdr/parsing.html"><small>(source)</small></a>
    </ul>
   </details>
   <dl>
    <dt><dfn class="css dfn-paneled" data-dfn-for="dynamic-range-limit" data-dfn-type="value" data-export id="valdef-dynamic-range-limit-standard">standard</dfn>
		
    <dd>
			The highest luminance color
			that is displayed is the same as
			HDR reference white, i.e. the CSS color <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-4/#valdef-color-white" id="ref-for-valdef-color-white">white</a>.
		
    <dt><dfn class="css dfn-paneled" data-dfn-for="dynamic-range-limit" data-dfn-type="value" data-export id="valdef-dynamic-range-limit-no-limit">no-limit</dfn>
		
    <dd>
			The highest peak luminance
			that is displayed is much greater than
			HDR reference white, i.e. the CSS color <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-4/#valdef-color-white" id="ref-for-valdef-color-white①">white</a>;
			the precise level is not specified.
		
    <dt><dfn class="css dfn-paneled" data-dfn-for="dynamic-range-limit" data-dfn-type="value" data-export id="valdef-dynamic-range-limit-constrained">constrained</dfn>
		
    <dd>
			The highest peak luminance
			that is displayed is somewhat greater than
			HDR reference white, i.e. the CSS color <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-4/#valdef-color-white" id="ref-for-valdef-color-white②">white</a>,
			such that a mix of SDR and HDR content
			can be comfortably viewed together.
		
   </dl>
   <div class="example" id="ex-hdr-limit-photogrid">
    <a class="self-link" href="#ex-hdr-limit-photogrid"></a>
		
<pre class="highlight lang-css">body <c- p>{</c-> <c- k>dynamic-range-limit</c-><c- p>:</c-> standard<c- p>;</c-> <c- p>}</c->
div.photogrid img <c- p>{</c-> <c- k>dynamic-range-limit</c-><c- p>:</c-> constrained <c- p>}</c->
</pre>
   </div>
   <h3 class="heading settled" data-level="3.2" id="dynamic-range-limit-mix"><span class="secno">3.2. </span><span class="content">Mixing Dynamic Range Limits: the <a class="css" data-link-type="maybe" href="#funcdef-dynamic-range-limit-mix" id="ref-for-funcdef-dynamic-range-limit-mix②">dynamic-range-limit-mix()</a> function</span><a class="self-link" href="#dynamic-range-limit-mix"></a></h3>
   <p>This function takes one or more <a class="css property" data-link-type="property" href="#propdef-dynamic-range-limit" id="ref-for-propdef-dynamic-range-limit①">dynamic-range-limit</a> values,
	converts them internally to a value in stops above HDR reference white,
	and alters the display to the result of mixing them
	by the specified amount.
	For privacy reasons, the actual calculated result is not exposed.</p>
<pre class="prod"><dfn class="dfn-paneled" data-dfn-type="function" data-export id="funcdef-dynamic-range-limit-mix">dynamic-range-limit-mix()</dfn> = dynamic-range-limit-mix( [ <a class="production" data-link-type="property" href="#propdef-dynamic-range-limit" id="ref-for-propdef-dynamic-range-limit②">&lt;'dynamic-range-limit'></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-all" id="ref-for-comb-all">&amp;&amp;</a> <a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#percentage-value" id="ref-for-percentage-value">&lt;percentage [0,100]></a> ]<a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#mult-comma" id="ref-for-mult-comma">#{2,}</a> )
</pre>
   <details class="wpt-tests-block" dir="ltr" lang="en" open>
    <summary>Tests</summary>
    <ul class="wpt-tests-list">
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/css/css-color-hdr/computed.html" title="css/css-color-hdr/computed.html">computed.html</a> <a class="wpt-live" href="http://wpt.live/css/css-color-hdr/computed.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/css/css-color-hdr/computed.html"><small>(source)</small></a>
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/css/css-color-hdr/inheritance.html" title="css/css-color-hdr/inheritance.html">inheritance.html</a> <a class="wpt-live" href="http://wpt.live/css/css-color-hdr/inheritance.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/css/css-color-hdr/inheritance.html"><small>(source)</small></a>
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/css/css-color-hdr/interpolation.html" title="css/css-color-hdr/interpolation.html">interpolation.html</a> <a class="wpt-live" href="http://wpt.live/css/css-color-hdr/interpolation.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/css/css-color-hdr/interpolation.html"><small>(source)</small></a>
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/css/css-color-hdr/parsing.html" title="css/css-color-hdr/parsing.html">parsing.html</a> <a class="wpt-live" href="http://wpt.live/css/css-color-hdr/parsing.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/css/css-color-hdr/parsing.html"><small>(source)</small></a>
    </ul>
   </details>
   <h3 class="heading settled" data-level="3.3" id="computing-dynamic-range-limit"><span class="secno">3.3. </span><span class="content">
	Computed Value for <a class="css property" data-link-type="property" href="#propdef-dynamic-range-limit" id="ref-for-propdef-dynamic-range-limit③">dynamic-range-limit</a>
</span><a class="self-link" href="#computing-dynamic-range-limit"></a></h3>
   <p>If the specified value is <a class="css" data-link-type="maybe" href="#valdef-dynamic-range-limit-standard" id="ref-for-valdef-dynamic-range-limit-standard">standard</a>, <a class="css" data-link-type="maybe" href="#valdef-dynamic-range-limit-constrained" id="ref-for-valdef-dynamic-range-limit-constrained">constrained</a>, or <a class="css" data-link-type="maybe" href="#valdef-dynamic-range-limit-no-limit" id="ref-for-valdef-dynamic-range-limit-no-limit">no-limit</a>, then the computed value is the specified value.</p>
   <p>If the specified value is <a class="css" data-link-type="maybe" href="#funcdef-dynamic-range-limit-mix" id="ref-for-funcdef-dynamic-range-limit-mix③">dynamic-range-limit-mix()</a>, then the computed value is determined by the following algorithm:</p>
   <ol>
    <li data-md>
     <p>Let <var>v1</var>, ..., <var>vN</var> be the computed values for the parameters to be mixed.</p>
    <li data-md>
     <p>Let <var>p1</var>, ..., <var>pN</var> be the mixing percentages, normalized to sum to 100%.</p>
    <li data-md>
     <p>Define the contributing percentages as:</p>
     <ul>
      <li data-md>
       <p>Let <var>p1_standard</var>,...,<var>pN_standard</var> be the percentages for <a class="css" data-link-type="maybe" href="#valdef-dynamic-range-limit-standard" id="ref-for-valdef-dynamic-range-limit-standard①">standard</a> in <var>v1</var>,...,<var>vN</var></p>
      <li data-md>
       <p>Let <var>p1_constrained_high</var>,...,<var>pN_constrained_high</var> be the percentages for <a class="css" data-link-type="maybe" href="#valdef-dynamic-range-limit-constrained" id="ref-for-valdef-dynamic-range-limit-constrained①">constrained</a> in <var>v1</var>,...,<var>vN</var></p>
      <li data-md>
       <p>Let <var>p1_no_limit</var>,...,<var>pN_no_limit</var> be the percentages for <a class="css" data-link-type="maybe" href="#valdef-dynamic-range-limit-no-limit" id="ref-for-valdef-dynamic-range-limit-no-limit①">no-limit</a> in <var>v1</var>,...,<var>vN</var></p>
     </ul>
    <li data-md>
     <p>Compute the weighted sums as:</p>
     <ul>
      <li data-md>
       <p><var>p_standard</var>=(<var>p1_standard</var>*<var>p1</var>+...+<var>pN_standard</var>*<var>pN</var>)/100.</p>
      <li data-md>
       <p><var>p_constrained_high</var>=(<var>p1_constrained_high</var>*<var>p1</var>+...+<var>pN_constrained_high</var>*<var>pN</var>)/100.</p>
      <li data-md>
       <p><var>p_no_limit</var>=(<var>p1_no_limit</var>*<var>p1</var>+...+<var>pN_no_limit</var>*<var>pN</var>)/100.</p>
     </ul>
    <li data-md>
     <p>If <var>p_standard</var>, <var>p_constrained_high</var>, or <var>p_no_limit</var> equals 100%, then the computed value is <a class="css" data-link-type="maybe" href="#valdef-dynamic-range-limit-standard" id="ref-for-valdef-dynamic-range-limit-standard②">standard</a>, <a class="css" data-link-type="maybe" href="#valdef-dynamic-range-limit-constrained" id="ref-for-valdef-dynamic-range-limit-constrained②">constrained</a>, or <a class="css" data-link-type="maybe" href="#valdef-dynamic-range-limit-no-limit" id="ref-for-valdef-dynamic-range-limit-no-limit②">no-limit</a>, respectively.</p>
    <li data-md>
     <p>Otherwise, the computed value is <a class="css" data-link-type="maybe" href="#funcdef-dynamic-range-limit-mix" id="ref-for-funcdef-dynamic-range-limit-mix④">dynamic-range-limit-mix()</a>, with parameters <a class="css" data-link-type="maybe" href="#valdef-dynamic-range-limit-standard" id="ref-for-valdef-dynamic-range-limit-standard③">standard</a>, <a class="css" data-link-type="maybe" href="#valdef-dynamic-range-limit-constrained" id="ref-for-valdef-dynamic-range-limit-constrained③">constrained</a>, and <a class="css" data-link-type="maybe" href="#valdef-dynamic-range-limit-no-limit" id="ref-for-valdef-dynamic-range-limit-no-limit③">no-limit</a>, in that order, and percentages <var>p_standard</var>, <var>p_constrained_high</var>, and <var>p_no_limit</var>, omitting parameters with a percentage equal to 0%. If <em>all</em> parameters are thereby omitted, the computed value is the initial value.</p>
   </ol>
   <details class="wpt-tests-block" dir="ltr" lang="en" open>
    <summary>Tests</summary>
    <ul class="wpt-tests-list">
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/css/css-color-hdr/computed.html" title="css/css-color-hdr/computed.html">computed.html</a> <a class="wpt-live" href="http://wpt.live/css/css-color-hdr/computed.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/css/css-color-hdr/computed.html"><small>(source)</small></a>
    </ul>
   </details>
   <div class="example" id="ex-hdr-limit-mix">
    <a class="self-link" href="#ex-hdr-limit-mix"></a>
		The computed value of
	  
<pre class="highlight lang-css"><c- nf>dynamic-range-limit-mix</c-><c- p>(</c->
    high <c- m>10</c-><c- k>%</c-><c- p>,</c->
    <c- nf>dynamic-range-limit-mix</c-><c- p>(</c->standard <c- m>25</c-><c- k>%</c-><c- p>,</c-> constrained <c- m>75</c-><c- k>%</c-><c- p>)</c-> <c- m>20</c-><c- k>%</c-><c- p>,</c->
    <c- nf>dynamic-range-limit-mix</c-><c- p>(</c->constrained <c- m>10</c-><c- k>%</c-><c- p>,</c-> no-limit <c- m>30</c-><c- k>%</c-><c- p>)</c-> <c- m>20</c-><c- k>%</c-><c- p>)</c->
</pre>
    
	is
	  
<pre class="highlight lang-css"><c- nf>dynamic-range-limit-mix</c-><c- p>(</c->standard <c- m>10</c-><c- k>%</c-><c- p>,</c-> constrained <c- m>40</c-><c- k>%</c-><c- p>,</c-> no-limit <c- m>50</c-><c- k>%</c-><c- p>)</c->
</pre>
   </div>
   <h2 class="heading settled" data-level="4" id="color-syntax"><span class="secno">4. </span><span class="content">The <a class="css production" data-link-type="type" href="https://www.w3.org/TR/css-color-5/#typedef-color" id="ref-for-typedef-color">&lt;color></a> syntax</span><a class="self-link" href="#color-syntax"></a></h2>
   <p>This module extends the <a class="css production" data-link-type="type" href="#typedef-color-function" id="ref-for-typedef-color-function">&lt;color-function></a> type:</p>
<pre class="prod"><dfn class="dfn-paneled" data-dfn-type="type" data-export id="typedef-color-function">&lt;color-function></dfn> = <a class="production" data-link-type="function" href="https://www.w3.org/TR/css-color-4/#funcdef-rgb" id="ref-for-funcdef-rgb">&lt;rgb()></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one③">|</a> <a class="production" data-link-type="function" href="https://www.w3.org/TR/css-color-4/#funcdef-rgba" id="ref-for-funcdef-rgba">&lt;rgba()></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one④">|</a>
    <a class="production" data-link-type="function" href="https://www.w3.org/TR/css-color-4/#funcdef-hsl" id="ref-for-funcdef-hsl">&lt;hsl()></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one⑤">|</a> <a class="production" data-link-type="function" href="https://www.w3.org/TR/css-color-4/#funcdef-hsla" id="ref-for-funcdef-hsla">&lt;hsla()></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one⑥">|</a> <a class="production" data-link-type="function" href="https://www.w3.org/TR/css-color-5/#funcdef-hwb" id="ref-for-funcdef-hwb">&lt;hwb()></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one⑦">|</a>
    <a class="production" data-link-type="function" href="https://www.w3.org/TR/css-color-5/#funcdef-lab" id="ref-for-funcdef-lab">&lt;lab()></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one⑧">|</a> <a class="production" data-link-type="function" href="https://www.w3.org/TR/css-color-5/#funcdef-lch" id="ref-for-funcdef-lch">&lt;lch()></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one⑨">|</a> <a class="production" data-link-type="function" href="https://www.w3.org/TR/css-color-5/#funcdef-oklab" id="ref-for-funcdef-oklab">&lt;oklab()></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①⓪">|</a> <a class="production" data-link-type="function" href="https://www.w3.org/TR/css-color-5/#funcdef-oklch" id="ref-for-funcdef-oklch">&lt;oklch()></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①①">|</a>
    <a class="production" data-link-type="function" href="#funcdef-ictcp" id="ref-for-funcdef-ictcp">&lt;ictcp()></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①②">|</a> <a class="production" data-link-type="function" href="#funcdef-jzazbz" id="ref-for-funcdef-jzazbz">&lt;jzazbz()></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①③">|</a> <a class="production" data-link-type="function" href="#funcdef-jzczhz" id="ref-for-funcdef-jzczhz">&lt;jzczhz()></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①④">|</a>
    <a class="production" data-link-type="function" href="https://drafts.csswg.org/css-color-5/#funcdef-alpha" id="ref-for-funcdef-alpha">&lt;alpha()></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①⑤">|</a>
    <a class="production" data-link-type="function" href="https://www.w3.org/TR/css-color-5/#funcdef-color" id="ref-for-funcdef-color">&lt;color()></a>
<dfn class="dfn-paneled" data-dfn-type="function" data-export id="funcdef-ictcp">ictcp()</dfn> = ictcp([from <a class="production" data-link-type="type" href="https://www.w3.org/TR/css-color-5/#typedef-color" id="ref-for-typedef-color①">&lt;color></a>]<a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#mult-opt" id="ref-for-mult-opt">?</a>
  [<a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#percentage-value" id="ref-for-percentage-value①">&lt;percentage></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①⑥">|</a> <a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value">&lt;number></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①⑦">|</a> none]
  [<a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#percentage-value" id="ref-for-percentage-value②">&lt;percentage></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①⑧">|</a> <a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value①">&lt;number></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①⑨">|</a> none]
  [<a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#percentage-value" id="ref-for-percentage-value③">&lt;percentage></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②⓪">|</a> <a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value②">&lt;number></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②①">|</a> none]
  [ / [<a class="production" data-link-type="type" href="https://www.w3.org/TR/css-color-4/#typedef-color-alpha-value" id="ref-for-typedef-color-alpha-value">&lt;alpha-value></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②②">|</a> none] ]<a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#mult-opt" id="ref-for-mult-opt①">?</a> )
<dfn class="dfn-paneled" data-dfn-type="function" data-export id="funcdef-jzazbz">jzazbz()</dfn> = jzazbz([from <a class="production" data-link-type="type" href="https://www.w3.org/TR/css-color-5/#typedef-color" id="ref-for-typedef-color②">&lt;color></a>]<a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#mult-opt" id="ref-for-mult-opt②">?</a>
  [<a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#percentage-value" id="ref-for-percentage-value④">&lt;percentage></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②③">|</a> <a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value③">&lt;number></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②④">|</a> none]
  [<a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#percentage-value" id="ref-for-percentage-value⑤">&lt;percentage></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②⑤">|</a> <a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value④">&lt;number></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②⑥">|</a> none]
  [<a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#percentage-value" id="ref-for-percentage-value⑥">&lt;percentage></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②⑦">|</a> <a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value⑤">&lt;number></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②⑧">|</a> none]
  [ / [<a class="production" data-link-type="type" href="https://www.w3.org/TR/css-color-4/#typedef-color-alpha-value" id="ref-for-typedef-color-alpha-value①">&lt;alpha-value></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②⑨">|</a> none] ]<a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#mult-opt" id="ref-for-mult-opt③">?</a> )
<dfn class="dfn-paneled" data-dfn-type="function" data-export id="funcdef-jzczhz">jzczhz()</dfn> = jzczhz([from <a class="production" data-link-type="type" href="https://www.w3.org/TR/css-color-5/#typedef-color" id="ref-for-typedef-color③">&lt;color></a>]<a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#mult-opt" id="ref-for-mult-opt④">?</a>
  [<a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#percentage-value" id="ref-for-percentage-value⑦">&lt;percentage></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one③⓪">|</a> <a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value⑥">&lt;number></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one③①">|</a> none]
  [<a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#percentage-value" id="ref-for-percentage-value⑧">&lt;percentage></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one③②">|</a> <a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value⑦">&lt;number></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one③③">|</a> none]
  [<a class="production" data-link-type="type" href="https://www.w3.org/TR/css-color-4/#typedef-hue" id="ref-for-typedef-hue">&lt;hue></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one③④">|</a> none]
  [ / [<a class="production" data-link-type="type" href="https://www.w3.org/TR/css-color-4/#typedef-color-alpha-value" id="ref-for-typedef-color-alpha-value②">&lt;alpha-value></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one③⑤">|</a> none] ]<a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#mult-opt" id="ref-for-mult-opt⑤">?</a> )
</pre>
   <h2 class="heading settled" data-level="5" id="hdr-color-function"><span class="secno">5. </span><span class="content">HDR colors parameterized by headroom: the <a class="css" data-link-type="maybe" href="#funcdef-hdr-color" id="ref-for-funcdef-hdr-color">hdr-color()</a> function</span><a class="self-link" href="#hdr-color-function"></a></h2>
   <p>The <a class="css" data-link-type="maybe" href="#funcdef-hdr-color" id="ref-for-funcdef-hdr-color①">hdr-color()</a> function allows a range of colors to be specified,
	whose value is automatically calculated based on the <a data-link-type="dfn" href="#hdr-headroom" id="ref-for-hdr-headroom①">HDR headroom</a>.</p>
   <p>It does this by specifying two <a class="css production" data-link-type="type" href="https://www.w3.org/TR/css-color-5/#typedef-color" id="ref-for-typedef-color④">&lt;color></a> values,
	each with an associated level of HDR headroom.
	(The two headroom values must not be the same).
	The actual value is computed by interpolating between these two colors,
	based on the current amount of HDR headroom,
	as described in <a href="#headroom-interpolation">§ 5.1 Interpolating colors based on headroom</a>.</p>
   <div class="informative">
	This is a similar mechanism to gain maps, 
	in raster images conforming to <a data-link-type="biblio" href="#biblio-iso_21496-1" title="Gain map metadata for image conversion: Part 1: Dynamic Range Conversion">[ISO_21496-1]</a>,
	or to adaptive gain curves,
	in <a data-link-type="biblio" href="#biblio-smpte-st-2094-50" title="Dynamic Metadata for Color Volume Transform - Application #5 (Broadcast)">[SMPTE-ST-2094-50]</a>.
	</div>
   <p>For privacy reasons, the actual calculated color is not exposed,
	nor is the actual HDR headroom,
	as this is a fingerprinting vector.</p>
   <p>Its syntax is as follows:</p>
<pre class="prod"><dfn class="dfn-paneled" data-dfn-type="function" data-export id="funcdef-hdr-color">hdr-color()</dfn> = color-hdr([ <a class="production" data-link-type="type" href="https://www.w3.org/TR/css-color-5/#typedef-color" id="ref-for-typedef-color⑤">&lt;color></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-all" id="ref-for-comb-all①">&amp;&amp;</a> <a class="production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value⑧">&lt;number [0,∞]></a><a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#mult-opt" id="ref-for-mult-opt⑥">?</a> ]<a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#mult-comma" id="ref-for-mult-comma①">#{2}</a>)
</pre>
   <div class="example" id="ex-hdr-color-simple">
    <a class="self-link" href="#ex-hdr-color-simple"></a>
	Consider the color:

	
<pre class="highlight lang-css"><c- nf>color-hdr</c-><c- p>(</c->
  <c- nf>color</c-><c- p>(</c->rec2100-linear <c- m>0.9</c-> <c- m>1.0</c-> <c- m>0.8</c-><c- p>)</c-> <c- m>0</c-><c- p>,</c->
  <c- nf>color</c-><c- p>(</c->rec2100-linear <c- m>1.8</c-> <c- m>2.0</c-> <c- m>1.5</c-><c- p>)</c-> <c- m>2</c-><c- p>);</c->
</pre>
    <p>On a display with <a data-link-type="dfn" href="#hdr-headroom" id="ref-for-hdr-headroom②">HDR headroom</a> &lt;= 0,
	in other words, an SDR display,
	this color will display as</p>
<pre class="highlight lang-css"><c- nf>color</c-><c- p>(</c->rec2100-linear <c- m>0.9</c-> <c- m>1.0</c-> <c- m>0.8</c-><c- p>)</c-></pre>
    <p>On a display with <a data-link-type="dfn" href="#hdr-headroom" id="ref-for-hdr-headroom③">HDR headroom</a> >= 2,
	this color will display as</p>
<pre class="highlight lang-css"><c- nf>color</c-><c- p>(</c->rec2100-linear <c- m>1.8</c-> <c- m>2.0</c-> <c- m>1.5</c-><c- p>)</c-> <c- m>2</c-><c- p>);</c-></pre>
    <p>For displays whose headroom lies between 0 and 2, the color is
	interpolated. For <a href="#ex-hdr-interpolate">example</a>, 
	on a display with HDR headroom 1:</p>
    <p>X = 243.664, Y = 275.713, Z = 244.000</p>
   </div>
   <p>Colors are interpolated in <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="absolute-d65-cie-xyz">Absolute D65 CIE XYZ</dfn>.</p>
   <p>This is derived from <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-4/#valdef-color-xyz-d65" id="ref-for-valdef-color-xyz-d65">xyz-d65</a>
	by multiplying each color component by 203 <a data-link-type="biblio" href="#biblio-rpt_bt2408" title="Report ITU-R BT.2408-0 Operational practices in HDR television production">[Rpt_BT.2408]</a>
	to convert from relative units (Y of white is 1, regardless of actual brightness)
	to absolute units of cd/m², also called "nits".
	In the <a href="#color-conversion-code">sample code</a>,
	this constant is denoted <var>Yw</var>,
	the luminance of HDR Reference White.</p>
   <div class="example" id="ex-rel-to-abs">
    <a class="self-link" href="#ex-rel-to-abs"></a>
		For example, the css color <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-4/#valdef-color-white" id="ref-for-valdef-color-white③">white</a> is 
		
<pre class="highlight lang-css"><c- nf>color</c-><c- p>(</c->xyz-d65 <c- m>0.9505</c-> <c- m>1</c-> <c- m>1.089</c-><c- p>)</c-></pre>
    <p>In absolute D65 XYX this is
		[192.9426, 203, 221.0787]</p>
   </div>
   <h3 class="heading settled" data-level="5.1" id="headroom-interpolation"><span class="secno">5.1. </span><span class="content">
	Interpolating colors based on headroom
</span><a class="self-link" href="#headroom-interpolation"></a></h3>
   <p>To interpolate between a color <var>c1</var> at headroom <var>H1</var>
	and a color <var>c2</var> at headroom <var>H2</var>,
	giving result color <var>cxyz</var>,
	when the target headroom is <var>H</var>:</p>
   <ol>
    <li data-md>
     <p>Let <var>c1xyz</var> be <var>c1</var> converted to <a data-link-type="dfn" href="#absolute-d65-cie-xyz" id="ref-for-absolute-d65-cie-xyz">Absolute D65 CIE XYZ</a></p>
    <li data-md>
     <p>Let <var>c2xyz</var> be <var>c2</var> converted to <a data-link-type="dfn" href="#absolute-d65-cie-xyz" id="ref-for-absolute-d65-cie-xyz①">Absolute D65 CIE XYZ</a></p>
    <li data-md>
     <p>Let <var> w1</var> = clamp((<var>H</var> - <var>H2</var>) / (<var>H1</var> - <var>H2</var>), 0, 1)</p>
    <li data-md>
     <p>Let <var> w2</var> = clamp((<var>H</var> - <var>H1</var>) / (<var>H2</var> - <var>H1</var>), 0, 1)
Note that <var> w2</var> = 1 - <var> w1</var></p>
    <li data-md>
     <p>Let <var>eps</var> = 0.001</p>
    <li data-md>
     <p>Let <var>cxyz</var> = Array(3)</p>
    <li data-md>
     <p>For i from 0 to 2:
Let <var>cxyz</var>[i] = pow(<var>c1xyz</var>[i] + <var>eps</var>, <var>w1</var> ) * pow(<var>c2xyz</var>[i] + <var>eps</var>, <var>w2</var> ) - <var>eps</var></p>
   </ol>
   <p class="note" role="note"><span class="marker">Note:</span> The factor <var>eps</var> is to prevent division by zero,
	and is particularly important when interpolating with SDR colors near to black.</p>
   <div class="example" id="ex-hdr-interpolate">
    <a class="self-link" href="#ex-hdr-interpolate"></a>
	For example, given c1 = color(rec2100-linear 0.9 1.0 0.8),
	c2 = color(rec2100-linear 1.8 2.0 1.5),
	H1 = 0, H2 = 2, and H = 1:

	
<pre class="highlight lang-css">c1xyz = <c- p>[</c-> <c- m>173.156</c-><c- p>,</c-> <c- m>195.260</c-><c- p>,</c-> <c- m>178.003</c-> <c- p>]</c->
c2xyz = <c- p>[</c-> <c- m>342.883</c-><c- p>,</c-> <c- m>389.315</c-><c- p>,</c-> <c- m>334.467</c-> <c- p>]</c->
w1 = <c- m>0.5</c->
w2 = <c- m>0.5</c->
cxyz = <c- p>[</c-> <c- m>243.664</c-><c- p>,</c-> <c- m>275.713</c-><c- p>,</c-> <c- m>244.000</c-> <c- p>]</c->
</pre>
   </div>
   <div class="example" id="ex-hdr-interpolate-2">
    <a class="self-link" href="#ex-hdr-interpolate-2"></a>
		For exmple, given c1 = color(display-p3 1 1 0.33),
		c2 = jzczhz(70% 0.14 100),
		H1 = 0.5, H2 = 4 and H = 2;

	
<pre class="highlight lang-css">c1xyz = <c- p>[</c-> <c- m>156.285</c-><c- p>,</c-> <c- m>188.337</c-><c- p>,</c-> <c- m>28.015</c-> <c- p>]</c->
c2xyz = <c- p>[</c-> <c- m>3776.1434</c-><c- p>,</c-> <c- m>4362.407</c-><c- p>,</c-> <c- m>1577.913</c-> <c- p>]</c->
w1 = <c- m>0.571</c-> 
w2 = <c- m>0.429</c->
cxyz = <c- p>[</c-> <c- m>611.911</c-><c- p>,</c-> <c- m>724.180</c-><c- p>,</c-> <c- m>157.650</c-> <c- p>]</c->
</pre>
    <p>Note that c1 will be used unmodified at all headroom values &lt;= 0.5,
	and c2 will be used unmodified at all headroom values >= 4.</p>
   </div>
   <h2 class="heading settled" data-level="6" id="DI-HDR"><span class="secno">6. </span><span class="content">
	Device-Independent HDR Colors
</span><a class="self-link" href="#DI-HDR"></a></h2>
   <p>In the same way that <a href="https://www.w3.org/TR/css-color-4/#lab-colors"><cite>CSS Color 4</cite> § 9 Device-independent Colors: CIE Lab and LCH, Oklab and OKLCh</a>
	allows specifying device-independent SDR colors,
	this specification allows specifying device-independent HDR colors.</p>
   <h3 class="heading informative settled" data-level="6.1" id="ictcp-intro"><span class="secno">6.1. </span><span class="content">
	Introducing ICtCp
</span><a class="self-link" href="#ictcp-intro"></a></h3>
   <p><em>This section is not normative.</em></p>
   <p>The IC<sub>T</sub>C<sub>P</sub> color space
	has better perceptual uniformity than CIE Lab,
	and is used as a part of the color image pipeline 
	in video and digital photography systems 
	for high dynamic range (HDR) and wide color gamut (WCG) imagery.</p>
   <p>The T and P subscripts
	refer to the Tritanope (yellowness-blueness) 
	and Protanope (redness-greenness)
	opponent color axes in the human visual system.
	To avoid pesky subscripts,
	the simplification ICtCp is frequently used.</p>
   <p>IC<sub>T</sub>C<sub>P</sub> was
	originaly developed by Dolby Laboratories <a data-link-type="biblio" href="#biblio-what_is_ictcp" title="What is ICtCp, v7.1">[What_is_ICtCp]</a>
	from the IPT color space by Ebner and Fairchild
	<a data-link-type="biblio" href="#biblio-development_itp" title="Development and testing of a color space (IPT) with improved hue uniformity. In: Proceedings of The Sixth Color Imaging Conference, 8-13, 1998">[Development_ITP]</a>,
	and is defined in <a data-link-type="biblio" href="#biblio-rec_bt2100" title="ITU-R BT.2100-3 Image parameter values for high dynamic range television for use in production and international programme exchange">[Rec_BT.2100]</a> as the 
	Constant Intensity IC<sub>T</sub>C<sub>P</sub> signal format. 
	It was intended to replace YCbCr <a data-link-type="biblio" href="#biblio-perrin" title="ICtCp Versus Y&apos;CbCr: Evaluation of ICtCp Color Space and an Adaptive Reshaper for HDR and WCG">[Perrin]</a>.</p>
   <p>It is based on the human visual system LMS cone primaries;
	the Hunt-Pointer-Estevez (HPE) XYZ to LMS transform
	is used,
	normalized to a <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-4/#d65" id="ref-for-d65">D65</a> whitepoint.
	A 4% crosstalk matrix is then applied  <a data-link-type="biblio" href="#biblio-what_is_ictcp" title="What is ICtCp, v7.1">[What_is_ICtCp]</a>,
	to reduce the gamut hull concavities of BT.2020 RGB,
	thus reducing interpolation errors.
	The crosstalk also provides improved lines of constant hue
	and improved uniformity of Just Noticeable Difference (JND) MacAdam ellipses.</p>
   <p>Unlike <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-4/#valdef-lab-lab" id="ref-for-valdef-lab-lab">Lab</a>, which has primarily been tested with
	lower-intensity <em>reflective</em> colors,
	IC<sub>T</sub>C<sub>P</sub> has been tested with
	high-chroma (wide color gamut),
	self-luminous, and
	high intensity (HDR) colors.</p>
   <p>This makes it suitable for HDR color difference measurement
	<a href="#deltaE">(deltaE ITP)</a>
	and for gamut mapping of mixed  SDR and HDR colors.</p>
   <div class="example" id="ex-DE-ITP">
    <a class="self-link" href="#ex-DE-ITP"></a>
		For example, BT.2020 and BT.2100 use the same primaries and white point.
		BT.2020 is SDR, while BT.2100 is HDR
		and places HDR reference white at a code value close to 0.58.


    <p>Here is a very wide gamut primary red in both color spaces:</p>
<pre class="highlight lang-css"><c- nf>color</c-><c- p>(</c->rec2100-pq <c- m>0.58</c-> <c- m>0</c-> <c- m>0</c-><c- p>)</c-> <c- c>/* ictcp(44.6% -0.129 0.399) */</c->
<c- nf>color</c-><c- p>(</c->rec2020 <c- m>1</c-> <c- m>0</c-> <c- m>0</c-><c- p>)</c->       <c- c>/* ictcp(44.7% -0.130 0.399)  */</c->
</pre>
    <p>The two colors are clearly very close in ICTCP
		and the deltaE ITP is 0.487,
		meaning the colors are not visually different.</p>
    <p>These colors are very different from sRGB "red":</p>
<pre class="highlight lang-css"><c- nf>color</c-><c- p>(</c->rec2100-pq <c- m>0.58</c-> <c- m>0</c-> <c- m>0</c-><c- p>)</c-> <c- c>/* ictcp(44.6% -0.129 0.399) */</c->
red                        <c- c>/* ictcp(42.8% -0.116 0.279) */</c->
</pre>
    <p>the deltaE ITP is 87.7,
		meaning the colors are very visually different.</p>
   </div>
   <h3 class="heading informative settled" data-level="6.2" id="jaz-intro"><span class="secno">6.2. </span><span class="content">
	Introducing Jzazbz and JzCzhz
</span><a class="self-link" href="#jaz-intro"></a></h3>
   <p><em>This section is not normative.</em></p>
   <p>The J<sub>z</sub>a<sub>z</sub>b<sub>z</sub> color space <a data-link-type="biblio" href="#biblio-safdar-pucs" title="Perceptually uniform color space for image signals including high dynamic range and wide gamut">[Safdar-PUCS]</a>,
	and its polar form  J<sub>z</sub>C<sub>z</sub>h<sub>z</sub>,
	were designed to be more perceptually uniform 
	for wide gamut colors such as BT.2020, 
	to accurately predict a wide-range of lightness,
	including HDR colors,
	and to have  minimal inter-dependence 
	between the perceptual attributes (lightness, chroma, and hue).
	In particular it has superior hue uniformity,
	compared to CAM16-UCS <a data-link-type="biblio" href="#biblio-safdar-pucs" title="Perceptually uniform color space for image signals including high dynamic range and wide gamut">[Safdar-PUCS]</a>.</p>
   <p>CIE Lab uses a lightness scale with a [0%, 100%] range,
	relative to HDR reference white;
	similarly, Oklab uses a lightness scale with a [0, 1.0] range,
	again with 1.0 referring to HDR reference white.
	In contrast, the J<sub>z</sub> axis in <span class="css">Jzazbz</span>,
	which has a [0, 1.0] range,
	uses an encoding <em>similar to</em> Perceptual Quantizer,
	and can represent a dynamic range of more than 13 stops.</p>
   <h3 class="heading settled" data-level="6.3" id="ICtCp"><span class="secno">6.3. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="ictcp">ICtCp</dfn></span><a class="self-link" href="#ICtCp"></a></h3>
   <p>The <span class="css">ICtCp</span> color space accepts three numeric parameters,
	with I representing the Intensity
	(similar to L in Lab, but covering a luminance range
	up to 10,000 cd/m<sup>2</sup>)
	while C<sub>T</sub> and C<sub>P</sub> represent the
	yellowness-blueness (tritanope) and
	redness-greenness (protanope)
	opponent-color axes (similar to b and a, respectively, in Lab).</p>
   <p>It has the following characteristics:</p>
   <table>
    <thead>
     <td>
     <td>x
     <td>y
    <tbody>
     <tr>
      <th>White chromaticity
      <td colspan="2"><a data-link-type="dfn" href="https://www.w3.org/TR/css-color-4/#d65" id="ref-for-d65①">D65</a>
     <tr>
      <th>Transfer function
      <td colspan="2">Perceptual Quantizer
     <tr>
      <th>White luminance
      <td colspan="2">203 cd/m²
     <tr>
      <th>Peak white luminance
      <td colspan="2">10,000 cd/m²
     <tr>
      <th>Black luminance
      <td colspan="2">0.001 cd/m²
     <tr>
      <th>Image state
      <td colspan="2">display-referred
     <tr>
      <th>Percentages
      <td colspan="2">Allowed for I, Ct and Cp
     <tr>
      <th>Percent reference range
      <td>for I: 0% = 0.0, 100% = 1.0<br>
			for Ct and Cp: -100% = -0.5, 100% = 0.5
   </table>
   <p>Although <a data-link-type="biblio" href="#biblio-rec_bt2100" title="ITU-R BT.2100-3 Image parameter values for high dynamic range television for use in production and international programme exchange">[Rec_BT.2100]</a> defines IC<sub>T</sub>C<sub>P</sub>
	by a conversion from linear-light BT.2100 RGB <a data-link-type="biblio" href="#biblio-rec_bt2100" title="ITU-R BT.2100-3 Image parameter values for high dynamic range television for use in production and international programme exchange">[Rec_BT.2100]</a>,
	this conversion proceeds via LMS
	and thus, any other color space can also be represented
	by applying an XYZ to LMS transform
	as shown in <a data-link-type="biblio" href="#biblio-what_is_ictcp" title="What is ICtCp, v7.1">[What_is_ICtCp]</a>.
	The <a href="#ictcp_code">sample code</a> uses this approach.</p>
   <div class="example" id="example-c42f1cee">
    <a class="self-link" href="#example-c42f1cee"></a>
		This color represents the sRGB color "lime" in <span class="css">ICtCp</span>
		
<pre><span class="swatch" style="--color: lime"></span> ictcp(0.5393 -0.2643 -0.0625)
</pre>
   </div>
   <div class="example" id="example-c8369b18">
    <a class="self-link" href="#example-c8369b18"></a>
		This color represents a comfortable "diffuse white"
		This color can be displayed for long periods,
		or used for subtitles,
		on any sized area of the screen.
		It is the same color as sRGB <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-4/#valdef-color-white" id="ref-for-valdef-color-white④">white</a>.
		Diffuse white is 203 cd/m²  <a data-link-type="biblio" href="#biblio-rec_bt2100" title="ITU-R BT.2100-3 Image parameter values for high dynamic range television for use in production and international programme exchange">[Rec_BT.2100]</a>.
		
<pre><span class="swatch" style="--color: white"></span> ictcp(0.58069 0 0)
</pre>
   </div>
   <p>Within a <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-5/#relative-color" id="ref-for-relative-color">relative color</a> syntax <a class="css" data-link-type="maybe" href="#funcdef-ictcp" id="ref-for-funcdef-ictcp①">ictcp()</a> function,
	the allowed <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-5/#component-keyword" id="ref-for-component-keyword">component keywords</a> are:</p>
   <ul>
    <li data-md>
     <p><dfn class="css dfn-paneled" data-dfn-for="ictcp()" data-dfn-type="value" data-export id="valdef-ictcp-i">i</dfn> is a  <a class="css production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value⑨">&lt;number></a>
that corresponds to the <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-5/#origin-color" id="ref-for-origin-color">origin color’s</a> I (Lightness)
after <a data-link-type="dfn" href="https://drafts.csswg.org/css-color-5/#required-conversion" id="ref-for-required-conversion">conversion, if required</a>, to ictcp.
1.0 is equivalent to 100%.</p>
    <li data-md>
     <p><dfn class="css dfn-paneled" data-dfn-for="ictcp()" data-dfn-type="value" data-export id="valdef-ictcp-ct">ct</dfn> and <dfn class="css dfn-paneled" data-dfn-for="ictcp()" data-dfn-type="value" data-export id="valdef-ictcp-cp">cp</dfn> are <a class="css production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value①⓪">&lt;number></a>s
that correspond to the <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-5/#origin-color" id="ref-for-origin-color①">origin color’s</a> ct and cp axes
after <a data-link-type="dfn" href="https://drafts.csswg.org/css-color-5/#required-conversion" id="ref-for-required-conversion①">conversion, if required</a>, to ictcp.
0.5 is equivalent to 100%, while -0.5 is equivalent to -100%.</p>
    <li data-md>
     <p><dfn class="css dfn-paneled" data-dfn-for="ictcp()" data-dfn-type="value" data-export id="valdef-ictcp-alpha">alpha</dfn> is a <a class="css production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value①①">&lt;number></a> that corresponds to the
<a data-link-type="dfn" href="https://www.w3.org/TR/css-color-5/#origin-color" id="ref-for-origin-color②">origin color’s</a> alpha transparency. 1.0 is equivalent to 100%.</p>
   </ul>
   <h3 class="heading settled" data-level="6.4" id="Jzazbz"><span class="secno">6.4. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="jzazbz">Jzazbz</dfn></span><a class="self-link" href="#Jzazbz"></a></h3>
   <p>The <span class="css">Jzazbz</span> color space accepts three numeric parameters,
		with J<sub>z</sub> representing the Lightness (similar to L in Lab)
		while a<sub>z</sub> and b<sub>z</sub> represent the
		redness-greenness and yellowness-blueness
		opponent-color axes (similar to a and b in Lab).</p>
   <p><span class="css">Jzazbz</span> has the following characteristics:</p>
   <table>
    <thead>
     <td>
     <td>x
     <td>y
    <tbody>
     <tr>
      <th>White chromaticity
      <td colspan="2"><a data-link-type="dfn" href="https://www.w3.org/TR/css-color-4/#d65" id="ref-for-d65②">D65</a>
     <tr>
      <th>Transfer function
      <td colspan="2">Perceptual Quantizer
     <tr>
      <th>Peak white luminance
      <td colspan="2">10,000 cd/m²
     <tr>
      <th>Black luminance
      <td colspan="2">0.001 cd/m²
     <tr>
      <th>Image state
      <td colspan="2">display-referred
     <tr>
      <th>Percentages
      <td colspan="2">Allowed for Jz, az and bz
     <tr>
      <th>Percent reference range
      <td>for Jz: 0% = 0.0, 100% = 1.0<br>
				for az and bz: -100% = -0.21, 100% = 0.21
   </table>
   <p>Note that unlike Lab, a <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-4/#d65" id="ref-for-d65③">D65</a> whitepoint is used.
		Thus, for most RGB spaces
		(which also use a D65 whitepoint)
		no chromatic adaptation step need be performed.</p>
   <p><a href="#jzazbz_code">Sample code</a>
		for converting between XYZ-D65 and <span class="css">Jzazbz</span> 
		is provided.</p>
   <div class="example" id="example-1fad9c22">
    <a class="self-link" href="#example-1fad9c22"></a>
			This color represents a comfortable "diffuse white"
			This color can be displayed for long periods,
			or used for subtitles,
			on any sized area of the screen.
			It is the same color as sRGB <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-4/#valdef-color-white" id="ref-for-valdef-color-white⑤">white</a>.
			Diffuse white is 203 cd/m²  <a data-link-type="biblio" href="#biblio-rec_bt2100" title="ITU-R BT.2100-3 Image parameter values for high dynamic range television for use in production and international programme exchange">[Rec_BT.2100]</a>.
			
<pre><span class="swatch" style="--color: white"></span> jzazbz(0.22207 -0.00016 -0.00012)
</pre>
   </div>
   <p>Within a <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-5/#relative-color" id="ref-for-relative-color①">relative color</a> syntax <a class="css" data-link-type="maybe" href="#funcdef-jzazbz" id="ref-for-funcdef-jzazbz①">jzazbz()</a> function,
		the allowed <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-5/#component-keyword" id="ref-for-component-keyword①">component keywords</a> are:</p>
   <ul>
    <li data-md>
     <p><dfn class="css dfn-paneled" data-dfn-for="jzazbz()" data-dfn-type="value" data-export id="valdef-jzazbz-j">j</dfn> is a  <a class="css production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value①②">&lt;number></a>
that corresponds to the <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-5/#origin-color" id="ref-for-origin-color③">origin color’s</a>  Jz (Lightness)
after <a data-link-type="dfn" href="https://drafts.csswg.org/css-color-5/#required-conversion" id="ref-for-required-conversion②">conversion, if required</a>, to jzazbz.
1.0 is equivalent to 100%.</p>
    <li data-md>
     <p><dfn class="css dfn-paneled" data-dfn-for="jzazbz()" data-dfn-type="value" data-export id="valdef-jzazbz-a">a</dfn> and <dfn class="css dfn-paneled" data-dfn-for="jzazbz()" data-dfn-type="value" data-export id="valdef-jzazbz-b">b</dfn> are <a class="css production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value①③">&lt;number></a>s
that correspond to the <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-5/#origin-color" id="ref-for-origin-color④">origin color’s</a> az and bz axes
after <a data-link-type="dfn" href="https://drafts.csswg.org/css-color-5/#required-conversion" id="ref-for-required-conversion③">conversion, if required</a>, to jzazbz.
0.21 is equivalent to 100%, while -0.21 is equivalent to -100%.</p>
    <li data-md>
     <p><dfn class="css dfn-paneled" data-dfn-for="jzazbz()" data-dfn-type="value" data-export id="valdef-jzazbz-alpha">alpha</dfn> is a <a class="css production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value①④">&lt;number></a> that corresponds to the
<a data-link-type="dfn" href="https://www.w3.org/TR/css-color-5/#origin-color" id="ref-for-origin-color⑤">origin color’s</a> alpha transparency. 1.0 is equivalent to 100%.</p>
   </ul>
   <h3 class="heading settled" data-level="6.5" id="JzCzhz"><span class="secno">6.5. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="jzczhz">JzCzhz</dfn></span><a class="self-link" href="#JzCzhz"></a></h3>
   <p>Similar to LCH, which is the polar representation of Lab,
		<span class="css">JzCzhz</span> is the polar form of <span class="css">Jzazbz</span>.</p>
   <p>J<sub>z</sub> is identical to  the value in <span class="css">Jzazbz</span> and represents the Lightness,
		while C<sub>z</sub> represents the Chroma or colorfulness
		and h<sub>z</sub> represents a hue angle,
		measured from the positive a<sub>z</sub> axis,
		towards the positive b<sub>z</sub> axis.</p>
   <p>It has the following characteristics:</p>
   <table>
    <thead>
     <td>
     <td>x
     <td>y
    <tbody>
     <tr>
      <th>White chromaticity
      <td colspan="2"><a data-link-type="dfn" href="https://www.w3.org/TR/css-color-4/#d65" id="ref-for-d65④">D65</a>
     <tr>
      <th>Transfer function
      <td colspan="2">Perceptual Quantizer
     <tr>
      <th>Peak white luminance
      <td colspan="2">10,000 cd/m²
     <tr>
      <th>Black luminance
      <td colspan="2">0.001 cd/m²
     <tr>
      <th>Image state
      <td colspan="2">display-referred
     <tr>
      <th>Percentages
      <td colspan="2">Allowed for Jz and Cz
     <tr>
      <th>Percent reference range
      <td>for Jz: 0% = 0.0, 100% = 1.0<br>
				for Cz: 0% = 0.0, 100% = 0.26
     <tr>
      <th>Powerless hue ε 
      <td>Cz &lt;= 0.0000026
   </table>
   <div class="example" id="example-86e60443">
    <a class="self-link" href="#example-86e60443"></a>
			This color represents the sRGB color "lime" in <span class="css">Jzazbz</span>
			
<pre><span class="swatch" style="--color: lime"></span> jzazbz(0.17542 -0.1179 0.1092)
</pre>
    
			and here is the same color in the polar form
			
<pre><span class="swatch" style="--color: lime"></span> jzczhz(0.17542 0.1614 132.50)
</pre>
   </div>
   <p>Within a <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-5/#relative-color" id="ref-for-relative-color②">relative color</a> syntax <a class="css" data-link-type="maybe" href="#funcdef-jzczhz" id="ref-for-funcdef-jzczhz①">jzczhz()</a> function,
		the allowed <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-5/#component-keyword" id="ref-for-component-keyword②">component keywords</a> are:</p>
   <ul>
    <li data-md>
     <p><dfn class="css dfn-paneled" data-dfn-for="jzczhz()" data-dfn-type="value" data-export id="valdef-jzczhz-j">j</dfn> is a <a class="css production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value①⑤">&lt;number></a>
that corresponds to the <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-5/#origin-color" id="ref-for-origin-color⑥">origin color’s</a> Jz (Lightness)
after <a data-link-type="dfn" href="https://drafts.csswg.org/css-color-5/#required-conversion" id="ref-for-required-conversion④">conversion, if required</a>, to jzczhz.
100 is equivalent to 100%.</p>
    <li data-md>
     <p><dfn class="css dfn-paneled" data-dfn-for="jzczhz()" data-dfn-type="value" data-export id="valdef-jzczhz-c">c</dfn> is a  <a class="css production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value①⑥">&lt;number></a>
that corresponds to the <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-5/#origin-color" id="ref-for-origin-color⑦">origin color’s</a> Cz (chroma)
after <a data-link-type="dfn" href="https://drafts.csswg.org/css-color-5/#required-conversion" id="ref-for-required-conversion⑤">conversion, if required</a>, to jzczhz.
0.26 is equivalent to 100%.</p>
    <li data-md>
     <p><dfn class="css dfn-paneled" data-dfn-for="jzczhz()" data-dfn-type="value" data-export id="valdef-jzczhz-h">h</dfn> is a <a class="css production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value①⑦">&lt;number></a>
that corresponds to the <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-5/#origin-color" id="ref-for-origin-color⑧">origin color’s</a> hz (hue), in degrees,
after <a data-link-type="dfn" href="https://drafts.csswg.org/css-color-5/#required-conversion" id="ref-for-required-conversion⑥">conversion, if required</a>, to jzczhz,
normalized to a [0, 360] range. 90 is equivalent to 90deg.</p>
    <li data-md>
     <p><dfn class="css dfn-paneled" data-dfn-for="jzczhz()" data-dfn-type="value" data-export id="valdef-jzczhz-alpha">alpha</dfn> is a <a class="css production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value①⑧">&lt;number></a> that corresponds to the
<a data-link-type="dfn" href="https://www.w3.org/TR/css-color-5/#origin-color" id="ref-for-origin-color⑨">origin color’s</a> alpha transparency. 1.0 is equivalent to 100%.</p>
   </ul>
   <h4 class="heading settled" data-level="6.5.1" id="Jzazbz-to-JzCzHz"><span class="secno">6.5.1. </span><span class="content">
		Converting <span class="css">Jzazbz</span> colors to <span class="css">JzCzhz</span> colors</span><a class="self-link" href="#Jzazbz-to-JzCzHz"></a></h4>
   <p>Conversion to <span class="css">JzCzhz</span> is trivial:</p>
   <ol>
    <li>hz = atan2(bz, az) // but convert to degrees!
				
    <li>Cz = sqrt(az^2 + bz^2)
				
    <li>Jz is the same
			
   </ol>
   <p>In addition, practical code should return a <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-4/#valdef-color-none" id="ref-for-valdef-color-none">none</a> value if Cz is less than ε.</p>
   <h4 class="heading settled" data-level="6.5.2" id="JzCzHz-to-Jzazbz"><span class="secno">6.5.2. </span><span class="content">
	Converting JzCzhz colors to Jzazbz  colors</span><a class="self-link" href="#JzCzHz-to-Jzazbz"></a></h4>
   <p>Conversion to <span class="css">Jzazbz</span> is trivial:</p>
   <ol>
    <li>az = Cz cos(H) 	// convert to radians first!
				
    <li>bz = Cz sin(H)	// convert to radians first!
				
    <li>Jz is the same
			
   </ol>
   <p>In addition, practical code should check for a <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-4/#valdef-color-none" id="ref-for-valdef-color-none①">none</a> value
			for hz.</p>
   <h2 class="heading settled" data-level="7" id="color-function"><span class="secno">7. </span><span class="content">
	Specifying Predefined and Custom Color Spaces: the <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-5/#funcdef-color" id="ref-for-funcdef-color①">color()</a> Function
</span><a class="self-link" href="#color-function"></a></h2>
   <p>The <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-5/#funcdef-color" id="ref-for-funcdef-color②">color()</a> function allows a color to be specified
	in a particular, given <a data-link-type="dfn" href="https://www.w3.org/TR/css-color-4/#color-space" id="ref-for-color-space">color space</a>
	(rather than the implicit sRGB color space that most of the other color functions operate in).</p>
   <p>This specification extends the <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-5/#funcdef-color" id="ref-for-funcdef-color③">color()</a> function
	to allow <a href="#predefined-HDR">predefined color spaces for HDR</a>,
	in addition to the predefined SDR spaces from <a href="https://www.w3.org/TR/css-color-4/#predefined"><cite>CSS Color 4</cite> §  10. Predefined Color Spaces</a>
	and the relative color syntax from <a href="https://www.w3.org/TR/css-color-5/#relative-colors"><cite>CSS Color 5</cite> § 4 Relative Colors</a>.</p>
   <p>Its syntax is now as follows:</p>
<pre class="prod"><dfn class="dfn-paneled" data-dfn-type="type" data-export id="typedef-predefined-rgb">&lt;predefined-rgb></dfn> = srgb <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one③⑥">|</a> srgb-linear <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one③⑦">|</a> display-p3 <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one③⑧">|</a> display-p3-linear <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one③⑨">|</a> a98-rgb <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one④⓪">|</a> prophoto-rgb <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one④①">|</a> rec2020 <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one④②">|</a> 
  rec2100-pq <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one④③">|</a> rec2100-hlg <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one④④">|</a> rec2100-linear
</pre>
   <h2 class="heading settled" data-level="8" id="predefined-HDR"><span class="secno">8. </span><span class="content">Predefined color spaces for HDR:</span><a class="self-link" href="#predefined-HDR"></a></h2>
   <p>In addition to the <a href="https://drafts.csswg.org/css-color-4/#predefined">SDR
	color spaces</a> defined by CSS Color 4, the following HDR color spaces are defined
	for use in the color function.</p>
   <p>Serialization of values in these new color spaces is identical to the description in <a href="https://www.w3.org/TR/css-color-4/#serializing-color-values"><cite>CSS Color 4</cite> §  15. Serializing &lt;color> Values</a>.</p>
   <h3 class="heading settled" data-level="8.1" id="valdef-color-rec2100-pq"><span class="secno">8.1. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="rec2100-pq">rec2100-pq</dfn></span><a class="self-link" href="#valdef-color-rec2100-pq"></a></h3>
   <p>The <span class="css">rec2100-pq</span> <a data-link-type="biblio" href="#biblio-rec_bt2100" title="ITU-R BT.2100-3 Image parameter values for high dynamic range television for use in production and international programme exchange">[Rec_BT.2100]</a> color space accepts three numeric parameters,
	representing the red, green, and blue channels of the color,
	with each having a valid range of [0, 1]
	regardless of the actual bit depth (10 or 12 bits per component).</p>
   <p>The Perceptual Quantizer (PQ) electro-optical transfer function is used
	<a data-link-type="biblio" href="#biblio-smpte-st-2084" title="ST 2084:2014 - SMPTE Standard - High Dynamic Range Electro-Optical Transfer Function of Mastering Reference Displays">[SMPTE-ST-2084]</a>,<a data-link-type="biblio" href="#biblio-rec_bt2100" title="ITU-R BT.2100-3 Image parameter values for high dynamic range television for use in production and international programme exchange">[Rec_BT.2100]</a>.
	PQ assumes a reference viewing condition
	where the screen surround
	is at 5 cd/m².</p>
   <p>ITU Reference 2100 is used for HDR 4k and 8k television.</p>
   <p>It has the following characteristics:
	(The display primaries are the same as <a data-link-type="biblio" href="#biblio-rec2020" title="Recommendation  ITU-R  BT.2020-2:  Parameter values for ultra-high definition television systems for production and international programme exchange">[Rec.2020]</a>):</p>
   <table>
    <thead>
     <td>
     <td>x
     <td>y
    <tbody>
     <tr>
      <th>Red chromaticity
      <td>0.708
      <td>0.292
     <tr>
      <th>Green chromaticity
      <td>0.170
      <td>0.797
     <tr>
      <th>Blue chromaticity
      <td>0.131
      <td>0.046
     <tr>
      <th>White chromaticity
      <td colspan="2"><a data-link-type="dfn" href="https://www.w3.org/TR/css-color-4/#d65" id="ref-for-d65⑤">D65</a>
     <tr>
      <th>Transfer function
      <td colspan="2">Perceptual Quantizer
     <tr>
      <th>White luminance
      <td colspan="2">203 cd/m²
     <tr>
      <th>Peak white luminance
      <td colspan="2">10,000 cd/m²
     <tr>
      <th>Black luminance
      <td colspan="2">≤ 0.005 cd/m²
     <tr>
      <th>Image state
      <td colspan="2">display-referred
     <tr>
      <th>Percentages
      <td colspan="2">Allowed for R, G and B
     <tr>
      <th>Percent reference range
      <td>for R,G,B: 0% = 0.0, 100% = 1.0
   </table>
   <p>For narrow-range PQ video in a non-reference viewing environment,
	or for HLG (in any viewing environment), 
	the black level should be adjusted 
	using the PLUGE test signal and procedure 
	specified in <a data-link-type="biblio" href="#biblio-rec_bt814" title="Specifications of PLUGE test signals and alignment procedures for setting of brightness and contrast of displays">[Rec_BT.814]</a> Annex  . 
	For PQ values in CSS, which uses wide-range, 
	the black corresponds to code point 0.</p>
   <div class="example" id="example-dbd71f8e">
    <a class="self-link" href="#example-dbd71f8e"></a>
		This color represents a blinding white
		with a luminance of 10,000 cd/m².
		Such a bright color can only be displayed briefly,
		on a small area of the screen.
		Content is typically mastered with a lower peak white,
		such as 4,000  cd/m².
		
<pre><span class="oog swatch" style="--color: white"></span> color(rec2100-pq 1.0 1.0 1.0);
</pre>
   </div>
   <div class="example" id="example-f604e8a3">
    <a class="self-link" href="#example-f604e8a3"></a>
		This color represents a comfortable "diffuse white"
		This color can be displayed for long periods,
		or used for subtitles,
		on any sized area of the screen.
		It is the same color as sRGB <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-4/#valdef-color-white" id="ref-for-valdef-color-white⑥">white</a>.
		Diffuse white is 203 cd/m²  <a data-link-type="biblio" href="#biblio-rec_bt2100" title="ITU-R BT.2100-3 Image parameter values for high dynamic range television for use in production and international programme exchange">[Rec_BT.2100]</a>.
		
<pre><span class="swatch" style="--color: white"></span> color(rec2100-pq 0.58 0.58 0.58);
</pre>
    
		This color represents a mid grey,
		like a photographer’s "18% reflectance grey" card,
		at 17 cd/m².
		
<pre><span class="swatch" style="--color: rgb(46.632% 46.632% 46.632%)"></span> color(rec2100-pq 0.34 0.34 0.34)
</pre>
   </div>
   <p class="issue" id="issue-3762b88c"><a class="self-link" href="#issue-3762b88c"></a> add other examples, including encoding of sRGB red, green, blue and P3 red, green, blue.</p>
   <p>Linear-light RGB signals are converted to PQ encoded as follows.
	The maximum encodable value (peak, small-area white) in PQ is 10,000 cd/m². 
	HDR reference white is 203 cd/m² <a data-link-type="biblio" href="#biblio-rpt_bt2408" title="Report ITU-R BT.2408-0 Operational practices in HDR television production">[Rpt_BT.2408]</a>.</p>
<pre class="highlight lang-javascript"><c- a>var</c-> Er<c- p>;</c->			<c- c1>// the red, green or blue component, [0, 1] for SDR, [0, 70ish] for HDR</c->
<c- a>var</c-> Yw <c- o>=</c-> <c- mf>203</c-><c- p>;</c->	<c- c1>// the luminance of diffuse white, cd/m²</c->
<c- a>var</c-> x <c- o>=</c-> Er <c- o>*</c-> Yw <c- o>/</c-> <c- mf>10000</c-><c- p>;</c-> 	<c- c1>// luminance of peak white is 10,000 cd/m².</c->
<c- a>const</c-> n <c- o>=</c-> <c- mf>2610</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>14</c-><c- p>);</c->
<c- a>const</c-> m <c- o>=</c-> <c- mf>2523</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>5</c-><c- p>);</c->
<c- a>const</c-> c1 <c- o>=</c-> <c- mf>3424</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>12</c-><c- p>);</c->
<c- a>const</c-> c2 <c- o>=</c-> <c- mf>2413</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>7</c-><c- p>);</c->
<c- a>const</c-> c3 <c- o>=</c-> <c- mf>2392</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>7</c-><c- p>);</c->
xPQ <c- o>=</c-> <c- p>(((</c->c1 <c- o>+</c-> <c- p>(</c->c2 <c- o>*</c-> <c- p>(</c->x <c- o>**</c-> n<c- p>)))</c-> <c- o>/</c-> <c- p>(</c-><c- mf>1</c-> <c- o>+</c-> <c- p>(</c->c3 <c- o>*</c-> <c- p>(</c->x <c- o>**</c-> n<c- p>))))</c-> <c- o>**</c-> m<c- p>);</c->

</pre>
   
		xPQ is the "gamma-corrected" (OETF-adjusted) signal [0, 1].


   <p>PQ encoded values are converted to linear-light as follows:</p>
<pre class="highlight lang-javascript"><c- a>var</c-> xPQ<c- p>;</c->			<c- c1>// the red, green or blue PQ-encoded component, [0, 1]</c->
<c- a>const</c-> ninv <c- o>=</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>14</c-><c- p>)</c-> <c- o>/</c-> <c- mf>2610</c-><c- p>;</c->
<c- a>const</c-> minv <c- o>=</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>5</c-><c- p>)</c-> <c- o>/</c-> <c- mf>2523</c-><c- p>;</c->
<c- a>const</c-> c1 <c- o>=</c-> <c- mf>3424</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>12</c-><c- p>);</c->
<c- a>const</c-> c2 <c- o>=</c-> <c- mf>2413</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>7</c-><c- p>);</c->
<c- a>const</c-> c3 <c- o>=</c-> <c- mf>2392</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>7</c-><c- p>);</c->
<c- a>var</c-> x <c- o>=</c-> <c- p>(((</c->Math<c- p>.</c->max<c- p>(((</c->xPQ <c- o>**</c-> minv<c- p>)</c-> <c- o>-</c-> c1<c- p>),</c-> <c- mf>0</c-><c- p>)</c-> <c- o>/</c-> <c- p>(</c->c2 <c- o>-</c-> <c- p>(</c->c3 <c- o>*</c-> <c- p>(</c->xPQ <c- o>**</c-> minv<c- p>))))</c-> <c- o>**</c-> ninv<c- p>);</c->
<c- a>var</c-> Yw <c- o>=</c-> <c- mf>203</c-><c- p>;</c->			<c- c1>// the luminance of diffuse white, cd/m²</c->
<c- a>var</c-> Ea <c- o>=</c-> x <c- o>*</c-> <c- mf>10000</c-><c- p>;</c-> 	<c- c1>// luminance, [0, 10,000].</c->
<c- a>var</c-> Er <c- o>=</c-> x <c- o>*</c-> <c- mf>10000</c-> <c- o>/</c-> Yw<c- p>;</c-> 	<c- c1>// luminance relative to diffuse white, [0, 70 or so].</c->
</pre>
   <h3 class="heading settled" data-level="8.2" id="valdef-color-rec2100-hlg"><span class="secno">8.2. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="rec2100-hlg">rec2100-hlg</dfn></span><a class="self-link" href="#valdef-color-rec2100-hlg"></a></h3>
   <p>The <span class="css">rec2100-hlg</span> <a data-link-type="biblio" href="#biblio-rec_bt2100" title="ITU-R BT.2100-3 Image parameter values for high dynamic range television for use in production and international programme exchange">[Rec_BT.2100]</a> color space accepts three numeric parameters,
	representing the red, green, and blue channels of the color,
	with each having a valid range of [0, 1]
	regardless of the actual bit depth (10 or 12 bits per component).</p>
   <p>The Hybrid Log-Gamma (HLG) electro-optical transfer function
	is used <a data-link-type="biblio" href="#biblio-arib_std-b67" title="Essential Parameter Values for the Extended Image Dynamic Range Television (EIDRTV) System for Programme Production">[ARIB_STD-B67]</a>,<a data-link-type="biblio" href="#biblio-rec_bt2100" title="ITU-R BT.2100-3 Image parameter values for high dynamic range television for use in production and international programme exchange">[Rec_BT.2100]</a>.
	HLG can be used with displays of different brightness
	in a wide range of viewing environments,
	with user control of the overall brightness level.
	A value of 0.75 represents "diffuse" or "media" white
	while an "18% reflectance grey" card
	has a value of 0.38. <a data-link-type="biblio" href="#biblio-rec_bt2390" title="ITU-R BT.2390-8 High dynamic range television for production and international programme exchange">[Rec_BT.2390]</a>.</p>
   <p>It has the following characteristics:
	(The display primaries are the same as <a data-link-type="biblio" href="#biblio-rec2020" title="Recommendation  ITU-R  BT.2020-2:  Parameter values for ultra-high definition television systems for production and international programme exchange">[Rec.2020]</a>):</p>
   <table>
    <thead>
     <td>
     <td>x
     <td>y
    <tbody>
     <tr>
      <th>Red chromaticity
      <td>0.708
      <td>0.292
     <tr>
      <th>Green chromaticity
      <td>0.170
      <td>0.797
     <tr>
      <th>Blue chromaticity
      <td>0.131
      <td>0.046
     <tr>
      <th>White chromaticity
      <td colspan="2"><a data-link-type="dfn" href="https://www.w3.org/TR/css-color-4/#d65" id="ref-for-d65⑥">D65</a>
     <tr>
      <th>Transfer function
      <td colspan="2">Hybrid Log-Gamma
     <tr>
      <th>White luminance
      <td colspan="2">depends on viewing conditions
     <tr>
      <th>Peak white luminance
      <td colspan="2">12 times reference white
     <tr>
      <th>Black luminance
      <td colspan="2">depends on reference white, see text
     <tr>
      <th>Image state
      <td colspan="2">scene-referred
     <tr>
      <th>Percentages
      <td colspan="2">Allowed for R, G and B
     <tr>
      <th>Percent reference range
      <td>for R,G,B: 0% = 0.0, 100% = 1.0
   </table>
   <p>For narrow-range HLG video (in any viewing environment),
	the black level should be adjusted 
	using the PLUGE test signal and procedure 
	specified in <a data-link-type="biblio" href="#biblio-rec_bt814" title="Specifications of PLUGE test signals and alignment procedures for setting of brightness and contrast of displays">[Rec_BT.814]</a> Annex 4.</p>
   <p>For HLG values in CSS, which uses wide-range,
	the black corresponds to code point 0.</p>
   <p class="issue" id="issue-63bd5f3d"><a class="self-link" href="#issue-63bd5f3d"></a> add other examples</p>
   <div class="example" id="example-8d914a69">
    <a class="self-link" href="#example-8d914a69"></a>
		This color represents a comfortable "diffuse white"
		This color can be displayed for long periods,
		or used for subtitles,
		on any sized area of the screen.
		Content is typically mastered with a peak white
		of 1,000 to 4,000  cd/m²,
		so diffuse white will be 203 to 581 cd/m².
		
<pre><span class="swatch" style="--color: white"></span> color(rec2100-hlg 0.75 0.75 0.75);
</pre>
    
		This color represents a mid grey,
		at 26 to 104  cd/m².
		
<pre><span class="swatch" style="--color: rgb(46.632% 46.632% 46.632%)"></span> color(rec2100-hlg 0.38 0.38 0.38)
</pre>
   </div>
   <p>Linear-light RGB signals are converted to HLG encoded as follows <a data-link-type="biblio" href="#biblio-rec_bt2390" title="ITU-R BT.2390-8 High dynamic range television for production and international programme exchange">[Rec_BT.2390]</a>:</p>
<pre class="highlight lang-javascript"><c- a>var</c-> E<c- p>;</c->			<c- c1>// the red, green or blue component, [0, 1]</c->
<c- a>const</c-> a <c- o>=</c-> <c- mf>0.17883277</c-><c- p>;</c->
<c- a>const</c-> b <c- o>=</c-> <c- mf>0.28466892</c-><c- p>;</c->   <c- c1>// 1 - (4 * a)</c->
<c- a>const</c-> c <c- o>=</c-> <c- mf>0.55991073</c-><c- p>;</c->   <c- c1>// 0.5 - a * Math.log(4 *a)</c->
<c- c1>// handle negative values</c->
<c- a>var</c-> sign <c- o>=</c-> E <c- o>&lt;</c-> <c- mf>0</c-><c- o>?</c-> <c- o>-</c-><c- mf>1</c-> <c- o>:</c-> <c- mf>1</c-><c- p>;</c->
<c- a>var</c-> abs <c- o>=</c-> Math<c- p>.</c->abs<c- p>(</c->E<c- p>);</c->
<c- k>if</c-> <c- p>(</c->abs <c- o>&lt;=</c-> <c- mf>1</c-><c- o>/</c-><c- mf>12</c-><c- p>)</c-> <c- p>{</c->
  Edash <c- o>=</c-> sign <c- o>*</c-> Math<c- p>.</c->sqrt<c- p>(</c-> <c- mf>3</c-> <c- o>*</c-> abs<c- p>);</c->
<c- p>}</c->
<c- k>else</c-> <c- p>{</c->
  Edash <c- o>=</c-> a <c- o>*</c-> Math<c- p>.</c->log<c- p>(</c-><c- mf>12</c-> <c- o>*</c-> E <c- o>-</c-> b<c- p>)</c-> <c- o>+</c-> c<c- p>;</c->
<c- p>}</c->
</pre>
   
		Edash is the "gamma-corrected" (OETF-adjusted) signal.


   <p>The reverse conversion (HLG encoded to linear light) is as follows  <a data-link-type="biblio" href="#biblio-rec_bt2390" title="ITU-R BT.2390-8 High dynamic range television for production and international programme exchange">[Rec_BT.2390]</a>::</p>
<pre class="highlight lang-javascript"><c- a>var</c-> Edash<c- p>;</c->			<c- c1>// the red, green or blue encoded component, [0, 1]</c->
<c- a>const</c-> a <c- o>=</c-> <c- mf>0.17883277</c-><c- p>;</c->
<c- a>const</c-> b <c- o>=</c-> <c- mf>0.28466892</c-><c- p>;</c->   <c- c1>// 1 - (4 * a)</c->
<c- a>const</c-> c <c- o>=</c-> <c- mf>0.55991073</c-><c- p>;</c->   <c- c1>// 0.5 - a * Math.log(4 *a)</c->
<c- k>if</c-> <c- p>(</c->Edash <c- o>&lt;=</c-> <c- mf>0.5</c-><c- p>)</c-> <c- p>{</c->
  E <c- o>=</c-> <c- p>(</c->Edash <c- o>**</c-> <c- mf>2</c-><c- p>)</c-> <c- o>/</c-> <c- mf>3</c-><c- p>;</c->
<c- p>}</c->
<c- k>else</c-> <c- p>{</c->
  E <c- o>=</c-> <c- p>(</c->Math<c- p>.</c->exp<c- p>((</c->Edash <c- o>-</c-> c<c- p>)</c-> <c- o>/</c-> a<c- p>)</c-> <c- o>+</c-> b<c- p>)</c-> <c- o>/</c-> <c- mf>12</c-><c- p>;</c->
<c- p>}</c->
</pre>
   <p class="issue" id="issue-fb589d17"><a class="self-link" href="#issue-fb589d17"></a> add black level lift Β as defined on same page?</p>
   <h3 class="heading settled" data-level="8.3" id="valdef-color-rec2100-linear"><span class="secno">8.3. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="rec2100-linear">rec2100-linear</dfn></span><a class="self-link" href="#valdef-color-rec2100-linear"></a></h3>
   <p>The <span class="css">rec2100-linear</span> <a data-link-type="biblio" href="#biblio-rec_bt2100" title="ITU-R BT.2100-3 Image parameter values for high dynamic range television for use in production and international programme exchange">[Rec_BT.2100]</a> color space accepts three numeric parameters,
	representing the red, green, and blue channels of the color,
	with each having a nominal range of [0, 1]
	regardless of the actual bit depth (10 or 12 bits per component).</p>
   <p>The color with red, green and blue all at 1.0
	represents <a data-link-type="dfn" href="#hdr-reference-white" id="ref-for-hdr-reference-white①">HDR reference white</a> with a luminance of 
	203 cd/m².</p>
<pre class="highlight lang-css"><c- nf>color</c-><c- p>(</c->rec2100-linear <c- m>1</c-> <c- m>1</c-> <c- m>1</c-><c- p>)</c-></pre>
   <div class="example" id="example-bda29122">
    <a class="self-link" href="#example-bda29122"></a>
		For example, the following color

		
<pre class="highlight lang-css"><c- nf>color</c-><c- p>(</c->rec2100-linear <c- m>9.852</c-> <c- m>9.852</c-> <c- m>9.852</c-><c- p>)</c-></pre>
    <p>represents a white highlight
		with a luminance
		of 9.852 × 203 = 1,999 cd/m².</p>
   </div>
   <div class="example" id="example-071a1469">
    <a class="self-link" href="#example-071a1469"></a>
		This color represents a comfortable "diffuse white"
		This color can be displayed for long periods,
		or used for subtitles,
		on any sized area of the screen.
		It is the same color as sRGB <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-4/#valdef-color-white" id="ref-for-valdef-color-white⑦">white</a>.
		Diffuse white is 203 cd/m²  <a data-link-type="biblio" href="#biblio-rec_bt2100" title="ITU-R BT.2100-3 Image parameter values for high dynamic range television for use in production and international programme exchange">[Rec_BT.2100]</a>.
		
<pre><span class="swatch" style="--color: white"></span> color(rec2100-linear 1 1 1)
</pre>
   </div>
   <p>A linear-light electro-optical transfer function is used.</p>
   <p>It has the following characteristics:
	(The display primaries are the same as <a data-link-type="biblio" href="#biblio-rec2020" title="Recommendation  ITU-R  BT.2020-2:  Parameter values for ultra-high definition television systems for production and international programme exchange">[Rec.2020]</a>):</p>
   <table>
    <thead>
     <td>
     <td>x
     <td>y
    <tbody>
     <tr>
      <th>Red chromaticity
      <td>0.708
      <td>0.292
     <tr>
      <th>Green chromaticity
      <td>0.170
      <td>0.797
     <tr>
      <th>Blue chromaticity
      <td>0.131
      <td>0.046
     <tr>
      <th>White chromaticity
      <td colspan="2"><a data-link-type="dfn" href="https://www.w3.org/TR/css-color-4/#d65" id="ref-for-d65⑦">D65</a>
     <tr>
      <th>Transfer function
      <td colspan="2">Linear
     <tr>
      <th>White luminance
      <td colspan="2">203 cd/m²
     <tr>
      <th>Peak white luminance
      <td colspan="2">10,000 cd/m²
     <tr>
      <th>Black luminance
      <td colspan="2">0.001 cd/m²
     <tr>
      <th>Image state
      <td colspan="2">display-referred
     <tr>
      <th>Percentages
      <td colspan="2">Allowed for R, G and B
     <tr>
      <th>Percent reference range
      <td>for R,G,B: 0% = 0.0, 100% = 1.0
   </table>
   <h2 class="heading settled" data-level="9" id="Compositing-SDR-HDR"><span class="secno">9. </span><span class="content">Compositing SDR and HDR content</span><a class="self-link" href="#Compositing-SDR-HDR"></a></h2>
   <p>Compositing should take place in CIE XYZ,
as it is a linear-light space without gamut limitations.
Implementations may chose to composite in a linear-light RGB space instead,
which will give the same result
provided out-of-gamut values (negative, or greater than 100%)
are correctly handled
and not clipped or gamut mapped until
the final transfer to the device color space.</p>
   <p>HDR using the HLG transfer function,
must map SDR HDR reference white
to the same luminance as is used
to display the 75% HLG value. <a data-link-type="biblio" href="#biblio-smpte-st-2084" title="ST 2084:2014 - SMPTE Standard - High Dynamic Range Electro-Optical Transfer Function of Mastering Reference Displays">[SMPTE-ST-2084]</a></p>
   <p>For further details, see also tables 3 and 4 in ITU Rpt_BT.2408-0 <a data-link-type="biblio" href="#biblio-rpt_bt2408" title="Report ITU-R BT.2408-0 Operational practices in HDR television production">[Rpt_BT.2408]</a></p>
   <p>HDR using the PQ transfer function,
should map SDR HDR reference white
to 203 cd/m², the same luminance as is used
to display the 58% PQ value. <a data-link-type="biblio" href="#biblio-smpte-st-2084" title="ST 2084:2014 - SMPTE Standard - High Dynamic Range Electro-Optical Transfer Function of Mastering Reference Displays">[SMPTE-ST-2084]</a>.</p>
   <p>However, implementations may chose to incorporate
a color re-rendering step
to account for non-reference viewing conditions.</p>
   <h2 class="heading settled" data-level="10" id="serializing-color-values"><span class="secno">10. </span><span class="content">
Serializing <a class="css production" data-link-type="type" href="https://www.w3.org/TR/css-color-5/#typedef-color" id="ref-for-typedef-color⑥">&lt;color></a> Values</span><a class="self-link" href="#serializing-color-values"></a></h2>
   <h3 class="heading settled" data-level="10.1" id="serializing-color-function-values"><span class="secno">10.1. </span><span class="content">
Serializing values of the <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-5/#funcdef-color" id="ref-for-funcdef-color④">color()</a> function</span><a class="self-link" href="#serializing-color-function-values"></a></h3>
   <p>This section extends <a href="https://www.w3.org/TR/css-color-4/#serializing-color-function-values"><cite>CSS Color 4</cite> § 15.5 Serializing values of the color() function</a></p>
   <p>The serialized form of <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-color-5/#funcdef-color" id="ref-for-funcdef-color⑤">color()</a> values
	is derived from the <a data-link-type="dfn" href="https://www.w3.org/TR/css-cascade-5/#computed-value" id="ref-for-computed-value">computed value</a>
	and uses the <span class="css" id="ref-for-funcdef-color⑥">color()</span> form,
	with <a href="https://infra.spec.whatwg.org/#ascii-lowercase">ASCII lowercase</a> 
	letters for the function name
	and the color space name.</p>
   <p>The component values are serialized in base 10,
	as <a class="css production" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#number-value" id="ref-for-number-value①⑨">&lt;number></a>.
	A single ASCII space character " "
	must be used as the separator
	between the component values,
	and also between the color space name and the first color component.</p>
   <p>For the predefined HDR color spaces,
	the <em>minimum</em> precision for round-tripping is as follows:</p>
   <table class="data" id="predefined-precision-table">
    <tbody>
     <tr>
      <th>HDR color space
      <th>Minimum bits
     <tr>
      <td><span class="css">rec2100-pq</span>, <span class="css">rec2100-hlg</span>
      <td>10
     <tr>
      <td><span class="css">rec2100-linear</span>, <span class="css">jzazbz</span>, <span class="css">jzczhz</span>, <span class="css">ictcp</span>
      <td>16
   </table>
   <p>(16bit, half-float, or float <em>per component</em>
	is recommended for internal storage).
	Values must be <a href="https://drafts.csswg.org/css-values-4/#combine-integers">rounded towards +∞</a>, not truncated.</p>
   <h2 class="heading settled" data-level="11" id="color-conversion-code"><span class="secno">11. </span><span class="content">
	Sample code for Color Conversions</span><a class="self-link" href="#color-conversion-code"></a></h2>
   <p><em>This section is not normative.</em></p>
   <details class="wpt-tests-block" dir="ltr" lang="en" open>
    <summary>Tests</summary>
    <p>This section is not normative, it does not need tests.</p>
    <ul class="wpt-tests-list"></ul>
    <hr>
   </details>
   <p>For clarity, <a href="https://drafts.csswg.org/css-color-4/multiply-matrices.js">a library</a> is used for matrix multiplication.
	(This is more readable than inlining all the multiplies and adds).
	The matrices are in <a href="https://www.scratchapixel.com/lessons/mathematics-physics-for-computer-graphics/geometry/row-major-vs-column-major-vector">column-major order</a>.</p>
   <p>This code also assumes all of the conversion code from
	<a href="https://www.w3.org/TR/css-color-4/#color-conversion-code"><cite>CSS Color 4</cite> §  18. Sample code for Color Conversions</a> is available.</p>
   <p>The LMS used in <span class="css">Jzazbz</span> are not the same
	as the ones used in <span class="css">ICtCp</span>,
	take care to use the right ones!</p>
   <h3 class="heading settled" data-level="11.1" id="rec2100-linear_code"><span class="secno">11.1. </span><span class="content">
	Sample code for <span class="css">rec2100-linear</span>
</span><a class="self-link" href="#rec2100-linear_code"></a></h3>
   <p>The BT.2020 and BT.2100 color spaces
use the same RGB primaries and white point,
and both place HDR reference white at a component value of 1.0.</p>
<pre class="highlight include-code lang-javascript"><c- c1>// These functions use the color conversion functions from CSS Color 4</c->

<c- a>function</c-> XYZ_to_lin_2100<c- p>(</c->XYZ<c- p>)</c-> <c- p>{</c->
    <c- c1>// convert an array of D65 XYZ to linear-light BT.2100 RGB</c->
    <c- c1>// such that [0,0,0] is black and [1,1,1] is media white.</c->
    <c- c1>// component values greater than 1 indicate HDR colors</c->

    <c- k>return</c->  XYZ_to_lin_2020<c- p>(</c->XYZ<c- p>);</c->
<c- p>}</c->

<c- a>function</c-> lin_2100_to_XYZ<c- p>(</c->RGB<c- p>)</c-> <c- p>{</c->
    <c- c1>// convert an array of linear-light BT.2100 RGB values</c->
    <c- c1>// to D65 XYZ</c->

    <c- k>return</c-> lin_2020_to_XYZ<c- p>(</c->RGB<c- p>);</c->
<c- p>}</c-></pre>
   <h3 class="heading settled" data-level="11.2" id="rec2100-pq_code"><span class="secno">11.2. </span><span class="content">
	Sample code for <span class="css">rec2100-pq</span>
</span><a class="self-link" href="#rec2100-pq_code"></a></h3>
<pre class="highlight include-code lang-javascript"><c- a>function</c-> XYZ_to_pq_2100<c- p>(</c->XYZ<c- p>)</c-> <c- p>{</c->
    <c- c1>// convert an array of D65 XYZ to PQ-encoded BT.2100 RGB</c->
    <c- c1>// such that [0,0,0] is black and [1,1,1] is 10,000 cd/m^2 white;</c->
    <c- c1>// media white is at [0.5807,0.5807,0.5807] (to four significant figures).</c->

    <c- a>let</c-> linRGB <c- o>=</c-> XYZ_to_lin_2100<c- p>(</c->XYZ<c- p>);</c->
    <c- k>return</c-> pq_encode<c- p>(</c->linRGB<c- p>);</c->
<c- p>}</c->

<c- a>function</c-> pq_2100_to_XYZ<c- p>(</c->RGB<c- p>)</c-> <c- p>{</c->
    <c- c1>// convert an array of PQ-encoded BT.2100 RGB values</c->
    <c- c1>// to D65 XYZ</c->

    <c- a>let</c-> linRGB <c- o>=</c-> pq_decode<c- p>(</c->RGB<c- p>);</c->
    <c- k>return</c-> lin_2100_to_XYZ<c- p>(</c->linRGB<c- p>);</c->
<c- p>}</c->

<c- a>function</c-> pq_encode<c- p>(</c->RGB<c- p>)</c-> <c- p>{</c->

    <c- a>const</c-> Yw <c- o>=</c-> <c- mf>203</c-><c- p>;</c->    <c- c1>// absolute luminance of media white, cd/m²</c->
    <c- a>const</c-> n <c- o>=</c-> <c- mf>2610</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>14</c-><c- p>);</c->
    <c- a>const</c-> m <c- o>=</c-> <c- mf>2523</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>5</c-><c- p>);</c->
    <c- a>const</c-> c1 <c- o>=</c-> <c- mf>3424</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>12</c-><c- p>);</c->
    <c- a>const</c-> c2 <c- o>=</c-> <c- mf>2413</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>7</c-><c- p>);</c->
    <c- a>const</c-> c3 <c- o>=</c-> <c- mf>2392</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>7</c-><c- p>);</c->

    <c- c1>// given PQ encoded component in range [0, 1]</c->
    <c- c1>// return media-white relative linear-light</c->
    <c- k>return</c-> RGB<c- p>.</c->map<c- p>(</c-><c- a>function</c-> <c- p>(</c->val<c- p>)</c-> <c- p>{</c->
        <c- a>let</c-> x <c- o>=</c-> Math<c- p>.</c->max<c- p>(</c->val <c- o>*</c-> Yw <c- o>/</c-> <c- mf>10000</c-><c- p>,</c-> <c- mf>0</c-><c- p>);</c->     <c- c1>// absolute luminance of peak white is 10,000 cd/m².</c->
        <c- a>let</c-> num <c- o>=</c-> <c- p>(</c->c1 <c- o>+</c-> <c- p>(</c->c2 <c- o>*</c-> <c- p>(</c->x <c- o>**</c-> n<c- p>)));</c->
        <c- a>let</c-> denom <c- o>=</c-> <c- p>(</c-><c- mf>1</c-> <c- o>+</c-> <c- p>(</c->c3 <c- o>*</c-> <c- p>(</c->x <c- o>**</c-> n<c- p>)));</c->

        <c- k>return</c-> <c- p>((</c->num <c- o>/</c-> denom<c- p>)</c->  <c- o>**</c-> m<c- p>);</c->
    <c- p>});</c->
<c- p>}</c->

<c- a>function</c-> pq_decode<c- p>(</c->RGB<c- p>)</c-> <c- p>{</c->

    <c- a>const</c-> Yw <c- o>=</c-> <c- mf>203</c-><c- p>;</c->    <c- c1>// absolute luminance of media white, cd/m²</c->
    <c- a>const</c-> ninv <c- o>=</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>14</c-><c- p>)</c-> <c- o>/</c-> <c- mf>2610</c-><c- p>;</c->
    <c- a>const</c-> minv <c- o>=</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>5</c-><c- p>)</c-> <c- o>/</c-> <c- mf>2523</c-><c- p>;</c->
    <c- a>const</c-> c1 <c- o>=</c-> <c- mf>3424</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>12</c-><c- p>);</c->
    <c- a>const</c-> c2 <c- o>=</c-> <c- mf>2413</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>7</c-><c- p>);</c->
    <c- a>const</c-> c3 <c- o>=</c-> <c- mf>2392</c-> <c- o>/</c-> <c- p>(</c-><c- mf>2</c-> <c- o>**</c-> <c- mf>7</c-><c- p>);</c->

    <c- c1>// given PQ encoded component in range [0, 1]</c->
    <c- c1>// return media-white relative linear-light</c->
    <c- k>return</c-> RGB<c- p>.</c->map<c- p>(</c-><c- a>function</c-> <c- p>(</c->val<c- p>)</c-> <c- p>{</c->
        <c- a>let</c-> x <c- o>=</c-> <c- p>((</c->Math<c- p>.</c->max<c- p>(((</c->val <c- o>**</c-> minv<c- p>)</c-> <c- o>-</c-> c1<c- p>),</c-> <c- mf>0</c-><c- p>)</c-> <c- o>/</c-> <c- p>(</c->c2 <c- o>-</c-> <c- p>(</c->c3 <c- o>*</c-> <c- p>(</c->val <c- o>**</c-> minv<c- p>))))</c-> <c- o>**</c-> ninv<c- p>);</c->
        <c- k>return</c-> <c- p>(</c->x <c- o>*</c-> <c- mf>10000</c-> <c- o>/</c-> Yw<c- p>);</c->     <c- c1>// luminance relative to diffuse white, [0, 70 or so].</c->
    <c- p>});</c->
<c- p>}</c-></pre>
   <h3 class="heading settled" data-level="11.3" id="rec2100-hlg_code"><span class="secno">11.3. </span><span class="content">
	Sample code for <span class="css">rec2100-hlg</span>
</span><a class="self-link" href="#rec2100-hlg_code"></a></h3>
<pre class="highlight include-code lang-javascript"><c- a>function</c-> XYZ_to_hlg_2100<c- p>(</c->XYZ<c- p>)</c-> <c- p>{</c->
    <c- c1>// convert an array of D65 XYZ to HLG-encoded BT.2100 RGB</c->
    <c- c1>// such that [0,0,0] is black and [0.75,0.75,0.75] is media white</c->

    <c- a>let</c-> linRGB <c- o>=</c-> XYZ_to_lin_2100<c- p>(</c->XYZ<c- p>);</c->
    <c- k>return</c-> hlg_encode<c- p>(</c->linRGB<c- p>);</c->
<c- p>}</c->

<c- a>function</c-> hlg_2100_to_XYZ<c- p>(</c->RGB<c- p>)</c-> <c- p>{</c->
    <c- c1>// convert an array of PQ-encoded BT.2100 RGB values</c->
    <c- c1>// to D65 XYZ</c->

    <c- a>let</c-> linRGB <c- o>=</c-> hlg_decode<c- p>(</c->RGB<c- p>);</c->
    <c- k>return</c-> lin_2100_to_XYZ<c- p>(</c->linRGB<c- p>);</c->
<c- p>}</c->

<c- a>function</c-> hlg_encode<c- p>(</c->RGB<c- p>)</c-> <c- p>{</c->

    <c- a>const</c-> a <c- o>=</c-> <c- mf>0.17883277</c-><c- p>;</c->
    <c- a>const</c-> b <c- o>=</c-> <c- mf>0.28466892</c-><c- p>;</c-> <c- c1>// 1 - (4 * a)</c->
    <c- a>const</c-> c <c- o>=</c-> <c- mf>0.55991073</c-><c- p>;</c-> <c- c1>// 0.5 - a * Math.log(4 *a)</c->
    <c- a>const</c-> scale <c- o>=</c-> <c- mf>3.7743</c-><c- p>;</c->    <c- c1>// Place 18% grey at HLG 0.38, so media white at 0.75</c->

    <c- k>return</c-> RGB<c- p>.</c->map<c- p>(</c-><c- a>function</c-> <c- p>(</c->val<c- p>)</c-> <c- p>{</c->
        <c- c1>// first scale to put linear-light media white at 1/3</c->
        val <c- o>/=</c-> scale<c- p>;</c->
        <c- c1>// now the HLG OETF</c->
        <c- c1>// ITU-R BT.2390-10 p.23</c->
        <c- c1>// 6.1 The hybrid log-gamma opto-electronic transfer function (OETF)</c->
        <c- k>if</c-> <c- p>(</c->val <c- o>&lt;=</c-> <c- mf>1</c-> <c- o>/</c-> <c- mf>12</c-><c- p>)</c-> <c- p>{</c->
            <c- k>return</c-> spow<c- p>(</c-><c- mf>3</c-> <c- o>*</c-> val<c- p>,</c-> <c- mf>0.5</c-><c- p>);</c->
        <c- p>}</c->
        <c- k>return</c-> a <c- o>*</c-> Math<c- p>.</c->log<c- p>(</c-><c- mf>12</c-> <c- o>*</c-> val <c- o>-</c-> b<c- p>)</c-> <c- o>+</c-> c<c- p>;</c->
    <c- p>});</c->
<c- p>}</c->

<c- a>function</c-> hlg_decode<c- p>(</c->RGB<c- p>)</c-> <c- p>{</c->

    <c- a>const</c-> a <c- o>=</c-> <c- mf>0.17883277</c-><c- p>;</c->
    <c- a>const</c-> b <c- o>=</c-> <c- mf>0.28466892</c-><c- p>;</c-> <c- c1>// 1 - (4 * a)</c->
    <c- a>const</c-> c <c- o>=</c-> <c- mf>0.55991073</c-><c- p>;</c-> <c- c1>// 0.5 - a * Math.log(4 *a)</c->
    <c- a>const</c-> scale <c- o>=</c-> <c- mf>3.7743</c-><c- p>;</c->    <c- c1>// Place 18% grey at HLG 0.38, so media white at 0.75</c->

    <c- k>return</c-> RGB<c- p>.</c->map<c- p>(</c-><c- a>function</c-> <c- p>(</c->val<c- p>)</c-> <c- p>{</c->
        <c- c1>// first the HLG EOTF</c->
        <c- c1>// ITU-R BT.2390-10 p.30 section</c->
        <c- c1>// 6.3 The hybrid log-gamma electro-optical transfer function (EOTF)</c->
        <c- c1>// Then scale by 3 so media white is 1.0</c->
        <c- k>if</c-> <c- p>(</c->val <c- o>&lt;=</c-> <c- mf>0.5</c-><c- p>)</c-> <c- p>{</c->
            <c- k>return</c-> <c- p>(</c->val <c- o>**</c-> <c- mf>2</c-><c- p>)</c-> <c- o>/</c-> <c- mf>3</c-> <c- o>*</c-> scale<c- p>;</c->
        <c- p>}</c->
        <c- k>return</c-> <c- p>((</c->Math<c- p>.</c->exp<c- p>((</c->val <c- o>-</c-> c<c- p>)</c-> <c- o>/</c-> a<c- p>)</c-> <c- o>+</c-> b<c- p>)</c-> <c- o>/</c-> <c- mf>12</c-><c- p>)</c-> <c- o>*</c-> scale<c- p>;</c->
    <c- p>});</c->
<c- p>}</c->

<c- a>function</c-> spow <c- p>(</c->base<c- p>,</c-> exp<c- p>)</c-> <c- p>{</c->
    <c- a>let</c-> sign <c- o>=</c-> base <c- o>&lt;</c-> <c- mf>0</c-><c- o>?</c-> <c- o>-</c-><c- mf>1</c-> <c- o>:</c-> <c- mf>1</c-><c- p>;</c->
    <c- k>return</c-> sign <c- o>*</c-> <c- p>(</c->Math<c- p>.</c->abs<c- p>(</c->base<c- p>)</c-> <c- o>**</c-> exp<c- p>);</c->
<c- p>}</c-></pre>
   <h3 class="heading settled" data-level="11.4" id="jzazbz_code"><span class="secno">11.4. </span><span class="content">
	Sample code for <span class="css">jzazbz</span>
</span><a class="self-link" href="#jzazbz_code"></a></h3>
   <p>This uses the same signed power (spow) function defined above.</p>
<pre class="highlight include-code lang-javascript"><c- a>function</c-> XYZ_to_Jzazbz <c- p>(</c->XYZ<c- p>)</c-> <c- p>{</c->
    <c- c1>// convert an array of D65 XYZ toJzAzBz</c->
    <c- c1>// such that [0,0,0] is black and</c->
    <c- c1>// media white is [0.2220, -0.00016, -0.0001]</c->

    <c- a>const</c-> Yw <c- o>=</c-> <c- mf>203</c-><c- p>;</c-> <c- c1>// absolute luminance of media white</c->
    <c- a>const</c-> M <c- o>=</c-> <c- p>[</c->
        <c- p>[</c->  <c- mf>0.41478972</c-><c- p>,</c-> <c- mf>0.579999</c-><c- p>,</c->  <c- mf>0.0146480</c-> <c- p>],</c->
        <c- p>[</c-> <c- o>-</c-><c- mf>0.2015100</c-><c- p>,</c->  <c- mf>1.120649</c-><c- p>,</c->  <c- mf>0.0531008</c-> <c- p>],</c->
        <c- p>[</c-> <c- o>-</c-><c- mf>0.0166008</c-><c- p>,</c->  <c- mf>0.264800</c-><c- p>,</c->  <c- mf>0.6684799</c-> <c- p>],</c->
    <c- p>];</c->
    <c- a>const</c-> b <c- o>=</c-> <c- mf>1.15</c-><c- p>;</c->
    <c- a>const</c-> g <c- o>=</c-> <c- mf>0.66</c-><c- p>;</c->

    <c- c1>// First make XYZ absolute, not relative to media white</c->
    <c- c1>// Maximum luminance in PQ is 10,000 cd/m²</c->
    <c- c1>// BT.2048 says media white Y=203  cd/m²</c->
    <c- a>let</c-> <c- p>[</c->Xa<c- p>,</c-> Ya<c- p>,</c-> Za<c- p>]</c-> <c- o>=</c-> XYZ<c- p>.</c->map<c- p>(</c->v <c- p>=></c-> v <c- o>*</c-> Yw<c- p>);</c->

    <c- c1>// then modify X and Y, to minimize blue curvature</c->
    <c- a>let</c-> Xm <c- o>=</c-> b <c- o>*</c-> Xa <c- o>-</c-> <c- p>(</c->b <c- o>-</c-> <c- mf>1</c-><c- p>)</c-> <c- o>*</c-> Za<c- p>;</c->
    <c- a>let</c-> Ym <c- o>=</c-> g <c- o>*</c-> Ya <c- o>-</c-> <c- p>(</c->g <c- o>-</c-> <c- mf>1</c-><c- p>)</c-> <c- o>*</c-> Xa<c- p>;</c->

    <c- c1>// now move to LMS cone domain</c->
    <c- a>let</c-> LMS <c- o>=</c-> multiplyMatrices<c- p>(</c->M<c- p>,</c-> <c- p>[</c->Xm<c- p>,</c-> Ym<c- p>,</c-> Za<c- p>]);</c->
    <c- k>return</c-> LMStoJzazbz<c- p>(</c->LMS<c- p>);</c->
<c- p>}</c->

<c- a>function</c-> LMStoJzazbz<c- p>(</c->LMS<c- p>)</c-> <c- p>{</c->

    <c- a>const</c-> M <c- o>=</c-> <c- p>[</c->
        <c- p>[</c->  <c- mf>0.5</c-><c- p>,</c->       <c- mf>0.5</c-><c- p>,</c->       <c- mf>0</c->        <c- p>],</c->
        <c- p>[</c->  <c- mf>3.524000</c-><c- p>,</c-> <c- o>-</c-><c- mf>4.066708</c-><c- p>,</c->  <c- mf>0.542708</c-> <c- p>],</c->
        <c- p>[</c->  <c- mf>0.199076</c-><c- p>,</c->  <c- mf>1.096799</c-><c- p>,</c-> <c- o>-</c-><c- mf>1.295875</c-> <c- p>],</c->
    <c- p>];</c->
    <c- a>const</c-> c1 <c- o>=</c-> <c- mf>3424</c-> <c- o>/</c-> <c- mf>2</c-> <c- o>**</c-> <c- mf>12</c-><c- p>;</c->
    <c- a>const</c-> c2 <c- o>=</c-> <c- mf>2413</c-> <c- o>/</c-> <c- mf>2</c-> <c- o>**</c-> <c- mf>7</c-><c- p>;</c->
    <c- a>const</c-> c3 <c- o>=</c-> <c- mf>2392</c-> <c- o>/</c-> <c- mf>2</c-> <c- o>**</c-> <c- mf>7</c-><c- p>;</c->
    <c- a>const</c-> n <c- o>=</c-> <c- mf>2610</c-> <c- o>/</c-> <c- mf>2</c-> <c- o>**</c-> <c- mf>14</c-><c- p>;</c->
    <c- a>const</c-> p <c- o>=</c-> <c- p>(</c-><c- mf>1.7</c-> <c- o>*</c-> <c- mf>2523</c-><c- p>)</c-> <c- o>/</c-> <c- mf>2</c-> <c- o>**</c-> <c- mf>5</c-><c- p>;</c->    <c- c1>// compared to usual PQ, 1.7 scale</c->
    <c- a>const</c-> d <c- o>=</c-> <c- o>-</c-><c- mf>0.56</c-><c- p>;</c->
    <c- a>const</c-> d0 <c- o>=</c-> <c- mf>1.6295499532821566e-11</c-><c- p>;</c->  <c- c1>// tiny shift to move black back to 0</c->


    <c- c1>// PQ-encode LMS</c->
    <c- a>let</c-> PQLMS <c- o>=</c-> <c- p>(</c->
        LMS<c- p>.</c->map<c- p>(</c-><c- a>function</c-> <c- p>(</c->val<c- p>)</c-> <c- p>{</c->
            <c- a>let</c-> num <c- o>=</c-> c1 <c- o>+</c-> c2 <c- o>*</c-> spow<c- p>((</c->val <c- o>/</c-> <c- mf>10000</c-><c- p>),</c-> n<c- p>);</c->
            <c- a>let</c-> denom <c- o>=</c-> <c- mf>1</c-> <c- o>+</c-> c3 <c- o>*</c-> spow<c- p>((</c->val <c- o>/</c-> <c- mf>10000</c-><c- p>),</c-> n<c- p>);</c->

            <c- k>return</c-> spow<c- p>((</c->num <c- o>/</c-> denom<c- p>),</c-> p<c- p>);</c->
        <c- p>})</c->
    <c- p>);</c->

    <c- c1>// calculate Iz az bz</c->
    <c- a>let</c-> <c- p>[</c->Iz<c- p>,</c-> az<c- p>,</c-> bz<c- p>]</c-> <c- o>=</c-> multiplyMatrices<c- p>(</c->M<c- p>,</c-> PQLMS<c- p>);</c->
    <c- c1>// now Jz from Iz</c->
    <c- a>let</c-> Jz <c- o>=</c-> <c- p>((</c-><c- mf>1</c-> <c- o>+</c-> d<c- p>)</c-> <c- o>*</c-> Iz<c- p>)</c-> <c- o>/</c-> <c- p>(</c-><c- mf>1</c-> <c- o>+</c-> d <c- o>*</c-> Iz<c- p>)</c-> <c- o>-</c-> d0<c- p>;</c->
    <c- k>return</c-> <c- p>[</c->Jz<c- p>,</c-> az<c- p>,</c-> bz<c- p>];</c->
<c- p>}</c->

<c- a>function</c-> Jzazbz_to_XYZ <c- p>(</c->Jzazbz<c- p>)</c-> <c- p>{</c->
    <c- c1>// convert an array of JzAzBz to D65 XYZ</c->
    <c- c1>// such that [0,0,0] is black and</c->
    <c- c1>// media white is [0.2220, -0.00016, -0.0001]</c->

    <c- a>const</c-> b <c- o>=</c-> <c- mf>1.15</c-><c- p>;</c->
    <c- a>const</c-> g <c- o>=</c-> <c- mf>0.66</c-><c- p>;</c->
    <c- a>const</c-> M <c- o>=</c-> <c- p>[</c->
        <c- p>[</c->  <c- mf>1.9242264357876067</c-><c- p>,</c->  <c- o>-</c-><c- mf>1.0047923125953657</c-><c- p>,</c->  <c- mf>0.037651404030618</c->   <c- p>],</c->
        <c- p>[</c->  <c- mf>0.35031676209499907</c-><c- p>,</c->  <c- mf>0.7264811939316552</c-><c- p>,</c-> <c- o>-</c-><c- mf>0.06538442294808501</c-> <c- p>],</c->
        <c- p>[</c-> <c- o>-</c-><c- mf>0.09098281098284752</c-><c- p>,</c-> <c- o>-</c-><c- mf>0.3127282905230739</c-><c- p>,</c->  <c- mf>1.5227665613052603</c->  <c- p>],</c->
    <c- p>];</c->

    <c- a>let</c-> LMS <c- o>=</c-> Jzazbz_to_LMS <c- p>(</c->Jzazbz<c- p>);</c->
    <c- c1>// modified absolute XYZ</c->
	<c- a>let</c-> <c- p>[</c->Xm<c- p>,</c-> Ym<c- p>,</c-> Za<c- p>]</c-> <c- o>=</c-> multiplyMatrices<c- p>(</c->LMS<c- p>,</c-> M<c- p>);</c->

    <c- c1>// un-modify X and Y to get D65 XYZ, relative to media white</c->
    <c- a>let</c-> Xa <c- o>=</c-> <c- p>(</c->Xm <c- o>+</c-> <c- p>(</c->b <c- o>-</c-> <c- mf>1</c-><c- p>)</c-> <c- o>*</c-> Za<c- p>)</c-> <c- o>/</c-> b<c- p>;</c->
    <c- a>let</c-> Ya <c- o>=</c-> <c- p>(</c->Ym <c- o>+</c-> <c- p>(</c->g <c- o>-</c-> <c- mf>1</c-><c- p>)</c-> <c- o>*</c-> Xa<c- p>)</c-> <c- o>/</c-> g<c- p>;</c->
    <c- k>return</c-> <c- p>[</c->Xa<c- p>,</c-> Ya<c- p>,</c-> Za<c- p>];</c->
<c- p>}</c->

<c- a>function</c-> Jzazbz_to_LMS <c- p>(</c->Jzazbz<c- p>)</c-> <c- p>{</c->

    <c- a>const</c-> d <c- o>=</c-> <c- o>-</c-><c- mf>0.56</c-><c- p>;</c->
    <c- a>const</c-> d0 <c- o>=</c-> <c- mf>1.6295499532821566e-11</c-><c- p>;</c->
    <c- a>const</c-> c1 <c- o>=</c-> <c- mf>3424</c-> <c- o>/</c-> <c- mf>2</c-> <c- o>**</c-> <c- mf>12</c-><c- p>;</c->
    <c- a>const</c-> c2 <c- o>=</c-> <c- mf>2413</c-> <c- o>/</c-> <c- mf>2</c-> <c- o>**</c-> <c- mf>7</c-><c- p>;</c->
    <c- a>const</c-> c3 <c- o>=</c-> <c- mf>2392</c-> <c- o>/</c-> <c- mf>2</c-> <c- o>**</c-> <c- mf>7</c-><c- p>;</c->
    <c- a>const</c-> pinv <c- o>=</c-> <c- mf>2</c-> <c- o>**</c-> <c- mf>5</c-> <c- o>/</c-> <c- p>(</c-><c- mf>1.7</c-> <c- o>*</c-> <c- mf>2523</c-><c- p>);</c->
    <c- a>const</c-> M <c- o>=</c-> <c- p>[</c->
        <c- p>[</c-> <c- mf>1</c-><c- p>,</c->  <c- mf>0.13860504327153927</c-><c- p>,</c->   <c- mf>0.05804731615611883</c->  <c- p>],</c->
        <c- p>[</c-> <c- mf>1</c-><c- p>,</c-> <c- o>-</c-><c- mf>0.1386050432715393</c-><c- p>,</c->   <c- o>-</c-><c- mf>0.058047316156118904</c-> <c- p>],</c->
        <c- p>[</c-> <c- mf>1</c-><c- p>,</c-> <c- o>-</c-><c- mf>0.09601924202631895</c-><c- p>,</c->  <c- o>-</c-><c- mf>0.81189189605603900</c->  <c- p>],</c->
    <c- p>];</c->

    <c- a>let</c-> <c- p>[</c->Jz<c- p>,</c-> az<c- p>,</c-> bz<c- p>]</c-> <c- o>=</c-> Jzazbz<c- p>;</c->
	<c- a>let</c-> Iz <c- o>=</c-> <c- p>(</c->Jz <c- o>+</c-> d0<c- p>)</c-> <c- o>/</c-> <c- p>(</c-><c- mf>1</c-> <c- o>+</c-> d <c- o>-</c-> d <c- o>*</c-> <c- p>(</c->Jz <c- o>+</c-> d0<c- p>));</c->

    <c- c1>// bring into LMS cone domain</c->
	<c- a>let</c-> PQLMS <c- o>=</c-> multiplyMatrices<c- p>([</c->Iz<c- p>,</c-> az<c- p>,</c-> bz<c- p>],</c-> M<c- p>);</c->

    <c- c1>// convert from PQ-coded to linear-light LMS</c->
    <c- a>let</c-> LMS <c- o>=</c-> <c- p>(</c->
        PQLMS<c- p>.</c->map<c- p>(</c-><c- a>function</c-> <c- p>(</c->val<c- p>)</c-> <c- p>{</c->
            <c- a>let</c-> num <c- o>=</c-> c1 <c- o>-</c-> spow<c- p>(</c->val<c- p>,</c-> pinv<c- p>);</c->
            <c- a>let</c-> denom <c- o>=</c-> c3 <c- o>*</c-> spow<c- p>(</c->val<c- p>,</c-> pinv<c- p>)</c-> <c- o>-</c-> c2<c- p>;</c->
            <c- a>let</c-> x <c- o>=</c-> <c- mf>10000</c-> <c- o>*</c-> spow<c- p>(</c->num <c- o>/</c-> denom<c- p>,</c-> ninv<c- p>);</c->

            <c- k>return</c-> x<c- p>;</c-> <c- c1>// luminance relative to diffuse white, [0, 70 or so].</c->
        <c- p>})</c->
    <c- p>);</c->
    <c- k>return</c-> LMS<c- p>;</c->
<c- p>}</c->
</pre>
   <h3 class="heading settled" data-level="11.5" id="ictcp_code"><span class="secno">11.5. </span><span class="content">
	Sample code for <span class="css">ICtCp</span>
</span><a class="self-link" href="#ictcp_code"></a></h3>
   <p>Rather than first requiring
conversion to <span class="css">rec2100-linear</span>,
which is how the conversion is defined in <a data-link-type="biblio" href="#biblio-rec_bt2100" title="ITU-R BT.2100-3 Image parameter values for high dynamic range television for use in production and international programme exchange">[Rec_BT.2100]</a>,
this sample code proceeds directly from absolute CIE XYZ
for compatibility with the other color conversion code.</p>
   <p>The 4% crosstalk matrix, and the hue rotation,
are also built into the XYZ to LMS step,
rather than being applied as three separate steps.</p>
   <p>The end result is identical, this just takes fewer steps.</p>
<pre class="highlight include-code lang-javascript">

<c- a>function</c-> XYZ_to_ICtCp <c- p>(</c->XYZ<c- p>)</c-> <c- p>{</c->
    <c- c1>// convert an array of D65 XYZ to ICtCp</c->

    <c- c1>// The matrix below includes the 4% crosstalk components</c->
    <c- c1>// and is from the procedure in the Dolby "What is ICtCp" paper"</c->
    <c- a>const</c-> M <c- o>=</c-> <c- p>[</c->
        <c- p>[</c->  <c- mf>0.3592832590121217</c-><c- p>,</c->  <c- mf>0.6976051147779502</c-><c- p>,</c-> <c- o>-</c-><c- mf>0.0358915932320290</c-> <c- p>],</c->
        <c- p>[</c-> <c- o>-</c-><c- mf>0.1920808463704993</c-><c- p>,</c->  <c- mf>1.1004767970374321</c-><c- p>,</c->  <c- mf>0.0753748658519118</c-> <c- p>],</c->
        <c- p>[</c->  <c- mf>0.0070797844607479</c-><c- p>,</c->  <c- mf>0.0748396662186362</c-><c- p>,</c->  <c- mf>0.8433265453898765</c-> <c- p>],</c->
    <c- p>];</c->

    <c- a>let</c-> LMS <c- o>=</c-> multiplyMatrices<c- p>(</c->M<c- p>,</c-> XYZ<c- p>.</c->map<c- p>(</c->v <c- p>=></c-> v <c- o>*</c-> Yw<c- p>));</c->
    <c- k>return</c-> LMStoICtCp<c- p>(</c->LMS<c- p>);</c->
<c- p>}</c->

<c- a>function</c-> LMStoICtCp <c- p>(</c->LMS<c- p>)</c-> <c- p>{</c->

    <c- a>const</c-> c1 <c- o>=</c-> <c- mf>3424</c-> <c- o>/</c-> <c- mf>4096</c-><c- p>;</c->
    <c- a>const</c-> c2 <c- o>=</c-> <c- mf>2413</c-> <c- o>/</c-> <c- mf>128</c-><c- p>;</c->
    <c- a>const</c-> c3 <c- o>=</c-> <c- mf>2392</c-> <c- o>/</c-> <c- mf>128</c-><c- p>;</c->
    <c- a>const</c-> m1 <c- o>=</c-> <c- mf>2610</c-> <c- o>/</c-> <c- mf>16384</c-><c- p>;</c->
    <c- a>const</c-> m2 <c- o>=</c-> <c- mf>2523</c-> <c- o>/</c-> <c- mf>32</c-><c- p>;</c->

    <c- c1>// This matrix includes the Ebner LMS coefficients,</c->
    <c- c1>// the rotation, and the scaling to [-0.5,0.5] range</c->
    <c- c1>// rational terms are from Fröhlich p.97</c->
    <c- c1>// and ITU-R BT.2124-0 pp.2-3</c->
    <c- a>const</c-> M <c- o>=</c-> <c- p>[</c->
        <c- p>[</c->  <c- mf>2048</c-> <c- o>/</c-> <c- mf>4096</c-><c- p>,</c->   <c- mf>2048</c-> <c- o>/</c-> <c- mf>4096</c-><c- p>,</c->       <c- mf>0</c->      <c- p>],</c->
        <c- p>[</c->  <c- mf>6610</c-> <c- o>/</c-> <c- mf>4096</c-><c- p>,</c-> <c- o>-</c-><c- mf>13613</c-> <c- o>/</c-> <c- mf>4096</c-><c- p>,</c->  <c- mf>7003</c-> <c- o>/</c-> <c- mf>4096</c-> <c- p>],</c->
        <c- p>[</c-> <c- mf>17933</c-> <c- o>/</c-> <c- mf>4096</c-><c- p>,</c-> <c- o>-</c-><c- mf>17390</c-> <c- o>/</c-> <c- mf>4096</c-><c- p>,</c->  <c- o>-</c-><c- mf>543</c-> <c- o>/</c-> <c- mf>4096</c-> <c- p>],</c->
    <c- p>];</c->

    <c- c1>// apply the PQ EOTF</c->
    <c- c1>// values scaled so [0, 10,000] maps to [0, 1]</c->
    <c- c1>// we can't ever be dividing by zero because of the "1 +" in the denominator</c->
    <c- a>let</c-> PQLMS <c- o>=</c-> LMS<c- p>.</c->map <c- p>(</c-><c- a>function</c-> <c- p>(</c->val<c- p>)</c-> <c- p>{</c->
        <c- a>let</c-> num <c- o>=</c-> c1 <c- o>+</c-> <c- p>(</c->c2 <c- o>*</c-> <c- p>((</c->val <c- o>/</c-> <c- mf>10000</c-><c- p>)</c-> <c- o>**</c-> m1<c- p>));</c->
        <c- a>let</c-> denom <c- o>=</c-> <c- mf>1</c-> <c- o>+</c-> <c- p>(</c->c3 <c- o>*</c-> <c- p>((</c->val <c- o>/</c-> <c- mf>10000</c-><c- p>)</c-> <c- o>**</c-> m1<c- p>));</c->

        <c- k>return</c-> <c- p>(</c->num <c- o>/</c-> denom<c- p>)</c->  <c- o>**</c-> m2<c- p>;</c->
    <c- p>});</c->

    <c- c1>// LMS to IPT, with rotation for Y'C'bC'r compatibility</c->
    <c- k>return</c-> multiplyMatrices<c- p>(</c->M<c- p>,</c-> PQLMS<c- p>);</c->
<c- p>}</c->

<c- a>function</c-> ICtCp_to_XYZ <c- p>(</c->ICtCp<c- p>)</c-> <c- p>{</c->
    <c- c1>// convert ICtCp to an array of absolute, D65 XYZ</c->

    <c- a>const</c-> M <c- o>=</c-> <c- p>[</c->
        <c- p>[</c->  <c- mf>2.0701522183894223</c-><c- p>,</c-> <c- o>-</c-><c- mf>1.3263473389671563</c-><c- p>,</c->  <c- mf>0.2066510476294053</c-> <c- p>],</c->
        <c- p>[</c->  <c- mf>0.3647385209748072</c-><c- p>,</c->  <c- mf>0.6805660249472273</c-><c- p>,</c-> <c- o>-</c-><c- mf>0.0453045459220347</c-> <c- p>],</c->
        <c- p>[</c-> <c- o>-</c-><c- mf>0.0497472075358123</c-><c- p>,</c-> <c- o>-</c-><c- mf>0.0492609666966131</c-><c- p>,</c->  <c- mf>1.1880659249923042</c-> <c- p>],</c->
    <c- p>];</c->

    <c- a>let</c-> LMS <c- o>=</c-> ICtCptoLMS<c- p>(</c->ICtCp<c- p>);</c->
    <c- k>return</c-> multiplyMatrices<c- p>(</c->M<c- p>,</c-> LMS<c- p>);</c->
<c- p>}</c->

<c- a>function</c-> ICtCptoLMS <c- p>(</c->ICtCp<c- p>)</c-> <c- p>{</c->

    <c- a>const</c-> c1 <c- o>=</c-> <c- mf>3424</c-> <c- o>/</c-> <c- mf>4096</c-><c- p>;</c->
    <c- a>const</c-> c2 <c- o>=</c-> <c- mf>2413</c-> <c- o>/</c-> <c- mf>128</c-><c- p>;</c->
    <c- a>const</c-> c3 <c- o>=</c-> <c- mf>2392</c-> <c- o>/</c-> <c- mf>128</c-><c- p>;</c->
    <c- a>const</c-> im1 <c- o>=</c-> <c- mf>16384</c-> <c- o>/</c-> <c- mf>2610</c-><c- p>;</c->
    <c- a>const</c-> im2 <c- o>=</c-> <c- mf>32</c-> <c- o>/</c-> <c- mf>2523</c-><c- p>;</c->

    <c- a>const</c-> M <c- o>=</c-> <c- p>[</c->
        <c- p>[</c-> <c- mf>0.9999999999999998</c-><c- p>,</c->  <c- mf>0.0086090370379328</c-><c- p>,</c->  <c- mf>0.1110296250030260</c-> <c- p>],</c->
        <c- p>[</c-> <c- mf>0.9999999999999998</c-><c- p>,</c-> <c- o>-</c-><c- mf>0.0086090370379328</c-><c- p>,</c-> <c- o>-</c-><c- mf>0.1110296250030259</c-> <c- p>],</c->
        <c- p>[</c-> <c- mf>0.9999999999999998</c-><c- p>,</c->  <c- mf>0.5600313357106791</c-><c- p>,</c-> <c- o>-</c-><c- mf>0.3206271749873188</c-> <c- p>],</c->
    <c- p>];</c->

    <c- a>let</c-> PQLMS <c- o>=</c-> multiplyMatrices<c- p>(</c->M<c- p>,</c-> ICtCp<c- p>);</c->

    <c- c1>// Undo PQ encoding, From BT.2124-0 Annex 2 Conversion 3</c->
    <c- a>let</c-> LMS <c- o>=</c-> PQLMS<c- p>.</c->map <c- p>(</c-><c- a>function</c-> <c- p>(</c->val<c- p>)</c-> <c- p>{</c->
        <c- a>let</c-> num  <c- o>=</c-> Math<c- p>.</c->max<c- p>((</c->val <c- o>**</c-> im2<c- p>)</c-> <c- o>-</c-> c1<c- p>,</c-> <c- mf>0</c-><c- p>);</c->
        <c- a>let</c-> denom <c- o>=</c-> <c- p>(</c->c2 <c- o>-</c-> <c- p>(</c->c3 <c- o>*</c-> <c- p>(</c->val <c- o>**</c-> im2<c- p>)));</c->
        <c- k>return</c-> <c- mf>10000</c-> <c- o>*</c-> <c- p>((</c->num <c- o>/</c-> denom<c- p>)</c-> <c- o>**</c-> im1<c- p>);</c->
    <c- p>});</c->

    <c- k>return</c-> LMS<c- p>;</c->
</pre>
   <h3 class="heading settled" data-level="11.6" id="hdr-color-code"><span class="secno">11.6. </span><span class="content">
	Sample code for <a class="css" data-link-type="maybe" href="#funcdef-hdr-color" id="ref-for-funcdef-hdr-color②">hdr-color()</a>
</span><a class="self-link" href="#hdr-color-code"></a></h3>
<pre class="highlight include-code lang-javascript"><c- a>function</c-> hdrColor<c- p>(</c->col1<c- p>,</c-> H1<c- p>,</c-> col2<c- p>,</c-> H2<c- p>,</c-> H<c- p>)</c-> <c- p>{</c->

    <c- c1>// col1, col2 are arrays representing two colors, in Absolute XYZ</c->
    <c- c1>// H1 and H2 are the headroom for each color (in stops, ie log scale, 0 = SDR)</c->
    <c- c1>// H is available headroom</c->

    <c- c1>// first check the headrooms are distinct</c->
    <c- k>if</c-> <c- p>(</c->H1 <c- o>==</c-> H2<c- p>)</c-> <c- k>return</c-> <c- mf>0</c-><c- p>;</c->

    <c- a>let</c-> w1 <c- o>=</c-> clamp<c- p>((</c->H <c- o>-</c-> H2<c- p>)</c-> <c- o>/</c-> <c- p>(</c->H1 <c- o>-</c-> H2<c- p>),</c-> <c- mf>0</c-><c- p>,</c-> <c- mf>1</c-><c- p>);</c->
    <c- a>let</c-> w2 <c- o>=</c-> clamp<c- p>((</c->H <c- o>-</c-> H1<c- p>)</c-> <c- o>/</c-> <c- p>(</c->H2 <c- o>-</c-> H1<c- p>),</c-> <c- mf>0</c-><c- p>,</c-> <c- mf>1</c-><c- p>);</c->
    <c- a>let</c-> eps <c- o>=</c-> <c- mf>0.001</c-><c- p>;</c->
    <c- a>let</c-> cxyz <c- o>=</c-> Array<c- p>(</c-><c- mf>3</c-><c- p>);</c->
    <c- k>for</c-> <c- p>(</c-><c- a>let</c-> i<c- o>=</c-><c- mf>0</c-><c- p>;</c-> i<c- o>&lt;</c-><c- mf>3</c-><c- p>;</c-> i<c- o>++</c-><c- p>)</c-> <c- p>{</c->
        cxyz<c- p>[</c->i<c- p>]</c-> <c- o>=</c-> Math<c- p>.</c->pow<c- p>(</c->c1xyz<c- p>[</c->i<c- p>]</c-> <c- o>+</c-> eps<c- p>,</c-> w1<c- p>)</c-> <c- o>*</c-> Math<c- p>.</c->pow<c- p>(</c->c2xyz<c- p>[</c->i<c- p>]</c-> <c- o>+</c-> eps<c- p>,</c-> w2<c- p>)</c-> <c- o>-</c-> eps<c- p>;</c->
    <c- p>}</c->
    <c- k>return</c-> cxyz<c- p>;</c->
<c- p>}</c->

<c- a>const</c-> clamp <c- o>=</c-> <c- p>(</c->n<c- p>,</c-> min<c- p>,</c-> max<c- p>)</c-> <c- p>=></c->
  Math<c- p>.</c->min<c- p>(</c->Math<c- p>.</c->max<c- p>(</c->n<c- p>,</c-> min<c- p>),</c-> max<c- p>)</c->
</pre>
   <h2 class="heading settled" data-level="12" id="deltaE"><span class="secno">12. </span><span class="content">
	Sample code for ΔEITP Color Differences
</span><a class="self-link" href="#deltaE"></a></h2>
   <p><em>This section is not normative.</em></p>
   <details class="wpt-tests-block" dir="ltr" lang="en" open>
    <summary>Tests</summary>
    <p>This section is not normative, it does not need tests.</p>
    <ul class="wpt-tests-list"></ul>
    <hr>
   </details>
   <p>The ΔEITP <a data-link-type="biblio" href="#biblio-rec_bt2124" title="ITU-R BT.2124-0 Objective metric for the assessment of the potential visibility of colour differences in television">[Rec_BT.2124]</a> color difference metric
may be used to measure the perceptual color difference between 
two display-referred colors
in an HDR or mixed SDR/HDR context,
for example in display calibration
or gamut and tone mapping.</p>
   <p>It is a Euclideam distance in <span class="css">ICtCp</span> color space,
scaled such that a ΔEITP of 1.0
represents one just-noticeable difference.</p>
<pre class="highlight include-code lang-javascript"><c- c1>// Calculate deltaE ITP</c->
<c- c1>// scaled root sum of squares</c->
<c- c1>// ITU-R BT.2124-0 Annex 1</c->
<c- d>/**</c->
<c- d> * @param {number[]} reference - Array of ICtCp: I as 0..1, Ct and Cp as -1..1</c->
<c- d> * @param {number[]} sample -    Array of ICtCp: I as 0..1, Ct and Cp as -1..1</c->
<c- d> * @return {number} How different a color sample is from reference</c->
<c- d> */</c->
<c- a>function</c-> deltaEITP <c- p>(</c->reference<c- p>,</c-> sample<c- p>)</c-> <c- p>{</c->
    <c- a>let</c-> <c- p>[</c->I1<c- p>,</c-> Ct1<c- p>,</c-> Cp1<c- p>]</c-> <c- o>=</c-> reference<c- p>;</c->
	<c- a>let</c-> <c- p>[</c->I2<c- p>,</c-> Ct2<c- p>,</c-> Cp2<c- p>]</c-> <c- o>=</c-> sample<c- p>;</c->
	<c- a>let</c-> ΔI <c- o>=</c-> I1 <c- o>-</c-> I2<c- p>;</c->
	<c- a>let</c-> ΔT <c- o>=</c-> <c- mf>0.5</c-> <c- o>*</c-> <c- p>(</c->Ct1 <c- o>-</c-> Ct2<c- p>);</c->
	<c- a>let</c-> ΔP <c- o>=</c-> Cp1 <c- o>-</c-> Cp2<c- p>;</c->
	<c- k>return</c-> <c- mf>720</c-> <c- o>*</c-> Math<c- p>.</c->sqrt<c- p>(</c->ΔI <c- o>**</c-> <c- mf>2</c-> <c- o>+</c-> ΔT <c- o>**</c-> <c- mf>2</c-> <c- o>+</c-> ΔP <c- o>**</c-> <c- mf>2</c-><c- p>);</c->
<c- p>}</c-></pre>
   <h2 class="heading no-num settled" id="privacy"><span class="content">Privacy Considerations</span><a class="self-link" href="#privacy"></a></h2>
   <p>The reason that numerical values of <a data-link-type="dfn" href="#hdr-headroom" id="ref-for-hdr-headroom④">HDR headroom</a>
	are not directly exposed by the Web platform
	is because doing so
	would expose the current viewing conditions,
	which would be a <a href="#headroom-privacy">privacy violation</a>.</p>
   <h2 class="heading no-num settled" id="security"><span class="content">Security Considerations</span><a class="self-link" href="#security"></a></h2>
   <p>No Security concerns have been raised on this document</p>
   <h2 class="heading no-num settled" id="a11y"><span class="content">Accessibility Considerations</span><a class="self-link" href="#a11y"></a></h2>
   <p>Some individuals may have a sensitivity
to very bright colors, 
so user agents should provide a mechanism 
to limit the maximum luminance at user option. 
<span class="non-normative">The toe and knee procedure 
	in section 5.4.1 
	<em>Mapping to display with limited brightness range</em> 
	of <a data-link-type="biblio" href="#biblio-rec_bt2390" title="ITU-R BT.2390-8 High dynamic range television for production and international programme exchange">[Rec_BT.2390]</a> 
	is suggested as suitable.</span></p>
   <p>The <span class="css">dynamic-range-limit</span> property could also be set to
<a class="css" data-link-type="maybe" href="#valdef-dynamic-range-limit-standard" id="ref-for-valdef-dynamic-range-limit-standard④">standard</a> or <a class="css" data-link-type="maybe" href="#valdef-dynamic-range-limit-constrained" id="ref-for-valdef-dynamic-range-limit-constrained④">constrained</a>
in a user stylesheet.</p>
   <h2 class="heading no-num settled" id="changes"><span class="content">
	Changes
</span><a class="self-link" href="#changes"></a></h2>
   <h3 class="heading settled" id="changes-20241217"><span class="content">Changes since the 
	<a href="https://www.w3.org/TR/2024/WD-css-color-hdr-1-20241217/">17 December 2024
	First Public Working Draft
	</a></span><a class="self-link" href="#changes-20241217"></a></h3>
   <ul>
    <li>Removed mention of SMPTE-ST-2094-50  as justification for eps
		(<a href="https://github.com/w3c/csswg-drafts/issues/12873">#12873</a>, 
		<a href="https://github.com/w3c/csswg-drafts/issues/11788">#11788</a>)
	
    <li>Noted similarity of hdr-color to adaptive gain curves
    <li>Added alpha() RCS to color syntax
		<a href="https://github.com/w3c/csswg-drafts/issues/10689">#10689</a>
	
    <li>Added display-p3-linear to color spaces for interpolation
		(<a href="https://github.com/w3c/csswg-drafts/issues/12596">#12596</a>)
	
    <li>Added a couple of deltaE ITP worked examples
		(<a href="https://github.com/w3c/csswg-drafts/issues/11250">#11250</a>)
	
    <li>Added display-p3-linear colorspace
		(<a href="https://github.com/w3c/csswg-drafts/issues/12596">#12596</a>)
	
    <li>Added the clamp function which is used in  hdr-color() 
    <li>Added sample code for hdr-color()
    <li>Explained what the eps factor is for 
		(<a href="https://github.com/w3c/csswg-drafts/issues/11788">#11788</a>)
    <li>Added second color-hdr() worked example
    <li>Defined the term "Absolute D65 CIE XYZ"
    <li>Clarified pseudo-code for color-hdr() to show each component is calculated separately 
		(<a href="https://github.com/w3c/csswg-drafts/issues/11694">#11694</a>)
    <li>In dynamic-range-limit-mix(), change to 'one or more' per WG resolution
		(<a href="https://github.com/w3c/csswg-drafts/issues/11694">#11694</a>)
    <li>Clarified that the computed value of dynamic-range-limit-mix(), 
		when all parameters are omitted, is the initial value 
		(<a href="https://github.com/w3c/csswg-drafts/issues/11678">#11678</a>)
    <li>Removed re-definition of "color(), link to definition in CSS Color 5 instead
		(<a href="https://github.com/w3c/csswg-drafts/issues/11954">#11954</a>)
	
    <li>Changed "constrained-high" back to "constrained", per WG resolution 
		(<a href="https://github.com/w3c/csswg-drafts/issues/11698">#11698</a>)
    <li>Define epsilon on chroma of JzCzhz, for missing hue
		(<a href="https://github.com/w3c/csswg-drafts/issues/11706">#11706</a>)
    <li>Properly exported, and consistently used, the term "required conversion"
    <li>Removed erroneous negative chroma reference range in JzCzhz
    <li>Added RCS component keywords for relative ictcp, jzazbz, and jzczhz 
		(<a href="https://github.com/w3c/csswg-drafts/issues/11713">#11713</a>)
    <li>Prevented color() links from pointing to back to CSS Color 5, which is SDR-only
    <li>Added an informative section introducing ICtCp, 
		moved definition out from color() 
		(<a href="https://github.com/w3c/csswg-drafts/issues/11713">#11713</a>)
    <li>Removed duplicate productions, already existing in CSS Color 5
		(<a href="https://github.com/w3c/csswg-drafts/issues/11954">#11954</a>)
    <li>Reference ranges encompass the BT.2100 gamut
		(<a href="https://github.com/w3c/csswg-drafts/issues/11710">#11710</a>)
    <li>Remove the "invalid if sum to zero" wording, per CSS WG resolution
		(<a href="https://github.com/w3c/csswg-drafts/issues/11678">#11678</a>)
    <li>Consistently use log (stops) definition of headroom, 
		not linear (multiplier) headroom 
		(<a href="https://github.com/w3c/csswg-drafts/issues/11787">#11787</a>)
    <li>Consistently used preferred term "HDR reference white", not "media white"
    <li>Added example of color interpolation
		(<a href="https://github.com/w3c/csswg-drafts/issues/11616">#11616</a>)
    <li>Added interpolation algorithm
		(<a href="https://github.com/w3c/csswg-drafts/issues/11616">#11616</a>)
    <li>Added section on interpolating colors parameterized by headroom
		(<a href="https://github.com/w3c/csswg-drafts/issues/11616">#11616</a>)
    <li>Added color-hdr function per WG resolution. 
		Added ISO 21496-1 informative reference
		(<a href="https://github.com/w3c/csswg-drafts/issues/11616">#11616</a>)
    <li>Added sample code for Jzazbz
		(<a href="https://github.com/w3c/csswg-drafts/issues/9934">#9934</a>)
    <li>Add missing signed power function for sample code
    <li>Added sample code for rec2100 colorspaces
		(<a href="https://github.com/w3c/csswg-drafts/issues/9934">#9934</a>)
    <li>Added sample code for ICtCp
		(<a href="https://github.com/w3c/csswg-drafts/issues/9934">#9934</a>)
    <li>Added informative reference to the Perrin ICtCp paper
    <li>Added new section, sample code for color conversions 
		(<a href="https://github.com/w3c/csswg-drafts/issues/9934">#9934</a>)
    <li>Added informative reference to Dolby "What is ICtCp" white paper 
		(<a href="https://github.com/w3c/csswg-drafts/issues/9934">#9934</a>)
    <li>Clarified on the grammar and spec text for dynamic-range-limit-mix() 
		(<a href="https://github.com/w3c/csswg-drafts/issues/11672">#11672</a>)
    <li>Added ΔEITP color difference metric from BT.2124 
		(<a href="https://github.com/w3c/csswg-drafts/issues/11250">#11250</a>)
    <li>For dynamic-range-limit, changes high to no-limit 
		(<a href="https://github.com/w3c/csswg-drafts/issues/11698">#11698</a>)
    <li>Corrected prose, dynamic-range-limit-mix takes 2 or more values 
		(<a href="https://github.com/w3c/csswg-drafts/issues/11694">#11694</a>)
    <li>Removed absolute and relative HDR concepts, stress instead scene-referred and display-referred. 
		Anchor media white, and allow color re-rendering 
		(<a href="https://github.com/w3c/csswg-drafts/issues/10460">#10460</a>)
    <li>Defined "media white" more clearly
    <li>Collected together explanatory material into an introductory section
   </ul>
  </main>
  <h2 class="heading no-num no-ref settled" id="w3c-conformance"><span class="content">
Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
  <h3 class="heading no-ref settled" id="w3c-conventions"><span class="content">
Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification.

    </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this:

    </p>
  <div class="example" id="w3c-example">
   <a class="self-link" href="#w3c-example"></a>
        
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this:

    </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <p>Advisements are normative sections styled to evoke special attention and are
    set apart from other normative text with <code>&lt;strong class="advisement"></code>, like
    this:

    <strong class="advisement">
        UAs MUST provide an accessible alternative.
    </strong></p>
  <details class="wpt-tests-block" dir="ltr" lang="en" open>
   <summary>Tests</summary>
   <p>Tests relating to the content of this specification
                     may be documented in “Tests” blocks like this one.
                     Any such block is non-normative.</p>
   <ul class="wpt-tests-list"></ul>
   <hr>
  </details>
  <h3 class="heading no-ref settled" id="w3c-conformance-classes"><span class="content">
Conformance classes</span><a class="self-link" href="#w3c-conformance-classes"></a></h3>
  <p>Conformance to this specification
    is defined for three conformance classes:
    </p>
  <dl>
   <dt>style sheet
            
   <dd>A <a href="https://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
            style sheet</a>.
        
   <dt>renderer
            
   <dd>A <a href="https://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
            that interprets the semantics of a style sheet and renders
            documents that use them.
        
   <dt>authoring tool
            
   <dd>A <a href="https://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
            that writes a style sheet.
    
  </dl>
  <p>A style sheet is conformant to this specification
    if all of its statements that use syntax defined in this module are valid
    according to the generic CSS grammar and the individual grammars of each
    feature defined in this module.

    </p>
  <p>A renderer is conformant to this specification
    if, in addition to interpreting the style sheet as defined by the
    appropriate specifications, it supports all the features defined
    by this specification by parsing them correctly
    and rendering the document accordingly. However, the inability of a
    UA to correctly render a document due to limitations of the device
    does not make the UA non-conformant. (For example, a UA is not
    required to render color on a monochrome monitor.)

    </p>
  <p>An authoring tool is conformant to this specification
    if it writes style sheets that are syntactically correct according to the
    generic CSS grammar and the individual grammars of each feature in
    this module, and meet all other conformance requirements of style sheets
    as described in this module.

</p>
  <h3 class="heading no-ref settled" id="w3c-partial"><span class="content">
Partial implementations</span><a class="self-link" href="#w3c-partial"></a></h3>
  <p>So that authors can exploit the forward-compatible parsing rules to
    assign fallback values, CSS renderers <strong>must</strong>
    treat as invalid (and <a href="https://www.w3.org/TR/CSS21/conform.html#ignore">ignore
    as appropriate</a>) any at-rules, properties, property values, keywords,
    and other syntactic constructs for which they have no usable level of
    support. In particular, user agents <strong>must not</strong> selectively
    ignore unsupported component values and honor supported values in a single
    multi-value property declaration: if any value is considered invalid
    (as unsupported values must be), CSS requires that the entire declaration
    be ignored.</p>
  <h4 class="heading settled" id="w3c-conform-future-proofing"><span class="content">
Implementations of Unstable and Proprietary Features</span><a class="self-link" href="#w3c-conform-future-proofing"></a></h4>
  <p>To avoid clashes with future stable CSS features,
        the CSSWG recommends <a href="https://www.w3.org/TR/CSS/#future-proofing">following best practices</a> for the implementation of <a href="https://www.w3.org/TR/CSS/#unstable">unstable</a> features and <a href="https://www.w3.org/TR/CSS/#proprietary-extension">proprietary extensions</a> to CSS.

</p>
  <h3 class="heading no-ref settled" id="w3c-testing"><span class="content">
Non-experimental implementations</span><a class="self-link" href="#w3c-testing"></a></h3>
  <p>Once a specification reaches the Candidate Recommendation stage,
    non-experimental implementations are possible, and implementors should
    release an unprefixed implementation of any CR-level feature they
    can demonstrate to be correctly implemented according to spec.

    </p>
  <p>To establish and maintain the interoperability of CSS across
    implementations, the CSS Working Group requests that non-experimental
    CSS renderers submit an implementation report (and, if necessary, the
    testcases used for that implementation report) to the W3C before
    releasing an unprefixed implementation of any CSS features. Testcases
    submitted to W3C are subject to review and correction by the CSS
    Working Group.

    </p>
  <p>Further information on submitting testcases and implementation reports
    can be found from on the CSS Working Group’s website at
    <a href="https://www.w3.org/Style/CSS/Test/">https://www.w3.org/Style/CSS/Test/</a>.
    Questions should be directed to the
    <a href="https://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a>
    mailing list.</p>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="heading no-num no-ref settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="heading no-num no-ref settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#valdef-jzazbz-a">a</a><span>, in § 6.4</span>
   <li><a href="#absolute-d65-cie-xyz">Absolute D65 CIE XYZ</a><span>, in § 5</span>
   <li>
    alpha
    <ul>
     <li><a href="#valdef-ictcp-alpha">value for ictcp()</a><span>, in § 6.3</span>
     <li><a href="#valdef-jzazbz-alpha">value for jzazbz()</a><span>, in § 6.4</span>
     <li><a href="#valdef-jzczhz-alpha">value for jzczhz()</a><span>, in § 6.5</span>
    </ul>
   <li><a href="#valdef-jzazbz-b">b</a><span>, in § 6.4</span>
   <li><a href="#valdef-jzczhz-c">c</a><span>, in § 6.5</span>
   <li><a href="#typedef-color-function">&lt;color-function></a><span>, in § 4</span>
   <li><a href="#color-re-rendering">color re-rendering</a><span>, in § 2.1</span>
   <li><a href="#valdef-dynamic-range-limit-constrained">constrained</a><span>, in § 3.1</span>
   <li><a href="#valdef-ictcp-cp">cp</a><span>, in § 6.3</span>
   <li><a href="#valdef-ictcp-ct">ct</a><span>, in § 6.3</span>
   <li><a href="#dynamic-range">Dynamic range</a><span>, in § 2.1</span>
   <li><a href="#propdef-dynamic-range-limit">dynamic-range-limit</a><span>, in § 3.1</span>
   <li><a href="#funcdef-dynamic-range-limit-mix">dynamic-range-limit-mix()</a><span>, in § 3.2</span>
   <li><a href="#valdef-jzczhz-h">h</a><span>, in § 6.5</span>
   <li><a href="#funcdef-hdr-color">hdr-color()</a><span>, in § 5</span>
   <li><a href="#hdr-headroom">HDR headroom</a><span>, in § 2.2</span>
   <li><a href="#hdr-reference-white">HDR reference white</a><span>, in § 2.1</span>
   <li><a href="#high-dynamic-range">High Dynamic Range</a><span>, in § 2.1</span>
   <li><a href="#valdef-ictcp-i">i</a><span>, in § 6.3</span>
   <li><a href="#ictcp">ICtCp</a><span>, in § 6.3</span>
   <li><a href="#funcdef-ictcp">ictcp()</a><span>, in § 4</span>
   <li>
    j
    <ul>
     <li><a href="#valdef-jzazbz-j">value for jzazbz()</a><span>, in § 6.4</span>
     <li><a href="#valdef-jzczhz-j">value for jzczhz()</a><span>, in § 6.5</span>
    </ul>
   <li><a href="#jzazbz">Jzazbz</a><span>, in § 6.4</span>
   <li><a href="#funcdef-jzazbz">jzazbz()</a><span>, in § 4</span>
   <li><a href="#jzczhz">JzCzhz</a><span>, in § 6.5</span>
   <li><a href="#funcdef-jzczhz">jzczhz()</a><span>, in § 4</span>
   <li><a href="#valdef-dynamic-range-limit-no-limit">no-limit</a><span>, in § 3.1</span>
   <li><a href="#typedef-predefined-rgb">&lt;predefined-rgb></a><span>, in § 7</span>
   <li><a href="#rec2100-hlg">rec2100-hlg</a><span>, in § 8.2</span>
   <li><a href="#rec2100-linear">rec2100-linear</a><span>, in § 8.3</span>
   <li><a href="#rec2100-pq">rec2100-pq</a><span>, in § 8.1</span>
   <li><a href="#valdef-dynamic-range-limit-standard">standard</a><span>, in § 3.1</span>
   <li><a href="#standard-dynamic-range">Standard Dynamic Range</a><span>, in § 2.1</span>
  </ul>
  <h3 class="heading no-num no-ref settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSS-CASCADE-5]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="8c8e51b4">computed value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-COLOR-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="e5db470f">&lt;alpha-value></span>
     <li><span class="dfn-paneled" id="33347c0e">&lt;hue></span>
     <li><span class="dfn-paneled" id="f6f69187">color space</span>
     <li><span class="dfn-paneled" id="c1a0e909">d65</span>
     <li><span class="dfn-paneled" id="5bd3632a">hsl()</span>
     <li><span class="dfn-paneled" id="239640fd">hsla()</span>
     <li><span class="dfn-paneled" id="4a14e4dc">lab</span>
     <li><span class="dfn-paneled" id="795f4c8b">luminance</span>
     <li><span class="dfn-paneled" id="528ea935">none</span>
     <li><span class="dfn-paneled" id="daabf294">rgb()</span>
     <li><span class="dfn-paneled" id="f3226176">rgba()</span>
     <li><span class="dfn-paneled" id="bd774466">sRGB</span>
     <li><span class="dfn-paneled" id="17858dc9">white</span>
     <li><span class="dfn-paneled" id="b3bfee63">xyz-d65</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-COLOR-5]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="d04b6986">&lt;color></span>
     <li><span class="dfn-paneled" id="49716633">alpha()</span>
     <li><span class="dfn-paneled" id="4966c7f8">color()</span>
     <li><span class="dfn-paneled" id="59963a3c">component keyword</span>
     <li><span class="dfn-paneled" id="f7f2e8bc">hwb()</span>
     <li><span class="dfn-paneled" id="f1cce64a">lab()</span>
     <li><span class="dfn-paneled" id="9b2c9faa">lch()</span>
     <li><span class="dfn-paneled" id="deb378dd">oklab()</span>
     <li><span class="dfn-paneled" id="0e5d2494">oklch()</span>
     <li><span class="dfn-paneled" id="1953bdac">origin color</span>
     <li><span class="dfn-paneled" id="b786b3c1">relative color</span>
     <li><span class="dfn-paneled" id="f4b08404">required conversion</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-VALUES-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="c297b070">#</span>
     <li><span class="dfn-paneled" id="bdb4e757">&amp;&amp;</span>
     <li><span class="dfn-paneled" id="61bb5e44">&lt;number></span>
     <li><span class="dfn-paneled" id="128295ac">&lt;percentage></span>
     <li><span class="dfn-paneled" id="d4441b24">?</span>
     <li><span class="dfn-paneled" id="8a110a7b">CSS-wide keywords</span>
     <li><span class="dfn-paneled" id="4eb9d37e">|</span>
    </ul>
  </ul>
  <h2 class="heading no-num no-ref settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="heading no-num no-ref settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-cascade-5">[CSS-CASCADE-5]
   <dd>Elika Etemad; Miriam Suzanne; Tab Atkins Jr.. <a href="https://www.w3.org/TR/css-cascade-5/"><cite>CSS Cascading and Inheritance Level 5</cite></a>. 13 January 2022. CR. URL: <a href="https://www.w3.org/TR/css-cascade-5/">https://www.w3.org/TR/css-cascade-5/</a>
   <dt id="biblio-css-color-4">[CSS-COLOR-4]
   <dd>Chris Lilley; Tab Atkins Jr.; Lea Verou. <a href="https://www.w3.org/TR/css-color-4/"><cite>CSS Color Module Level 4</cite></a>. 24 April 2025. CRD. URL: <a href="https://www.w3.org/TR/css-color-4/">https://www.w3.org/TR/css-color-4/</a>
   <dt id="biblio-css-color-5">[CSS-COLOR-5]
   <dd>Chris Lilley; et al. <a href="https://www.w3.org/TR/css-color-5/"><cite>CSS Color Module Level 5</cite></a>. 18 March 2025. WD. URL: <a href="https://www.w3.org/TR/css-color-5/">https://www.w3.org/TR/css-color-5/</a>
   <dt id="biblio-css-values-3">[CSS-VALUES-3]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://www.w3.org/TR/css-values-3/"><cite>CSS Values and Units Module Level 3</cite></a>. 22 March 2024. CRD. URL: <a href="https://www.w3.org/TR/css-values-3/">https://www.w3.org/TR/css-values-3/</a>
   <dt id="biblio-css-values-4">[CSS-VALUES-4]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://www.w3.org/TR/css-values-4/"><cite>CSS Values and Units Module Level 4</cite></a>. 12 March 2024. WD. URL: <a href="https://www.w3.org/TR/css-values-4/">https://www.w3.org/TR/css-values-4/</a>
   <dt id="biblio-css2">[CSS2]
   <dd>Bert Bos; et al. <a href="https://www.w3.org/TR/CSS2/"><cite>Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification</cite></a>. 7 June 2011. REC. URL: <a href="https://www.w3.org/TR/CSS2/">https://www.w3.org/TR/CSS2/</a>
   <dt id="biblio-rec2020">[Rec.2020]
   <dd><a href="http://www.itu.int/rec/R-REC-BT.2020/en"><cite>Recommendation  ITU-R  BT.2020-2:  Parameter values for ultra-high definition television systems for production and international programme exchange</cite></a>. October 2015. URL: <a href="http://www.itu.int/rec/R-REC-BT.2020/en">http://www.itu.int/rec/R-REC-BT.2020/en</a>
   <dt id="biblio-rec_bt2100">[Rec_BT.2100]
   <dd><a href="https://www.itu.int/rec/recommendation.asp?lang=en&amp;parent=R-REC-BT.2100-3-202502-I"><cite>ITU-R BT.2100-3 Image parameter values for high dynamic range television for use in production and international programme exchange</cite></a>. February 2025. URL: <a href="https://www.itu.int/rec/recommendation.asp?lang=en&amp;parent=R-REC-BT.2100-3-202502-I">https://www.itu.int/rec/recommendation.asp?lang=en&amp;parent=R-REC-BT.2100-3-202502-I</a>
   <dt id="biblio-rec_bt2390">[Rec_BT.2390]
   <dd><a href="https://www.itu.int/dms_pub/itu-r/opb/rep/R-REP-BT.2390-8-2020-PDF-E.pdf"><cite>ITU-R BT.2390-8 High dynamic range television for production and international programme exchange</cite></a>. February 2020. URL: <a href="https://www.itu.int/dms_pub/itu-r/opb/rep/R-REP-BT.2390-8-2020-PDF-E.pdf">https://www.itu.int/dms_pub/itu-r/opb/rep/R-REP-BT.2390-8-2020-PDF-E.pdf</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-rpt_bt2408">[Rpt_BT.2408]
   <dd><a href="https://www.itu.int/dms_pub/itu-r/opb/rep/R-REP-BT.2408-2017-PDF-E.pdf"><cite>Report ITU-R BT.2408-0 Operational practices in HDR television production</cite></a>. October 2017. URL: <a href="https://www.itu.int/dms_pub/itu-r/opb/rep/R-REP-BT.2408-2017-PDF-E.pdf">https://www.itu.int/dms_pub/itu-r/opb/rep/R-REP-BT.2408-2017-PDF-E.pdf</a>
   <dt id="biblio-safdar-pucs">[Safdar-PUCS]
   <dd>Safdar, Muhammad; et al. <a href="https://opg.optica.org/oe/fulltext.cfm?uri=oe-25-13-15131&amp;id=368272"><cite>Perceptually uniform color space for image signals including high dynamic range and wide gamut</cite></a>. 26 June 2017. URL: <a href="https://opg.optica.org/oe/fulltext.cfm?uri=oe-25-13-15131&amp;id=368272">https://opg.optica.org/oe/fulltext.cfm?uri=oe-25-13-15131&amp;id=368272</a>
   <dt id="biblio-smpte-st-2084">[SMPTE-ST-2084]
   <dd><a href="https://pub.smpte.org/latest/st2084/st2084-2014.pdf"><cite>ST 2084:2014 - SMPTE Standard - High Dynamic Range Electro-Optical Transfer Function of Mastering Reference Displays</cite></a>. 29 August 2014. URL: <a href="https://pub.smpte.org/latest/st2084/st2084-2014.pdf">https://pub.smpte.org/latest/st2084/st2084-2014.pdf</a>
  </dl>
  <h3 class="heading no-num no-ref settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-arib_std-b67">[ARIB_STD-B67]
   <dd><a href="https://www.arib.or.jp/english/html/overview/doc/2-STD-B67v1_0.pdf"><cite>Essential Parameter Values for the Extended Image Dynamic Range Television (EIDRTV) System for Programme Production</cite></a>. 3 July 2015. URL: <a href="https://www.arib.or.jp/english/html/overview/doc/2-STD-B67v1_0.pdf">https://www.arib.or.jp/english/html/overview/doc/2-STD-B67v1_0.pdf</a>
   <dt id="biblio-development_itp">[Development_ITP]
   <dd>F.Ebner; M.D.Fairchild. <a href="https://www.researchgate.net/publication/221677980_Development_and_Testing_of_a_Color_Space_IPT_with_Improved_Hue_Uniformity"><cite>Development and testing of a color space (IPT) with improved hue uniformity. In: Proceedings of The Sixth Color Imaging Conference, 8-13, 1998</cite></a>. January 1998. URL: <a href="https://www.researchgate.net/publication/221677980_Development_and_Testing_of_a_Color_Space_IPT_with_Improved_Hue_Uniformity">https://www.researchgate.net/publication/221677980_Development_and_Testing_of_a_Color_Space_IPT_with_Improved_Hue_Uniformity</a>
   <dt id="biblio-displayhdr">[DisplayHDR]
   <dd><a href="https://displayhdr.org/performance-criteria/"><cite>Summary of DisplayHDR Specs under CTS 1.2</cite></a>. 17 May 2024. URL: <a href="https://displayhdr.org/performance-criteria/">https://displayhdr.org/performance-criteria/</a>
   <dt id="biblio-iso_21496-1">[ISO_21496-1]
   <dd><a href="https://www.iso.org/standard/86775.html"><cite>Gain map metadata for image conversion: Part 1: Dynamic Range Conversion</cite></a>. URL: <a href="https://www.iso.org/standard/86775.html">https://www.iso.org/standard/86775.html</a>
   <dt id="biblio-perrin">[Perrin]
   <dd>Perrin, A-F.; et al. <a href="https://ieeexplore.ieee.org/document/8333011"><cite>ICtCp Versus Y'CbCr: Evaluation of ICtCp Color Space and an Adaptive Reshaper for HDR and WCG</cite></a>. May 2018. URL: <a href="https://ieeexplore.ieee.org/document/8333011">https://ieeexplore.ieee.org/document/8333011</a>
   <dt id="biblio-rec_bt2124">[Rec_BT.2124]
   <dd><a href="https://www.itu.int/dms_pubrec/itu-r/rec/bt/R-REC-BT.2124-0-201901-I!!PDF-E.pdf"><cite>ITU-R BT.2124-0 Objective metric for the assessment of the potential visibility of colour differences in television</cite></a>. URL: <a href="https://www.itu.int/dms_pubrec/itu-r/rec/bt/R-REC-BT.2124-0-201901-I!!PDF-E.pdf">https://www.itu.int/dms_pubrec/itu-r/rec/bt/R-REC-BT.2124-0-201901-I!!PDF-E.pdf</a>
   <dt id="biblio-rec_bt814">[Rec_BT.814]
   <dd><a href="https://www.itu.int/dms_pubrec/itu-r/rec/bt/R-REC-BT.814-4-201807-I!!PDF-E.pdf"><cite>Specifications of PLUGE test signals and alignment procedures for setting of brightness and contrast of displays</cite></a>. July 2018. URL: <a href="https://www.itu.int/dms_pubrec/itu-r/rec/bt/R-REC-BT.814-4-201807-I!!PDF-E.pdf">https://www.itu.int/dms_pubrec/itu-r/rec/bt/R-REC-BT.814-4-201807-I!!PDF-E.pdf</a>
   <dt id="biblio-smpte-st-2094-50">[SMPTE-ST-2094-50]
   <dd><a href="https://github.com/SMPTE/st2094-50"><cite>Dynamic Metadata for Color Volume Transform - Application #5 (Broadcast)</cite></a>. 2025. URL: <a href="https://github.com/SMPTE/st2094-50">https://github.com/SMPTE/st2094-50</a>
   <dt id="biblio-what_is_ictcp">[What_is_ICtCp]
   <dd><a href="https://professional.dolby.com/siteassets/pdfs/ictcp_dolbywhitepaper_v071.pdf"><cite>What is ICtCp, v7.1</cite></a>. URL: <a href="https://professional.dolby.com/siteassets/pdfs/ictcp_dolbywhitepaper_v071.pdf">https://professional.dolby.com/siteassets/pdfs/ictcp_dolbywhitepaper_v071.pdf</a>
  </dl>
  <h2 class="heading no-num no-ref settled" id="property-index"><span class="content">Property Index</span><a class="self-link" href="#property-index"></a></h2>
  <div class="big-element-wrapper">
   <table class="index">
    <thead>
     <tr>
      <th scope="col">Name
      <th scope="col">Value
      <th scope="col">Initial
      <th scope="col">Applies to
      <th scope="col">Inh.
      <th scope="col">%ages
      <th scope="col">Anim­ation type
      <th scope="col">Canonical order
      <th scope="col">Com­puted value
    <tbody>
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-dynamic-range-limit" id="ref-for-propdef-dynamic-range-limit④">dynamic-range-limit</a>
      <td>standard | no-limit | constrained | &lt;dynamic-range-limit-mix()>
      <td>no-limit
      <td>all elements
      <td>yes
      <td>n/a
      <td>by dynamic-range-limit-mix()
      <td>per grammar
      <td>see Computed Value for dynamic-range-limit
   </table>
  </div>
  <h2 class="heading no-num no-ref settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> add a diagram showing SDR and HDR dynamic ranges on a log scale <a class="issue-return" href="#issue-b905ab0c" title="Jump to section">↵</a></div>
   <div class="issue"> add other examples, including encoding of sRGB red, green, blue and P3 red, green, blue. <a class="issue-return" href="#issue-3762b88c" title="Jump to section">↵</a></div>
   <div class="issue"> add other examples <a class="issue-return" href="#issue-63bd5f3d" title="Jump to section">↵</a></div>
   <div class="issue"> add black level lift Β as defined on same page? <a class="issue-return" href="#issue-fb589d17" title="Jump to section">↵</a></div>
  </div>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"0e5d2494": {"dfnID":"0e5d2494","dfnText":"oklch()","external":true,"refSections":[{"refs":[{"id":"ref-for-funcdef-oklch"}],"title":"4. The <color> syntax"}],"url":"https://www.w3.org/TR/css-color-5/#funcdef-oklch"},
"128295ac": {"dfnID":"128295ac","dfnText":"<percentage>","external":true,"refSections":[{"refs":[{"id":"ref-for-percentage-value"}],"title":"3.2. Mixing Dynamic Range Limits: the dynamic-range-limit-mix() function"},{"refs":[{"id":"ref-for-percentage-value\u2460"},{"id":"ref-for-percentage-value\u2461"},{"id":"ref-for-percentage-value\u2462"},{"id":"ref-for-percentage-value\u2463"},{"id":"ref-for-percentage-value\u2464"},{"id":"ref-for-percentage-value\u2465"},{"id":"ref-for-percentage-value\u2466"},{"id":"ref-for-percentage-value\u2467"}],"title":"4. The <color> syntax"}],"url":"https://www.w3.org/TR/css-values-4/#percentage-value"},
"17858dc9": {"dfnID":"17858dc9","dfnText":"white","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-color-white"},{"id":"ref-for-valdef-color-white\u2460"},{"id":"ref-for-valdef-color-white\u2461"}],"title":"3.1. The dynamic-range-limit property"},{"refs":[{"id":"ref-for-valdef-color-white\u2462"}],"title":"5. HDR colors parameterized by headroom: the hdr-color() function"},{"refs":[{"id":"ref-for-valdef-color-white\u2463"}],"title":"6.3. ICtCp"},{"refs":[{"id":"ref-for-valdef-color-white\u2464"}],"title":"6.4. Jzazbz"},{"refs":[{"id":"ref-for-valdef-color-white\u2465"}],"title":"8.1. rec2100-pq"},{"refs":[{"id":"ref-for-valdef-color-white\u2466"}],"title":"8.3. rec2100-linear"}],"url":"https://www.w3.org/TR/css-color-4/#valdef-color-white"},
"1953bdac": {"dfnID":"1953bdac","dfnText":"origin color","external":true,"refSections":[{"refs":[{"id":"ref-for-origin-color"},{"id":"ref-for-origin-color\u2460"},{"id":"ref-for-origin-color\u2461"}],"title":"6.3. ICtCp"},{"refs":[{"id":"ref-for-origin-color\u2462"},{"id":"ref-for-origin-color\u2463"},{"id":"ref-for-origin-color\u2464"}],"title":"6.4. Jzazbz"},{"refs":[{"id":"ref-for-origin-color\u2465"},{"id":"ref-for-origin-color\u2466"},{"id":"ref-for-origin-color\u2467"},{"id":"ref-for-origin-color\u2468"}],"title":"6.5. JzCzhz"}],"url":"https://www.w3.org/TR/css-color-5/#origin-color"},
"239640fd": {"dfnID":"239640fd","dfnText":"hsla()","external":true,"refSections":[{"refs":[{"id":"ref-for-funcdef-hsla"}],"title":"4. The <color> syntax"}],"url":"https://www.w3.org/TR/css-color-4/#funcdef-hsla"},
"33347c0e": {"dfnID":"33347c0e","dfnText":"<hue>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-hue"}],"title":"4. The <color> syntax"}],"url":"https://www.w3.org/TR/css-color-4/#typedef-hue"},
"4966c7f8": {"dfnID":"4966c7f8","dfnText":"color()","external":true,"refSections":[{"refs":[{"id":"ref-for-funcdef-color"}],"title":"4. The <color> syntax"},{"refs":[{"id":"ref-for-funcdef-color\u2460"},{"id":"ref-for-funcdef-color\u2461"},{"id":"ref-for-funcdef-color\u2462"}],"title":"7. \n\tSpecifying Predefined and Custom Color Spaces: the color() Function\n"},{"refs":[{"id":"ref-for-funcdef-color\u2463"},{"id":"ref-for-funcdef-color\u2464"},{"id":"ref-for-funcdef-color\u2465"}],"title":"10.1. \nSerializing values of the color() function"}],"url":"https://www.w3.org/TR/css-color-5/#funcdef-color"},
"49716633": {"dfnID":"49716633","dfnText":"alpha()","external":true,"refSections":[{"refs":[{"id":"ref-for-funcdef-alpha"}],"title":"4. The <color> syntax"}],"url":"https://drafts.csswg.org/css-color-5/#funcdef-alpha"},
"4a14e4dc": {"dfnID":"4a14e4dc","dfnText":"lab","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-lab-lab"}],"title":"6.1. \n\tIntroducing ICtCp\n"}],"url":"https://www.w3.org/TR/css-color-4/#valdef-lab-lab"},
"4eb9d37e": {"dfnID":"4eb9d37e","dfnText":"|","external":true,"refSections":[{"refs":[{"id":"ref-for-comb-one"},{"id":"ref-for-comb-one\u2460"},{"id":"ref-for-comb-one\u2461"}],"title":"3.1. The dynamic-range-limit property"},{"refs":[{"id":"ref-for-comb-one\u2462"},{"id":"ref-for-comb-one\u2463"},{"id":"ref-for-comb-one\u2464"},{"id":"ref-for-comb-one\u2465"},{"id":"ref-for-comb-one\u2466"},{"id":"ref-for-comb-one\u2467"},{"id":"ref-for-comb-one\u2468"},{"id":"ref-for-comb-one\u2460\u24ea"},{"id":"ref-for-comb-one\u2460\u2460"},{"id":"ref-for-comb-one\u2460\u2461"},{"id":"ref-for-comb-one\u2460\u2462"},{"id":"ref-for-comb-one\u2460\u2463"},{"id":"ref-for-comb-one\u2460\u2464"},{"id":"ref-for-comb-one\u2460\u2465"},{"id":"ref-for-comb-one\u2460\u2466"},{"id":"ref-for-comb-one\u2460\u2467"},{"id":"ref-for-comb-one\u2460\u2468"},{"id":"ref-for-comb-one\u2461\u24ea"},{"id":"ref-for-comb-one\u2461\u2460"},{"id":"ref-for-comb-one\u2461\u2461"},{"id":"ref-for-comb-one\u2461\u2462"},{"id":"ref-for-comb-one\u2461\u2463"},{"id":"ref-for-comb-one\u2461\u2464"},{"id":"ref-for-comb-one\u2461\u2465"},{"id":"ref-for-comb-one\u2461\u2466"},{"id":"ref-for-comb-one\u2461\u2467"},{"id":"ref-for-comb-one\u2461\u2468"},{"id":"ref-for-comb-one\u2462\u24ea"},{"id":"ref-for-comb-one\u2462\u2460"},{"id":"ref-for-comb-one\u2462\u2461"},{"id":"ref-for-comb-one\u2462\u2462"},{"id":"ref-for-comb-one\u2462\u2463"},{"id":"ref-for-comb-one\u2462\u2464"}],"title":"4. The <color> syntax"},{"refs":[{"id":"ref-for-comb-one\u2462\u2465"},{"id":"ref-for-comb-one\u2462\u2466"},{"id":"ref-for-comb-one\u2462\u2467"},{"id":"ref-for-comb-one\u2462\u2468"},{"id":"ref-for-comb-one\u2463\u24ea"},{"id":"ref-for-comb-one\u2463\u2460"},{"id":"ref-for-comb-one\u2463\u2461"},{"id":"ref-for-comb-one\u2463\u2462"},{"id":"ref-for-comb-one\u2463\u2463"}],"title":"7. \n\tSpecifying Predefined and Custom Color Spaces: the color() Function\n"}],"url":"https://www.w3.org/TR/css-values-4/#comb-one"},
"528ea935": {"dfnID":"528ea935","dfnText":"none","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-color-none"}],"title":"6.5.1. \n\t\tConverting Jzazbz colors to JzCzhz colors"},{"refs":[{"id":"ref-for-valdef-color-none\u2460"}],"title":"6.5.2. \n\tConverting JzCzhz colors to Jzazbz  colors"}],"url":"https://www.w3.org/TR/css-color-4/#valdef-color-none"},
"59963a3c": {"dfnID":"59963a3c","dfnText":"component keyword","external":true,"refSections":[{"refs":[{"id":"ref-for-component-keyword"}],"title":"6.3. ICtCp"},{"refs":[{"id":"ref-for-component-keyword\u2460"}],"title":"6.4. Jzazbz"},{"refs":[{"id":"ref-for-component-keyword\u2461"}],"title":"6.5. JzCzhz"}],"url":"https://www.w3.org/TR/css-color-5/#component-keyword"},
"5bd3632a": {"dfnID":"5bd3632a","dfnText":"hsl()","external":true,"refSections":[{"refs":[{"id":"ref-for-funcdef-hsl"}],"title":"4. The <color> syntax"}],"url":"https://www.w3.org/TR/css-color-4/#funcdef-hsl"},
"61bb5e44": {"dfnID":"61bb5e44","dfnText":"<number>","external":true,"refSections":[{"refs":[{"id":"ref-for-number-value"},{"id":"ref-for-number-value\u2460"},{"id":"ref-for-number-value\u2461"},{"id":"ref-for-number-value\u2462"},{"id":"ref-for-number-value\u2463"},{"id":"ref-for-number-value\u2464"},{"id":"ref-for-number-value\u2465"},{"id":"ref-for-number-value\u2466"}],"title":"4. The <color> syntax"},{"refs":[{"id":"ref-for-number-value\u2467"}],"title":"5. HDR colors parameterized by headroom: the hdr-color() function"},{"refs":[{"id":"ref-for-number-value\u2468"},{"id":"ref-for-number-value\u2460\u24ea"},{"id":"ref-for-number-value\u2460\u2460"}],"title":"6.3. ICtCp"},{"refs":[{"id":"ref-for-number-value\u2460\u2461"},{"id":"ref-for-number-value\u2460\u2462"},{"id":"ref-for-number-value\u2460\u2463"}],"title":"6.4. Jzazbz"},{"refs":[{"id":"ref-for-number-value\u2460\u2464"},{"id":"ref-for-number-value\u2460\u2465"},{"id":"ref-for-number-value\u2460\u2466"},{"id":"ref-for-number-value\u2460\u2467"}],"title":"6.5. JzCzhz"},{"refs":[{"id":"ref-for-number-value\u2460\u2468"}],"title":"10.1. \nSerializing values of the color() function"}],"url":"https://www.w3.org/TR/css-values-4/#number-value"},
"795f4c8b": {"dfnID":"795f4c8b","dfnText":"luminance","external":true,"refSections":[{"refs":[{"id":"ref-for-luminance"}],"title":"2.1. Defining Dynamic Range"},{"refs":[{"id":"ref-for-luminance\u2460"}],"title":"2.2. Introducing Headroom"}],"url":"https://www.w3.org/TR/css-color-4/#luminance"},
"8a110a7b": {"dfnID":"8a110a7b","dfnText":"CSS-wide keywords","external":true,"refSections":[{"refs":[{"id":"ref-for-css-wide-keywords"}],"title":"1.1. Value Definitions"}],"url":"https://www.w3.org/TR/css-values-4/#css-wide-keywords"},
"8c8e51b4": {"dfnID":"8c8e51b4","dfnText":"computed value","external":true,"refSections":[{"refs":[{"id":"ref-for-computed-value"}],"title":"10.1. \nSerializing values of the color() function"}],"url":"https://www.w3.org/TR/css-cascade-5/#computed-value"},
"9b2c9faa": {"dfnID":"9b2c9faa","dfnText":"lch()","external":true,"refSections":[{"refs":[{"id":"ref-for-funcdef-lch"}],"title":"4. The <color> syntax"}],"url":"https://www.w3.org/TR/css-color-5/#funcdef-lch"},
"absolute-d65-cie-xyz": {"dfnID":"absolute-d65-cie-xyz","dfnText":"Absolute D65 CIE XYZ","external":false,"refSections":[{"refs":[{"id":"ref-for-absolute-d65-cie-xyz"},{"id":"ref-for-absolute-d65-cie-xyz\u2460"}],"title":"5.1. Interpolating colors based on headroom"}],"url":"#absolute-d65-cie-xyz"},
"b3bfee63": {"dfnID":"b3bfee63","dfnText":"xyz-d65","external":true,"refSections":[{"refs":[{"id":"ref-for-valdef-color-xyz-d65"}],"title":"5. HDR colors parameterized by headroom: the hdr-color() function"}],"url":"https://www.w3.org/TR/css-color-4/#valdef-color-xyz-d65"},
"b786b3c1": {"dfnID":"b786b3c1","dfnText":"relative color","external":true,"refSections":[{"refs":[{"id":"ref-for-relative-color"}],"title":"6.3. ICtCp"},{"refs":[{"id":"ref-for-relative-color\u2460"}],"title":"6.4. Jzazbz"},{"refs":[{"id":"ref-for-relative-color\u2461"}],"title":"6.5. JzCzhz"}],"url":"https://www.w3.org/TR/css-color-5/#relative-color"},
"bd774466": {"dfnID":"bd774466","dfnText":"sRGB","external":true,"refSections":[{"refs":[{"id":"ref-for-sRGB-space"},{"id":"ref-for-sRGB-space\u2460"}],"title":"2.1. Defining Dynamic Range"}],"url":"https://www.w3.org/TR/css-color-4/#sRGB-space"},
"bdb4e757": {"dfnID":"bdb4e757","dfnText":"&&","external":true,"refSections":[{"refs":[{"id":"ref-for-comb-all"}],"title":"3.2. Mixing Dynamic Range Limits: the dynamic-range-limit-mix() function"},{"refs":[{"id":"ref-for-comb-all\u2460"}],"title":"5. HDR colors parameterized by headroom: the hdr-color() function"}],"url":"https://www.w3.org/TR/css-values-4/#comb-all"},
"c1a0e909": {"dfnID":"c1a0e909","dfnText":"d65","external":true,"refSections":[{"refs":[{"id":"ref-for-d65"}],"title":"6.1. \n\tIntroducing ICtCp\n"},{"refs":[{"id":"ref-for-d65\u2460"}],"title":"6.3. ICtCp"},{"refs":[{"id":"ref-for-d65\u2461"},{"id":"ref-for-d65\u2462"}],"title":"6.4. Jzazbz"},{"refs":[{"id":"ref-for-d65\u2463"}],"title":"6.5. JzCzhz"},{"refs":[{"id":"ref-for-d65\u2464"}],"title":"8.1. rec2100-pq"},{"refs":[{"id":"ref-for-d65\u2465"}],"title":"8.2. rec2100-hlg"},{"refs":[{"id":"ref-for-d65\u2466"}],"title":"8.3. rec2100-linear"}],"url":"https://www.w3.org/TR/css-color-4/#d65"},
"c297b070": {"dfnID":"c297b070","dfnText":"#","external":true,"refSections":[{"refs":[{"id":"ref-for-mult-comma"}],"title":"3.2. Mixing Dynamic Range Limits: the dynamic-range-limit-mix() function"},{"refs":[{"id":"ref-for-mult-comma\u2460"}],"title":"5. HDR colors parameterized by headroom: the hdr-color() function"}],"url":"https://www.w3.org/TR/css-values-4/#mult-comma"},
"color-re-rendering": {"dfnID":"color-re-rendering","dfnText":"color re-rendering","external":false,"refSections":[],"url":"#color-re-rendering"},
"d04b6986": {"dfnID":"d04b6986","dfnText":"<color>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-color"},{"id":"ref-for-typedef-color\u2460"},{"id":"ref-for-typedef-color\u2461"},{"id":"ref-for-typedef-color\u2462"}],"title":"4. The <color> syntax"},{"refs":[{"id":"ref-for-typedef-color\u2463"},{"id":"ref-for-typedef-color\u2464"}],"title":"5. HDR colors parameterized by headroom: the hdr-color() function"},{"refs":[{"id":"ref-for-typedef-color\u2465"}],"title":"10. \nSerializing <color> Values"}],"url":"https://www.w3.org/TR/css-color-5/#typedef-color"},
"d4441b24": {"dfnID":"d4441b24","dfnText":"?","external":true,"refSections":[{"refs":[{"id":"ref-for-mult-opt"},{"id":"ref-for-mult-opt\u2460"},{"id":"ref-for-mult-opt\u2461"},{"id":"ref-for-mult-opt\u2462"},{"id":"ref-for-mult-opt\u2463"},{"id":"ref-for-mult-opt\u2464"}],"title":"4. The <color> syntax"},{"refs":[{"id":"ref-for-mult-opt\u2465"}],"title":"5. HDR colors parameterized by headroom: the hdr-color() function"}],"url":"https://www.w3.org/TR/css-values-4/#mult-opt"},
"daabf294": {"dfnID":"daabf294","dfnText":"rgb()","external":true,"refSections":[{"refs":[{"id":"ref-for-funcdef-rgb"}],"title":"4. The <color> syntax"}],"url":"https://www.w3.org/TR/css-color-4/#funcdef-rgb"},
"deb378dd": {"dfnID":"deb378dd","dfnText":"oklab()","external":true,"refSections":[{"refs":[{"id":"ref-for-funcdef-oklab"}],"title":"4. The <color> syntax"}],"url":"https://www.w3.org/TR/css-color-5/#funcdef-oklab"},
"dynamic-range": {"dfnID":"dynamic-range","dfnText":"Dynamic range","external":false,"refSections":[],"url":"#dynamic-range"},
"e5db470f": {"dfnID":"e5db470f","dfnText":"<alpha-value>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-color-alpha-value"},{"id":"ref-for-typedef-color-alpha-value\u2460"},{"id":"ref-for-typedef-color-alpha-value\u2461"}],"title":"4. The <color> syntax"}],"url":"https://www.w3.org/TR/css-color-4/#typedef-color-alpha-value"},
"f1cce64a": {"dfnID":"f1cce64a","dfnText":"lab()","external":true,"refSections":[{"refs":[{"id":"ref-for-funcdef-lab"}],"title":"4. The <color> syntax"}],"url":"https://www.w3.org/TR/css-color-5/#funcdef-lab"},
"f3226176": {"dfnID":"f3226176","dfnText":"rgba()","external":true,"refSections":[{"refs":[{"id":"ref-for-funcdef-rgba"}],"title":"4. The <color> syntax"}],"url":"https://www.w3.org/TR/css-color-4/#funcdef-rgba"},
"f4b08404": {"dfnID":"f4b08404","dfnText":"required conversion","external":true,"refSections":[{"refs":[{"id":"ref-for-required-conversion"},{"id":"ref-for-required-conversion\u2460"}],"title":"6.3. ICtCp"},{"refs":[{"id":"ref-for-required-conversion\u2461"},{"id":"ref-for-required-conversion\u2462"}],"title":"6.4. Jzazbz"},{"refs":[{"id":"ref-for-required-conversion\u2463"},{"id":"ref-for-required-conversion\u2464"},{"id":"ref-for-required-conversion\u2465"}],"title":"6.5. JzCzhz"}],"url":"https://drafts.csswg.org/css-color-5/#required-conversion"},
"f6f69187": {"dfnID":"f6f69187","dfnText":"color space","external":true,"refSections":[{"refs":[{"id":"ref-for-color-space"}],"title":"7. \n\tSpecifying Predefined and Custom Color Spaces: the color() Function\n"}],"url":"https://www.w3.org/TR/css-color-4/#color-space"},
"f7f2e8bc": {"dfnID":"f7f2e8bc","dfnText":"hwb()","external":true,"refSections":[{"refs":[{"id":"ref-for-funcdef-hwb"}],"title":"4. The <color> syntax"}],"url":"https://www.w3.org/TR/css-color-5/#funcdef-hwb"},
"funcdef-dynamic-range-limit-mix": {"dfnID":"funcdef-dynamic-range-limit-mix","dfnText":"dynamic-range-limit-mix()","external":false,"refSections":[{"refs":[{"id":"ref-for-funcdef-dynamic-range-limit-mix"},{"id":"ref-for-funcdef-dynamic-range-limit-mix\u2460"}],"title":"3.1. The dynamic-range-limit property"},{"refs":[{"id":"ref-for-funcdef-dynamic-range-limit-mix\u2461"}],"title":"3.2. Mixing Dynamic Range Limits: the dynamic-range-limit-mix() function"},{"refs":[{"id":"ref-for-funcdef-dynamic-range-limit-mix\u2462"},{"id":"ref-for-funcdef-dynamic-range-limit-mix\u2463"}],"title":"3.3. Computed Value for dynamic-range-limit"}],"url":"#funcdef-dynamic-range-limit-mix"},
"funcdef-hdr-color": {"dfnID":"funcdef-hdr-color","dfnText":"hdr-color()","external":false,"refSections":[{"refs":[{"id":"ref-for-funcdef-hdr-color"},{"id":"ref-for-funcdef-hdr-color\u2460"}],"title":"5. HDR colors parameterized by headroom: the hdr-color() function"},{"refs":[{"id":"ref-for-funcdef-hdr-color\u2461"}],"title":"11.6. Sample code for hdr-color()"}],"url":"#funcdef-hdr-color"},
"funcdef-ictcp": {"dfnID":"funcdef-ictcp","dfnText":"ictcp()","external":false,"refSections":[{"refs":[{"id":"ref-for-funcdef-ictcp"}],"title":"4. The <color> syntax"},{"refs":[{"id":"ref-for-funcdef-ictcp\u2460"}],"title":"6.3. ICtCp"}],"url":"#funcdef-ictcp"},
"funcdef-jzazbz": {"dfnID":"funcdef-jzazbz","dfnText":"jzazbz()","external":false,"refSections":[{"refs":[{"id":"ref-for-funcdef-jzazbz"}],"title":"4. The <color> syntax"},{"refs":[{"id":"ref-for-funcdef-jzazbz\u2460"}],"title":"6.4. Jzazbz"}],"url":"#funcdef-jzazbz"},
"funcdef-jzczhz": {"dfnID":"funcdef-jzczhz","dfnText":"jzczhz()","external":false,"refSections":[{"refs":[{"id":"ref-for-funcdef-jzczhz"}],"title":"4. The <color> syntax"},{"refs":[{"id":"ref-for-funcdef-jzczhz\u2460"}],"title":"6.5. JzCzhz"}],"url":"#funcdef-jzczhz"},
"hdr-headroom": {"dfnID":"hdr-headroom","dfnText":"HDR headroom","external":false,"refSections":[{"refs":[{"id":"ref-for-hdr-headroom"}],"title":"2.2. Introducing Headroom"},{"refs":[{"id":"ref-for-hdr-headroom\u2460"},{"id":"ref-for-hdr-headroom\u2461"},{"id":"ref-for-hdr-headroom\u2462"}],"title":"5. HDR colors parameterized by headroom: the hdr-color() function"},{"refs":[{"id":"ref-for-hdr-headroom\u2463"}],"title":"Privacy Considerations"}],"url":"#hdr-headroom"},
"hdr-reference-white": {"dfnID":"hdr-reference-white","dfnText":"HDR reference white","external":false,"refSections":[{"refs":[{"id":"ref-for-hdr-reference-white"}],"title":"2.1. Defining Dynamic Range"},{"refs":[{"id":"ref-for-hdr-reference-white\u2460"}],"title":"8.3. rec2100-linear"}],"url":"#hdr-reference-white"},
"high-dynamic-range": {"dfnID":"high-dynamic-range","dfnText":"High Dynamic Range","external":false,"refSections":[],"url":"#high-dynamic-range"},
"ictcp": {"dfnID":"ictcp","dfnText":"ICtCp","external":false,"refSections":[],"url":"#ictcp"},
"jzazbz": {"dfnID":"jzazbz","dfnText":"Jzazbz","external":false,"refSections":[],"url":"#jzazbz"},
"jzczhz": {"dfnID":"jzczhz","dfnText":"JzCzhz","external":false,"refSections":[],"url":"#jzczhz"},
"propdef-dynamic-range-limit": {"dfnID":"propdef-dynamic-range-limit","dfnText":"dynamic-range-limit","external":false,"refSections":[{"refs":[{"id":"ref-for-propdef-dynamic-range-limit"}],"title":"3.1. The dynamic-range-limit property"},{"refs":[{"id":"ref-for-propdef-dynamic-range-limit\u2460"},{"id":"ref-for-propdef-dynamic-range-limit\u2461"}],"title":"3.2. Mixing Dynamic Range Limits: the dynamic-range-limit-mix() function"},{"refs":[{"id":"ref-for-propdef-dynamic-range-limit\u2462"}],"title":"3.3. Computed Value for dynamic-range-limit"}],"url":"#propdef-dynamic-range-limit"},
"rec2100-hlg": {"dfnID":"rec2100-hlg","dfnText":"rec2100-hlg","external":false,"refSections":[],"url":"#rec2100-hlg"},
"rec2100-linear": {"dfnID":"rec2100-linear","dfnText":"rec2100-linear","external":false,"refSections":[],"url":"#rec2100-linear"},
"rec2100-pq": {"dfnID":"rec2100-pq","dfnText":"rec2100-pq","external":false,"refSections":[],"url":"#rec2100-pq"},
"standard-dynamic-range": {"dfnID":"standard-dynamic-range","dfnText":"Standard Dynamic Range","external":false,"refSections":[{"refs":[{"id":"ref-for-standard-dynamic-range"}],"title":"2.2. Introducing Headroom"}],"url":"#standard-dynamic-range"},
"typedef-color-function": {"dfnID":"typedef-color-function","dfnText":"<color-function>","external":false,"refSections":[{"refs":[{"id":"ref-for-typedef-color-function"}],"title":"4. The <color> syntax"}],"url":"#typedef-color-function"},
"typedef-predefined-rgb": {"dfnID":"typedef-predefined-rgb","dfnText":"<predefined-rgb>","external":false,"refSections":[],"url":"#typedef-predefined-rgb"},
"valdef-dynamic-range-limit-constrained": {"dfnID":"valdef-dynamic-range-limit-constrained","dfnText":"constrained","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-dynamic-range-limit-constrained"},{"id":"ref-for-valdef-dynamic-range-limit-constrained\u2460"},{"id":"ref-for-valdef-dynamic-range-limit-constrained\u2461"},{"id":"ref-for-valdef-dynamic-range-limit-constrained\u2462"}],"title":"3.3. Computed Value for dynamic-range-limit"},{"refs":[{"id":"ref-for-valdef-dynamic-range-limit-constrained\u2463"}],"title":"Accessibility Considerations"}],"url":"#valdef-dynamic-range-limit-constrained"},
"valdef-dynamic-range-limit-no-limit": {"dfnID":"valdef-dynamic-range-limit-no-limit","dfnText":"no-limit","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-dynamic-range-limit-no-limit"},{"id":"ref-for-valdef-dynamic-range-limit-no-limit\u2460"},{"id":"ref-for-valdef-dynamic-range-limit-no-limit\u2461"},{"id":"ref-for-valdef-dynamic-range-limit-no-limit\u2462"}],"title":"3.3. Computed Value for dynamic-range-limit"}],"url":"#valdef-dynamic-range-limit-no-limit"},
"valdef-dynamic-range-limit-standard": {"dfnID":"valdef-dynamic-range-limit-standard","dfnText":"standard","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-dynamic-range-limit-standard"},{"id":"ref-for-valdef-dynamic-range-limit-standard\u2460"},{"id":"ref-for-valdef-dynamic-range-limit-standard\u2461"},{"id":"ref-for-valdef-dynamic-range-limit-standard\u2462"}],"title":"3.3. Computed Value for dynamic-range-limit"},{"refs":[{"id":"ref-for-valdef-dynamic-range-limit-standard\u2463"}],"title":"Accessibility Considerations"}],"url":"#valdef-dynamic-range-limit-standard"},
"valdef-ictcp-alpha": {"dfnID":"valdef-ictcp-alpha","dfnText":"alpha","external":false,"refSections":[],"url":"#valdef-ictcp-alpha"},
"valdef-ictcp-cp": {"dfnID":"valdef-ictcp-cp","dfnText":"cp","external":false,"refSections":[],"url":"#valdef-ictcp-cp"},
"valdef-ictcp-ct": {"dfnID":"valdef-ictcp-ct","dfnText":"ct","external":false,"refSections":[],"url":"#valdef-ictcp-ct"},
"valdef-ictcp-i": {"dfnID":"valdef-ictcp-i","dfnText":"i","external":false,"refSections":[],"url":"#valdef-ictcp-i"},
"valdef-jzazbz-a": {"dfnID":"valdef-jzazbz-a","dfnText":"a","external":false,"refSections":[],"url":"#valdef-jzazbz-a"},
"valdef-jzazbz-alpha": {"dfnID":"valdef-jzazbz-alpha","dfnText":"alpha","external":false,"refSections":[],"url":"#valdef-jzazbz-alpha"},
"valdef-jzazbz-b": {"dfnID":"valdef-jzazbz-b","dfnText":"b","external":false,"refSections":[],"url":"#valdef-jzazbz-b"},
"valdef-jzazbz-j": {"dfnID":"valdef-jzazbz-j","dfnText":"j","external":false,"refSections":[],"url":"#valdef-jzazbz-j"},
"valdef-jzczhz-alpha": {"dfnID":"valdef-jzczhz-alpha","dfnText":"alpha","external":false,"refSections":[],"url":"#valdef-jzczhz-alpha"},
"valdef-jzczhz-c": {"dfnID":"valdef-jzczhz-c","dfnText":"c","external":false,"refSections":[],"url":"#valdef-jzczhz-c"},
"valdef-jzczhz-h": {"dfnID":"valdef-jzczhz-h","dfnText":"h","external":false,"refSections":[],"url":"#valdef-jzczhz-h"},
"valdef-jzczhz-j": {"dfnID":"valdef-jzczhz-j","dfnText":"j","external":false,"refSections":[],"url":"#valdef-jzczhz-j"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-link-titles */
"use strict";
{
let linkTitleData = {
"https://www.w3.org/TR/css-color-5/#typedef-color": "Expands to: <alpha-value> | aliceblue | antiquewhite | aqua | aquamarine | azure | beige | bisque | black | blanchedalmond | blue | blueviolet | brown | burlywood | cadetblue | chartreuse | chocolate | coral | cornflowerblue | cornsilk | crimson | currentcolor | cyan | darkblue | darkcyan | darkgoldenrod | darkgray | darkgreen | darkgrey | darkkhaki | darkmagenta | darkolivegreen | darkorange | darkorchid | darkred | darksalmon | darkseagreen | darkslateblue | darkslategray | darkslategrey | darkturquoise | darkviolet | deeppink | deepskyblue | dimgray | dimgrey | dodgerblue | firebrick | floralwhite | forestgreen | fuchsia | gainsboro | ghostwhite | gold | goldenrod | gray | green | greenyellow | grey | honeydew | hotpink | indianred | indigo | ivory | khaki | lavender | lavenderblush | lawngreen | lemonchiffon | lightblue | lightcoral | lightcyan | lightgoldenrodyellow | lightgray | lightgreen | lightgrey | lightpink | lightsalmon | lightseagreen | lightskyblue | lightslategray | lightslategrey | lightsteelblue | lightyellow | lime | limegreen | linen | magenta | maroon | mediumaquamarine | mediumblue | mediumorchid | mediumpurple | mediumseagreen | mediumslateblue | mediumspringgreen | mediumturquoise | mediumvioletred | midnightblue | mintcream | mistyrose | moccasin | navajowhite | navy | none | oldlace | olive | olivedrab | orange | orangered | orchid | palegoldenrod | palegreen | paleturquoise | palevioletred | papayawhip | peachpuff | peru | pink | plum | powderblue | purple | rebeccapurple | red | rosybrown | royalblue | saddlebrown | salmon | sandybrown | seagreen | seashell | sienna | silver | skyblue | slateblue | slategray | slategrey | snow | springgreen | steelblue | tan | teal | thistle | tomato | transparent | turquoise | violet | wheat | white | whitesmoke | yellow | yellowgreen",
};

function setTypeTitles() {
	for(let el of document.querySelectorAll("a[href]")) {
		if(el.href in linkTitleData && !el.hasAttribute("title")) {
			el.setAttribute("title", linkTitleData[el.href]);
		}
	}
}

document.addEventListener("DOMContentLoaded", setTypeTitles);
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#absolute-d65-cie-xyz": {"displayText":"absolute d65 cie xyz","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-color-hdr","spec":"css-color-hdr-1","status":"local","text":"absolute d65 cie xyz","type":"dfn","url":"#absolute-d65-cie-xyz"},
"#funcdef-dynamic-range-limit-mix": {"displayText":"dynamic-range-limit-mix()","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-color-hdr","spec":"css-color-hdr-1","status":"local","text":"dynamic-range-limit-mix()","type":"function","url":"#funcdef-dynamic-range-limit-mix"},
"#funcdef-hdr-color": {"displayText":"hdr-color()","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-color-hdr","spec":"css-color-hdr-1","status":"local","text":"hdr-color()","type":"function","url":"#funcdef-hdr-color"},
"#funcdef-ictcp": {"displayText":"ictcp()","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-color-hdr","spec":"css-color-hdr-1","status":"local","text":"ictcp()","type":"function","url":"#funcdef-ictcp"},
"#funcdef-jzazbz": {"displayText":"jzazbz()","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-color-hdr","spec":"css-color-hdr-1","status":"local","text":"jzazbz()","type":"function","url":"#funcdef-jzazbz"},
"#funcdef-jzczhz": {"displayText":"jzczhz()","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-color-hdr","spec":"css-color-hdr-1","status":"local","text":"jzczhz()","type":"function","url":"#funcdef-jzczhz"},
"#hdr-headroom": {"displayText":"hdr headroom","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-color-hdr","spec":"css-color-hdr-1","status":"local","text":"hdr headroom","type":"dfn","url":"#hdr-headroom"},
"#hdr-reference-white": {"displayText":"hdr reference white","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-color-hdr","spec":"css-color-hdr-1","status":"local","text":"hdr reference white","type":"dfn","url":"#hdr-reference-white"},
"#propdef-dynamic-range-limit": {"displayText":"dynamic-range-limit","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-color-hdr","spec":"css-color-hdr-1","status":"local","text":"dynamic-range-limit","type":"property","url":"#propdef-dynamic-range-limit"},
"#standard-dynamic-range": {"displayText":"standard dynamic range","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-color-hdr","spec":"css-color-hdr-1","status":"local","text":"standard dynamic range","type":"dfn","url":"#standard-dynamic-range"},
"#typedef-color-function": {"displayText":"<color-function>","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-color-hdr","spec":"css-color-hdr-1","status":"local","text":"<color-function>","type":"type","url":"#typedef-color-function"},
"#valdef-dynamic-range-limit-constrained": {"displayText":"constrained","export":true,"for_":["dynamic-range-limit"],"level":"1","normative":true,"shortname":"css-color-hdr","spec":"css-color-hdr-1","status":"local","text":"constrained","type":"value","url":"#valdef-dynamic-range-limit-constrained"},
"#valdef-dynamic-range-limit-no-limit": {"displayText":"no-limit","export":true,"for_":["dynamic-range-limit"],"level":"1","normative":true,"shortname":"css-color-hdr","spec":"css-color-hdr-1","status":"local","text":"no-limit","type":"value","url":"#valdef-dynamic-range-limit-no-limit"},
"#valdef-dynamic-range-limit-standard": {"displayText":"standard","export":true,"for_":["dynamic-range-limit"],"level":"1","normative":true,"shortname":"css-color-hdr","spec":"css-color-hdr-1","status":"local","text":"standard","type":"value","url":"#valdef-dynamic-range-limit-standard"},
"https://drafts.csswg.org/css-color-5/#funcdef-alpha": {"displayText":"alpha()","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-color","spec":"css-color-5","status":"current","text":"alpha()","type":"function","url":"https://drafts.csswg.org/css-color-5/#funcdef-alpha"},
"https://drafts.csswg.org/css-color-5/#required-conversion": {"displayText":"required conversion","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-color","spec":"css-color-5","status":"current","text":"required conversion","type":"dfn","url":"https://drafts.csswg.org/css-color-5/#required-conversion"},
"https://www.w3.org/TR/css-cascade-5/#computed-value": {"displayText":"computed value","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-cascade","spec":"css-cascade-5","status":"snapshot","text":"computed value","type":"dfn","url":"https://www.w3.org/TR/css-cascade-5/#computed-value"},
"https://www.w3.org/TR/css-color-4/#color-space": {"displayText":"color space","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-color","spec":"css-color-4","status":"snapshot","text":"color space","type":"dfn","url":"https://www.w3.org/TR/css-color-4/#color-space"},
"https://www.w3.org/TR/css-color-4/#d65": {"displayText":"d65","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-color","spec":"css-color-4","status":"snapshot","text":"d65","type":"dfn","url":"https://www.w3.org/TR/css-color-4/#d65"},
"https://www.w3.org/TR/css-color-4/#funcdef-hsl": {"displayText":"hsl()","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-color","spec":"css-color-4","status":"snapshot","text":"hsl()","type":"function","url":"https://www.w3.org/TR/css-color-4/#funcdef-hsl"},
"https://www.w3.org/TR/css-color-4/#funcdef-hsla": {"displayText":"hsla()","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-color","spec":"css-color-4","status":"snapshot","text":"hsla()","type":"function","url":"https://www.w3.org/TR/css-color-4/#funcdef-hsla"},
"https://www.w3.org/TR/css-color-4/#funcdef-rgb": {"displayText":"rgb()","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-color","spec":"css-color-4","status":"snapshot","text":"rgb()","type":"function","url":"https://www.w3.org/TR/css-color-4/#funcdef-rgb"},
"https://www.w3.org/TR/css-color-4/#funcdef-rgba": {"displayText":"rgba()","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-color","spec":"css-color-4","status":"snapshot","text":"rgba()","type":"function","url":"https://www.w3.org/TR/css-color-4/#funcdef-rgba"},
"https://www.w3.org/TR/css-color-4/#luminance": {"displayText":"luminance","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-color","spec":"css-color-4","status":"snapshot","text":"luminance","type":"dfn","url":"https://www.w3.org/TR/css-color-4/#luminance"},
"https://www.w3.org/TR/css-color-4/#sRGB-space": {"displayText":"sRGB","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-color","spec":"css-color-4","status":"snapshot","text":"srgb","type":"dfn","url":"https://www.w3.org/TR/css-color-4/#sRGB-space"},
"https://www.w3.org/TR/css-color-4/#typedef-color-alpha-value": {"displayText":"<alpha-value>","export":true,"for_":["<color>"],"level":"4","normative":true,"shortname":"css-color","spec":"css-color-4","status":"snapshot","text":"<alpha-value>","type":"type","url":"https://www.w3.org/TR/css-color-4/#typedef-color-alpha-value"},
"https://www.w3.org/TR/css-color-4/#typedef-hue": {"displayText":"<hue>","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-color","spec":"css-color-4","status":"snapshot","text":"<hue>","type":"type","url":"https://www.w3.org/TR/css-color-4/#typedef-hue"},
"https://www.w3.org/TR/css-color-4/#valdef-color-none": {"displayText":"none","export":true,"for_":["<color>"],"level":"4","normative":true,"shortname":"css-color","spec":"css-color-4","status":"snapshot","text":"none","type":"value","url":"https://www.w3.org/TR/css-color-4/#valdef-color-none"},
"https://www.w3.org/TR/css-color-4/#valdef-color-white": {"displayText":"white","export":true,"for_":["<color>","<named-color>"],"level":"4","normative":true,"shortname":"css-color","spec":"css-color-4","status":"snapshot","text":"white","type":"value","url":"https://www.w3.org/TR/css-color-4/#valdef-color-white"},
"https://www.w3.org/TR/css-color-4/#valdef-color-xyz-d65": {"displayText":"xyz-d65","export":true,"for_":["color()"],"level":"4","normative":true,"shortname":"css-color","spec":"css-color-4","status":"snapshot","text":"xyz-d65","type":"value","url":"https://www.w3.org/TR/css-color-4/#valdef-color-xyz-d65"},
"https://www.w3.org/TR/css-color-4/#valdef-lab-lab": {"displayText":"lab","export":true,"for_":["lab()"],"level":"4","normative":true,"shortname":"css-color","spec":"css-color-4","status":"snapshot","text":"lab","type":"value","url":"https://www.w3.org/TR/css-color-4/#valdef-lab-lab"},
"https://www.w3.org/TR/css-color-5/#component-keyword": {"displayText":"component keyword","export":false,"for_":[],"level":"5","normative":true,"shortname":"css-color","spec":"css-color-5","status":"snapshot","text":"component keyword","type":"dfn","url":"https://www.w3.org/TR/css-color-5/#component-keyword"},
"https://www.w3.org/TR/css-color-5/#funcdef-color": {"displayText":"color()","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-color","spec":"css-color-5","status":"snapshot","text":"color()","type":"function","url":"https://www.w3.org/TR/css-color-5/#funcdef-color"},
"https://www.w3.org/TR/css-color-5/#funcdef-hwb": {"displayText":"hwb()","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-color","spec":"css-color-5","status":"snapshot","text":"hwb()","type":"function","url":"https://www.w3.org/TR/css-color-5/#funcdef-hwb"},
"https://www.w3.org/TR/css-color-5/#funcdef-lab": {"displayText":"lab()","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-color","spec":"css-color-5","status":"snapshot","text":"lab()","type":"function","url":"https://www.w3.org/TR/css-color-5/#funcdef-lab"},
"https://www.w3.org/TR/css-color-5/#funcdef-lch": {"displayText":"lch()","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-color","spec":"css-color-5","status":"snapshot","text":"lch()","type":"function","url":"https://www.w3.org/TR/css-color-5/#funcdef-lch"},
"https://www.w3.org/TR/css-color-5/#funcdef-oklab": {"displayText":"oklab()","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-color","spec":"css-color-5","status":"snapshot","text":"oklab()","type":"function","url":"https://www.w3.org/TR/css-color-5/#funcdef-oklab"},
"https://www.w3.org/TR/css-color-5/#funcdef-oklch": {"displayText":"oklch()","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-color","spec":"css-color-5","status":"snapshot","text":"oklch()","type":"function","url":"https://www.w3.org/TR/css-color-5/#funcdef-oklch"},
"https://www.w3.org/TR/css-color-5/#origin-color": {"displayText":"origin color","export":false,"for_":[],"level":"5","normative":true,"shortname":"css-color","spec":"css-color-5","status":"snapshot","text":"origin color","type":"dfn","url":"https://www.w3.org/TR/css-color-5/#origin-color"},
"https://www.w3.org/TR/css-color-5/#relative-color": {"displayText":"relative color","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-color","spec":"css-color-5","status":"snapshot","text":"relative color","type":"dfn","url":"https://www.w3.org/TR/css-color-5/#relative-color"},
"https://www.w3.org/TR/css-color-5/#typedef-color": {"displayText":"<color>","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-color","spec":"css-color-5","status":"snapshot","text":"<color>","type":"type","url":"https://www.w3.org/TR/css-color-5/#typedef-color"},
"https://www.w3.org/TR/css-values-4/#comb-all": {"displayText":"&&","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"snapshot","text":"&&","type":"grammar","url":"https://www.w3.org/TR/css-values-4/#comb-all"},
"https://www.w3.org/TR/css-values-4/#comb-one": {"displayText":"|","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"snapshot","text":"|","type":"grammar","url":"https://www.w3.org/TR/css-values-4/#comb-one"},
"https://www.w3.org/TR/css-values-4/#css-wide-keywords": {"displayText":"CSS-wide keywords","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"snapshot","text":"css-wide keywords","type":"dfn","url":"https://www.w3.org/TR/css-values-4/#css-wide-keywords"},
"https://www.w3.org/TR/css-values-4/#mult-comma": {"displayText":"#","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"snapshot","text":"#","type":"grammar","url":"https://www.w3.org/TR/css-values-4/#mult-comma"},
"https://www.w3.org/TR/css-values-4/#mult-opt": {"displayText":"?","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"snapshot","text":"?","type":"grammar","url":"https://www.w3.org/TR/css-values-4/#mult-opt"},
"https://www.w3.org/TR/css-values-4/#number-value": {"displayText":"<number>","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"snapshot","text":"<number>","type":"type","url":"https://www.w3.org/TR/css-values-4/#number-value"},
"https://www.w3.org/TR/css-values-4/#percentage-value": {"displayText":"<percentage>","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"snapshot","text":"<percentage>","type":"type","url":"https://www.w3.org/TR/css-values-4/#percentage-value"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
        // Give the original term if it's being displayed in a different way.
        // But allow casing differences, they're insignificant.
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.displayText)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const refHintKey = link.getAttribute("data-refhint-key");
    let key = url;
    if(refHintKey) {
        key = refHintKey + "_" + url;
    }
    const ref = refsData[key];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-wpt */
"use strict";
{
let wptData = {
"paths": ["/css/css-color-hdr/"],
};

document.addEventListener("DOMContentLoaded", async ()=>{
    if(wptData.paths.length == 0) return;

    const runsUrl = "https://wpt.fyi/api/runs?label=master&label=stable&max-count=1&product=chrome&product=firefox&product=safari&product=edge";
    const runs = await (await fetch(runsUrl)).json();

    let testResults = [];
    for(const pathPrefix of wptData.paths) {
        const pathResults = await (await fetch("https://wpt.fyi/api/search", {
            method:"POST",
            headers:{
                "Content-Type":"application/json",
            },
            body: JSON.stringify({
                "run_ids": runs.map(x=>x.id),
                "query": {"path": pathPrefix},
            })
        })).json();
        testResults = testResults.concat(pathResults.results);
    }

    const browsers = runs.map(x=>({name:x.browser_name, version:x.browser_version, passes:0, total: 0}));
    const resultsFromPath = new Map(testResults.map(result=>{
        const testPath = result.test;
        const passes = result.legacy_status.map(x=>[x.passes, x.total]);
        return [testPath, passes];
    }));
    const seenTests = new Set();
    document.querySelectorAll(".wpt-name").forEach(nameEl=>{
        const passData = resultsFromPath.get("/" + nameEl.getAttribute("title"));
        if(!passData) {
            console.log("Couldn't find test in results:", nameEl);
            return
        }
        const numTests = passData[0][1];
        if(numTests > 1) {
            nameEl.insertAdjacentElement("beforeend",
                mk.small({}, ` (${numTests} tests)`));
        }
        if(passData == undefined) return;
        const resultsEl = mk.span({"class":"wpt-results"},
            ...passData.map((p,i) => mk.span(
            {
                "title": `${browsers[i].name} ${p[0]}/${p[1]}`,
                "class": "wpt-result",
                "style": `background: conic-gradient(forestgreen ${p[0]/p[1]*360}deg, darkred 0deg);`,
            })),
        );
        nameEl.insertAdjacentElement("afterend", resultsEl);

        // Only update the summary pass/total count if we haven't seen this
        // test before, to support authors listing the same test multiple times
        // in a spec.
        if (!seenTests.has(nameEl.getAttribute("title"))) {
            seenTests.add(nameEl.getAttribute("title"));
            passData.forEach((p,i) => {
                browsers[i].passes += p[0];
                browsers[i].total += p[1];
            });
        }
    });
    const overview = document.querySelector(".wpt-overview");
    if(overview) {
        overview.appendChild(mk.ul({}, ...browsers.map(formatWptResult)));
        document.head.appendChild(mk.style({},
            `.wpt-overview ul { display: flex; flex-flow: row wrap; gap: .2em; justify-content: start; list-style: none; padding: 0; margin: 0;}
             .wpt-overview li { padding: .25em 1em; color: black; text-align: center; }
             .wpt-overview img { height: 1.5em; height: max(1.5em, 32px); background: transparent; }
             .wpt-overview .browser { font-weight: bold; }
             .wpt-overview .passes-none { background: #e57373; }
             .wpt-overview .passes-hardly { background: #ffb74d; }
             .wpt-overview .passes-a-few { background: #ffd54f; }
             .wpt-overview .passes-half { background: #fff176; }
             .wpt-overview .passes-lots { background: #dce775; }
             .wpt-overview .passes-most { background: #aed581; }
             .wpt-overview .passes-all { background: #81c784; }`));
    }
});

function formatWptResult({name, version, passes, total}) {
    const passRate = passes/total;
    let passClass = "";
    if(passRate == 0)      passClass = "passes-none";
    else if(passRate < .2) passClass = "passes-hardly";
    else if(passRate < .4) passClass = "passes-a-few";
    else if(passRate < .6) passClass = "passes-half";
    else if(passRate < .8) passClass = "passes-lots";
    else if(passRate < 1)  passClass = "passes-most";
    else                   passClass = "passes-all";

    name = name[0].toUpperCase() + name.slice(1);
    const shortVersion = /^\d+/.exec(version);
    const icon = []

    if(name == "Chrome") icon.push(mk.img({alt:"", src:"https://wpt.fyi/static/chrome_64x64.png"}));
    if(name == "Edge") icon.push(mk.img({alt:"", src:"https://wpt.fyi/static/edge_64x64.png"}));
    if(name == "Safari") icon.push(mk.img({alt:"", src:"https://wpt.fyi/static/safari_64x64.png"}));
    if(name == "Firefox") icon.push(mk.img({alt:"", src:"https://wpt.fyi/static/firefox_64x64.png"}));

    return mk.li({"class":passClass},
        mk.nobr({'class':'browser'}, ...icon, ` ${name} ${shortVersion}`),
        mk.br(),
        mk.nobr({'class':'pass-rate'}, `${passes}/${total}`)
    );
}
}
</script>