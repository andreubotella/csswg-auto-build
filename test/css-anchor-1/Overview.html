<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>CSS Anchor Positioning</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <meta content="Bikeshed version 618007319, updated Thu Jun 26 17:23:55 2025 -0700" name="generator">
  <link href="https://drafts.csswg.org/css-anchor-1/" rel="canonical">
  <link href="https://drafts.csswg.org/csslogo.ico" rel="icon">
  <meta content="03f6b66e0a3c0b5bb1044b7d88aa6674e31c5129" name="revision">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

[data-algorithm] var { cursor: pointer; }
var[data-var-color] { background-color: var(--var-bg); box-shadow: 0 0 0 2px var(--var-bg); }

var[data-var-color] { --var-bg: #F4D200; }
var[data-var-color="1"] { --var-bg: #FF87A2; }
var[data-var-color="2"] { --var-bg: #96E885; }
var[data-var-color="3"] { --var-bg: #3EEED2; }
var[data-var-color="4"] { --var-bg: #EACFB6; }
var[data-var-color="5"] { --var-bg: #82DDFF; }
var[data-var-color="6"] { --var-vg: #FFBCF2; }

@media (prefers-color-scheme: dark) {
	var[data-var-color] { --var-bg: #bc1a00; }
	var[data-var-color="1"] { --var-bg: #007f00; }
	var[data-var-color="2"] { --var-bg: #008698; }
	var[data-var-color="3"] { --var-bg: #7f5b2b; }
	var[data-var-color="4"] { --var-bg: #004df3; }
	var[data-var-color="5"] { --var-bg: #a1248a; }
	var[data-var-color="6"] { --var-vg: #ff0000; }
}
</style>
<style>/* Boilerplate: style-wpt */
:root {
    --wpt-border: hsl(0, 0%, 60%);
    --wpt-bg: hsl(0, 0%, 95%);
    --wpt-text: var(--text);
    --wptheading-text: hsl(0, 0%, 30%);
}
@media (prefers-color-scheme: dark) {
    :root {
        --wpt-border: hsl(0, 0%, 30%);
        --wpt-bg: var(--borderedblock-bg);
        --wpt-text: var(--text);
        --wptheading-text: hsl(0, 0%, 60%);
    }
}
.wpt-tests-block {
    list-style: none;
    border-left: .5em solid var(--wpt-border);
    background: var(--wpt-bg);
    color: var(--wpt-text);
    margin: 1em auto;
    padding: .5em;
}
.wpt-tests-block summary {
    color: var(--wptheading-text);
    font-weight: normal;
    text-transform: uppercase;
}
.wpt-tests-block summary::marker{
    color: var(--wpt-border);
}
.wpt-tests-block summary:hover::marker{
    color: var(--wpt-text);
}
/*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
.wpt-tests-block:not([open]){
    padding: 0;
    border: none;
    background: none;
    font-size: 0.75em;
    line-height: 1;
    position: relative;
    margin: 1em 0 0;
}
.wpt-tests-block:not([open]) summary {
    position: absolute;
    right: 0;
    bottom: 0;
}
/*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
.wpt-tests-block:not([open]):last-child {
    padding-bottom: 1px;
    margin-bottom: -1px;
}
/*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
li:not(:last-child) > .wpt-tests-block:not([open]):last-child,
dd:not(:last-child) > .wpt-tests-block:not([open]):last-child {
    padding-bottom: 0;
    margin-bottom: 0;
}
.wpt-tests-block:not([open]):not(:hover){
    opacity: 0.5;
}
.wpt-tests-list {
    list-style: none;
    display: grid;
    margin: 0;
    padding: 0;
    grid-template-columns: 1fr max-content auto auto;
    grid-column-gap: .5em;
}
.wpt-tests-block hr:last-child {
    display: none;
}
.wpt-test {
    display: contents;
}
.wpt-test > a {
    text-decoration: underline;
    border: none;
}
.wpt-test > .wpt-name { grid-column: 1; }
.wpt-test > .wpt-results { grid-column: 2; }
.wpt-test > .wpt-live { grid-column: 3; }
.wpt-test > .wpt-source { grid-column: 4; }

.wpt-test > .wpt-results {
    display: flex;
    gap: .1em;
}
.wpt-test .wpt-result {
    display: inline-block;
    height: 1em;
    width: 1em;
    border-radius: 50%;
    position: relative;
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/">
    <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
</a>
</p>
   <h1 class="p-name no-ref" id="title">CSS Anchor Positioning</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#ED">Editor’s Draft</a>,
    <time class="dt-updated" datetime="2025-06-30">30 June 2025</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://drafts.csswg.org/css-anchor-1/">https://drafts.csswg.org/css-anchor-1/</a>
      <dt>Issue Tracking:
      <dd><a href="https://github.com/w3c/csswg-drafts/labels/css-anchor-1">CSSWG Issues Repository</a>
      <dd><a href="#issues-index">Inline In Spec</a>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard" data-editor-id="42199"><a class="p-name fn u-url url" href="http://xanthir.com/contact/">Tab Atkins-Bittner</a> (<span class="p-org org">Google</span>)
      <dd class="editor p-author h-card vcard" data-editor-id="137616"><a class="p-name fn u-url url" href="https://twitter.com/jh3yy">Jhey Tompkins</a> (<span class="p-org org">Google</span>)
      <dd class="editor p-author h-card vcard"><span class="p-name fn">Ian Kilpatrick</span> (<span class="p-org org">Google</span>)
      <dt>Suggest an Edit for this Spec:
      <dd><a href="https://github.com/w3c/csswg-drafts/blob/main/css-anchor-1/Overview.bs">GitHub Editor</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 2025 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply.
</p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification defines 'anchor positioning', where a positioned element can size and position itself relative to one or more "anchor elements" elsewhere on the page.</p>
   


<a href="https://www.w3.org/TR/CSS/">CSS</a> is a language for describing the rendering of structured documents
(such as HTML and XML)
on screen, on paper, etc.


  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p>
	This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress.

</p>
   <p>Please send feedback
	by <a href="https://github.com/w3c/csswg-drafts/issues">filing issues in GitHub</a> (preferred),
	including the spec code “css-anchor” in the title, like this:
	“[css-anchor] <i>…summary of comment…</i>”.
	All issues and comments are <a href="https://lists.w3.org/Archives/Public/public-css-archive/">archived</a>.
	Alternately, feedback can be sent to the (<a href="https://lists.w3.org/Archives/Public/www-style/">archived</a>) public mailing list
	<a href="mailto:www-style@w3.org?Subject=%5Bcss-anchor%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a>.

</p>
   <p>This document is governed by the
	<a href="https://www.w3.org/policies/process/20231103/" id="w3c_process_revision">03 November 2023 W3C Process Document</a>.

</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#anchoring"><span class="secno">2</span> <span class="content">Anchoring</span></a>
     <ol class="toc">
      <li><a href="#anchor-pos"><span class="secno">2.1</span> <span class="content">Anchor-based Positioning: the <span class="css">anchor()</span> function</span></a>
      <li><a href="#anchor-size"><span class="secno">2.2</span> <span class="content">Anchor-based Sizing: the <span class="css">anchor-size()</span> function</span></a>
      <li><a href="#scroll"><span class="secno">2.3</span> <span class="content">Taking Scroll Into Account: the <span class="property">anchor-scroll</span> property</span></a>
      <li><a href="#determining"><span class="secno">2.4</span> <span class="content">Determining The Anchor: the <span class="property">anchor-name</span> property</span></a>
      <li><a href="#queries"><span class="secno">2.5</span> <span class="content">Anchor Queries</span></a>
     </ol>
    <li>
     <a href="#fallback"><span class="secno">3</span> <span class="content">Fallback Sizing/Positioning</span></a>
     <ol class="toc">
      <li><a href="#fallback-property"><span class="secno">3.1</span> <span class="content">The <span class="property">position-fallback</span> Property</span></a>
      <li><a href="#fallback-rule"><span class="secno">3.2</span> <span class="content">The <span class="css">@position-fallback</span> Rule</span></a>
      <li><a href="#fallback-apply"><span class="secno">3.3</span> <span class="content">Applying Position Fallback</span></a>
     </ol>
    <li><a href="#sec"><span class="secno">4</span> <span class="content">Security Considerations</span></a>
    <li><a href="#priv"><span class="secno">5</span> <span class="content">Privacy Considerations</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">
Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">
Document conventions</span></a>
      <li><a href="#w3c-conformance-classes"><span class="secno"></span> <span class="content">
Conformance classes</span></a>
      <li>
       <a href="#w3c-partial"><span class="secno"></span> <span class="content">
Partial implementations</span></a>
       <ol class="toc">
        <li><a href="#w3c-conform-future-proofing"><span class="secno"></span> <span class="content">
Implementations of Unstable and Proprietary Features</span></a>
       </ol>
      <li><a href="#w3c-testing"><span class="secno"></span> <span class="content">
Non-experimental implementations</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#property-index"><span class="secno"></span> <span class="content">Property Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>Introduction here.</p>
   <h2 class="heading settled" data-level="2" id="anchoring"><span class="secno">2. </span><span class="content">Anchoring</span><a class="self-link" href="#anchoring"></a></h2>
   <p>While CSS generally determines the position and size of elements
according to their parents or other ancestors,
<a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position" id="ref-for-absolute-position">absolutely positioned</a> elements barely participate in their ancestors' layout.
Instead, they’re sized and positioned explicitly
by the <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-logical-1/#inset-properties" id="ref-for-inset-properties">inset properties</a> and <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-align-3/#box-alignment-properties" id="ref-for-box-alignment-properties">box alignment properties</a>,
only referencing the final size and position of their <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block" id="ref-for-containing-block">containing block</a>.
This provides extreme flexibility,
allowing elements to be positioned more or less arbitrarily,
including over the top of other elements
in ways that the layout methods don’t otherwise allow,
but in return it’s not very expressive—​the element cannot easily express its size and position
in terms of other elements on the page.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="anchor function" id="anchor-function">anchor functions</dfn>
<a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor">anchor()</a> and <a class="css" data-link-type="maybe" href="#funcdef-anchor-size" id="ref-for-funcdef-anchor-size">anchor-size()</a>,
defined below,
give back some of the expressivity of ordinary layout
without compromising on the flexibility and power of <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position" id="ref-for-absolute-position①">absolute positioning</a>.
Using these functions,
one can size and position an <span id="ref-for-absolute-position②">absolutely positioned</span> element
relative to one or more <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element">anchor elements</a> on the page.
The <span class="css">@position-set</span> rule allows even more flexibility,
allowing multiple different sizes/positions to be tried out sequentially
until one is found that fits within the <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block" id="ref-for-containing-block①">containing block</a>.</p>
   <h3 class="heading settled" data-level="2.1" id="anchor-pos"><span class="secno">2.1. </span><span class="content">Anchor-based Positioning: the <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor①">anchor()</a> function</span><a class="self-link" href="#anchor-pos"></a></h3>
   <p>An <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position" id="ref-for-absolute-position③">absolutely-positioned</a> element
can use the <dfn class="dfn-paneled css" data-dfn-type="function" data-export id="funcdef-anchor">anchor()</dfn> function
as a value in its <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-logical-1/#inset-properties" id="ref-for-inset-properties①">inset properties</a>
to refer to the position of one or more <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element①">anchor elements</a>.
The <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor②">anchor()</a> function resolves to a <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#length-value" id="ref-for-length-value">&lt;length></a>.</p>
<pre class="prod">anchor() = anchor( <a class="production" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident">&lt;dashed-ident></a><a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#mult-opt" id="ref-for-mult-opt">?</a> <a class="production" data-link-type="type" href="#typedef-anchor-side" id="ref-for-typedef-anchor-side">&lt;anchor-side></a><a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-comma" id="ref-for-comb-comma">,</a> <a class="production" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-length-percentage" id="ref-for-typedef-length-percentage">&lt;length-percentage></a><a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#mult-opt" id="ref-for-mult-opt①">?</a> )
<dfn class="dfn-paneled" data-dfn-type="type" data-export id="typedef-anchor-side"><a class="production" data-link-type="type" href="#typedef-anchor-side" id="ref-for-typedef-anchor-side①">&lt;anchor-side></a></dfn> = top <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one">|</a> left <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one①">|</a> right <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one②">|</a> bottom
        <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one③">|</a> start <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one④">|</a> end <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one⑤">|</a> self-start <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one⑥">|</a> self-end
        <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one⑦">|</a> <a class="production" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#percentage-value" id="ref-for-percentage-value">&lt;percentage></a> <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one⑧">|</a> center
</pre>
   <p>The <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor③">anchor()</a> function has three arguments:</p>
   <ul>
    <li data-md>
     <p>the <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident①">&lt;dashed-ident></a> specifies the <a data-link-type="dfn" href="#anchor-name" id="ref-for-anchor-name">anchor name</a> of the <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element②">anchor element</a>
it will be drawing positioning information from.
See <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element">target anchor element</a> for details.
This name is a <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-scoping-1/#css-tree-scoped-reference" id="ref-for-css-tree-scoped-reference">tree-scoped reference</a>.</p>
     <p>If omitted, the function uses an element’s <a data-link-type="dfn" href="#implicit-anchor-element" id="ref-for-implicit-anchor-element">implicit anchor element</a> instead.</p>
    <li data-md>
     <p>the <a class="production css" data-link-type="type" href="#typedef-anchor-side" id="ref-for-typedef-anchor-side②">&lt;anchor-side></a> value
refers to the position of the corresponding side
of the <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element①">target anchor element</a>.</p>
     <p>The physical <a class="production css" data-link-type="type" href="#typedef-anchor-side" id="ref-for-typedef-anchor-side③">&lt;anchor-side></a> keywords
(<dfn class="dfn-paneled css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-left">left</dfn>,
<dfn class="dfn-paneled css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-right">right</dfn>,
<dfn class="dfn-paneled css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-top">top</dfn>,
and <dfn class="dfn-paneled css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-bottom">bottom</dfn>)
are only useful in <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-logical-1/#inset-properties" id="ref-for-inset-properties②">inset properties</a>
corresponding to their corresponding axis:
for example, using <a class="css" data-link-type="maybe" href="#valdef-anchor-top" id="ref-for-valdef-anchor-top">top</a> and <a class="css" data-link-type="maybe" href="#valdef-anchor-bottom" id="ref-for-valdef-anchor-bottom">bottom</a> in <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-left" id="ref-for-propdef-left">left</a> or <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-right" id="ref-for-propdef-right">right</a>
(or in <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-inset-inline-start" id="ref-for-propdef-inset-inline-start">inset-inline-start</a> if the inline axis is horizontal, etc)
results in an <a data-link-type="dfn" href="#valid-anchor-query" id="ref-for-valid-anchor-query">invalid anchor query</a>.</p>
     <p>The logical <a class="production css" data-link-type="type" href="#typedef-anchor-side" id="ref-for-typedef-anchor-side④">&lt;anchor-side></a> keywords
(<dfn class="dfn-paneled css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-start">start</dfn>,
<dfn class="dfn-paneled css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-end">end</dfn>,
<dfn class="dfn-paneled css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-self-start">self-start</dfn>,
and <dfn class="dfn-paneled css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-self-end">self-end</dfn>)
map to one of the physical keywords
depending on the property the function is being used in
(<a class="css" data-link-type="maybe" href="#valdef-anchor-top" id="ref-for-valdef-anchor-top①">top</a> or <a class="css" data-link-type="maybe" href="#valdef-anchor-bottom" id="ref-for-valdef-anchor-bottom①">bottom</a> in the <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-top" id="ref-for-propdef-top">top</a> or <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-bottom" id="ref-for-propdef-bottom">bottom</a> properties, etc)
and the <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-writing-modes-4/#writing-mode" id="ref-for-writing-mode">writing mode</a> of either the element
(for <a class="css" data-link-type="maybe" href="#valdef-anchor-self-start" id="ref-for-valdef-anchor-self-start">self-start</a> and <a class="css" data-link-type="maybe" href="#valdef-anchor-self-end" id="ref-for-valdef-anchor-self-end">self-end</a>)
or the <span id="ref-for-writing-mode①">writing mode</span> of the element’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block" id="ref-for-containing-block②">containing block</a>
(for <a class="css" data-link-type="maybe" href="#valdef-anchor-start" id="ref-for-valdef-anchor-start">start</a> and <a class="css" data-link-type="maybe" href="#valdef-anchor-end" id="ref-for-valdef-anchor-end">end</a>).</p>
     <p class="issue" id="issue-c74bca11"><a class="self-link" href="#issue-c74bca11"></a> Do we need to refer to the anchor element’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-writing-modes-4/#writing-mode" id="ref-for-writing-mode②">writing mode</a>?
I think that’s too unpredictable to actually do anything useful.
If you’re specifying your <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-inset-inline-start" id="ref-for-propdef-inset-inline-start①">inset-inline-start</a> property,
you almost certainly want to refer to an anchor edge
relative to your own directions,
not an unpredictable edge based on the anchor.</p>
     <p>A <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#percentage-value" id="ref-for-percentage-value①">&lt;percentage></a> value refers to a position
a corresponding percentage between the <a class="css" data-link-type="maybe" href="#valdef-anchor-start" id="ref-for-valdef-anchor-start①">start</a> and <a class="css" data-link-type="maybe" href="#valdef-anchor-end" id="ref-for-valdef-anchor-end①">end</a> sides,
with <span class="css">0%</span> being equivalent to <span class="css" id="ref-for-valdef-anchor-start②">start</span>
and <span class="css">100%</span> being equivalent to <span class="css" id="ref-for-valdef-anchor-end②">end</span>.
The <dfn class="dfn-paneled css" data-dfn-for="anchor()" data-dfn-type="value" data-export id="valdef-anchor-center">center</dfn> keyword is equivalent to <span class="css">50%</span>.</p>
    <li data-md>
     <p>the optional <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-length-percentage" id="ref-for-typedef-length-percentage①">&lt;length-percentage></a> final argument is a fallback value.
If the <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor④">anchor()</a> represents an <a data-link-type="dfn" href="#valid-anchor-query" id="ref-for-valid-anchor-query①">invalid anchor query</a>,
it resolves to this value
rather that determining its value as detailed below.</p>
     <p>If omitted,
it defaults to <span class="css">0px</span>.</p>
   </ul>
   <p>An <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor⑤">anchor()</a> function representing a <a data-link-type="dfn" href="#valid-anchor-query" id="ref-for-valid-anchor-query②">valid anchor query</a>
resolves to the <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#length-value" id="ref-for-length-value①">&lt;length></a>
that would align the edge
of the positioned elements' <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#inset-modified-containing-block" id="ref-for-inset-modified-containing-block">inset-modified containing block</a>
corresponding to the property the function appears in
with the specified border edge of the <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element②">target anchor element</a>,
assuming that all <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-overflow-3/#scroll-container" id="ref-for-scroll-container">scroll containers</a>
between the <span id="ref-for-target-anchor-element③">target anchor element</span>
and the positioned element’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block" id="ref-for-containing-block③">containing block</a>
are scrolled to their initial scroll position
(but see <a class="property css" data-link-type="property" href="#propdef-anchor-scroll" id="ref-for-propdef-anchor-scroll">anchor-scroll</a>).</p>
   <p>If the <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element④">target anchor element</a> is <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-break-4/#fragment" id="ref-for-fragment">fragmented</a>,
the axis-aligned bounding rectangle
of the fragments' border boxes is used instead.</p>
   <p class="issue" id="issue-3c6fe13f"><a class="self-link" href="#issue-3c6fe13f"></a> Do we need to control which box we’re referring to,
so you can align to padding or content edge?</p>
   <p>If the positioned element
has a <a data-link-type="dfn" href="#snapshotted-scroll-offset" id="ref-for-snapshotted-scroll-offset">snapshotted scroll offset</a>,
then it is additionally visually shifted
by those offsets,
as if by an additional <a class="css" data-link-type="maybe" href="https://andreubotella.com/csswg-auto-build/test/css-transforms-1/#funcdef-transform-translate" id="ref-for-funcdef-transform-translate">translate()</a> transform.</p>
   <div class="example" id="example-ef794aa0">
    <a class="self-link" href="#example-ef794aa0"></a>
	For example,
	in <span class="css">.bar { top: anchor(--foo top); }</span>,
	the <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor⑥">anchor()</a> will resolve to the length
	that’ll line up the <code>.bar</code> element’s top edge
	with the <span class="css">--foo</span> anchor’s top edge.


    <p>On the other hand,
	in <span class="css">.bar { bottom: anchor(--foo top); }</span>,
	it will instead resolve to the length
	that’ll line up the <code>.bar</code> element’s <em>bottom</em> edge
	with the <span class="css">--foo</span> anchor’s top edge.</p>
    <p>Since <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-top" id="ref-for-propdef-top①">top</a> and <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-bottom" id="ref-for-propdef-bottom①">bottom</a> values specify insets from different edges
	(the top and bottom of the element’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block" id="ref-for-containing-block④">containing block</a>,
	respectively),
	the same <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor⑦">anchor()</a> will usually resolve to different lengths in each.</p>
   </div>
   <div class="example" id="example-fcdb8337">
    <a class="self-link" href="#example-fcdb8337"></a>
	Because the <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor⑧">anchor()</a> function resolves to a <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#length-value" id="ref-for-length-value②">&lt;length></a>,
	it can be used in <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#math-function" id="ref-for-math-function">math functions</a> like any other length.


    <p>For example, the following will set up the element
	so that its <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#inset-modified-containing-block" id="ref-for-inset-modified-containing-block①">inset-modified containing block</a>
	is centered on the <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element③">anchor element</a>
	and as wide as possible without overflowing the <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block" id="ref-for-containing-block⑤">containing block</a>:</p>
<pre class="highlight">.centered-message <c- p>{</c->
  <c- k>position</c-><c- p>:</c-> fixed<c- p>;</c->
  <c- k>max-width</c-><c- p>:</c-> max-content<c- p>;</c->
  <c- k>justify-content</c-><c- p>:</c-> center<c- p>;</c->

  <c- k>--center</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--x <c- m>50</c-><c- k>%</c-><c- p>);</c->
  <c- k>--half-distance</c-><c- p>:</c-> <c- nf>min</c-><c- p>(</c->
    <c- nf>abs</c-><c- p>(</c-><c- m>0</c-><c- k>%</c-> - <c- nf>var</c-><c- p>(</c->--center<c- p>)),</c->
    <c- nf>abs</c-><c- p>(</c-><c- m>100</c-><c- k>%</c-> - <c- nf>var</c-><c- p>(</c->--center<c- p>))</c->
  <c- p>);</c->
  <c- k>left</c-><c- p>:</c-> <c- nf>calc</c-><c- p>(</c-><c- nf>var</c-><c- p>(</c->--center<c- p>)</c-> - <c- nf>var</c-><c- p>(</c->--half-distance<c- p>));</c->
  <c- k>right</c-><c- p>:</c-> <c- nf>calc</c-><c- p>(</c-><c- nf>var</c-><c- p>(</c->--center<c- p>)</c-> - <c- nf>var</c-><c- p>(</c->--half-distance<c- p>));</c->
  <c- k>bottom</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--x top<c- p>);</c->
<c- p>}</c->
</pre>
    <p>This might be appropriate for an error message
	on an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/input.html#the-input-element" id="ref-for-the-input-element">input</a></code> element,
	for example,
	as the centering will make it easier to discover
	which input is being referred to.</p>
   </div>
   <h3 class="heading settled" data-level="2.2" id="anchor-size"><span class="secno">2.2. </span><span class="content">Anchor-based Sizing: the <a class="css" data-link-type="maybe" href="#funcdef-anchor-size" id="ref-for-funcdef-anchor-size①">anchor-size()</a> function</span><a class="self-link" href="#anchor-size"></a></h3>
   <p>An <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position" id="ref-for-absolute-position④">absolutely-positioned</a> element
can use the <dfn class="dfn-paneled css" data-dfn-type="function" data-export id="funcdef-anchor-size">anchor-size()</dfn> function
in its <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-sizing-3/#sizing-property" id="ref-for-sizing-property">sizing properties</a>
to refer to the size of one or more <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element④">anchor elements</a>.
The <a class="css" data-link-type="maybe" href="#funcdef-anchor-size" id="ref-for-funcdef-anchor-size②">anchor-size()</a> function resolves to a <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#length-value" id="ref-for-length-value③">&lt;length></a>.</p>
<pre class="prod">anchor-size() = anchor( <a class="production" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident②">&lt;dashed-ident></a><a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#mult-opt" id="ref-for-mult-opt②">?</a> <a class="production" data-link-type="type" href="#typedef-anchor-size" id="ref-for-typedef-anchor-size">&lt;anchor-size></a><a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-comma" id="ref-for-comb-comma①">,</a> <a class="production" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-length-percentage" id="ref-for-typedef-length-percentage②">&lt;length-percentage></a><a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#mult-opt" id="ref-for-mult-opt③">?</a> )
<dfn class="dfn-paneled" data-dfn-type="type" data-export id="typedef-anchor-size"><a class="production" data-link-type="type" href="#typedef-anchor-size" id="ref-for-typedef-anchor-size①">&lt;anchor-size></a></dfn> = width <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one⑨">|</a> height <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one①⓪">|</a> block <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one①①">|</a> inline <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one①②">|</a> self-block <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one①③">|</a> self-inline
</pre>
   <p>The <a class="css" data-link-type="maybe" href="#funcdef-anchor-size" id="ref-for-funcdef-anchor-size③">anchor-size()</a> function is similar to <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor⑨">anchor()</a>,
and takes the same arguments,
save that the <a class="production css" data-link-type="type" href="#typedef-anchor-side" id="ref-for-typedef-anchor-side⑤">&lt;anchor-side></a> keywords are replaced with <a class="production css" data-link-type="type" href="#typedef-anchor-size" id="ref-for-typedef-anchor-size②">&lt;anchor-size></a>,
referring to the distance between two opposing sides.</p>
   <p>The physical <a class="production css" data-link-type="type" href="#typedef-anchor-size" id="ref-for-typedef-anchor-size③">&lt;anchor-size></a> keywords
(<dfn class="dfn-paneled css" data-dfn-for="anchor-size()" data-dfn-type="value" data-export id="valdef-anchor-size-width">width</dfn>
and <dfn class="dfn-paneled css" data-dfn-for="anchor-size()" data-dfn-type="value" data-export id="valdef-anchor-size-height">height</dfn>)
refer to the width and height,
respectively,
of the <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element⑤">target anchor element</a>.
Unlike <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor①⓪">anchor()</a>, there is no restriction on having to match axises;
for example, <a class="css" data-link-type="propdesc" href="https://andreubotella.com/csswg-auto-build/test/css-sizing-3/#propdef-width" id="ref-for-propdef-width">width: anchor-size(--foo height);</a> is valid.</p>
   <p>The logical <a class="production css" data-link-type="type" href="#typedef-anchor-size" id="ref-for-typedef-anchor-size④">&lt;anchor-size></a> keywords
(<dfn class="dfn-paneled css" data-dfn-for="anchor-size()" data-dfn-type="value" data-export id="valdef-anchor-size-block">block</dfn>,
<dfn class="dfn-paneled css" data-dfn-for="anchor-size()" data-dfn-type="value" data-export id="valdef-anchor-size-inline">inline</dfn>,
<dfn class="dfn-paneled css" data-dfn-for="anchor-size()" data-dfn-type="value" data-export id="valdef-anchor-size-self-block">self-block</dfn>,
and <dfn class="dfn-paneled css" data-dfn-for="anchor-size()" data-dfn-type="value" data-export id="valdef-anchor-size-self-inline">self-inline</dfn>)
map to one of the physical keywords
according to either the <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-writing-modes-4/#writing-mode" id="ref-for-writing-mode③">writing mode</a> of the element
(for <a class="css" data-link-type="maybe" href="#valdef-anchor-size-self-block" id="ref-for-valdef-anchor-size-self-block">self-block</a> and <a class="css" data-link-type="maybe" href="#valdef-anchor-size-self-inline" id="ref-for-valdef-anchor-size-self-inline">self-inline</a>)
or the <span id="ref-for-writing-mode④">writing mode</span> of the element’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block" id="ref-for-containing-block⑥">containing block</a>
(for <a class="css" data-link-type="maybe" href="#valdef-anchor-size-block" id="ref-for-valdef-anchor-size-block">block</a> and <a class="css" data-link-type="maybe" href="#valdef-anchor-size-inline" id="ref-for-valdef-anchor-size-inline">inline</a>).</p>
   <p>An <a class="css" data-link-type="maybe" href="#funcdef-anchor-size" id="ref-for-funcdef-anchor-size④">anchor-size()</a> function representing a <a data-link-type="dfn" href="#valid-anchor-query" id="ref-for-valid-anchor-query③">valid anchor query</a>
resolves to the <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#length-value" id="ref-for-length-value④">&lt;length></a> separating the relevant border edges
(either left and right, or top and bottom,
whichever is in the specified axis)
of the <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element⑥">target anchor element</a>.</p>
   <h3 class="heading settled" data-level="2.3" id="scroll"><span class="secno">2.3. </span><span class="content">Taking Scroll Into Account: the <a class="property css" data-link-type="property" href="#propdef-anchor-scroll" id="ref-for-propdef-anchor-scroll①">anchor-scroll</a> property</span><a class="self-link" href="#scroll"></a></h3>
   <table class="def propdef" data-link-for-hint="anchor-scroll">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-anchor-scroll">anchor-scroll</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">none <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one①④">|</a> <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident③">&lt;dashed-ident></a>
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>none
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td><a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position" id="ref-for-absolute-position⑤">absolutely-positioned</a> elements
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>no
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>n/a
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>as specified
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>discrete
   </table>
   <p>Because scrolling is often done in a separate thread from layout in implementations for performance reasons,
but <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor①①">anchor()</a> can result in both positioning changes
(which can be handled in the scrolling thread)
and layout changes
(which cannot),
<span class="css" id="ref-for-funcdef-anchor①②">anchor()</span> is defined to assume
all the <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-overflow-3/#scroll-container" id="ref-for-scroll-container①">scroll containers</a> between the anchor element
and the positioned element’s containing block
are at their initial scroll position.
This means a positioned element
will <em>not</em> be aligned with its anchor
if any of the scrollers are <em>not</em> at their initial positions.</p>
   <p>The <a class="property css" data-link-type="property" href="#propdef-anchor-scroll" id="ref-for-propdef-anchor-scroll②">anchor-scroll</a> property allows an author to compensate for this,
without losing the performance benefits of the separate scrolling thread,
so long as the positioned element
is only anchoring to a single anchor element.
Its values are:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled css" data-dfn-for="anchor-scroll" data-dfn-type="value" data-export id="valdef-anchor-scroll-none">none</dfn>
    <dd data-md>
     <p>No effect.</p>
    <dt data-md><dfn class="dfn-paneled css" data-dfn-for="anchor-scroll" data-dfn-type="value" data-export id="valdef-anchor-scroll-dashed-ident"><a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident④">&lt;dashed-ident></a></dfn>
    <dd data-md>
     <p>The scroll offsets of the <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element⑦">target anchor element</a>
with the name given by the <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident⑤">&lt;dashed-ident></a>
will be compensated for in positioning and fallback.</p>
    <dt data-md><dfn class="dfn-paneled css" data-dfn-for="anchor-scroll" data-dfn-type="value" data-export id="valdef-anchor-scroll-implicit">implicit</dfn>
    <dd data-md>
     <p>The scroll offsets of the <a data-link-type="dfn" href="#implicit-anchor-element" id="ref-for-implicit-anchor-element①">implicit anchor element</a>
will be compensated for in positioning and fallback.</p>
   </dl>
   <div class="algorithm" data-algorithm="compensate for scroll">
    
	If <a class="property css" data-link-type="property" href="#propdef-anchor-scroll" id="ref-for-propdef-anchor-scroll③">anchor-scroll</a> is not <a class="css" data-link-type="maybe" href="#valdef-anchor-scroll-none" id="ref-for-valdef-anchor-scroll-none">none</a>
	on an <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position" id="ref-for-absolute-position⑥">absolutely-positioned</a> element <var>query el</var>,
	and there is a <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element⑧">target anchor element</a> for <var>query el</var>
	with either the name given by <span class="property" id="ref-for-propdef-anchor-scroll④">anchor-scroll</span>
	(if its value is a <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident⑥">&lt;dashed-ident></a>)
	or no name
	(if its value is <a class="css" data-link-type="maybe" href="#valdef-anchor-scroll-implicit" id="ref-for-valdef-anchor-scroll-implicit">implicit</a>),
	and at least one <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor①③">anchor()</a> function on <var>query el</var>
	refers to the same <span id="ref-for-target-anchor-element⑨">target anchor element</span>,
	then <var>query el</var> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="snapshotted-scroll-offset">snapshotted scroll offset</dfn>,
	which is a pair of lengths
	representing a vertical and horizontal offset.


    <p>The <a data-link-type="dfn" href="#snapshotted-scroll-offset" id="ref-for-snapshotted-scroll-offset①">snapshotted scroll offset</a>
	is the sum of the offsets from the <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-overflow-3/#initial-scroll-position" id="ref-for-initial-scroll-position">initial scroll position</a>
	of all <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-overflow-3/#scroll-container" id="ref-for-scroll-container②">scroll container</a> ancestors of the <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element①⓪">target anchor element</a>,
	up to but not including <var>query el</var>’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block" id="ref-for-containing-block⑦">containing block</a>.</p>
    <p class="issue" id="issue-5446f06a"><a class="self-link" href="#issue-5446f06a"></a> Define the precise timing of the snapshot:
	updated each frame,
	before style recalc.</p>
   </div>
   <h3 class="heading settled" data-level="2.4" id="determining"><span class="secno">2.4. </span><span class="content">Determining The Anchor: the <a class="property css" data-link-type="property" href="#propdef-anchor-name" id="ref-for-propdef-anchor-name">anchor-name</a> property</span><a class="self-link" href="#determining"></a></h3>
   <table class="def propdef" data-link-for-hint="anchor-name">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-anchor-name">anchor-name</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">none <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one①⑤">|</a> <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident⑦">&lt;dashed-ident></a>
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>none
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td>all elements that generate a <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#principal-box" id="ref-for-principal-box">principal box</a>
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>no
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>n/a
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>as specified
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>discrete
   </table>
   <p>Values are defined as follows:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled css" data-dfn-for="anchor-name" data-dfn-type="value" data-export id="valdef-anchor-name-none">none</dfn>
    <dd data-md>
     <p>The property has no effect.</p>
    <dt data-md><dfn class="dfn-paneled css" data-dfn-for="anchor-name" data-dfn-type="value" data-export id="valdef-anchor-name-dashed-ident"><a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident⑧">&lt;dashed-ident></a></dfn>
    <dd data-md>
     <p>If the element generates a <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#principal-box" id="ref-for-principal-box①">principal box</a>,
the element is an <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-local-lt="anchor" data-noexport id="anchor-element">anchor element</dfn>,
with an <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-noexport id="anchor-name">anchor name</dfn> equal to the <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident⑨">&lt;dashed-ident></a>.
The <a data-link-type="dfn" href="#anchor-name" id="ref-for-anchor-name①">anchor name</a> is a <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-scoping-1/#css-tree-scoped-name" id="ref-for-css-tree-scoped-name">tree-scoped name</a>.</p>
     <p>Otherwise, the property has no effect.</p>
   </dl>
   <p>The <a data-link-type="dfn" href="#anchor-function" id="ref-for-anchor-function">anchor functions</a>
refer to an <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element⑤">anchor element</a> by name.
That name is not necessarily unique on the page, however;
even if it is, the <span id="ref-for-anchor-element⑥">anchor element</span> in question
might not be capable of anchoring the positioned element.</p>
   <div class="algorithm" data-algorithm="target anchor element">
    
	To determine the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="target-anchor-element">target <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element⑦">anchor element</a></dfn>
	given a querying element <var>query el</var>
	and an optional anchor name <var>name</var>:


    <ol>
     <li data-md>
      <p>If <var>name</var> is not provided:</p>
      <ol>
       <li data-md>
        <p>If <var>query el</var> has an <a data-link-type="dfn" href="#implicit-anchor-element" id="ref-for-implicit-anchor-element②">implicit anchor element</a>,
and that element is an <a data-link-type="dfn" href="#acceptable-anchor-element" id="ref-for-acceptable-anchor-element">acceptable anchor element</a> for <var>query el</var>,
return that element.</p>
       <li data-md>
        <p>Otherwise, return nothing.</p>
      </ol>
     <li data-md>
      <p>Otherwise, return the first element <var>el</var> in tree order
that satisfies the following conditions:</p>
      <ul>
       <li data-md>
        <p><var>el</var> is an <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element⑧">anchor element</a> with an <a data-link-type="dfn" href="#anchor-name" id="ref-for-anchor-name②">anchor name</a> of <var>name</var>.</p>
       <li data-md>
        <p><var>el</var>’s <a data-link-type="dfn" href="#anchor-name" id="ref-for-anchor-name③">anchor name</a> and <var>name</var> are both associated with the same <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree" id="ref-for-concept-tree">tree</a> <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree-root" id="ref-for-concept-tree-root">root</a>.</p>
        <p class="note" role="note"><span class="marker">Note:</span> The <a data-link-type="dfn" href="#anchor-name" id="ref-for-anchor-name④">anchor name</a> is a <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-scoping-1/#css-tree-scoped-name" id="ref-for-css-tree-scoped-name①">tree-scoped name</a>,
while <var>name</var> is a <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-scoping-1/#css-tree-scoped-reference" id="ref-for-css-tree-scoped-reference①">tree-scoped reference</a>.</p>
       <li data-md>
        <p><var>el</var> is an <a data-link-type="dfn" href="#acceptable-anchor-element" id="ref-for-acceptable-anchor-element①">acceptable anchor element</a> for <var>query el</var>.</p>
      </ul>
      <p>If no element satisfies these conditions,
return nothing.</p>
    </ol>
    <p class="note" role="note"><span class="marker">Note:</span> The general rule captured by these conditions
	is that <var>el</var> must be fully laid out
	before <var>query el</var> is laid out.
	CSS’s rules about the layout order of stacking contexts
	give us assurances about this,
	and the list of conditions above
	exactly rephrases the stacking context rules
	into just what’s relevant for this purpose,
	ensuring there is no possibly circularity
	in anchor positioning.</p>
    <p class="note" role="note"><span class="marker">Note:</span> An <a class="property css" data-link-type="property" href="#propdef-anchor-name" id="ref-for-propdef-anchor-name①">anchor-name</a> defined by styles in one <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-shadow-tree" id="ref-for-concept-shadow-tree">shadow tree</a>
	won’t be seen by <a data-link-type="dfn" href="#anchor-function" id="ref-for-anchor-function①">anchor functions</a> in styles in a different <span id="ref-for-concept-shadow-tree①">shadow tree</span>,
	preserving encapsulation.
	However, <em>elements</em> in different <span id="ref-for-concept-shadow-tree②">shadow trees</span>
	can still anchor to each other,
	so long as both the <span class="property" id="ref-for-propdef-anchor-name②">anchor-name</span> and <span id="ref-for-anchor-function②">anchor function</span>
	come from styles in the same tree,
	such as by using <a class="css" data-link-type="maybe" href="https://andreubotella.com/csswg-auto-build/test/css-shadow-parts-1/#selectordef-part" id="ref-for-selectordef-part">::part()</a> to style an element inside a shadow.
	(<a data-link-type="dfn" href="#implicit-anchor-element" id="ref-for-implicit-anchor-element③">Implicit anchor elements</a> also aren’t intrinsically limited to a single tree,
	but the details of that will depend on the API assigning them.)</p>
   </div>
   <div class="algorithm" data-algorithm="acceptable anchor element">
    
	An element <var>el</var> is a <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="acceptable-anchor-element">acceptable anchor element</dfn>
	for an <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position" id="ref-for-absolute-position⑦">absolutely positioned</a> element <var>query el</var>
	if all of the following properties apply:


    <ul>
     <li data-md>
      <p>Either <var>el</var> is a descendant of <var>query el</var>’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block" id="ref-for-containing-block⑧">containing block</a>,
or <var>query el</var>’s <span id="ref-for-containing-block⑨">containing block</span> is the <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#initial-containing-block" id="ref-for-initial-containing-block">initial containing block</a>.</p>
     <li data-md>
      <p>If <var>el</var> has the same <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block" id="ref-for-containing-block①⓪">containing block</a> as <var>query el</var>,
<var>el</var> is not <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position" id="ref-for-absolute-position⑧">absolutely positioned</a>.</p>
     <li data-md>
      <p>If <var>el</var> has a different <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block" id="ref-for-containing-block①①">containing block</a> from <var>query el</var>,
the last <span id="ref-for-containing-block①②">containing block</span> in <var>el</var>’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block-chain" id="ref-for-containing-block-chain">containing block chain</a>
before reaching <var>query el</var>’s <span id="ref-for-containing-block①③">containing block</span>
is not <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position" id="ref-for-absolute-position⑨">absolutely positioned</a>.</p>
    </ul>
   </div>
   <p>An element can also have an <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="implicit-anchor-element">implicit anchor element</dfn>,
used when an <a data-link-type="dfn" href="#anchor-function" id="ref-for-anchor-function③">anchor function</a> doesn’t specify an explicit <a data-link-type="dfn" href="#anchor-name" id="ref-for-anchor-name⑤">anchor name</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The Popup API, for example,
defines an <a data-link-type="dfn" href="#implicit-anchor-element" id="ref-for-implicit-anchor-element④">implicit anchor element</a> for a popup—​the element that the popup is attached to.</p>
   <p class="note" role="note"><span class="marker">Note:</span> An element can have only one implicit anchor element.
If we end up with multiple features defining
potentially different <a data-link-type="dfn" href="#implicit-anchor-element" id="ref-for-implicit-anchor-element⑤">implicit anchor elements</a> on the same element,
this specification will define a resolution order.</p>
   <h3 class="heading settled" data-level="2.5" id="queries"><span class="secno">2.5. </span><span class="content">Anchor Queries</span><a class="self-link" href="#queries"></a></h3>
   <p>The <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor①④">anchor()</a> and <a class="css" data-link-type="maybe" href="#funcdef-anchor-size" id="ref-for-funcdef-anchor-size⑤">anchor-size()</a> functions
represent an <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="anchor-query">anchor query</dfn>:
a request for the position of one or more sides
of one or more <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element⑨">anchor elements</a>.</p>
   <p><a data-link-type="dfn" href="#anchor-query" id="ref-for-anchor-query">Anchor queries</a> are <dfn class="dfn-paneled" data-dfn-type="dfn" data-local-lt="invalid|valid" data-lt="valid anchor query|invalid anchor query" data-noexport id="valid-anchor-query">valid</dfn>
only if all of the following conditions are true:</p>
   <ul>
    <li data-md>
     <p>Their function is used on an element that is <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position" id="ref-for-absolute-position①⓪">absolutely-positioned</a>.</p>
    <li data-md>
     <p>If representing an <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor①⑤">anchor()</a> function,
the function is being used in an <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-logical-1/#inset-properties" id="ref-for-inset-properties③">inset property</a>.</p>
    <li data-md>
     <p>If representing an <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor①⑥">anchor()</a> function
and the <a class="production css" data-link-type="type" href="#typedef-anchor-side" id="ref-for-typedef-anchor-side⑥">&lt;anchor-side></a> keyword is a physical keyword,
it’s used in an <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-logical-1/#inset-properties" id="ref-for-inset-properties④">inset property</a> in the corresponding axis.</p>
    <li data-md>
     <p>If representing an <a class="css" data-link-type="maybe" href="#funcdef-anchor-size" id="ref-for-funcdef-anchor-size⑥">anchor-size()</a> function,
the function is being used in a <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-sizing-3/#sizing-property" id="ref-for-sizing-property①">sizing property</a>.</p>
    <li data-md>
     <p>There is a <a data-link-type="dfn" href="#target-anchor-element" id="ref-for-target-anchor-element①①">target anchor element</a>
for the element
and the <a data-link-type="dfn" href="#anchor-name" id="ref-for-anchor-name⑥">anchor name</a> specified in the function.</p>
   </ul>
   <p class="note" role="note"><span class="marker">Note:</span> As specified in the definition of <a class="css" data-link-type="maybe" href="#funcdef-anchor" id="ref-for-funcdef-anchor①⑦">anchor()</a>,
an <a data-link-type="dfn" href="#valid-anchor-query" id="ref-for-valid-anchor-query④">invalid anchor query</a>
causes the function to resolve to its fallback value instead.</p>
   <h2 class="heading settled" data-level="3" id="fallback"><span class="secno">3. </span><span class="content">Fallback Sizing/Positioning</span><a class="self-link" href="#fallback"></a></h2>
   <p>Anchor positioning,
while powerful,
can also be unpredictable.
The <a data-link-type="dfn" href="#anchor-element" id="ref-for-anchor-element①⓪">anchor element</a> might be anywhere on the page,
so positioning an element in any particular fashion
(such as above the anchor, or the right of the anchor)
might result in the positioned element overflowing its <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block" id="ref-for-containing-block①④">containing block</a>
or being positioned partially off screen.</p>
   <p>To ameliorate this, an <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position" id="ref-for-absolute-position①①">absolutely positioned</a> element
can use the <a class="property css" data-link-type="property" href="#propdef-position-fallback" id="ref-for-propdef-position-fallback">position-fallback</a> property
to refer to a <a class="css" data-link-type="maybe" href="#at-ruledef-position-fallback" id="ref-for-at-ruledef-position-fallback">@position-fallback</a> block,
giving a list of possible style rules to try out.
Each is applied to the element, one by one,
and the first that doesn’t cause the element
to overflow its <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block" id="ref-for-containing-block①⑤">containing block</a>
is taken as the winner.</p>
   <h3 class="heading settled" data-level="3.1" id="fallback-property"><span class="secno">3.1. </span><span class="content">The <a class="property css" data-link-type="property" href="#propdef-position-fallback" id="ref-for-propdef-position-fallback①">position-fallback</a> Property</span><a class="self-link" href="#fallback-property"></a></h3>
   <table class="def propdef" data-link-for-hint="position-fallback">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-position-fallback">position-fallback</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">none <a data-link-type="grammar" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one" id="ref-for-comb-one①⑥">|</a> <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident①⓪">&lt;dashed-ident></a>
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>none
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td><a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position" id="ref-for-absolute-position①②">absolutely-positioned</a> elements
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>no
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>n/a
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>as specified
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>discrete
   </table>
   <p>Values have the following meanings:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled css" data-dfn-for="position-fallback" data-dfn-type="value" data-export id="valdef-position-fallback-none">none</dfn>
    <dd data-md>
     <p>The property has no effect;
the element does not use a <a data-link-type="dfn" href="#position-fallback-list" id="ref-for-position-fallback-list">position fallback list</a>.</p>
    <dt data-md><dfn class="dfn-paneled css" data-dfn-for="position-fallback" data-dfn-type="value" data-export id="valdef-position-fallback-dashed-ident"><a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident①①">&lt;dashed-ident></a></dfn>
    <dd data-md>
     <p>If there is a <a class="css" data-link-type="maybe" href="#at-ruledef-position-fallback" id="ref-for-at-ruledef-position-fallback①">@position-fallback</a> rule
with a name matching the specified ident,
then the element uses that <a data-link-type="dfn" href="#position-fallback-list" id="ref-for-position-fallback-list①">position fallback list</a>.</p>
     <p>Otherwise,
this value has no effect.</p>
   </dl>
   <h3 class="heading settled" data-level="3.2" id="fallback-rule"><span class="secno">3.2. </span><span class="content">The <a class="css" data-link-type="maybe" href="#at-ruledef-position-fallback" id="ref-for-at-ruledef-position-fallback②">@position-fallback</a> Rule</span><a class="self-link" href="#fallback-rule"></a></h3>
   <p>The <dfn class="dfn-paneled css" data-dfn-type="at-rule" data-export id="at-ruledef-position-fallback">@position-fallback</dfn> rule
defines a <a data-link-type="dfn" href="#position-fallback-list" id="ref-for-position-fallback-list②">position fallback list</a>
with a given name,
specifying one or more sets of positioning properties
inside of <dfn class="dfn-paneled css" data-dfn-type="at-rule" data-export id="at-ruledef-try">@try</dfn> blocks
that will be applied to an element,
with each successive one serving as fallback
if the previous would cause the element
to partially or fully overflow its <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block" id="ref-for-containing-block①⑥">containing block</a>.</p>
   <p>The grammar of the <a class="css" data-link-type="maybe" href="#at-ruledef-position-fallback" id="ref-for-at-ruledef-position-fallback③">@position-fallback</a> rule is:</p>
<pre class="prod">@position-fallback <a class="production" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident①②">&lt;dashed-ident></a> {
  <a class="production" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-syntax-3/#typedef-rule-list" id="ref-for-typedef-rule-list">&lt;rule-list></a>
}

@try { <a class="production" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-syntax-3/#typedef-declaration-list" id="ref-for-typedef-declaration-list">&lt;declaration-list></a> }
</pre>
   <p>The <a class="css" data-link-type="maybe" href="#at-ruledef-position-fallback" id="ref-for-at-ruledef-position-fallback④">@position-fallback</a> rule only accepts <a class="css" data-link-type="maybe" href="#at-ruledef-try" id="ref-for-at-ruledef-try">@try</a> rules.
The <a class="production css" data-link-type="type" href="https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident" id="ref-for-typedef-dashed-ident①③">&lt;dashed-ident></a> specified in the prelude
is the rule’s name.
If multiple <span class="css" id="ref-for-at-ruledef-position-fallback⑤">@position-fallback</span> rules are declared with the same name,
the last one in document order "wins".</p>
   <p>The <a class="css" data-link-type="maybe" href="#at-ruledef-try" id="ref-for-at-ruledef-try①">@try</a> rule only accepts the following <a data-link-type="dfn" href="https://w3c.github.io/aria/#dfn-property" id="ref-for-dfn-property">properties</a>:</p>
   <ul>
    <li data-md>
     <p><a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-logical-1/#inset-properties" id="ref-for-inset-properties⑤">inset properties</a></p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-sizing-3/#sizing-property" id="ref-for-sizing-property②">sizing properties</a></p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-align-3/#box-alignment-properties" id="ref-for-box-alignment-properties①">box alignment properties</a></p>
   </ul>
   <p class="issue" id="issue-14452576"><a class="self-link" href="#issue-14452576"></a> What exactly are the constraints that determine what’s allowed here?
Current list is based off of what’s reasonable
from Chrome’s experimental impl.
We can make a CQ that keys off of which fallback was used
to allow more general styling,
at least for descendants.</p>
   <p>The <a class="css" data-link-type="maybe" href="#at-ruledef-try" id="ref-for-at-ruledef-try②">@try</a> rules inside a <a class="css" data-link-type="maybe" href="#at-ruledef-position-fallback" id="ref-for-at-ruledef-position-fallback⑥">@position-fallback</a>
specify a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="position-fallback-list">position fallback list</dfn>,
where each entry consists of the properties specified by each <span class="css" id="ref-for-at-ruledef-try③">@try</span>,
in order.</p>
   <p class="issue" id="issue-0dfe4786"><a class="self-link" href="#issue-0dfe4786"></a> If you have a bunch of elements
that all use the same positioning and fallback,
just relative to different anchor elements
(like a bunch of tooltips),
there’s no way to have them share @position-fallback rules;
they each need a unique set.
This sucks!
Should figure out some way to address this.</p>
   <p class="issue" id="issue-5b530169"><a class="self-link" href="#issue-5b530169"></a> Would be useful to be able to detect
when your anchor(s) are fully off-screen
and suppress your display entirely.
For example, tooltips living outside the scroller
holding the text they’re anchored to
don’t want to just hover over arbitrary parts of the page
because their anchor happens to have that position
relative to the scrollport.</p>
   <h3 class="heading settled" data-level="3.3" id="fallback-apply"><span class="secno">3.3. </span><span class="content">Applying Position Fallback</span><a class="self-link" href="#fallback-apply"></a></h3>
   <p>When an element uses a <a data-link-type="dfn" href="#position-fallback-list" id="ref-for-position-fallback-list③">position fallback list</a>,
it selects one entry from the list
as defined below,
and applies those properties to itself as <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-cascade-5/#used-value" id="ref-for-used-value">used values</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> These have to be applied as used values
because we’re in the middle of layout right now;
defining how they’d interact with the cascade
would be extremely confusing *at a minimum*,
and perhaps actually circular.
In any case, not worth the cost in spec or impl.</p>
   <p class="issue" id="issue-0b311ea0"><a class="self-link" href="#issue-0b311ea0"></a> This implies that the values can’t be transitioned in the usual fashion,
since transitions key off of computed values
and we’re past that point.
However, popups sliding between positions is a common effect in UI libs.
Probably should introduce a <span class="css">smooth</span> keyword
to <a class="property css" data-link-type="property" href="#propdef-position-fallback" id="ref-for-propdef-position-fallback②">position-fallback</a>
to trigger automatic "animation" of the fallback’d properties.</p>
   <p>To determine which entry is selected,
<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">iterate</a> over the <a data-link-type="dfn" href="#position-fallback-list" id="ref-for-position-fallback-list④">position fallback list</a>,
applying the properties of each entry in turn
according to the standard cascade rules,
and additionally shifting the element’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-box-4/#margin-box" id="ref-for-margin-box">margin box</a>
according to its <a data-link-type="dfn" href="#snapshotted-scroll-offset" id="ref-for-snapshotted-scroll-offset②">snapshotted scroll offset</a>
(if it has one),
and determining whether or not the element’s <span id="ref-for-margin-box①">margin box</span>
overflows its <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block" id="ref-for-containing-block①⑦">containing block</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Descendants overflowing the anchored block
don’t affect this.</p>
   <p>The properties of the first non-overflowing entry
(or the last attempted entry, if none succeeded),
are taken as the final values for the specified properties.</p>
   <p>Implementations may choose to impose an implementation-defined limit
on the length of <a data-link-type="dfn" href="#position-fallback-list" id="ref-for-position-fallback-list⑤">position fallback lists</a>,
to limit the amount of excess layout work that may be required.
This limit must be <em>at least</em> five.</p>
   <div class="issue" id="issue-52cb8f94">
    <a class="self-link" href="#issue-52cb8f94"></a>
	Nested anchors
	(an anchored element inside of another anchored element)
	present the potential for exponential blow-up of layouts
	when doing fallback,
	since the grandchild anchored element can cause scrollbars on an ancestor,
	changing the IMCB for the child anchored element,
	thus possibly causing the fallback choice to change for it.


    <p>There are strategies to avoid this,
	but they’re not without costs of their own.
	We should <em>probably</em> impose a <strong>maximum</strong> limit as well,
	to avoid this.</p>
    <p>However, since *most* usages won’t be problematic in the first place,
	we don’t want to restrict them unduly
	just to prevent weird situations from exploding.
	Perhaps a complexity budget based on the branching factor at each level?
	Like, accumulate the product of the fallback list lengths from ancestors,
	and your fallback list gets limited to not exceed a total product
	of, say, 1k.
	Get too deep and you’re stuck with your first choice only!
	But this would allow large, complex fallback lists for top-level stuff,
	and even some reasonable nesting.
	(Length-five lists could be nested to depth of 4, for example,
	if we did go with 1k.)</p>
    <p>More thought is needed.</p>
   </div>
   <div class="example" id="example-cd628aaa">
    <a class="self-link" href="#example-cd628aaa"></a>
	For example,
	the following CSS will first attempt to position a "popup"
	below the <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-display-3/#elements" id="ref-for-elements">element</a>,
	but if it doesn’t fit on-screen will switch to being above;
	it defaults to left-aligning,
	but will switch to right-aligning if that doesn’t fit.

	
<pre class="highlight">#myPopup <c- p>{</c->
  <c- k>position</c-><c- p>:</c-> fixed<c- p>;</c->
  <c- k>position-fallback</c-><c- p>:</c-> --button-popup<c- p>;</c->
  <c- k>overflow</c-><c- p>:</c-> auto<c- p>;</c->

  <c- c>/* The popup is at least as wide as the button */</c->
  min-width: <c- nf>anchor-size</c-><c- p>(</c->--button width<c- p>);</c->

  <c- c>/* The popup is at least as tall as 2 menu items */</c->
  min-height: <c- m>6</c-><c- k>em</c-><c- p>;</c->
<c- p>}</c->

<c- n>@position-fallback</c-> --button-popup <c- p>{</c->
  <c- c>/* First try to align the top, left edge of the popup</c->
<c- c>  with the bottom, left edge of the button. */</c->
  <c- n>@try</c-> <c- p>{</c->
    <c- k>top</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--button bottom<c- p>);</c->
    <c- k>left</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--button left<c- p>);</c->
  <c- p>}</c->

  <c- c>/* Next try to align the bottom, left edge of the popup</c->
<c- c>  with the top, left edge of the button. */</c->
  <c- n>@try</c-> <c- p>{</c->
    <c- k>bottom</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--button top<c- p>);</c->
    <c- k>left</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--button left<c- p>);</c->
  <c- p>}</c->

  <c- c>/* Next try to align the top, right edge of the popup</c->
<c- c>  with the bottom, right edge of the button. */</c->
  <c- n>@try</c-> <c- p>{</c->
    <c- k>top</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--button bottom<c- p>);</c->
    <c- k>right</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--button right<c- p>);</c->
  <c- p>}</c->

  <c- c>/* Finally, try to align the bottom, right edge of the popup</c->
<c- c>  with the top, right edge of the button. Other positions are possible,</c->
<c- c>  but this is the final option the author would like the rendering</c->
<c- c>  engine to try. */</c->
  <c- n>@try</c-> <c- p>{</c->
    <c- k>bottom</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--button top<c- p>);</c->
    <c- k>right</c-><c- p>:</c-> <c- nf>anchor</c-><c- p>(</c->--button right<c- p>);</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
   </div>
   <h2 class="heading settled" data-level="4" id="sec"><span class="secno">4. </span><span class="content">Security Considerations</span><a class="self-link" href="#sec"></a></h2>
   <p>Nil.</p>
   <h2 class="heading settled" data-level="5" id="priv"><span class="secno">5. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#priv"></a></h2>
   <p>Nil.</p>
  </main>
  <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">
Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
  <h3 class="no-ref heading settled" id="w3c-conventions"><span class="content">
Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification.

    </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this:

    </p>
  <div class="example" id="w3c-example">
   <a class="self-link" href="#w3c-example"></a>
        
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this:

    </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <p>Advisements are normative sections styled to evoke special attention and are
    set apart from other normative text with <code>&lt;strong class="advisement"></code>, like
    this:

    <strong class="advisement">
        UAs MUST provide an accessible alternative.
    </strong></p>
  <details class="wpt-tests-block" dir="ltr" lang="en" open>
   <summary>Tests</summary>
   <p>Tests relating to the content of this specification
                     may be documented in “Tests” blocks like this one.
                     Any such block is non-normative.</p>
   <ul class="wpt-tests-list"></ul>
   <hr>
  </details>
  <h3 class="no-ref heading settled" id="w3c-conformance-classes"><span class="content">
Conformance classes</span><a class="self-link" href="#w3c-conformance-classes"></a></h3>
  <p>Conformance to this specification
    is defined for three conformance classes:
    </p>
  <dl>
   <dt>style sheet
            
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
            style sheet</a>.
        
   <dt>renderer
            
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
            that interprets the semantics of a style sheet and renders
            documents that use them.
        
   <dt>authoring tool
            
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
            that writes a style sheet.
    
  </dl>
  <p>A style sheet is conformant to this specification
    if all of its statements that use syntax defined in this module are valid
    according to the generic CSS grammar and the individual grammars of each
    feature defined in this module.

    </p>
  <p>A renderer is conformant to this specification
    if, in addition to interpreting the style sheet as defined by the
    appropriate specifications, it supports all the features defined
    by this specification by parsing them correctly
    and rendering the document accordingly. However, the inability of a
    UA to correctly render a document due to limitations of the device
    does not make the UA non-conformant. (For example, a UA is not
    required to render color on a monochrome monitor.)

    </p>
  <p>An authoring tool is conformant to this specification
    if it writes style sheets that are syntactically correct according to the
    generic CSS grammar and the individual grammars of each feature in
    this module, and meet all other conformance requirements of style sheets
    as described in this module.

</p>
  <h3 class="no-ref heading settled" id="w3c-partial"><span class="content">
Partial implementations</span><a class="self-link" href="#w3c-partial"></a></h3>
  <p>So that authors can exploit the forward-compatible parsing rules to
    assign fallback values, CSS renderers <strong>must</strong>
    treat as invalid (and <a href="http://www.w3.org/TR/CSS21/conform.html#ignore">ignore
    as appropriate</a>) any at-rules, properties, property values, keywords,
    and other syntactic constructs for which they have no usable level of
    support. In particular, user agents <strong>must not</strong> selectively
    ignore unsupported component values and honor supported values in a single
    multi-value property declaration: if any value is considered invalid
    (as unsupported values must be), CSS requires that the entire declaration
    be ignored.</p>
  <h4 class="heading settled" id="w3c-conform-future-proofing"><span class="content">
Implementations of Unstable and Proprietary Features</span><a class="self-link" href="#w3c-conform-future-proofing"></a></h4>
  <p>To avoid clashes with future stable CSS features,
        the CSSWG recommends <a href="http://www.w3.org/TR/CSS/#future-proofing">following best practices</a> for the implementation of <a href="http://www.w3.org/TR/CSS/#unstable">unstable</a> features and <a href="http://www.w3.org/TR/CSS/#proprietary-extension">proprietary extensions</a> to CSS.

</p>
  <h3 class="no-ref heading settled" id="w3c-testing"><span class="content">
Non-experimental implementations</span><a class="self-link" href="#w3c-testing"></a></h3>
  <p>Once a specification reaches the Candidate Recommendation stage,
    non-experimental implementations are possible, and implementors should
    release an unprefixed implementation of any CR-level feature they
    can demonstrate to be correctly implemented according to spec.

    </p>
  <p>To establish and maintain the interoperability of CSS across
    implementations, the CSS Working Group requests that non-experimental
    CSS renderers submit an implementation report (and, if necessary, the
    testcases used for that implementation report) to the W3C before
    releasing an unprefixed implementation of any CSS features. Testcases
    submitted to W3C are subject to review and correction by the CSS
    Working Group.

    </p>
  <p>Further information on submitting testcases and implementation reports
    can be found from on the CSS Working Group’s website at
    <a href="http://www.w3.org/Style/CSS/Test/">http://www.w3.org/Style/CSS/Test/</a>.
    Questions should be directed to the
    <a href="http://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a>
    mailing list.</p>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#acceptable-anchor-element">acceptable anchor element</a><span>, in § 2.4</span>
   <li><a href="#anchor-element">anchor</a><span>, in § 2.4</span>
   <li><a href="#funcdef-anchor">anchor()</a><span>, in § 2.1</span>
   <li><a href="#anchor-element">anchor element</a><span>, in § 2.4</span>
   <li><a href="#anchor-function">anchor function</a><span>, in § 2</span>
   <li><a href="#anchor-name">anchor name</a><span>, in § 2.4</span>
   <li><a href="#propdef-anchor-name">anchor-name</a><span>, in § 2.4</span>
   <li><a href="#anchor-query">anchor query</a><span>, in § 2.5</span>
   <li><a href="#propdef-anchor-scroll">anchor-scroll</a><span>, in § 2.3</span>
   <li><a href="#typedef-anchor-side">&lt;anchor-side></a><span>, in § 2.1</span>
   <li><a href="#typedef-anchor-size">&lt;anchor-size></a><span>, in § 2.2</span>
   <li><a href="#funcdef-anchor-size">anchor-size()</a><span>, in § 2.2</span>
   <li><a href="#valdef-anchor-size-block">block</a><span>, in § 2.2</span>
   <li><a href="#valdef-anchor-bottom">bottom</a><span>, in § 2.1</span>
   <li><a href="#valdef-anchor-center">center</a><span>, in § 2.1</span>
   <li>
    &lt;dashed-ident>
    <ul>
     <li><a href="#valdef-anchor-name-dashed-ident">value for anchor-name</a><span>, in § 2.4</span>
     <li><a href="#valdef-anchor-scroll-dashed-ident">value for anchor-scroll</a><span>, in § 2.3</span>
     <li><a href="#valdef-position-fallback-dashed-ident">value for position-fallback</a><span>, in § 3.1</span>
    </ul>
   <li><a href="#valdef-anchor-end">end</a><span>, in § 2.1</span>
   <li><a href="#valdef-anchor-size-height">height</a><span>, in § 2.2</span>
   <li><a href="#valdef-anchor-scroll-implicit">implicit</a><span>, in § 2.3</span>
   <li><a href="#implicit-anchor-element">implicit anchor element</a><span>, in § 2.4</span>
   <li><a href="#valdef-anchor-size-inline">inline</a><span>, in § 2.2</span>
   <li><a href="#valid-anchor-query">invalid</a><span>, in § 2.5</span>
   <li><a href="#valid-anchor-query">invalid anchor query</a><span>, in § 2.5</span>
   <li><a href="#valdef-anchor-left">left</a><span>, in § 2.1</span>
   <li>
    none
    <ul>
     <li><a href="#valdef-anchor-name-none">value for anchor-name</a><span>, in § 2.4</span>
     <li><a href="#valdef-anchor-scroll-none">value for anchor-scroll</a><span>, in § 2.3</span>
     <li><a href="#valdef-position-fallback-none">value for position-fallback</a><span>, in § 3.1</span>
    </ul>
   <li><a href="#at-ruledef-position-fallback">@position-fallback</a><span>, in § 3.2</span>
   <li><a href="#propdef-position-fallback">position-fallback</a><span>, in § 3.1</span>
   <li><a href="#position-fallback-list">position fallback list</a><span>, in § 3.2</span>
   <li><a href="#valdef-anchor-right">right</a><span>, in § 2.1</span>
   <li><a href="#valdef-anchor-size-self-block">self-block</a><span>, in § 2.2</span>
   <li><a href="#valdef-anchor-self-end">self-end</a><span>, in § 2.1</span>
   <li><a href="#valdef-anchor-size-self-inline">self-inline</a><span>, in § 2.2</span>
   <li><a href="#valdef-anchor-self-start">self-start</a><span>, in § 2.1</span>
   <li><a href="#snapshotted-scroll-offset">snapshotted scroll offset</a><span>, in § 2.3</span>
   <li><a href="#valdef-anchor-start">start</a><span>, in § 2.1</span>
   <li><a href="#target-anchor-element">target anchor element</a><span>, in § 2.4</span>
   <li><a href="#valdef-anchor-top">top</a><span>, in § 2.1</span>
   <li><a href="#at-ruledef-try">@try</a><span>, in § 3.2</span>
   <li><a href="#valid-anchor-query">valid</a><span>, in § 2.5</span>
   <li><a href="#valid-anchor-query">valid anchor query</a><span>, in § 2.5</span>
   <li><a href="#valdef-anchor-size-width">width</a><span>, in § 2.2</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSS-ALIGN-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="8166efa4">box alignment properties</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-BOX-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="218b93ec">margin box</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-BREAK-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0023c450">fragment</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-CASCADE-5]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="e2f3965c">used value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-DISPLAY-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="9dd11945">element</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-DISPLAY-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3603ae22">containing block</span>
     <li><span class="dfn-paneled" id="b31fbe80">containing block chain</span>
     <li><span class="dfn-paneled" id="0fd8a325">initial containing block</span>
     <li><span class="dfn-paneled" id="6a70f541">principal box</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-LOGICAL-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="08143767">inset properties</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-OVERFLOW-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="03bc7b51">initial scroll position</span>
     <li><span class="dfn-paneled" id="69547633">scroll container</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-POSITION-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="bbdac8e6">absolute position</span>
     <li><span class="dfn-paneled" id="6c0d6411">absolutely position</span>
     <li><span class="dfn-paneled" id="2be43659">absolutely-positioned</span>
     <li><span class="dfn-paneled" id="713506fd">bottom</span>
     <li><span class="dfn-paneled" id="672afd94">inset-inline-start</span>
     <li><span class="dfn-paneled" id="ada1da57">inset-modified containing block</span>
     <li><span class="dfn-paneled" id="0be384e5">left</span>
     <li><span class="dfn-paneled" id="02ef71c3">right</span>
     <li><span class="dfn-paneled" id="2026220c">top</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-SCOPING-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="6925551f">tree-scoped name</span>
     <li><span class="dfn-paneled" id="96486290">tree-scoped reference</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-SHADOW-PARTS-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="da11c1e3">::part()</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-SIZING-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="5f24cfa0">sizing property</span>
     <li><span class="dfn-paneled" id="e7ddd248">width</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-SYNTAX-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="5fe8efb8">&lt;declaration-list></span>
     <li><span class="dfn-paneled" id="1744dc6c">&lt;rule-list></span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-TRANSFORMS-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="6c64e1d4">translate()</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-VALUES-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3c77fbd0">,</span>
     <li><span class="dfn-paneled" id="33a030d2">&lt;dashed-ident></span>
     <li><span class="dfn-paneled" id="9a017547">&lt;length-percentage></span>
     <li><span class="dfn-paneled" id="af5d24db">&lt;length></span>
     <li><span class="dfn-paneled" id="6041451f">&lt;percentage></span>
     <li><span class="dfn-paneled" id="e5365b83">?</span>
     <li><span class="dfn-paneled" id="e9822553">math function</span>
     <li><span class="dfn-paneled" id="7936a36b">|</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-WRITING-MODES-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="69ec4933">writing mode</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f7960529">root</span>
     <li><span class="dfn-paneled" id="19f9e9df">shadow tree</span>
     <li><span class="dfn-paneled" id="e6cc3311">tree</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="d7d642a2">input</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f02cd417">iterate</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WAI-ARIA-1.2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f1ec7d28">property</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-align-3">[CSS-ALIGN-3]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://andreubotella.com/csswg-auto-build/test/css-align/"><cite>CSS Box Alignment Module Level 3</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/test/css-align/">https://andreubotella.com/csswg-auto-build/test/css-align/</a>
   <dt id="biblio-css-box-4">[CSS-BOX-4]
   <dd>Elika Etemad. <a href="https://andreubotella.com/csswg-auto-build/test/css-box-4/"><cite>CSS Box Model Module Level 4</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/test/css-box-4/">https://andreubotella.com/csswg-auto-build/test/css-box-4/</a>
   <dt id="biblio-css-break-4">[CSS-BREAK-4]
   <dd>Rossen Atanassov; Elika Etemad. <a href="https://andreubotella.com/csswg-auto-build/test/css-break-4/"><cite>CSS Fragmentation Module Level 4</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/test/css-break-4/">https://andreubotella.com/csswg-auto-build/test/css-break-4/</a>
   <dt id="biblio-css-cascade-5">[CSS-CASCADE-5]
   <dd>Elika Etemad; Miriam Suzanne; Tab Atkins Jr.. <a href="https://andreubotella.com/csswg-auto-build/test/css-cascade-5/"><cite>CSS Cascading and Inheritance Level 5</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/test/css-cascade-5/">https://andreubotella.com/csswg-auto-build/test/css-cascade-5/</a>
   <dt id="biblio-css-display-4">[CSS-DISPLAY-4]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://andreubotella.com/csswg-auto-build/test/css-display/"><cite>CSS Display Module Level 4</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/test/css-display/">https://andreubotella.com/csswg-auto-build/test/css-display/</a>
   <dt id="biblio-css-logical-1">[CSS-LOGICAL-1]
   <dd>Rossen Atanassov; Elika Etemad. <a href="https://andreubotella.com/csswg-auto-build/test/css-logical-1/"><cite>CSS Logical Properties and Values Level 1</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/test/css-logical-1/">https://andreubotella.com/csswg-auto-build/test/css-logical-1/</a>
   <dt id="biblio-css-overflow-3">[CSS-OVERFLOW-3]
   <dd>Elika Etemad; Florian Rivoal. <a href="https://andreubotella.com/csswg-auto-build/test/css-overflow-3/"><cite>CSS Overflow Module Level 3</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/test/css-overflow-3/">https://andreubotella.com/csswg-auto-build/test/css-overflow-3/</a>
   <dt id="biblio-css-position-3">[CSS-POSITION-3]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://andreubotella.com/csswg-auto-build/test/css-position-3/"><cite>CSS Positioned Layout Module Level 3</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/test/css-position-3/">https://andreubotella.com/csswg-auto-build/test/css-position-3/</a>
   <dt id="biblio-css-scoping-1">[CSS-SCOPING-1]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://andreubotella.com/csswg-auto-build/test/css-scoping/"><cite>CSS Scoping Module Level 1</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/test/css-scoping/">https://andreubotella.com/csswg-auto-build/test/css-scoping/</a>
   <dt id="biblio-css-sizing-3">[CSS-SIZING-3]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://andreubotella.com/csswg-auto-build/test/css-sizing-3/"><cite>CSS Box Sizing Module Level 3</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/test/css-sizing-3/">https://andreubotella.com/csswg-auto-build/test/css-sizing-3/</a>
   <dt id="biblio-css-syntax-3">[CSS-SYNTAX-3]
   <dd>Tab Atkins Jr.; Simon Sapin. <a href="https://andreubotella.com/csswg-auto-build/test/css-syntax/"><cite>CSS Syntax Module Level 3</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/test/css-syntax/">https://andreubotella.com/csswg-auto-build/test/css-syntax/</a>
   <dt id="biblio-css-transforms-1">[CSS-TRANSFORMS-1]
   <dd>Simon Fraser; et al. <a href="https://andreubotella.com/csswg-auto-build/test/css-transforms/"><cite>CSS Transforms Module Level 1</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/test/css-transforms/">https://andreubotella.com/csswg-auto-build/test/css-transforms/</a>
   <dt id="biblio-css-values-4">[CSS-VALUES-4]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://andreubotella.com/csswg-auto-build/test/css-values-4/"><cite>CSS Values and Units Module Level 4</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/test/css-values-4/">https://andreubotella.com/csswg-auto-build/test/css-values-4/</a>
   <dt id="biblio-css-writing-modes-4">[CSS-WRITING-MODES-4]
   <dd>Elika Etemad; Koji Ishii. <a href="https://andreubotella.com/csswg-auto-build/test/css-writing-modes-4/"><cite>CSS Writing Modes Level 4</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/test/css-writing-modes-4/">https://andreubotella.com/csswg-auto-build/test/css-writing-modes-4/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-wai-aria-12">[WAI-ARIA-1.2]
   <dd>Joanmarie Diggs; et al. <a href="https://w3c.github.io/aria/"><cite>Accessible Rich Internet Applications (WAI-ARIA) 1.2</cite></a>. URL: <a href="https://w3c.github.io/aria/">https://w3c.github.io/aria/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-css-display-3">[CSS-DISPLAY-3]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://andreubotella.com/csswg-auto-build/test/css-display/"><cite>CSS Display Module Level 3</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/test/css-display/">https://andreubotella.com/csswg-auto-build/test/css-display/</a>
   <dt id="biblio-css-shadow-parts-1">[CSS-SHADOW-PARTS-1]
   <dd>Tab Atkins Jr.; Fergal Daly. <a href="https://andreubotella.com/csswg-auto-build/test/css-shadow-parts/"><cite>CSS Shadow Parts</cite></a>. URL: <a href="https://andreubotella.com/csswg-auto-build/test/css-shadow-parts/">https://andreubotella.com/csswg-auto-build/test/css-shadow-parts/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="property-index"><span class="content">Property Index</span><a class="self-link" href="#property-index"></a></h2>
  <div class="big-element-wrapper">
   <table class="index">
    <thead>
     <tr>
      <th scope="col">Name
      <th scope="col">Value
      <th scope="col">Initial
      <th scope="col">Applies to
      <th scope="col">Inh.
      <th scope="col">%ages
      <th scope="col">Anim­ation type
      <th scope="col">Canonical order
      <th scope="col">Com­puted value
    <tbody>
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-anchor-name" id="ref-for-propdef-anchor-name③">anchor-name</a>
      <td>none | &lt;dashed-ident>
      <td>none
      <td>all elements that generate a principal box
      <td>no
      <td>n/a
      <td>discrete
      <td>per grammar
      <td>as specified
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-anchor-scroll" id="ref-for-propdef-anchor-scroll⑤">anchor-scroll</a>
      <td>none | &lt;dashed-ident>
      <td>none
      <td>absolutely-positioned elements
      <td>no
      <td>n/a
      <td>discrete
      <td>per grammar
      <td>as specified
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-position-fallback" id="ref-for-propdef-position-fallback③">position-fallback</a>
      <td>none | &lt;dashed-ident>
      <td>none
      <td>absolutely-positioned elements
      <td>no
      <td>n/a
      <td>discrete
      <td>per grammar
      <td>as specified
   </table>
  </div>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Do we need to refer to the anchor element’s <a data-link-type="dfn" href="https://andreubotella.com/csswg-auto-build/test/css-writing-modes-4/#writing-mode">writing mode</a>?
I think that’s too unpredictable to actually do anything useful.
If you’re specifying your <a class="property css" data-link-type="property" href="https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-inset-inline-start">inset-inline-start</a> property,
you almost certainly want to refer to an anchor edge
relative to your own directions,
not an unpredictable edge based on the anchor. <a class="issue-return" href="#issue-c74bca11" title="Jump to section">↵</a></div>
   <div class="issue"> Do we need to control which box we’re referring to,
so you can align to padding or content edge? <a class="issue-return" href="#issue-3c6fe13f" title="Jump to section">↵</a></div>
   <div class="issue"> Define the precise timing of the snapshot:
	updated each frame,
	before style recalc. <a class="issue-return" href="#issue-5446f06a" title="Jump to section">↵</a></div>
   <div class="issue"> What exactly are the constraints that determine what’s allowed here?
Current list is based off of what’s reasonable
from Chrome’s experimental impl.
We can make a CQ that keys off of which fallback was used
to allow more general styling,
at least for descendants. <a class="issue-return" href="#issue-14452576" title="Jump to section">↵</a></div>
   <div class="issue"> If you have a bunch of elements
that all use the same positioning and fallback,
just relative to different anchor elements
(like a bunch of tooltips),
there’s no way to have them share @position-fallback rules;
they each need a unique set.
This sucks!
Should figure out some way to address this. <a class="issue-return" href="#issue-0dfe4786" title="Jump to section">↵</a></div>
   <div class="issue"> Would be useful to be able to detect
when your anchor(s) are fully off-screen
and suppress your display entirely.
For example, tooltips living outside the scroller
holding the text they’re anchored to
don’t want to just hover over arbitrary parts of the page
because their anchor happens to have that position
relative to the scrollport. <a class="issue-return" href="#issue-5b530169" title="Jump to section">↵</a></div>
   <div class="issue"> This implies that the values can’t be transitioned in the usual fashion,
since transitions key off of computed values
and we’re past that point.
However, popups sliding between positions is a common effect in UI libs.
Probably should introduce a <span class="css">smooth</span> keyword
to <a class="property css" data-link-type="property" href="#propdef-position-fallback">position-fallback</a>
to trigger automatic "animation" of the fallback’d properties. <a class="issue-return" href="#issue-0b311ea0" title="Jump to section">↵</a></div>
   <div class="issue">
    
	Nested anchors
	(an anchored element inside of another anchored element)
	present the potential for exponential blow-up of layouts
	when doing fallback,
	since the grandchild anchored element can cause scrollbars on an ancestor,
	changing the IMCB for the child anchored element,
	thus possibly causing the fallback choice to change for it.


    <p>There are strategies to avoid this,
	but they’re not without costs of their own.
	We should <em>probably</em> impose a <strong>maximum</strong> limit as well,
	to avoid this.</p>
    <p>However, since *most* usages won’t be problematic in the first place,
	we don’t want to restrict them unduly
	just to prevent weird situations from exploding.
	Perhaps a complexity budget based on the branching factor at each level?
	Like, accumulate the product of the fallback list lengths from ancestors,
	and your fallback list gets limited to not exceed a total product
	of, say, 1k.
	Get too deep and you’re stuck with your first choice only!
	But this would allow large, complex fallback lists for top-level stuff,
	and even some reasonable nesting.
	(Length-five lists could be nested to depth of 4, for example,
	if we did go with 1k.)</p>
    <p>More thought is needed.</p>
    
 <a class="issue-return" href="#issue-52cb8f94" title="Jump to section">↵</a>
   </div>
  </div>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"0023c450": {"dfnID":"0023c450","dfnText":"fragment","external":true,"refSections":[{"refs":[{"id":"ref-for-fragment"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-break-4/#fragment"},
"02ef71c3": {"dfnID":"02ef71c3","dfnText":"right","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-right"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-right"},
"03bc7b51": {"dfnID":"03bc7b51","dfnText":"initial scroll position","external":true,"refSections":[{"refs":[{"id":"ref-for-initial-scroll-position"}],"title":"2.3. Taking Scroll Into Account: the anchor-scroll property"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-overflow-3/#initial-scroll-position"},
"08143767": {"dfnID":"08143767","dfnText":"inset properties","external":true,"refSections":[{"refs":[{"id":"ref-for-inset-properties"}],"title":"2. Anchoring"},{"refs":[{"id":"ref-for-inset-properties\u2460"},{"id":"ref-for-inset-properties\u2461"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-inset-properties\u2462"},{"id":"ref-for-inset-properties\u2463"}],"title":"2.5. Anchor Queries"},{"refs":[{"id":"ref-for-inset-properties\u2464"}],"title":"3.2. The @position-fallback Rule"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-logical-1/#inset-properties"},
"0be384e5": {"dfnID":"0be384e5","dfnText":"left","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-left"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-left"},
"0fd8a325": {"dfnID":"0fd8a325","dfnText":"initial containing block","external":true,"refSections":[{"refs":[{"id":"ref-for-initial-containing-block"}],"title":"2.4. Determining The Anchor: the anchor-name property"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-display-4/#initial-containing-block"},
"1744dc6c": {"dfnID":"1744dc6c","dfnText":"<rule-list>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-rule-list"}],"title":"3.2. The @position-fallback Rule"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-syntax-3/#typedef-rule-list"},
"19f9e9df": {"dfnID":"19f9e9df","dfnText":"shadow tree","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-shadow-tree"},{"id":"ref-for-concept-shadow-tree\u2460"},{"id":"ref-for-concept-shadow-tree\u2461"}],"title":"2.4. Determining The Anchor: the anchor-name property"}],"url":"https://dom.spec.whatwg.org/#concept-shadow-tree"},
"2026220c": {"dfnID":"2026220c","dfnText":"top","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-top"},{"id":"ref-for-propdef-top\u2460"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-top"},
"218b93ec": {"dfnID":"218b93ec","dfnText":"margin box","external":true,"refSections":[{"refs":[{"id":"ref-for-margin-box"},{"id":"ref-for-margin-box\u2460"}],"title":"3.3. Applying Position Fallback"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-box-4/#margin-box"},
"2be43659": {"dfnID":"2be43659","dfnText":"absolutely-positioned","external":true,"refSections":[{"refs":[{"id":"ref-for-absolute-position"},{"id":"ref-for-absolute-position\u2460"},{"id":"ref-for-absolute-position\u2461"}],"title":"2. Anchoring"},{"refs":[{"id":"ref-for-absolute-position\u2462"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-absolute-position\u2463"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"},{"refs":[{"id":"ref-for-absolute-position\u2464"},{"id":"ref-for-absolute-position\u2465"}],"title":"2.3. Taking Scroll Into Account: the anchor-scroll property"},{"refs":[{"id":"ref-for-absolute-position\u2466"},{"id":"ref-for-absolute-position\u2467"},{"id":"ref-for-absolute-position\u2468"}],"title":"2.4. Determining The Anchor: the anchor-name property"},{"refs":[{"id":"ref-for-absolute-position\u2460\u24ea"}],"title":"2.5. Anchor Queries"},{"refs":[{"id":"ref-for-absolute-position\u2460\u2460"}],"title":"3. Fallback Sizing/Positioning"},{"refs":[{"id":"ref-for-absolute-position\u2460\u2461"}],"title":"3.1. The position-fallback Property"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position"},
"33a030d2": {"dfnID":"33a030d2","dfnText":"<dashed-ident>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-dashed-ident"},{"id":"ref-for-typedef-dashed-ident\u2460"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-typedef-dashed-ident\u2461"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"},{"refs":[{"id":"ref-for-typedef-dashed-ident\u2462"},{"id":"ref-for-typedef-dashed-ident\u2463"},{"id":"ref-for-typedef-dashed-ident\u2464"},{"id":"ref-for-typedef-dashed-ident\u2465"}],"title":"2.3. Taking Scroll Into Account: the anchor-scroll property"},{"refs":[{"id":"ref-for-typedef-dashed-ident\u2466"},{"id":"ref-for-typedef-dashed-ident\u2467"},{"id":"ref-for-typedef-dashed-ident\u2468"}],"title":"2.4. Determining The Anchor: the anchor-name property"},{"refs":[{"id":"ref-for-typedef-dashed-ident\u2460\u24ea"},{"id":"ref-for-typedef-dashed-ident\u2460\u2460"}],"title":"3.1. The position-fallback Property"},{"refs":[{"id":"ref-for-typedef-dashed-ident\u2460\u2461"},{"id":"ref-for-typedef-dashed-ident\u2460\u2462"}],"title":"3.2. The @position-fallback Rule"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident"},
"3603ae22": {"dfnID":"3603ae22","dfnText":"containing block","external":true,"refSections":[{"refs":[{"id":"ref-for-containing-block"},{"id":"ref-for-containing-block\u2460"}],"title":"2. Anchoring"},{"refs":[{"id":"ref-for-containing-block\u2461"},{"id":"ref-for-containing-block\u2462"},{"id":"ref-for-containing-block\u2463"},{"id":"ref-for-containing-block\u2464"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-containing-block\u2465"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"},{"refs":[{"id":"ref-for-containing-block\u2466"}],"title":"2.3. Taking Scroll Into Account: the anchor-scroll property"},{"refs":[{"id":"ref-for-containing-block\u2467"},{"id":"ref-for-containing-block\u2468"},{"id":"ref-for-containing-block\u2460\u24ea"},{"id":"ref-for-containing-block\u2460\u2460"},{"id":"ref-for-containing-block\u2460\u2461"},{"id":"ref-for-containing-block\u2460\u2462"}],"title":"2.4. Determining The Anchor: the anchor-name property"},{"refs":[{"id":"ref-for-containing-block\u2460\u2463"},{"id":"ref-for-containing-block\u2460\u2464"}],"title":"3. Fallback Sizing/Positioning"},{"refs":[{"id":"ref-for-containing-block\u2460\u2465"}],"title":"3.2. The @position-fallback Rule"},{"refs":[{"id":"ref-for-containing-block\u2460\u2466"}],"title":"3.3. Applying Position Fallback"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block"},
"3c77fbd0": {"dfnID":"3c77fbd0","dfnText":",","external":true,"refSections":[{"refs":[{"id":"ref-for-comb-comma"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-comb-comma\u2460"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-comma"},
"5f24cfa0": {"dfnID":"5f24cfa0","dfnText":"sizing property","external":true,"refSections":[{"refs":[{"id":"ref-for-sizing-property"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"},{"refs":[{"id":"ref-for-sizing-property\u2460"}],"title":"2.5. Anchor Queries"},{"refs":[{"id":"ref-for-sizing-property\u2461"}],"title":"3.2. The @position-fallback Rule"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-sizing-3/#sizing-property"},
"5fe8efb8": {"dfnID":"5fe8efb8","dfnText":"<declaration-list>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-declaration-list"}],"title":"3.2. The @position-fallback Rule"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-syntax-3/#typedef-declaration-list"},
"6041451f": {"dfnID":"6041451f","dfnText":"<percentage>","external":true,"refSections":[{"refs":[{"id":"ref-for-percentage-value"},{"id":"ref-for-percentage-value\u2460"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-values-4/#percentage-value"},
"672afd94": {"dfnID":"672afd94","dfnText":"inset-inline-start","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-inset-inline-start"},{"id":"ref-for-propdef-inset-inline-start\u2460"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-inset-inline-start"},
"6925551f": {"dfnID":"6925551f","dfnText":"tree-scoped name","external":true,"refSections":[{"refs":[{"id":"ref-for-css-tree-scoped-name"},{"id":"ref-for-css-tree-scoped-name\u2460"}],"title":"2.4. Determining The Anchor: the anchor-name property"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-scoping-1/#css-tree-scoped-name"},
"69547633": {"dfnID":"69547633","dfnText":"scroll container","external":true,"refSections":[{"refs":[{"id":"ref-for-scroll-container"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-scroll-container\u2460"},{"id":"ref-for-scroll-container\u2461"}],"title":"2.3. Taking Scroll Into Account: the anchor-scroll property"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-overflow-3/#scroll-container"},
"69ec4933": {"dfnID":"69ec4933","dfnText":"writing mode","external":true,"refSections":[{"refs":[{"id":"ref-for-writing-mode"},{"id":"ref-for-writing-mode\u2460"},{"id":"ref-for-writing-mode\u2461"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-writing-mode\u2462"},{"id":"ref-for-writing-mode\u2463"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-writing-modes-4/#writing-mode"},
"6a70f541": {"dfnID":"6a70f541","dfnText":"principal box","external":true,"refSections":[{"refs":[{"id":"ref-for-principal-box"},{"id":"ref-for-principal-box\u2460"}],"title":"2.4. Determining The Anchor: the anchor-name property"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-display-4/#principal-box"},
"6c0d6411": {"dfnID":"6c0d6411","dfnText":"absolutely position","external":true,"refSections":[{"refs":[{"id":"ref-for-absolute-position"},{"id":"ref-for-absolute-position\u2460"},{"id":"ref-for-absolute-position\u2461"}],"title":"2. Anchoring"},{"refs":[{"id":"ref-for-absolute-position\u2462"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-absolute-position\u2463"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"},{"refs":[{"id":"ref-for-absolute-position\u2464"},{"id":"ref-for-absolute-position\u2465"}],"title":"2.3. Taking Scroll Into Account: the anchor-scroll property"},{"refs":[{"id":"ref-for-absolute-position\u2466"},{"id":"ref-for-absolute-position\u2467"},{"id":"ref-for-absolute-position\u2468"}],"title":"2.4. Determining The Anchor: the anchor-name property"},{"refs":[{"id":"ref-for-absolute-position\u2460\u24ea"}],"title":"2.5. Anchor Queries"},{"refs":[{"id":"ref-for-absolute-position\u2460\u2460"}],"title":"3. Fallback Sizing/Positioning"},{"refs":[{"id":"ref-for-absolute-position\u2460\u2461"}],"title":"3.1. The position-fallback Property"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position"},
"6c64e1d4": {"dfnID":"6c64e1d4","dfnText":"translate()","external":true,"refSections":[{"refs":[{"id":"ref-for-funcdef-transform-translate"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-transforms-1/#funcdef-transform-translate"},
"713506fd": {"dfnID":"713506fd","dfnText":"bottom","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-bottom"},{"id":"ref-for-propdef-bottom\u2460"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-bottom"},
"7936a36b": {"dfnID":"7936a36b","dfnText":"|","external":true,"refSections":[{"refs":[{"id":"ref-for-comb-one"},{"id":"ref-for-comb-one\u2460"},{"id":"ref-for-comb-one\u2461"},{"id":"ref-for-comb-one\u2462"},{"id":"ref-for-comb-one\u2463"},{"id":"ref-for-comb-one\u2464"},{"id":"ref-for-comb-one\u2465"},{"id":"ref-for-comb-one\u2466"},{"id":"ref-for-comb-one\u2467"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-comb-one\u2468"},{"id":"ref-for-comb-one\u2460\u24ea"},{"id":"ref-for-comb-one\u2460\u2460"},{"id":"ref-for-comb-one\u2460\u2461"},{"id":"ref-for-comb-one\u2460\u2462"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"},{"refs":[{"id":"ref-for-comb-one\u2460\u2463"}],"title":"2.3. Taking Scroll Into Account: the anchor-scroll property"},{"refs":[{"id":"ref-for-comb-one\u2460\u2464"}],"title":"2.4. Determining The Anchor: the anchor-name property"},{"refs":[{"id":"ref-for-comb-one\u2460\u2465"}],"title":"3.1. The position-fallback Property"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one"},
"8166efa4": {"dfnID":"8166efa4","dfnText":"box alignment properties","external":true,"refSections":[{"refs":[{"id":"ref-for-box-alignment-properties"}],"title":"2. Anchoring"},{"refs":[{"id":"ref-for-box-alignment-properties\u2460"}],"title":"3.2. The @position-fallback Rule"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-align-3/#box-alignment-properties"},
"96486290": {"dfnID":"96486290","dfnText":"tree-scoped reference","external":true,"refSections":[{"refs":[{"id":"ref-for-css-tree-scoped-reference"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-css-tree-scoped-reference\u2460"}],"title":"2.4. Determining The Anchor: the anchor-name property"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-scoping-1/#css-tree-scoped-reference"},
"9a017547": {"dfnID":"9a017547","dfnText":"<length-percentage>","external":true,"refSections":[{"refs":[{"id":"ref-for-typedef-length-percentage"},{"id":"ref-for-typedef-length-percentage\u2460"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-typedef-length-percentage\u2461"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-length-percentage"},
"9dd11945": {"dfnID":"9dd11945","dfnText":"element","external":true,"refSections":[{"refs":[{"id":"ref-for-elements"}],"title":"3.3. Applying Position Fallback"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-display-3/#elements"},
"acceptable-anchor-element": {"dfnID":"acceptable-anchor-element","dfnText":"acceptable anchor element","external":false,"refSections":[{"refs":[{"id":"ref-for-acceptable-anchor-element"},{"id":"ref-for-acceptable-anchor-element\u2460"}],"title":"2.4. Determining The Anchor: the anchor-name property"}],"url":"#acceptable-anchor-element"},
"ada1da57": {"dfnID":"ada1da57","dfnText":"inset-modified containing block","external":true,"refSections":[{"refs":[{"id":"ref-for-inset-modified-containing-block"},{"id":"ref-for-inset-modified-containing-block\u2460"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-position-3/#inset-modified-containing-block"},
"af5d24db": {"dfnID":"af5d24db","dfnText":"<length>","external":true,"refSections":[{"refs":[{"id":"ref-for-length-value"},{"id":"ref-for-length-value\u2460"},{"id":"ref-for-length-value\u2461"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-length-value\u2462"},{"id":"ref-for-length-value\u2463"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-values-4/#length-value"},
"anchor-element": {"dfnID":"anchor-element","dfnText":"anchor element","external":false,"refSections":[{"refs":[{"id":"ref-for-anchor-element"}],"title":"2. Anchoring"},{"refs":[{"id":"ref-for-anchor-element\u2460"},{"id":"ref-for-anchor-element\u2461"},{"id":"ref-for-anchor-element\u2462"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-anchor-element\u2463"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"},{"refs":[{"id":"ref-for-anchor-element\u2464"},{"id":"ref-for-anchor-element\u2465"},{"id":"ref-for-anchor-element\u2466"},{"id":"ref-for-anchor-element\u2467"}],"title":"2.4. Determining The Anchor: the anchor-name property"},{"refs":[{"id":"ref-for-anchor-element\u2468"}],"title":"2.5. Anchor Queries"},{"refs":[{"id":"ref-for-anchor-element\u2460\u24ea"}],"title":"3. Fallback Sizing/Positioning"}],"url":"#anchor-element"},
"anchor-function": {"dfnID":"anchor-function","dfnText":"anchor functions","external":false,"refSections":[{"refs":[{"id":"ref-for-anchor-function"},{"id":"ref-for-anchor-function\u2460"},{"id":"ref-for-anchor-function\u2461"},{"id":"ref-for-anchor-function\u2462"}],"title":"2.4. Determining The Anchor: the anchor-name property"}],"url":"#anchor-function"},
"anchor-name": {"dfnID":"anchor-name","dfnText":"anchor name","external":false,"refSections":[{"refs":[{"id":"ref-for-anchor-name"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-anchor-name\u2460"},{"id":"ref-for-anchor-name\u2461"},{"id":"ref-for-anchor-name\u2462"},{"id":"ref-for-anchor-name\u2463"},{"id":"ref-for-anchor-name\u2464"}],"title":"2.4. Determining The Anchor: the anchor-name property"},{"refs":[{"id":"ref-for-anchor-name\u2465"}],"title":"2.5. Anchor Queries"}],"url":"#anchor-name"},
"anchor-query": {"dfnID":"anchor-query","dfnText":"anchor query","external":false,"refSections":[{"refs":[{"id":"ref-for-anchor-query"}],"title":"2.5. Anchor Queries"}],"url":"#anchor-query"},
"at-ruledef-position-fallback": {"dfnID":"at-ruledef-position-fallback","dfnText":"@position-fallback","external":false,"refSections":[{"refs":[{"id":"ref-for-at-ruledef-position-fallback"}],"title":"3. Fallback Sizing/Positioning"},{"refs":[{"id":"ref-for-at-ruledef-position-fallback\u2460"}],"title":"3.1. The position-fallback Property"},{"refs":[{"id":"ref-for-at-ruledef-position-fallback\u2461"},{"id":"ref-for-at-ruledef-position-fallback\u2462"},{"id":"ref-for-at-ruledef-position-fallback\u2463"},{"id":"ref-for-at-ruledef-position-fallback\u2464"},{"id":"ref-for-at-ruledef-position-fallback\u2465"}],"title":"3.2. The @position-fallback Rule"}],"url":"#at-ruledef-position-fallback"},
"at-ruledef-try": {"dfnID":"at-ruledef-try","dfnText":"@try","external":false,"refSections":[{"refs":[{"id":"ref-for-at-ruledef-try"},{"id":"ref-for-at-ruledef-try\u2460"},{"id":"ref-for-at-ruledef-try\u2461"},{"id":"ref-for-at-ruledef-try\u2462"}],"title":"3.2. The @position-fallback Rule"}],"url":"#at-ruledef-try"},
"b31fbe80": {"dfnID":"b31fbe80","dfnText":"containing block chain","external":true,"refSections":[{"refs":[{"id":"ref-for-containing-block-chain"}],"title":"2.4. Determining The Anchor: the anchor-name property"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block-chain"},
"bbdac8e6": {"dfnID":"bbdac8e6","dfnText":"absolute position","external":true,"refSections":[{"refs":[{"id":"ref-for-absolute-position"},{"id":"ref-for-absolute-position\u2460"},{"id":"ref-for-absolute-position\u2461"}],"title":"2. Anchoring"},{"refs":[{"id":"ref-for-absolute-position\u2462"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-absolute-position\u2463"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"},{"refs":[{"id":"ref-for-absolute-position\u2464"},{"id":"ref-for-absolute-position\u2465"}],"title":"2.3. Taking Scroll Into Account: the anchor-scroll property"},{"refs":[{"id":"ref-for-absolute-position\u2466"},{"id":"ref-for-absolute-position\u2467"},{"id":"ref-for-absolute-position\u2468"}],"title":"2.4. Determining The Anchor: the anchor-name property"},{"refs":[{"id":"ref-for-absolute-position\u2460\u24ea"}],"title":"2.5. Anchor Queries"},{"refs":[{"id":"ref-for-absolute-position\u2460\u2460"}],"title":"3. Fallback Sizing/Positioning"},{"refs":[{"id":"ref-for-absolute-position\u2460\u2461"}],"title":"3.1. The position-fallback Property"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position"},
"d7d642a2": {"dfnID":"d7d642a2","dfnText":"input","external":true,"refSections":[{"refs":[{"id":"ref-for-the-input-element"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"https://html.spec.whatwg.org/multipage/input.html#the-input-element"},
"da11c1e3": {"dfnID":"da11c1e3","dfnText":"::part()","external":true,"refSections":[{"refs":[{"id":"ref-for-selectordef-part"}],"title":"2.4. Determining The Anchor: the anchor-name property"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-shadow-parts-1/#selectordef-part"},
"e2f3965c": {"dfnID":"e2f3965c","dfnText":"used value","external":true,"refSections":[{"refs":[{"id":"ref-for-used-value"}],"title":"3.3. Applying Position Fallback"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-cascade-5/#used-value"},
"e5365b83": {"dfnID":"e5365b83","dfnText":"?","external":true,"refSections":[{"refs":[{"id":"ref-for-mult-opt"},{"id":"ref-for-mult-opt\u2460"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-mult-opt\u2461"},{"id":"ref-for-mult-opt\u2462"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-values-4/#mult-opt"},
"e6cc3311": {"dfnID":"e6cc3311","dfnText":"tree","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-tree"}],"title":"2.4. Determining The Anchor: the anchor-name property"}],"url":"https://dom.spec.whatwg.org/#concept-tree"},
"e7ddd248": {"dfnID":"e7ddd248","dfnText":"width","external":true,"refSections":[{"refs":[{"id":"ref-for-propdef-width"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-sizing-3/#propdef-width"},
"e9822553": {"dfnID":"e9822553","dfnText":"math function","external":true,"refSections":[{"refs":[{"id":"ref-for-math-function"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"https://andreubotella.com/csswg-auto-build/test/css-values-4/#math-function"},
"f02cd417": {"dfnID":"f02cd417","dfnText":"iterate","external":true,"refSections":[{"refs":[{"id":"ref-for-list-iterate"}],"title":"3.3. Applying Position Fallback"}],"url":"https://infra.spec.whatwg.org/#list-iterate"},
"f1ec7d28": {"dfnID":"f1ec7d28","dfnText":"property","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-property"}],"title":"3.2. The @position-fallback Rule"}],"url":"https://w3c.github.io/aria/#dfn-property"},
"f7960529": {"dfnID":"f7960529","dfnText":"root","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-tree-root"}],"title":"2.4. Determining The Anchor: the anchor-name property"}],"url":"https://dom.spec.whatwg.org/#concept-tree-root"},
"funcdef-anchor": {"dfnID":"funcdef-anchor","dfnText":"anchor()","external":false,"refSections":[{"refs":[{"id":"ref-for-funcdef-anchor"}],"title":"2. Anchoring"},{"refs":[{"id":"ref-for-funcdef-anchor\u2460"},{"id":"ref-for-funcdef-anchor\u2461"},{"id":"ref-for-funcdef-anchor\u2462"},{"id":"ref-for-funcdef-anchor\u2463"},{"id":"ref-for-funcdef-anchor\u2464"},{"id":"ref-for-funcdef-anchor\u2465"},{"id":"ref-for-funcdef-anchor\u2466"},{"id":"ref-for-funcdef-anchor\u2467"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-funcdef-anchor\u2468"},{"id":"ref-for-funcdef-anchor\u2460\u24ea"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"},{"refs":[{"id":"ref-for-funcdef-anchor\u2460\u2460"},{"id":"ref-for-funcdef-anchor\u2460\u2461"},{"id":"ref-for-funcdef-anchor\u2460\u2462"}],"title":"2.3. Taking Scroll Into Account: the anchor-scroll property"},{"refs":[{"id":"ref-for-funcdef-anchor\u2460\u2463"},{"id":"ref-for-funcdef-anchor\u2460\u2464"},{"id":"ref-for-funcdef-anchor\u2460\u2465"},{"id":"ref-for-funcdef-anchor\u2460\u2466"}],"title":"2.5. Anchor Queries"}],"url":"#funcdef-anchor"},
"funcdef-anchor-size": {"dfnID":"funcdef-anchor-size","dfnText":"anchor-size()","external":false,"refSections":[{"refs":[{"id":"ref-for-funcdef-anchor-size"}],"title":"2. Anchoring"},{"refs":[{"id":"ref-for-funcdef-anchor-size\u2460"},{"id":"ref-for-funcdef-anchor-size\u2461"},{"id":"ref-for-funcdef-anchor-size\u2462"},{"id":"ref-for-funcdef-anchor-size\u2463"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"},{"refs":[{"id":"ref-for-funcdef-anchor-size\u2464"},{"id":"ref-for-funcdef-anchor-size\u2465"}],"title":"2.5. Anchor Queries"}],"url":"#funcdef-anchor-size"},
"implicit-anchor-element": {"dfnID":"implicit-anchor-element","dfnText":"implicit anchor element","external":false,"refSections":[{"refs":[{"id":"ref-for-implicit-anchor-element"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-implicit-anchor-element\u2460"}],"title":"2.3. Taking Scroll Into Account: the anchor-scroll property"},{"refs":[{"id":"ref-for-implicit-anchor-element\u2461"},{"id":"ref-for-implicit-anchor-element\u2462"},{"id":"ref-for-implicit-anchor-element\u2463"},{"id":"ref-for-implicit-anchor-element\u2464"}],"title":"2.4. Determining The Anchor: the anchor-name property"}],"url":"#implicit-anchor-element"},
"position-fallback-list": {"dfnID":"position-fallback-list","dfnText":"position fallback list","external":false,"refSections":[{"refs":[{"id":"ref-for-position-fallback-list"},{"id":"ref-for-position-fallback-list\u2460"}],"title":"3.1. The position-fallback Property"},{"refs":[{"id":"ref-for-position-fallback-list\u2461"}],"title":"3.2. The @position-fallback Rule"},{"refs":[{"id":"ref-for-position-fallback-list\u2462"},{"id":"ref-for-position-fallback-list\u2463"},{"id":"ref-for-position-fallback-list\u2464"}],"title":"3.3. Applying Position Fallback"}],"url":"#position-fallback-list"},
"propdef-anchor-name": {"dfnID":"propdef-anchor-name","dfnText":"anchor-name","external":false,"refSections":[{"refs":[{"id":"ref-for-propdef-anchor-name"},{"id":"ref-for-propdef-anchor-name\u2460"},{"id":"ref-for-propdef-anchor-name\u2461"}],"title":"2.4. Determining The Anchor: the anchor-name property"}],"url":"#propdef-anchor-name"},
"propdef-anchor-scroll": {"dfnID":"propdef-anchor-scroll","dfnText":"anchor-scroll","external":false,"refSections":[{"refs":[{"id":"ref-for-propdef-anchor-scroll"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-propdef-anchor-scroll\u2460"},{"id":"ref-for-propdef-anchor-scroll\u2461"},{"id":"ref-for-propdef-anchor-scroll\u2462"},{"id":"ref-for-propdef-anchor-scroll\u2463"}],"title":"2.3. Taking Scroll Into Account: the anchor-scroll property"}],"url":"#propdef-anchor-scroll"},
"propdef-position-fallback": {"dfnID":"propdef-position-fallback","dfnText":"position-fallback","external":false,"refSections":[{"refs":[{"id":"ref-for-propdef-position-fallback"}],"title":"3. Fallback Sizing/Positioning"},{"refs":[{"id":"ref-for-propdef-position-fallback\u2460"}],"title":"3.1. The position-fallback Property"},{"refs":[{"id":"ref-for-propdef-position-fallback\u2461"}],"title":"3.3. Applying Position Fallback"}],"url":"#propdef-position-fallback"},
"snapshotted-scroll-offset": {"dfnID":"snapshotted-scroll-offset","dfnText":"snapshotted scroll offset","external":false,"refSections":[{"refs":[{"id":"ref-for-snapshotted-scroll-offset"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-snapshotted-scroll-offset\u2460"}],"title":"2.3. Taking Scroll Into Account: the anchor-scroll property"},{"refs":[{"id":"ref-for-snapshotted-scroll-offset\u2461"}],"title":"3.3. Applying Position Fallback"}],"url":"#snapshotted-scroll-offset"},
"target-anchor-element": {"dfnID":"target-anchor-element","dfnText":"target anchor element","external":false,"refSections":[{"refs":[{"id":"ref-for-target-anchor-element"},{"id":"ref-for-target-anchor-element\u2460"},{"id":"ref-for-target-anchor-element\u2461"},{"id":"ref-for-target-anchor-element\u2462"},{"id":"ref-for-target-anchor-element\u2463"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-target-anchor-element\u2464"},{"id":"ref-for-target-anchor-element\u2465"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"},{"refs":[{"id":"ref-for-target-anchor-element\u2466"},{"id":"ref-for-target-anchor-element\u2467"},{"id":"ref-for-target-anchor-element\u2468"},{"id":"ref-for-target-anchor-element\u2460\u24ea"}],"title":"2.3. Taking Scroll Into Account: the anchor-scroll property"},{"refs":[{"id":"ref-for-target-anchor-element\u2460\u2460"}],"title":"2.5. Anchor Queries"}],"url":"#target-anchor-element"},
"typedef-anchor-side": {"dfnID":"typedef-anchor-side","dfnText":"<anchor-side>","external":false,"refSections":[{"refs":[{"id":"ref-for-typedef-anchor-side"},{"id":"ref-for-typedef-anchor-side\u2460"},{"id":"ref-for-typedef-anchor-side\u2461"},{"id":"ref-for-typedef-anchor-side\u2462"},{"id":"ref-for-typedef-anchor-side\u2463"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-typedef-anchor-side\u2464"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"},{"refs":[{"id":"ref-for-typedef-anchor-side\u2465"}],"title":"2.5. Anchor Queries"}],"url":"#typedef-anchor-side"},
"typedef-anchor-size": {"dfnID":"typedef-anchor-size","dfnText":"<anchor-size>","external":false,"refSections":[{"refs":[{"id":"ref-for-typedef-anchor-size"},{"id":"ref-for-typedef-anchor-size\u2460"},{"id":"ref-for-typedef-anchor-size\u2461"},{"id":"ref-for-typedef-anchor-size\u2462"},{"id":"ref-for-typedef-anchor-size\u2463"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"}],"url":"#typedef-anchor-size"},
"valdef-anchor-bottom": {"dfnID":"valdef-anchor-bottom","dfnText":"bottom","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-anchor-bottom"},{"id":"ref-for-valdef-anchor-bottom\u2460"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"#valdef-anchor-bottom"},
"valdef-anchor-center": {"dfnID":"valdef-anchor-center","dfnText":"center","external":false,"refSections":[],"url":"#valdef-anchor-center"},
"valdef-anchor-end": {"dfnID":"valdef-anchor-end","dfnText":"end","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-anchor-end"},{"id":"ref-for-valdef-anchor-end\u2460"},{"id":"ref-for-valdef-anchor-end\u2461"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"#valdef-anchor-end"},
"valdef-anchor-left": {"dfnID":"valdef-anchor-left","dfnText":"left","external":false,"refSections":[],"url":"#valdef-anchor-left"},
"valdef-anchor-name-dashed-ident": {"dfnID":"valdef-anchor-name-dashed-ident","dfnText":"<dashed-ident>","external":false,"refSections":[],"url":"#valdef-anchor-name-dashed-ident"},
"valdef-anchor-name-none": {"dfnID":"valdef-anchor-name-none","dfnText":"none","external":false,"refSections":[],"url":"#valdef-anchor-name-none"},
"valdef-anchor-right": {"dfnID":"valdef-anchor-right","dfnText":"right","external":false,"refSections":[],"url":"#valdef-anchor-right"},
"valdef-anchor-scroll-dashed-ident": {"dfnID":"valdef-anchor-scroll-dashed-ident","dfnText":"<dashed-ident>","external":false,"refSections":[],"url":"#valdef-anchor-scroll-dashed-ident"},
"valdef-anchor-scroll-implicit": {"dfnID":"valdef-anchor-scroll-implicit","dfnText":"implicit","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-anchor-scroll-implicit"}],"title":"2.3. Taking Scroll Into Account: the anchor-scroll property"}],"url":"#valdef-anchor-scroll-implicit"},
"valdef-anchor-scroll-none": {"dfnID":"valdef-anchor-scroll-none","dfnText":"none","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-anchor-scroll-none"}],"title":"2.3. Taking Scroll Into Account: the anchor-scroll property"}],"url":"#valdef-anchor-scroll-none"},
"valdef-anchor-self-end": {"dfnID":"valdef-anchor-self-end","dfnText":"self-end","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-anchor-self-end"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"#valdef-anchor-self-end"},
"valdef-anchor-self-start": {"dfnID":"valdef-anchor-self-start","dfnText":"self-start","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-anchor-self-start"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"#valdef-anchor-self-start"},
"valdef-anchor-size-block": {"dfnID":"valdef-anchor-size-block","dfnText":"block","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-anchor-size-block"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"}],"url":"#valdef-anchor-size-block"},
"valdef-anchor-size-height": {"dfnID":"valdef-anchor-size-height","dfnText":"height","external":false,"refSections":[],"url":"#valdef-anchor-size-height"},
"valdef-anchor-size-inline": {"dfnID":"valdef-anchor-size-inline","dfnText":"inline","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-anchor-size-inline"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"}],"url":"#valdef-anchor-size-inline"},
"valdef-anchor-size-self-block": {"dfnID":"valdef-anchor-size-self-block","dfnText":"self-block","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-anchor-size-self-block"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"}],"url":"#valdef-anchor-size-self-block"},
"valdef-anchor-size-self-inline": {"dfnID":"valdef-anchor-size-self-inline","dfnText":"self-inline","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-anchor-size-self-inline"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"}],"url":"#valdef-anchor-size-self-inline"},
"valdef-anchor-size-width": {"dfnID":"valdef-anchor-size-width","dfnText":"width","external":false,"refSections":[],"url":"#valdef-anchor-size-width"},
"valdef-anchor-start": {"dfnID":"valdef-anchor-start","dfnText":"start","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-anchor-start"},{"id":"ref-for-valdef-anchor-start\u2460"},{"id":"ref-for-valdef-anchor-start\u2461"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"#valdef-anchor-start"},
"valdef-anchor-top": {"dfnID":"valdef-anchor-top","dfnText":"top","external":false,"refSections":[{"refs":[{"id":"ref-for-valdef-anchor-top"},{"id":"ref-for-valdef-anchor-top\u2460"}],"title":"2.1. Anchor-based Positioning: the anchor() function"}],"url":"#valdef-anchor-top"},
"valdef-position-fallback-dashed-ident": {"dfnID":"valdef-position-fallback-dashed-ident","dfnText":"<dashed-ident>","external":false,"refSections":[],"url":"#valdef-position-fallback-dashed-ident"},
"valdef-position-fallback-none": {"dfnID":"valdef-position-fallback-none","dfnText":"none","external":false,"refSections":[],"url":"#valdef-position-fallback-none"},
"valid-anchor-query": {"dfnID":"valid-anchor-query","dfnText":"valid","external":false,"refSections":[{"refs":[{"id":"ref-for-valid-anchor-query"},{"id":"ref-for-valid-anchor-query\u2460"},{"id":"ref-for-valid-anchor-query\u2461"}],"title":"2.1. Anchor-based Positioning: the anchor() function"},{"refs":[{"id":"ref-for-valid-anchor-query\u2462"}],"title":"2.2. Anchor-based Sizing: the anchor-size() function"},{"refs":[{"id":"ref-for-valid-anchor-query\u2463"}],"title":"2.5. Anchor Queries"}],"url":"#valid-anchor-query"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-link-titles */
"use strict";
{
let linkTitleData = {
"https://andreubotella.com/csswg-auto-build/test/css-values-4/#length-value": "Expands to: advance measure | cap | ch | cm | dvb | dvh | dvi | dvmax | dvmin | dvw | em | ex | ic | in | lh | lvb | lvh | lvi | lvmax | lvmin | lvw | mm | pc | pt | px | rcap | rch | rem | rex | ric | rlh | svb | svh | svi | svmax | svmin | svw | vb | vh | vi | vmax | vmin | vw",
};

function setTypeTitles() {
	for(let el of document.querySelectorAll("a[href]")) {
		if(el.href in linkTitleData && !el.hasAttribute("title")) {
			el.setAttribute("title", linkTitleData[el.href]);
		}
	}
}

document.addEventListener("DOMContentLoaded", setTypeTitles);
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#acceptable-anchor-element": {"displayText":"acceptable anchor element","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"acceptable anchor element","type":"dfn","url":"#acceptable-anchor-element"},
"#anchor-element": {"displayText":"anchor element","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"anchor element","type":"dfn","url":"#anchor-element"},
"#anchor-function": {"displayText":"anchor function","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"anchor function","type":"dfn","url":"#anchor-function"},
"#anchor-name": {"displayText":"anchor name","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"anchor name","type":"dfn","url":"#anchor-name"},
"#anchor-query": {"displayText":"anchor query","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"anchor query","type":"dfn","url":"#anchor-query"},
"#at-ruledef-position-fallback": {"displayText":"@position-fallback","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"@position-fallback","type":"at-rule","url":"#at-ruledef-position-fallback"},
"#at-ruledef-try": {"displayText":"@try","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"@try","type":"at-rule","url":"#at-ruledef-try"},
"#funcdef-anchor": {"displayText":"anchor()","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"anchor()","type":"function","url":"#funcdef-anchor"},
"#funcdef-anchor-size": {"displayText":"anchor-size()","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"anchor-size()","type":"function","url":"#funcdef-anchor-size"},
"#implicit-anchor-element": {"displayText":"implicit anchor element","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"implicit anchor element","type":"dfn","url":"#implicit-anchor-element"},
"#position-fallback-list": {"displayText":"position fallback list","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"position fallback list","type":"dfn","url":"#position-fallback-list"},
"#propdef-anchor-name": {"displayText":"anchor-name","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"anchor-name","type":"property","url":"#propdef-anchor-name"},
"#propdef-anchor-scroll": {"displayText":"anchor-scroll","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"anchor-scroll","type":"property","url":"#propdef-anchor-scroll"},
"#propdef-position-fallback": {"displayText":"position-fallback","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"position-fallback","type":"property","url":"#propdef-position-fallback"},
"#snapshotted-scroll-offset": {"displayText":"snapshotted scroll offset","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"snapshotted scroll offset","type":"dfn","url":"#snapshotted-scroll-offset"},
"#target-anchor-element": {"displayText":"target anchor element","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"target anchor element","type":"dfn","url":"#target-anchor-element"},
"#typedef-anchor-side": {"displayText":"<anchor-side>","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"<anchor-side>","type":"type","url":"#typedef-anchor-side"},
"#typedef-anchor-size": {"displayText":"<anchor-size>","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"<anchor-size>","type":"type","url":"#typedef-anchor-size"},
"#valdef-anchor-bottom": {"displayText":"bottom","export":true,"for_":["anchor()"],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"bottom","type":"value","url":"#valdef-anchor-bottom"},
"#valdef-anchor-end": {"displayText":"end","export":true,"for_":["anchor()"],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"end","type":"value","url":"#valdef-anchor-end"},
"#valdef-anchor-scroll-implicit": {"displayText":"implicit","export":true,"for_":["anchor-scroll"],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"implicit","type":"value","url":"#valdef-anchor-scroll-implicit"},
"#valdef-anchor-scroll-none": {"displayText":"none","export":true,"for_":["anchor-scroll"],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"none","type":"value","url":"#valdef-anchor-scroll-none"},
"#valdef-anchor-self-end": {"displayText":"self-end","export":true,"for_":["anchor()"],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"self-end","type":"value","url":"#valdef-anchor-self-end"},
"#valdef-anchor-self-start": {"displayText":"self-start","export":true,"for_":["anchor()"],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"self-start","type":"value","url":"#valdef-anchor-self-start"},
"#valdef-anchor-size-block": {"displayText":"block","export":true,"for_":["anchor-size()"],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"block","type":"value","url":"#valdef-anchor-size-block"},
"#valdef-anchor-size-inline": {"displayText":"inline","export":true,"for_":["anchor-size()"],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"inline","type":"value","url":"#valdef-anchor-size-inline"},
"#valdef-anchor-size-self-block": {"displayText":"self-block","export":true,"for_":["anchor-size()"],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"self-block","type":"value","url":"#valdef-anchor-size-self-block"},
"#valdef-anchor-size-self-inline": {"displayText":"self-inline","export":true,"for_":["anchor-size()"],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"self-inline","type":"value","url":"#valdef-anchor-size-self-inline"},
"#valdef-anchor-start": {"displayText":"start","export":true,"for_":["anchor()"],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"start","type":"value","url":"#valdef-anchor-start"},
"#valdef-anchor-top": {"displayText":"top","export":true,"for_":["anchor()"],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"top","type":"value","url":"#valdef-anchor-top"},
"#valid-anchor-query": {"displayText":"invalid anchor query","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-anchor","spec":"css-anchor-1","status":"local","text":"invalid anchor query","type":"dfn","url":"#valid-anchor-query"},
"https://andreubotella.com/csswg-auto-build/test/css-align-3/#box-alignment-properties": {"displayText":"box alignment properties","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-align","spec":"css-align-3","status":"current","text":"box alignment properties","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-align-3/#box-alignment-properties"},
"https://andreubotella.com/csswg-auto-build/test/css-box-4/#margin-box": {"displayText":"margin box","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-box","spec":"css-box-4","status":"current","text":"margin box","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-box-4/#margin-box"},
"https://andreubotella.com/csswg-auto-build/test/css-break-4/#fragment": {"displayText":"fragment","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-break","spec":"css-break-4","status":"current","text":"fragment","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-break-4/#fragment"},
"https://andreubotella.com/csswg-auto-build/test/css-cascade-5/#used-value": {"displayText":"used value","export":true,"for_":[],"level":"5","normative":true,"shortname":"css-cascade","spec":"css-cascade-5","status":"current","text":"used value","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-cascade-5/#used-value"},
"https://andreubotella.com/csswg-auto-build/test/css-display-3/#elements": {"displayText":"element","export":false,"for_":["CSS"],"level":"3","normative":true,"shortname":"css-display","spec":"css-display-3","status":"current","text":"element","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-display-3/#elements"},
"https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block": {"displayText":"containing block","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"containing block","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block"},
"https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block-chain": {"displayText":"containing block chain","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"containing block chain","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-display-4/#containing-block-chain"},
"https://andreubotella.com/csswg-auto-build/test/css-display-4/#initial-containing-block": {"displayText":"initial containing block","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"initial containing block","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-display-4/#initial-containing-block"},
"https://andreubotella.com/csswg-auto-build/test/css-display-4/#principal-box": {"displayText":"principal box","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-display","spec":"css-display-4","status":"current","text":"principal box","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-display-4/#principal-box"},
"https://andreubotella.com/csswg-auto-build/test/css-logical-1/#inset-properties": {"displayText":"inset properties","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-logical","spec":"css-logical-1","status":"current","text":"inset properties","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-logical-1/#inset-properties"},
"https://andreubotella.com/csswg-auto-build/test/css-overflow-3/#initial-scroll-position": {"displayText":"initial scroll position","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-overflow","spec":"css-overflow-3","status":"current","text":"initial scroll position","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-overflow-3/#initial-scroll-position"},
"https://andreubotella.com/csswg-auto-build/test/css-overflow-3/#scroll-container": {"displayText":"scroll container","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-overflow","spec":"css-overflow-3","status":"current","text":"scroll container","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-overflow-3/#scroll-container"},
"https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position": {"displayText":"absolutely position","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-position","spec":"css-position-3","status":"current","text":"absolutely position","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-position-3/#absolute-position"},
"https://andreubotella.com/csswg-auto-build/test/css-position-3/#inset-modified-containing-block": {"displayText":"inset-modified containing block","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-position","spec":"css-position-3","status":"current","text":"inset-modified containing block","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-position-3/#inset-modified-containing-block"},
"https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-bottom": {"displayText":"bottom","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-position","spec":"css-position-3","status":"current","text":"bottom","type":"property","url":"https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-bottom"},
"https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-inset-inline-start": {"displayText":"inset-inline-start","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-position","spec":"css-position-3","status":"current","text":"inset-inline-start","type":"property","url":"https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-inset-inline-start"},
"https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-left": {"displayText":"left","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-position","spec":"css-position-3","status":"current","text":"left","type":"property","url":"https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-left"},
"https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-right": {"displayText":"right","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-position","spec":"css-position-3","status":"current","text":"right","type":"property","url":"https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-right"},
"https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-top": {"displayText":"top","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-position","spec":"css-position-3","status":"current","text":"top","type":"property","url":"https://andreubotella.com/csswg-auto-build/test/css-position-3/#propdef-top"},
"https://andreubotella.com/csswg-auto-build/test/css-scoping-1/#css-tree-scoped-name": {"displayText":"tree-scoped name","export":true,"for_":["CSS"],"level":"1","normative":true,"shortname":"css-scoping","spec":"css-scoping-1","status":"current","text":"tree-scoped name","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-scoping-1/#css-tree-scoped-name"},
"https://andreubotella.com/csswg-auto-build/test/css-scoping-1/#css-tree-scoped-reference": {"displayText":"tree-scoped reference","export":true,"for_":["CSS"],"level":"1","normative":true,"shortname":"css-scoping","spec":"css-scoping-1","status":"current","text":"tree-scoped reference","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-scoping-1/#css-tree-scoped-reference"},
"https://andreubotella.com/csswg-auto-build/test/css-shadow-parts-1/#selectordef-part": {"displayText":"::part()","export":true,"for_":[],"level":"1","normative":true,"shortname":"css-shadow-parts","spec":"css-shadow-parts-1","status":"current","text":"::part()","type":"selector","url":"https://andreubotella.com/csswg-auto-build/test/css-shadow-parts-1/#selectordef-part"},
"https://andreubotella.com/csswg-auto-build/test/css-sizing-3/#propdef-width": {"displayText":"width","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-sizing","spec":"css-sizing-3","status":"current","text":"width","type":"property","url":"https://andreubotella.com/csswg-auto-build/test/css-sizing-3/#propdef-width"},
"https://andreubotella.com/csswg-auto-build/test/css-sizing-3/#sizing-property": {"displayText":"sizing property","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-sizing","spec":"css-sizing-3","status":"current","text":"sizing property","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-sizing-3/#sizing-property"},
"https://andreubotella.com/csswg-auto-build/test/css-syntax-3/#typedef-declaration-list": {"displayText":"<declaration-list>","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-syntax","spec":"css-syntax-3","status":"current","text":"<declaration-list>","type":"type","url":"https://andreubotella.com/csswg-auto-build/test/css-syntax-3/#typedef-declaration-list"},
"https://andreubotella.com/csswg-auto-build/test/css-syntax-3/#typedef-rule-list": {"displayText":"<rule-list>","export":true,"for_":[],"level":"3","normative":true,"shortname":"css-syntax","spec":"css-syntax-3","status":"current","text":"<rule-list>","type":"type","url":"https://andreubotella.com/csswg-auto-build/test/css-syntax-3/#typedef-rule-list"},
"https://andreubotella.com/csswg-auto-build/test/css-transforms-1/#funcdef-transform-translate": {"displayText":"translate()","export":true,"for_":["transform"],"level":"1","normative":true,"shortname":"css-transforms","spec":"css-transforms-1","status":"current","text":"translate()","type":"function","url":"https://andreubotella.com/csswg-auto-build/test/css-transforms-1/#funcdef-transform-translate"},
"https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-comma": {"displayText":",","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":",","type":"grammar","url":"https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-comma"},
"https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one": {"displayText":"|","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"|","type":"grammar","url":"https://andreubotella.com/csswg-auto-build/test/css-values-4/#comb-one"},
"https://andreubotella.com/csswg-auto-build/test/css-values-4/#length-value": {"displayText":"<length>","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"<length>","type":"type","url":"https://andreubotella.com/csswg-auto-build/test/css-values-4/#length-value"},
"https://andreubotella.com/csswg-auto-build/test/css-values-4/#math-function": {"displayText":"math function","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"math function","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-values-4/#math-function"},
"https://andreubotella.com/csswg-auto-build/test/css-values-4/#mult-opt": {"displayText":"?","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"?","type":"grammar","url":"https://andreubotella.com/csswg-auto-build/test/css-values-4/#mult-opt"},
"https://andreubotella.com/csswg-auto-build/test/css-values-4/#percentage-value": {"displayText":"<percentage>","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"<percentage>","type":"type","url":"https://andreubotella.com/csswg-auto-build/test/css-values-4/#percentage-value"},
"https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident": {"displayText":"<dashed-ident>","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"<dashed-ident>","type":"type","url":"https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-dashed-ident"},
"https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-length-percentage": {"displayText":"<length-percentage>","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-values","spec":"css-values-4","status":"current","text":"<length-percentage>","type":"type","url":"https://andreubotella.com/csswg-auto-build/test/css-values-4/#typedef-length-percentage"},
"https://andreubotella.com/csswg-auto-build/test/css-writing-modes-4/#writing-mode": {"displayText":"writing mode","export":true,"for_":[],"level":"4","normative":true,"shortname":"css-writing-modes","spec":"css-writing-modes-4","status":"current","text":"writing mode","type":"dfn","url":"https://andreubotella.com/csswg-auto-build/test/css-writing-modes-4/#writing-mode"},
"https://dom.spec.whatwg.org/#concept-shadow-tree": {"displayText":"shadow tree","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"shadow tree","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-shadow-tree"},
"https://dom.spec.whatwg.org/#concept-tree": {"displayText":"tree","export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"tree","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-tree"},
"https://dom.spec.whatwg.org/#concept-tree-root": {"displayText":"root","export":true,"for_":["tree"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"root","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-tree-root"},
"https://html.spec.whatwg.org/multipage/input.html#the-input-element": {"displayText":"input","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"input","type":"element","url":"https://html.spec.whatwg.org/multipage/input.html#the-input-element"},
"https://infra.spec.whatwg.org/#list-iterate": {"displayText":"iterate","export":true,"for_":["list","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"iterate","type":"dfn","url":"https://infra.spec.whatwg.org/#list-iterate"},
"https://w3c.github.io/aria/#dfn-property": {"displayText":"property","export":true,"for_":["ARIA"],"level":"1","normative":false,"shortname":"wai-aria","spec":"wai-aria-1.2","status":"current","text":"property","type":"dfn","url":"https://w3c.github.io/aria/#dfn-property"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
        // Give the original term if it's being displayed in a different way.
        // But allow casing differences, they're insignificant.
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.displayText)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const refHintKey = link.getAttribute("data-refhint-key");
    let key = url;
    if(refHintKey) {
        key = refHintKey + "_" + url;
    }
    const ref = refsData[key];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>